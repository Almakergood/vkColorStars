var cr={};cr.plugins_={},cr.behaviors={},"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf=function(e){return e.__proto__}),function(){function e(e,t){this.x=e,this.y=t,cr.seal(this)}function t(e,t,r,n){this.set(e,t,r,n),cr.seal(this)}function r(){this.tlx=0,this.tly=0,this.trx=0,this.try_=0,this.brx=0,this.bry=0,this.blx=0,this.bly=0,cr.seal(this)}function n(e,t,r,n){e<t?r<n?(f=e<r?e:r,x=t>n?t:n):(f=e<n?e:n,x=t>r?t:r):r<n?(f=t<r?t:r,x=e>n?e:n):(f=t<n?t:n,x=e>r?e:r)}function o(){this.s=null,this.items=null,this.item_count=0,O&&(this.s=new Set),this.values_cache=[],this.cache_valid=!0,cr.seal(this)}function a(e){A[E++]=e}function i(){this.c=0,this.y=0,this.t=0,this.sum=0,cr.seal(this)}function s(e){this.pts_cache=[],this.bboxLeft=0,this.bboxTop=0,this.bboxRight=0,this.bboxBottom=0,this.convexpolys=null,this.set_pts(e),cr.seal(this)}function l(e,t){this.cellwidth=e,this.cellheight=t,this.cells={}}function p(e,t){this.cellwidth=e,this.cellheight=t,this.cells={}}function d(e,t,r){var n;return l.prototype.totalCellCount++,I.length?(n=I.pop(),n.grid=e,n.x=t,n.y=r,n):new cr.GridCell(e,t,r)}function c(e){l.prototype.totalCellCount--,e.objects.clear(),1e3>I.length&&I.push(e)}function u(e,t,r){this.grid=e,this.x=t,this.y=r,this.objects=new cr.ObjectSet}function g(e,t,r){var n;return p.prototype.totalCellCount++,k.length?(n=k.pop(),n.grid=e,n.x=t,n.y=r,n):new cr.RenderCell(e,t,r)}function m(e){p.prototype.totalCellCount--,e.reset(),1e3>k.length&&k.push(e)}function _(e,t,r){this.grid=e,this.x=t,this.y=r,this.objects=[],this.is_sorted=!0,this.pending_removal=new cr.ObjectSet,this.any_pending_removal=!1}function h(e,t){return e.zindex-t.zindex}cr.logexport=function(e){window.console&&window.console.log&&window.console.log(e)},cr.logerror=function(e){window.console&&window.console.error&&window.console.error(e)},cr.seal=function(e){return e},cr.freeze=function(e){return e},cr.is_undefined=function(e){return"undefined"==typeof e},cr.is_number=function(e){return"number"==typeof e},cr.is_string=function(e){return"string"==typeof e},cr.isPOT=function(e){return 0<e&&0==(e-1&e)},cr.nextHighestPowerOfTwo=function(e){--e;for(var t=1;32>t;t<<=1)e|=e>>t;return e+1},cr.abs=function(e){return 0>e?-e:e},cr.max=function(e,t){return e>t?e:t},cr.min=function(e,t){return e<t?e:t},cr.PI=Math.PI,cr.round=function(e){return 0|e+.5},cr.floor=function(e){return 0<=e?0|e:(0|e)-1},cr.ceil=function(e){var t=0|e;return t===e?t:t+1};e.prototype.offset=function(e,t){return this.x+=e,this.y+=t,this},e.prototype.mul=function(e,t){return this.x*=e,this.y*=t,this},cr.vector2=e,cr.segments_intersect=function(e,t,r,n,o,a,i,s){var l,p,c,u,g,y,m,_;if(e<r?(p=e,l=r):(p=r,l=e),o<i?(y=o,g=i):(y=i,g=o),l<y||p>g)return!1;if(t<n?(u=t,c=n):(u=n,c=t),a<s?(_=a,m=s):(_=s,m=a),c<_||u>m)return!1;var h=o-e+i-r,f=a-t+s-n,b=r-e,x=n-t,v=i-o,w=s-a,S=cr.abs(x*v-w*b);if(cr.abs(v*f-w*h)>S)return!1;return cr.abs(b*f-x*h)<=S};t.prototype.set=function(e,t,r,n){this.left=e,this.top=t,this.right=r,this.bottom=n},t.prototype.copy=function(e){this.left=e.left,this.top=e.top,this.right=e.right,this.bottom=e.bottom},t.prototype.width=function(){return this.right-this.left},t.prototype.height=function(){return this.bottom-this.top},t.prototype.offset=function(e,t){return this.left+=e,this.top+=t,this.right+=e,this.bottom+=t,this},t.prototype.normalize=function(){var e=0;this.left>this.right&&(e=this.left,this.left=this.right,this.right=e),this.top>this.bottom&&(e=this.top,this.top=this.bottom,this.bottom=e)},t.prototype.intersects_rect=function(e){return!(e.right<this.left||e.bottom<this.top||e.left>this.right||e.top>this.bottom)},t.prototype.intersects_rect_off=function(e,t,r){return!(e.right+t<this.left||e.bottom+r<this.top||e.left+t>this.right||e.top+r>this.bottom)},t.prototype.contains_pt=function(e,t){return e>=this.left&&e<=this.right&&t>=this.top&&t<=this.bottom},t.prototype.equals=function(e){return this.left===e.left&&this.top===e.top&&this.right===e.right&&this.bottom===e.bottom},cr.rect=t;r.prototype.set_from_rect=function(e){this.tlx=e.left,this.tly=e.top,this.trx=e.right,this.try_=e.top,this.brx=e.right,this.bry=e.bottom,this.blx=e.left,this.bly=e.bottom},r.prototype.set_from_rotated_rect=function(e,t){if(0===t)this.set_from_rect(e);else{var r=Math.sin(t),n=Math.cos(t),o=e.left*r,a=e.top*r,i=e.right*r,s=e.bottom*r,l=e.left*n,p=e.top*n,d=e.right*n,c=e.bottom*n;this.tlx=l-a,this.tly=p+o,this.trx=d-a,this.try_=p+i,this.brx=d-s,this.bry=c+i,this.blx=l-s,this.bly=c+o}},r.prototype.offset=function(e,t){return this.tlx+=e,this.tly+=t,this.trx+=e,this.try_+=t,this.brx+=e,this.bry+=t,this.blx+=e,this.bly+=t,this};var f=0,x=0;r.prototype.bounding_box=function(e){n(this.tlx,this.trx,this.brx,this.blx),e.left=f,e.right=x,n(this.tly,this.try_,this.bry,this.bly),e.top=f,e.bottom=x},r.prototype.contains_pt=function(e,t){var r=this.tlx,n=this.tly,o=this.trx-r,a=this.try_-n,i=this.brx-r,s=this.bry-n,l=e-r,p=t-n,d=o*o+a*a,c=o*i+a*s,g=o*l+a*p,y=i*i+s*s,m=i*l+s*p,_=1/(d*y-c*c),h=(y*g-c*m)*_,f=(d*m-c*g)*_;if(0<=h&&0<f&&1>h+f)return!0;o=this.blx-r,a=this.bly-n;var d=o*o+a*a,c=o*i+a*s,g=o*l+a*p;return _=1/(d*y-c*c),h=(y*g-c*m)*_,f=(d*m-c*g)*_,0<=h&&0<f&&1>h+f},r.prototype.at=function(e,t){return t?0===e?this.tlx:1===e?this.trx:2===e?this.brx:3===e?this.blx:4===e?this.tlx:this.tlx:0===e?this.tly:1===e?this.try_:2===e?this.bry:3===e?this.bly:4===e?this.tly:this.tly},r.prototype.midX=function(){return(this.tlx+this.trx+this.brx+this.blx)/4},r.prototype.midY=function(){return(this.tly+this.try_+this.bry+this.bly)/4},r.prototype.intersects_segment=function(e,t,r,n){if(this.contains_pt(e,t)||this.contains_pt(r,n))return!0;var o,a,s,l,p;for(p=0;4>p;p++)if(o=this.at(p,!0),a=this.at(p,!1),s=this.at(p+1,!0),l=this.at(p+1,!1),cr.segments_intersect(e,t,r,n,o,a,s,l))return!0;return!1},r.prototype.intersects_quad=function(e){var t=e.midX(),r=e.midY();if(this.contains_pt(t,r))return!0;if(t=this.midX(),r=this.midY(),e.contains_pt(t,r))return!0;var n,o,a,s,l,p,d,c,u,g;for(u=0;4>u;u++)for(g=0;4>g;g++)if(n=this.at(u,!0),o=this.at(u,!1),a=this.at(u+1,!0),s=this.at(u+1,!1),l=e.at(g,!0),p=e.at(g,!1),d=e.at(g+1,!0),c=e.at(g+1,!1),cr.segments_intersect(n,o,a,s,l,p,d,c))return!0;return!1},cr.quad=r,cr.RGB=function(e,t,r){return Math.max(Math.min(e,255),0)|Math.max(Math.min(t,255),0)<<8|Math.max(Math.min(r,255),0)<<16},cr.GetRValue=function(e){return 255&e},cr.GetGValue=function(e){return(65280&e)>>8},cr.GetBValue=function(e){return(16711680&e)>>16},cr.shallowCopy=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},cr.arrayRemove=function(e,t){var r,n;if(t=cr.floor(t),!(0>t||t>=e.length)){for(r=t,n=e.length-1;r<n;r++)e[r]=e[r+1];cr.truncateArray(e,n)}},cr.truncateArray=function(e,t){e.length=t},cr.clearArray=function(e){cr.truncateArray(e,0)},cr.shallowAssignArray=function(e,t){cr.clearArray(e);var r,n;for(r=0,n=t.length;r<n;++r)e[r]=t[r]},cr.appendArray=function(e,t){e.push.apply(e,t)},cr.fastIndexOf=function(e,t){var r,n;for(r=0,n=e.length;r<n;++r)if(e[r]===t)return r;return-1},cr.arrayFindRemove=function(e,t){var r=cr.fastIndexOf(e,t);-1!==r&&cr.arrayRemove(e,r)},cr.clamp=function(e,t,r){return e<t?t:e>r?r:e},cr.to_radians=function(e){return e/(180/cr.PI)},cr.to_degrees=function(e){return e*(180/cr.PI)},cr.clamp_angle_degrees=function(e){return e%=360,0>e&&(e+=360),e},cr.clamp_angle=function(e){return e%=2*cr.PI,0>e&&(e+=2*cr.PI),e},cr.to_clamped_degrees=function(e){return cr.clamp_angle_degrees(cr.to_degrees(e))},cr.to_clamped_radians=function(e){return cr.clamp_angle(cr.to_radians(e))},cr.angleTo=function(e,t,r,n){return Math.atan2(n-t,r-e)},cr.angleDiff=function(e,t){if(e===t)return 0;var r=Math.sin(e),o=Math.cos(e),a=Math.sin(t),i=Math.cos(t),s=r*a+o*i;return 1<=s?0:-1>=s?cr.PI:Math.acos(s)},cr.angleRotate=function(e,t,r){var n=Math.sin(e),o=Math.cos(e),a=Math.sin(t),i=Math.cos(t);return Math.acos(n*a+o*i)>r?0<o*a-n*i?cr.clamp_angle(e+r):cr.clamp_angle(e-r):cr.clamp_angle(t)},cr.angleClockwise=function(e,t){var r=Math.sin(e),n=Math.cos(e),o=Math.sin(t),a=Math.cos(t);return 0>=n*o-r*a},cr.rotatePtAround=function(e,t,r,n,o,a){if(0===r)return a?e:t;var i=Math.sin(r),s=Math.cos(r);e-=n,t-=o;var l=e*i,p=t*i,d=e*s,c=t*s;return e=d-p,t=c+l,e+=n,t+=o,a?e:t},cr.distanceTo=function(e,t,r,n){var o=r-e,a=n-t;return Math.sqrt(o*o+a*a)},cr.xor=function(e,t){return!e!=!t},cr.lerp=function(e,t,r){return e+(t-e)*r},cr.unlerp=function(e,t,r){return e===t?0:(r-e)/(t-e)},cr.anglelerp=function(e,t,r){var n=cr.angleDiff(e,t);return cr.angleClockwise(t,e)?e+n*r:e-n*r},cr.qarp=function(e,t,r,n){return cr.lerp(cr.lerp(e,t,n),cr.lerp(t,r,n),n)},cr.cubic=function(e,t,r,n,o){return cr.lerp(cr.qarp(e,t,r,o),cr.qarp(t,r,n,o),o)},cr.cosp=function(e,t,r){return(e+t+(e-t)*Math.cos(r*Math.PI))/2},cr.hasAnyOwnProperty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!0;return!1},cr.wipe=function(e){for(var t in e)e.hasOwnProperty(t)&&delete e[t]};var v=+new Date;cr.performance_now=function(){if("undefined"!=typeof window.performance){var e=window.performance;if("undefined"!=typeof e.now)return e.now();if("undefined"!=typeof e.webkitNow)return e.webkitNow();if("undefined"!=typeof e.mozNow)return e.mozNow();if("undefined"!=typeof e.msNow)return e.msNow()}return Date.now()-v};var w=!1,S=!1,T=!1,C=!1;"undefined"!=typeof window&&(w=/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent),S=!w&&/safari/i.test(navigator.userAgent),T=/(iphone|ipod|ipad)/i.test(navigator.userAgent),C=window.c2ejecta);var O=!S&&!C&&!T&&"undefined"!=typeof Set&&"undefined"!=typeof Set.prototype.forEach;o.prototype.contains=function(e){return!this.isEmpty()&&(O?this.s.has(e):this.items&&this.items.hasOwnProperty(e))},o.prototype.add=function(e){if(O)this.s.has(e)||(this.s.add(e),this.cache_valid=!1);else{var t=e.toString(),r=this.items;r?!r.hasOwnProperty(t)&&(r[t]=e,this.item_count++,this.cache_valid=!1):(this.items={},this.items[t]=e,this.item_count=1,this.cache_valid=!1)}},o.prototype.remove=function(e){if(!this.isEmpty())if(O)this.s.has(e)&&(this.s["delete"](e),this.cache_valid=!1);else if(this.items){var t=e.toString(),r=this.items;r.hasOwnProperty(t)&&(delete r[t],this.item_count--,this.cache_valid=!1)}},o.prototype.clear=function(){this.isEmpty()||(O?this.s.clear():(this.items=null,this.item_count=0),cr.clearArray(this.values_cache),this.cache_valid=!0)},o.prototype.isEmpty=function(){return 0===this.count()},o.prototype.count=function(){return O?this.s.size:this.item_count};var A=null,E=0;o.prototype.update_cache=function(){if(!this.cache_valid){if(O)cr.clearArray(this.values_cache),A=this.values_cache,E=0,this.s.forEach(a),A=null,E=0;else{var e=this.values_cache;cr.clearArray(e);var t=0,r=this.items,o;if(r)for(o in r)r.hasOwnProperty(o)&&(e[t++]=r[o])}this.cache_valid=!0}},o.prototype.valuesRef=function(){return this.update_cache(),this.values_cache},cr.ObjectSet=o;var P=new cr.ObjectSet;cr.removeArrayDuplicates=function(e){var t,r;for(t=0,r=e.length;t<r;++t)P.add(e[t]);cr.shallowAssignArray(e,P.valuesRef()),P.clear()},cr.arrayRemoveAllFromObjectSet=function(e,t){O?cr.arrayRemoveAll_set(e,t.s):cr.arrayRemoveAll_arr(e,t.valuesRef())},cr.arrayRemoveAll_set=function(e,t){var r,n,o,a;for(r=0,n=0,o=e.length;r<o;++r)a=e[r],t.has(a)||(e[n++]=a);cr.truncateArray(e,n)},cr.arrayRemoveAll_arr=function(e,t){var r,n,o,a;for(r=0,n=0,o=e.length;r<o;++r)a=e[r],-1===cr.fastIndexOf(t,a)&&(e[n++]=a);cr.truncateArray(e,n)};i.prototype.add=function(e){this.y=e-this.c,this.t=this.sum+this.y,this.c=this.t-this.sum-this.y,this.sum=this.t},i.prototype.reset=function(){this.c=0,this.y=0,this.t=0,this.sum=0},cr.KahanAdder=i,cr.regexp_escape=function(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")};s.prototype.set_pts=function(e){this.pts_array=e,this.pts_count=e.length/2,this.pts_cache.length=e.length,this.cache_width=-1,this.cache_height=-1,this.cache_angle=0},s.prototype.is_empty=function(){return!this.pts_array.length},s.prototype.update_bbox=function(){for(var e=this.pts_cache,t=e[0],r=t,n=e[1],o=n,a=1,s=this.pts_count,l,p,d;a<s;++a)d=2*a,l=e[d],p=e[d+1],l<t&&(t=l),l>r&&(r=l),p<n&&(n=p),p>o&&(o=p);this.bboxLeft=t,this.bboxRight=r,this.bboxTop=n,this.bboxBottom=o},s.prototype.set_from_rect=function(e,t,r){this.pts_cache.length=8,this.pts_count=4;var n=this.pts_cache;n[0]=e.left-t,n[1]=e.top-r,n[2]=e.right-t,n[3]=e.top-r,n[4]=e.right-t,n[5]=e.bottom-r,n[6]=e.left-t,n[7]=e.bottom-r,this.cache_width=e.right-e.left,this.cache_height=e.bottom-e.top,this.update_bbox()},s.prototype.set_from_quad=function(e,t,r,n,o){this.pts_cache.length=8,this.pts_count=4;var a=this.pts_cache;a[0]=e.tlx-t,a[1]=e.tly-r,a[2]=e.trx-t,a[3]=e.try_-r,a[4]=e.brx-t,a[5]=e.bry-r,a[6]=e.blx-t,a[7]=e.bly-r,this.cache_width=n,this.cache_height=o,this.update_bbox()},s.prototype.set_from_poly=function(e){this.pts_count=e.pts_count,cr.shallowAssignArray(this.pts_cache,e.pts_cache),this.bboxLeft=e.bboxLeft,this.bboxTop=e.bboxTop,this.bboxRight=e.bboxRight,this.bboxBottom=e.bboxBottom},s.prototype.cache_poly=function(e,t,r){if(this.cache_width!==e||this.cache_height!==t||this.cache_angle!==r){this.cache_width=e,this.cache_height=t,this.cache_angle=r;var n=0,o=1,a=this.pts_array,s=this.pts_cache,l,p,d,c,u,g;for(0!==r&&(n=Math.sin(r),o=Math.cos(r)),l=0,c=this.pts_count;l<c;l++)p=2*l,d=p+1,u=a[p]*e,g=a[d]*t,s[p]=u*o-g*n,s[d]=g*o+u*n;this.update_bbox()}},s.prototype.contains_pt=function(e,t){var r=this.pts_cache;if(e===r[0]&&t===r[1])return!0;var n=this.pts_count,o=this.bboxLeft-110,a=this.bboxTop-101,s=this.bboxRight+131,l=this.bboxBottom+120,p=0,d=0,c,u,g,y,m,_,h;for(c=0;c<n;c++)u=2*c,g=2*((c+1)%n),y=r[u],m=r[u+1],_=r[g],h=r[g+1],cr.segments_intersect(o,a,e,t,y,m,_,h)&&p++,cr.segments_intersect(s,l,e,t,y,m,_,h)&&d++;return 1==p%2||1==d%2},s.prototype.intersects_poly=function(e,t,r){var n=e.pts_cache,o=this.pts_cache;if(this.contains_pt(n[0]+t,n[1]+r))return!0;if(e.contains_pt(o[0]-t,o[1]-r))return!0;var a,s,l,p,d,c,u,g,y,m,_,h,f,b,x,v;for(a=0,p=this.pts_count;a<p;a++)for(s=2*a,l=2*((a+1)%p),y=o[s],m=o[s+1],_=o[l],h=o[l+1],(d=0,g=e.pts_count);d<g;d++)if(c=2*d,u=2*((d+1)%g),f=n[c]+t,b=n[c+1]+r,x=n[u]+t,v=n[u+1]+r,cr.segments_intersect(y,m,_,h,f,b,x,v))return!0;return!1},s.prototype.intersects_segment=function(e,t,r,n,o,a){var s=this.pts_cache;if(this.contains_pt(r-e,n-t))return!0;var l,p,d,c,u,g,y,m;for(l=0,p=this.pts_count;l<p;l++)if(d=2*l,c=2*((l+1)%p),u=s[d]+e,g=s[d+1]+t,y=s[c]+e,m=s[c+1]+t,cr.segments_intersect(r,n,o,a,u,g,y,m))return!0;return!1},s.prototype.mirror=function(e){var t,r,n;for(t=0,r=this.pts_count;t<r;++t)n=2*t,this.pts_cache[n]=2*e-this.pts_cache[n]},s.prototype.flip=function(e){var t,r,n;for(t=0,r=this.pts_count;t<r;++t)n=2*t+1,this.pts_cache[n]=2*e-this.pts_cache[n]},s.prototype.diag=function(){var e,t,r,n,o;for(e=0,t=this.pts_count;e<t;++e)r=2*e,n=r+1,o=this.pts_cache[r],this.pts_cache[r]=this.pts_cache[n],this.pts_cache[n]=o},cr.CollisionPoly=s;l.prototype.totalCellCount=0,l.prototype.getCell=function(e,t,r){var n=this.cells[e],o;return n?(o=n[t],o?o:r?(o=d(this,e,t),this.cells[e][t]=o,o):null):r?(o=d(this,e,t),this.cells[e]={},this.cells[e][t]=o,o):null},l.prototype.XToCell=function(e){return cr.floor(e/this.cellwidth)},l.prototype.YToCell=function(e){return cr.floor(e/this.cellheight)},l.prototype.update=function(e,t,r){var n,o,a,i,s;if(t)for(n=t.left,o=t.right;n<=o;++n)for(a=t.top,i=t.bottom;a<=i;++a)r&&r.contains_pt(n,a)||(s=this.getCell(n,a,!1),s&&(s.remove(e),s.isEmpty()&&(c(s),this.cells[n][a]=null)));if(r)for(n=r.left,o=r.right;n<=o;++n)for(a=r.top,i=r.bottom;a<=i;++a)t&&t.contains_pt(n,a)||this.getCell(n,a,!0).insert(e)},l.prototype.queryRange=function(e,t){var r,n,o,a,i,s;for(r=this.XToCell(e.left),o=this.YToCell(e.top),n=this.XToCell(e.right),i=this.YToCell(e.bottom);r<=n;++r)for(a=o;a<=i;++a)s=this.getCell(r,a,!1),s&&s.dump(t)},cr.SparseGrid=l;p.prototype.totalCellCount=0,p.prototype.getCell=function(e,t,r){var n=this.cells[e],o;return n?(o=n[t],o?o:r?(o=g(this,e,t),this.cells[e][t]=o,o):null):r?(o=g(this,e,t),this.cells[e]={},this.cells[e][t]=o,o):null},p.prototype.XToCell=function(e){return cr.floor(e/this.cellwidth)},p.prototype.YToCell=function(e){return cr.floor(e/this.cellheight)},p.prototype.update=function(e,t,r){var n,o,a,i,s;if(t)for(n=t.left,o=t.right;n<=o;++n)for(a=t.top,i=t.bottom;a<=i;++a)r&&r.contains_pt(n,a)||(s=this.getCell(n,a,!1),s&&(s.remove(e),s.isEmpty()&&(m(s),this.cells[n][a]=null)));if(r)for(n=r.left,o=r.right;n<=o;++n)for(a=r.top,i=r.bottom;a<=i;++a)t&&t.contains_pt(n,a)||this.getCell(n,a,!0).insert(e)},p.prototype.queryRange=function(e,t,r,n,o){var a,i,s,l,p,d;for(a=this.XToCell(e),s=this.YToCell(t),i=this.XToCell(r),p=this.YToCell(n);a<=i;++a)for(l=s;l<=p;++l)d=this.getCell(a,l,!1),d&&d.dump(o)},p.prototype.markRangeChanged=function(e){var t,r,n,o,a,i;for(t=e.left,n=e.top,r=e.right,a=e.bottom;t<=r;++t)for(o=n;o<=a;++o)i=this.getCell(t,o,!1),i&&(i.is_sorted=!1)},cr.RenderGrid=p;var I=[];u.prototype.isEmpty=function(){return this.objects.isEmpty()},u.prototype.insert=function(e){this.objects.add(e)},u.prototype.remove=function(e){this.objects.remove(e)},u.prototype.dump=function(e){cr.appendArray(e,this.objects.valuesRef())},cr.GridCell=u;var k=[];_.prototype.isEmpty=function(){return!this.objects.length||!(this.objects.length>this.pending_removal.count())&&(this.flush_pending(),!0)},_.prototype.insert=function(e){if(this.pending_removal.contains(e))return this.pending_removal.remove(e),void(this.pending_removal.isEmpty()&&(this.any_pending_removal=!1));if(this.objects.length){var t=this.objects[this.objects.length-1];t.get_zindex()>e.get_zindex()&&(this.is_sorted=!1),this.objects.push(e)}else this.objects.push(e),this.is_sorted=!0},_.prototype.remove=function(e){this.pending_removal.add(e),this.any_pending_removal=!0,30<=this.pending_removal.count()&&this.flush_pending()},_.prototype.flush_pending=function(){return this.any_pending_removal?this.pending_removal.count()===this.objects.length?void this.reset():void(cr.arrayRemoveAllFromObjectSet(this.objects,this.pending_removal),this.pending_removal.clear(),this.any_pending_removal=!1):void 0};_.prototype.ensure_sorted=function(){this.is_sorted||(this.objects.sort(h),this.is_sorted=!0)},_.prototype.reset=function(){cr.clearArray(this.objects),this.is_sorted=!0,this.pending_removal.clear(),this.any_pending_removal=!1},_.prototype.dump=function(e){this.flush_pending(),this.ensure_sorted(),this.objects.length&&e.push(this.objects)},cr.RenderCell=_;var L=["lighter","xor","copy","destination-over","source-in","destination-in","source-out","destination-out","source-atop","destination-atop"];cr.effectToCompositeOp=function(e){return 0>=e||11<=e?"source-over":L[e-1]},cr.setGLBlend=function(e,t,r){if(r)switch(e.srcBlend=r.ONE,e.destBlend=r.ONE_MINUS_SRC_ALPHA,t){case 1:e.srcBlend=r.ONE,e.destBlend=r.ONE;break;case 2:break;case 3:e.srcBlend=r.ONE,e.destBlend=r.ZERO;break;case 4:e.srcBlend=r.ONE_MINUS_DST_ALPHA,e.destBlend=r.ONE;break;case 5:e.srcBlend=r.DST_ALPHA,e.destBlend=r.ZERO;break;case 6:e.srcBlend=r.ZERO,e.destBlend=r.SRC_ALPHA;break;case 7:e.srcBlend=r.ONE_MINUS_DST_ALPHA,e.destBlend=r.ZERO;break;case 8:e.srcBlend=r.ZERO,e.destBlend=r.ONE_MINUS_SRC_ALPHA;break;case 9:e.srcBlend=r.DST_ALPHA,e.destBlend=r.ONE_MINUS_SRC_ALPHA;break;case 10:e.srcBlend=r.ONE_MINUS_DST_ALPHA,e.destBlend=r.SRC_ALPHA;}},cr.round6dp=function(e){return Math.round(1e6*e)/1e6},cr.equals_nocase=function(e,t){return"string"==typeof e&&"string"==typeof t&&!(e.length!==t.length)&&(!(e!==t)||e.toLowerCase()===t.toLowerCase())},cr.isCanvasInputEvent=function(t){var e=t.target;return!e||!(e!==document&&e!==window)||!!(document&&document.body&&e===document.body)||!!cr.equals_nocase(e.tagName,"canvas")}}();var MatrixArray="undefined"==typeof Float32Array?Array:Float32Array,glMatrixArrayType=MatrixArray,vec3={},mat3={},mat4={},quat4={};vec3.create=function(e){var t=new MatrixArray(3);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2]),t},vec3.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},vec3.add=function(e,t,r){return r&&e!==r?(r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r):(e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e)},vec3.subtract=function(e,t,r){return r&&e!==r?(r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r):(e[0]-=t[0],e[1]-=t[1],e[2]-=t[2],e)},vec3.negate=function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},vec3.scale=function(e,t,r){return r&&e!==r?(r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r):(e[0]*=t,e[1]*=t,e[2]*=t,e)},vec3.normalize=function(t,r){r||(r=t);var n=t[0],o=t[1],a=t[2],e=Math.sqrt(n*n+o*o+a*a);if(!e)return r[0]=0,r[1]=0,r[2]=0,r;return 1===e?(r[0]=n,r[1]=o,r[2]=a,r):(e=1/e,r[0]=n*e,r[1]=o*e,r[2]=a*e,r)},vec3.cross=function(t,r,n){n||(n=t);var o=t[0],i=t[1],t=t[2],e=r[0],s=r[1],r=r[2];return n[0]=i*r-t*s,n[1]=t*e-o*r,n[2]=o*s-i*e,n},vec3.length=function(e){var t=e[0],r=e[1],e=e[2];return Math.sqrt(t*t+r*r+e*e)},vec3.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},vec3.direction=function(t,r,n){n||(n=t);var o=t[0]-r[0],i=t[1]-r[1],t=t[2]-r[2],r=Math.sqrt(o*o+i*i+t*t);return r?(r=1/r,n[0]=o*r,n[1]=i*r,n[2]=t*r,n):(n[0]=0,n[1]=0,n[2]=0,n)},vec3.lerp=function(e,t,r,n){return n||(n=e),n[0]=e[0]+r*(t[0]-e[0]),n[1]=e[1]+r*(t[1]-e[1]),n[2]=e[2]+r*(t[2]-e[2]),n},vec3.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+"]"},mat3.create=function(e){var t=new MatrixArray(9);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8]),t},mat3.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},mat3.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},mat3.transpose=function(t,r){if(!r||t===r){var n=t[1],o=t[2],a=t[5];return t[1]=t[3],t[2]=t[6],t[3]=n,t[5]=t[7],t[6]=o,t[7]=a,t}return r[0]=t[0],r[1]=t[3],r[2]=t[6],r[3]=t[1],r[4]=t[4],r[5]=t[7],r[6]=t[2],r[7]=t[5],r[8]=t[8],r},mat3.toMat4=function(e,t){return t||(t=mat4.create()),t[15]=1,t[14]=0,t[13]=0,t[12]=0,t[11]=0,t[10]=e[8],t[9]=e[7],t[8]=e[6],t[7]=0,t[6]=e[5],t[5]=e[4],t[4]=e[3],t[3]=0,t[2]=e[2],t[1]=e[1],t[0]=e[0],t},mat3.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+"]"},mat4.create=function(e){var t=new MatrixArray(16);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t},mat4.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},mat4.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4.transpose=function(t,r){if(!r||t===r){var n=t[1],o=t[2],a=t[3],e=t[6],i=t[7],s=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=n,t[6]=t[9],t[7]=t[13],t[8]=o,t[9]=e,t[11]=t[14],t[12]=a,t[13]=i,t[14]=s,t}return r[0]=t[0],r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=t[1],r[5]=t[5],r[6]=t[9],r[7]=t[13],r[8]=t[2],r[9]=t[6],r[10]=t[10],r[11]=t[14],r[12]=t[3],r[13]=t[7],r[14]=t[11],r[15]=t[15],r},mat4.determinant=function(t){var r=t[0],s=t[1],c=t[2],d=t[3],e=t[4],u=t[5],g=t[6],y=t[7],i=t[8],_=t[9],h=t[10],l=t[11],n=t[12],o=t[13],m=t[14],t=t[15];return n*_*g*d-i*o*g*d-n*u*h*d+e*o*h*d+i*u*m*d-e*_*m*d-n*_*c*y+i*o*c*y+n*s*h*y-r*o*h*y-i*s*m*y+r*_*m*y+n*u*c*l-e*o*c*l-n*s*g*l+r*o*g*l+e*s*m*l-r*u*m*l-i*u*c*t+e*_*c*t+i*s*g*t-r*_*g*t-e*s*h*t+r*u*h*t},mat4.inverse=function(_,a){a||(a=_);var S=_[0],c=_[1],d=_[2],e=_[3],g=_[4],f=_[5],h=_[6],i=_[7],T=_[8],O=_[9],l=_[10],n=_[11],o=_[12],m=_[13],p=_[14],r=_[15],s=S*f-c*g,A=S*h-d*g,P=S*i-e*g,t=c*h-d*f,u=c*i-e*f,v=d*i-e*h,w=T*m-O*o,x=T*p-l*o,y=T*r-n*o,I=O*p-l*m,C=O*r-n*m,k=l*r-n*p,E=1/(s*k-A*C+P*I+t*y-u*x+v*w);return a[0]=(f*k-h*C+i*I)*E,a[1]=(-c*k+d*C-e*I)*E,a[2]=(m*v-p*u+r*t)*E,a[3]=(-O*v+l*u-n*t)*E,a[4]=(-g*k+h*y-i*x)*E,a[5]=(S*k-d*y+e*x)*E,a[6]=(-o*v+p*P-r*A)*E,a[7]=(T*v-l*P+n*A)*E,a[8]=(g*C-f*y+i*w)*E,a[9]=(-S*C+c*y-e*w)*E,a[10]=(o*u-m*P+r*s)*E,a[11]=(-T*u+O*P-n*s)*E,a[12]=(-g*I+f*x-h*w)*E,a[13]=(S*I-c*x+d*w)*E,a[14]=(-o*t+m*A-p*s)*E,a[15]=(T*t-O*A+l*s)*E,a},mat4.toRotationMat=function(e,t){return t||(t=mat4.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4.toMat3=function(e,t){return t||(t=mat3.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},mat4.toInverseMat3=function(t,r){var a=t[0],s=t[1],p=t[2],e=t[4],d=t[5],c=t[6],u=t[8],i=t[9],g=t[10],y=g*d-c*i,l=-g*e+c*u,n=i*e-d*u,o=a*y+s*l+p*n;return o?(o=1/o,r||(r=mat3.create()),r[0]=y*o,r[1]=(-g*s+p*i)*o,r[2]=(c*s-p*d)*o,r[3]=l*o,r[4]=(g*a-p*u)*o,r[5]=(-c*a+p*e)*o,r[6]=n*o,r[7]=(-i*a+s*u)*o,r[8]=(d*a-s*e)*o,r):null},mat4.multiply=function(_,S,T){T||(T=_);var O=_[0],d=_[1],e=_[2],g=_[3],f=_[4],h=_[5],i=_[6],P=_[7],I=_[8],l=_[9],n=_[10],o=_[11],m=_[12],p=_[13],r=_[14],_=_[15],s=S[0],A=S[1],k=S[2],t=S[3],u=S[4],v=S[5],w=S[6],x=S[7],y=S[8],L=S[9],C=S[10],R=S[11],E=S[12],B=S[13],F=S[14],S=S[15];return T[0]=s*O+A*f+k*I+t*m,T[1]=s*d+A*h+k*l+t*p,T[2]=s*e+A*i+k*n+t*r,T[3]=s*g+A*P+k*o+t*_,T[4]=u*O+v*f+w*I+x*m,T[5]=u*d+v*h+w*l+x*p,T[6]=u*e+v*i+w*n+x*r,T[7]=u*g+v*P+w*o+x*_,T[8]=y*O+L*f+C*I+R*m,T[9]=y*d+L*h+C*l+R*p,T[10]=y*e+L*i+C*n+R*r,T[11]=y*g+L*P+C*o+R*_,T[12]=E*O+B*f+F*I+S*m,T[13]=E*d+B*h+F*l+S*p,T[14]=E*e+B*i+F*n+S*r,T[15]=E*g+B*P+F*o+S*_,T},mat4.multiplyVec3=function(t,r,n){n||(n=r);var o=r[0],a=r[1],r=r[2];return n[0]=t[0]*o+t[4]*a+t[8]*r+t[12],n[1]=t[1]*o+t[5]*a+t[9]*r+t[13],n[2]=t[2]*o+t[6]*a+t[10]*r+t[14],n},mat4.multiplyVec4=function(t,r,n){n||(n=r);var o=r[0],a=r[1],e=r[2],r=r[3];return n[0]=t[0]*o+t[4]*a+t[8]*e+t[12]*r,n[1]=t[1]*o+t[5]*a+t[9]*e+t[13]*r,n[2]=t[2]*o+t[6]*a+t[10]*e+t[14]*r,n[3]=t[3]*o+t[7]*a+t[11]*e+t[15]*r,n},mat4.translate=function(t,a,s){var c=a[0],d=a[1],a=a[2],e,u,y,_,x,v,w,S,T,C,O,A;return s&&t!==s?(e=t[0],u=t[1],y=t[2],_=t[3],x=t[4],v=t[5],w=t[6],S=t[7],T=t[8],C=t[9],O=t[10],A=t[11],s[0]=e,s[1]=u,s[2]=y,s[3]=_,s[4]=x,s[5]=v,s[6]=w,s[7]=S,s[8]=T,s[9]=C,s[10]=O,s[11]=A,s[12]=e*c+x*d+T*a+t[12],s[13]=u*c+v*d+C*a+t[13],s[14]=y*c+w*d+O*a+t[14],s[15]=_*c+S*d+A*a+t[15],s):(t[12]=t[0]*c+t[4]*d+t[8]*a+t[12],t[13]=t[1]*c+t[5]*d+t[9]*a+t[13],t[14]=t[2]*c+t[6]*d+t[10]*a+t[14],t[15]=t[3]*c+t[7]*d+t[11]*a+t[15],t)},mat4.scale=function(t,r,n){var o=r[0],a=r[1],r=r[2];return n&&t!==n?(n[0]=t[0]*o,n[1]=t[1]*o,n[2]=t[2]*o,n[3]=t[3]*o,n[4]=t[4]*a,n[5]=t[5]*a,n[6]=t[6]*a,n[7]=t[7]*a,n[8]=t[8]*r,n[9]=t[9]*r,n[10]=t[10]*r,n[11]=t[11]*r,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n):(t[0]*=o,t[1]*=o,t[2]*=o,t[3]*=o,t[4]*=a,t[5]*=a,t[6]*=a,t[7]*=a,t[8]*=r,t[9]*=r,t[10]*=r,t[11]*=r,t)},mat4.rotate=function(_,a,S,T){var C=S[0],O=S[1],S=S[2],E=Math.sqrt(C*C+O*O+S*S),P,I,L,R,F,N,D,M,W,V,G,U,X,H,q,Y,K,J,Z,Q;return E?(1!==E&&(E=1/E,C*=E,O*=E,S*=E),P=Math.sin(a),I=Math.cos(a),L=1-I,a=_[0],E=_[1],R=_[2],F=_[3],N=_[4],D=_[5],M=_[6],W=_[7],V=_[8],G=_[9],U=_[10],X=_[11],H=C*C*L+I,q=O*C*L+S*P,Y=S*C*L-O*P,K=C*O*L-S*P,J=O*O*L+I,Z=S*O*L+C*P,Q=C*S*L+O*P,C=O*S*L-C*P,O=S*S*L+I,T?_!==T&&(T[12]=_[12],T[13]=_[13],T[14]=_[14],T[15]=_[15]):T=_,T[0]=a*H+N*q+V*Y,T[1]=E*H+D*q+G*Y,T[2]=R*H+M*q+U*Y,T[3]=F*H+W*q+X*Y,T[4]=a*K+N*J+V*Z,T[5]=E*K+D*J+G*Z,T[6]=R*K+M*J+U*Z,T[7]=F*K+W*J+X*Z,T[8]=a*Q+N*C+V*O,T[9]=E*Q+D*C+G*O,T[10]=R*Q+M*C+U*O,T[11]=F*Q+W*C+X*O,T):null},mat4.rotateX=function(t,r,n){var o=Math.sin(r),r=Math.cos(r),a=t[4],e=t[5],s=t[6],p=t[7],d=t[8],i=t[9],u=t[10],g=t[11];return n?t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[4]=a*r+d*o,n[5]=e*r+i*o,n[6]=s*r+u*o,n[7]=p*r+g*o,n[8]=a*-o+d*r,n[9]=e*-o+i*r,n[10]=s*-o+u*r,n[11]=p*-o+g*r,n},mat4.rotateY=function(t,r,n){var o=Math.sin(r),r=Math.cos(r),a=t[0],e=t[1],s=t[2],p=t[3],d=t[8],i=t[9],u=t[10],g=t[11];return n?t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[0]=a*r+d*-o,n[1]=e*r+i*-o,n[2]=s*r+u*-o,n[3]=p*r+g*-o,n[8]=a*o+d*r,n[9]=e*o+i*r,n[10]=s*o+u*r,n[11]=p*o+g*r,n},mat4.rotateZ=function(t,r,n){var o=Math.sin(r),r=Math.cos(r),a=t[0],e=t[1],s=t[2],p=t[3],d=t[4],i=t[5],u=t[6],g=t[7];return n?t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[0]=a*r+d*o,n[1]=e*r+i*o,n[2]=s*r+u*o,n[3]=p*r+g*o,n[4]=a*-o+d*r,n[5]=e*-o+i*r,n[6]=s*-o+u*r,n[7]=p*-o+g*r,n},mat4.frustum=function(t,r,n,o,a,e,s){s||(s=mat4.create());var l=r-t,p=o-n,i=e-a;return s[0]=2*a/l,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2*a/p,s[6]=0,s[7]=0,s[8]=(r+t)/l,s[9]=(o+n)/p,s[10]=-(e+a)/i,s[11]=-1,s[12]=0,s[13]=0,s[14]=-(2*(e*a))/i,s[15]=0,s},mat4.perspective=function(t,r,n,o,i){return t=n*Math.tan(t*Math.PI/360),r*=t,mat4.frustum(-r,r,-t,t,n,o,i)},mat4.ortho=function(t,r,n,o,a,e,s){s||(s=mat4.create());var l=r-t,p=o-n,i=e-a;return s[0]=2/l,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=2/p,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=-2/i,s[11]=0,s[12]=-(t+r)/l,s[13]=-(o+n)/p,s[14]=-(e+a)/i,s[15]=1,s},mat4.lookAt=function(t,r,s,p){p||(p=mat4.create());var u=t[0],n=t[1],t=t[2],o,y,m,_,x,v,w,S;return(y=s[0],m=s[1],o=s[2],s=r[1],v=r[2],u===r[0]&&n===s&&t===v)?mat4.identity(p):(s=u-r[0],v=n-r[1],w=t-r[2],S=1/Math.sqrt(s*s+v*v+w*w),s*=S,v*=S,w*=S,r=m*w-o*v,o=o*s-y*w,y=y*v-m*s,(S=Math.sqrt(r*r+o*o+y*y))?(S=1/S,r*=S,o*=S,y*=S):y=o=r=0,m=v*y-w*o,_=w*r-s*y,x=s*o-v*r,(S=Math.sqrt(m*m+_*_+x*x))?(S=1/S,m*=S,_*=S,x*=S):x=_=m=0,p[0]=r,p[1]=m,p[2]=s,p[3]=0,p[4]=o,p[5]=_,p[6]=v,p[7]=0,p[8]=y,p[9]=x,p[10]=w,p[11]=0,p[12]=-(r*u+o*n+y*t),p[13]=-(m*u+_*n+x*t),p[14]=-(s*u+v*n+w*t),p[15]=1,p)},mat4.fromRotationTranslation=function(t,r,n){n||(n=mat4.create());var o=t[0],s=t[1],p=t[2],u=t[3],y=o+o,m=s+s,_=p+p,t=o*y,b=o*m;o*=_;var x=s*m;return s*=_,p*=_,y*=u,m*=u,u*=_,n[0]=1-(x+p),n[1]=b+u,n[2]=o-m,n[3]=0,n[4]=b-u,n[5]=1-(t+p),n[6]=s+y,n[7]=0,n[8]=o+m,n[9]=s-y,n[10]=1-(t+x),n[11]=0,n[12]=r[0],n[13]=r[1],n[14]=r[2],n[15]=1,n},mat4.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+"]"},quat4.create=function(e){var t=new MatrixArray(4);return e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t},quat4.set=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},quat4.calculateW=function(t,r){var n=t[0],o=t[1],a=t[2];return r&&t!==r?(r[0]=n,r[1]=o,r[2]=a,r[3]=-Math.sqrt(Math.abs(1-n*n-o*o-a*a)),r):(t[3]=-Math.sqrt(Math.abs(1-n*n-o*o-a*a)),t)},quat4.inverse=function(e,t){return t&&e!==t?(t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t):(e[0]*=-1,e[1]*=-1,e[2]*=-1,e)},quat4.length=function(e){var t=e[0],r=e[1],n=e[2],e=e[3];return Math.sqrt(t*t+r*r+n*n+e*e)},quat4.normalize=function(t,r){r||(r=t);var n=t[0],o=t[1],a=t[2],e=t[3],i=Math.sqrt(n*n+o*o+a*a+e*e);return 0===i?(r[0]=0,r[1]=0,r[2]=0,r[3]=0,r):(i=1/i,r[0]=n*i,r[1]=o*i,r[2]=a*i,r[3]=e*i,r)},quat4.multiply=function(t,r,n){n||(n=t);var o=t[0],s=t[1],e=t[2],t=t[3],l=r[0],p=r[1],d=r[2],r=r[3];return n[0]=o*r+t*l+s*d-e*p,n[1]=s*r+t*p+e*l-o*d,n[2]=e*r+t*d+o*p-s*l,n[3]=t*r-o*l-s*p-e*d,n},quat4.multiplyVec3=function(t,r,n){n||(n=r);var o=r[0],s=r[1],e=r[2],r=t[0],l=t[1],p=t[2],t=t[3],u=t*o+l*e-p*s,i=t*s+p*o-r*e,g=t*e+r*s-l*o,o=-r*o-l*s-p*e;return n[0]=u*t+o*-r+i*-p-g*-l,n[1]=i*t+o*-l+g*-r-u*-p,n[2]=g*t+o*-p+u*-l-i*-r,n},quat4.toMat3=function(t,r){r||(r=mat3.create());var n=t[0],o=t[1],a=t[2],s=t[3],p=n+n,u=o+o,y=a+a,i=n*p,m=n*u;n*=y;var _=o*u;return o*=y,a*=y,p*=s,u*=s,s*=y,r[0]=1-(_+a),r[1]=m+s,r[2]=n-u,r[3]=m-s,r[4]=1-(i+a),r[5]=o+p,r[6]=n+u,r[7]=o-p,r[8]=1-(i+_),r},quat4.toMat4=function(t,r){r||(r=mat4.create());var n=t[0],o=t[1],a=t[2],s=t[3],p=n+n,u=o+o,y=a+a,i=n*p,m=n*u;n*=y;var _=o*u;return o*=y,a*=y,p*=s,u*=s,s*=y,r[0]=1-(_+a),r[1]=m+s,r[2]=n-u,r[3]=0,r[4]=m-s,r[5]=1-(i+a),r[6]=o+p,r[7]=0,r[8]=n+u,r[9]=o-p,r[10]=1-(i+_),r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},quat4.slerp=function(t,r,n,o){o||(o=t);var a=t[0]*r[0]+t[1]*r[1]+t[2]*r[2]+t[3]*r[3],i,s;return 1<=Math.abs(a)?(o!==t&&(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3]),o):(i=Math.acos(a),s=Math.sqrt(1-a*a),.001>Math.abs(s))?(o[0]=.5*t[0]+.5*r[0],o[1]=.5*t[1]+.5*r[1],o[2]=.5*t[2]+.5*r[2],o[3]=.5*t[3]+.5*r[3],o):(a=Math.sin((1-n)*i)/s,n=Math.sin(n*i)/s,o[0]=t[0]*a+r[0]*n,o[1]=t[1]*a+r[1]*n,o[2]=t[2]*a+r[2]*n,o[3]=t[3]*a+r[3]*n,o)},quat4.str=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"},function(){function e(e,t,r){this.isIE=/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent),this.width=0,this.height=0,this.enableFrontToBack=!!r,this.isEarlyZPass=!1,this.isBatchInEarlyZPass=!1,this.currentZ=0,this.zNear=1,this.zFar=1e3,this.zIncrement=(this.zFar-this.zNear)/32768,this.zA=this.zFar/(this.zFar-this.zNear),this.zB=this.zFar*this.zNear/(this.zNear-this.zFar),this.kzA=65536*this.zA,this.kzB=65536*this.zB,this.cam=vec3.create([0,0,100]),this.look=vec3.create([0,0,0]),this.up=vec3.create([0,1,0]),this.worldScale=vec3.create([1,1,1]),this.enable_mipmaps=!0,this.matP=mat4.create(),this.matMV=mat4.create(),this.lastMV=mat4.create(),this.currentMV=mat4.create(),this.gl=e,this.version=0===this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2")?2:1,this.initState()}function t(e,t,r){this.gl=e,this.shaderProgram=t,this.name=r,this.locAPos=e.getAttribLocation(t,"aPos"),this.locATex=e.getAttribLocation(t,"aTex"),this.locMatP=e.getUniformLocation(t,"matP"),this.locMatMV=e.getUniformLocation(t,"matMV"),this.locOpacity=e.getUniformLocation(t,"opacity"),this.locColorFill=e.getUniformLocation(t,"colorFill"),this.locSamplerFront=e.getUniformLocation(t,"samplerFront"),this.locSamplerBack=e.getUniformLocation(t,"samplerBack"),this.locDestStart=e.getUniformLocation(t,"destStart"),this.locDestEnd=e.getUniformLocation(t,"destEnd"),this.locSeconds=e.getUniformLocation(t,"seconds"),this.locPixelWidth=e.getUniformLocation(t,"pixelWidth"),this.locPixelHeight=e.getUniformLocation(t,"pixelHeight"),this.locLayerScale=e.getUniformLocation(t,"layerScale"),this.locLayerAngle=e.getUniformLocation(t,"layerAngle"),this.locViewOrigin=e.getUniformLocation(t,"viewOrigin"),this.locScrollPos=e.getUniformLocation(t,"scrollPos"),this.hasAnyOptionalUniforms=!!(this.locPixelWidth||this.locPixelHeight||this.locSeconds||this.locSamplerBack||this.locDestStart||this.locDestEnd||this.locLayerScale||this.locLayerAngle||this.locViewOrigin||this.locScrollPos),this.lpPixelWidth=-999,this.lpPixelHeight=-999,this.lpOpacity=1,this.lpDestStartX=0,this.lpDestStartY=0,this.lpDestEndX=1,this.lpDestEndY=1,this.lpLayerScale=1,this.lpLayerAngle=0,this.lpViewOriginX=0,this.lpViewOriginY=0,this.lpScrollPosX=0,this.lpScrollPosY=0,this.lpSeconds=0,this.lastCustomParams=[],this.lpMatMV=mat4.create(),this.locOpacity&&e.uniform1f(this.locOpacity,1),this.locColorFill&&e.uniform4f(this.locColorFill,1,1,1,1),this.locSamplerFront&&e.uniform1i(this.locSamplerFront,0),this.locSamplerBack&&e.uniform1i(this.locSamplerBack,1),this.locDestStart&&e.uniform2f(this.locDestStart,0,0),this.locDestEnd&&e.uniform2f(this.locDestEnd,1,1),this.locLayerScale&&e.uniform1f(this.locLayerScale,1),this.locLayerAngle&&e.uniform1f(this.locLayerAngle,0),this.locViewOrigin&&e.uniform2f(this.locViewOrigin,0,0),this.locScrollPos&&e.uniform2f(this.locScrollPos,0,0),this.locSeconds&&e.uniform1f(this.locSeconds,0),this.hasCurrentMatMV=!1}function r(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function n(e,t){this.type=e,this.glwrap=t,this.gl=t.gl,this.opacityParam=0,this.startIndex=0,this.indexCount=0,this.texParam=null,this.mat4param=null,this.shaderParams=[],cr.seal(this)}var o=12000,a=8e3,l=4,p=1,d=7,c=mat4.create();e.prototype.initState=function(){var e=this.gl,t,r;for(this.lastOpacity=1,this.lastTexture0=null,this.lastTexture1=null,this.currentOpacity=1,e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.enable(e.BLEND),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA),e.disable(e.CULL_FACE),e.disable(e.STENCIL_TEST),e.disable(e.DITHER),this.enableFrontToBack?(e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL)):e.disable(e.DEPTH_TEST),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.lastSrcBlend=e.ONE,this.lastDestBlend=e.ONE_MINUS_SRC_ALPHA,this.vertexData=new Float32Array(8000*(this.enableFrontToBack?3:2)),this.texcoordData=new Float32Array(16000),this.pointData=new Float32Array(4*a),this.pointBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.pointBuffer),e.bufferData(e.ARRAY_BUFFER,this.pointData.byteLength,e.DYNAMIC_DRAW),this.vertexBuffers=Array(l),this.texcoordBuffers=Array(l),t=0;t<l;t++)this.vertexBuffers[t]=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffers[t]),e.bufferData(e.ARRAY_BUFFER,this.vertexData.byteLength,e.DYNAMIC_DRAW),this.texcoordBuffers[t]=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texcoordBuffers[t]),e.bufferData(e.ARRAY_BUFFER,this.texcoordData.byteLength,e.DYNAMIC_DRAW);this.curBuffer=0,this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var n=new Uint16Array(o);t=0,r=o;for(var s=0;t<r;)n[t++]=s,n[t++]=s+1,n[t++]=s+2,n[t++]=s,n[t++]=s+2,n[t++]=s+3,s+=4;e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW),this.vertexPtr=0,this.texPtr=0,this.pointPtr=0;var p,d;this.shaderPrograms=[],p="varying mediump vec2 vTex;\nuniform lowp float opacity;\nuniform lowp sampler2D samplerFront;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, vTex);\n\tgl_FragColor *= opacity;\n}",d=this.enableFrontToBack?"attribute highp vec3 aPos;\nattribute mediump vec2 aTex;\nvarying mediump vec2 vTex;\nuniform highp mat4 matP;\nuniform highp mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, aPos.z, 1.0);\n\tvTex = aTex;\n}":"attribute highp vec2 aPos;\nattribute mediump vec2 aTex;\nvarying mediump vec2 vTex;\nuniform highp mat4 matP;\nuniform highp mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);\n\tvTex = aTex;\n}";var c=this.createShaderProgram({src:p},d,"<default>");this.shaderPrograms.push(c),p="uniform mediump sampler2D samplerFront;\nvarying lowp float opacity;\nvoid main(void) {\n\tgl_FragColor = texture2D(samplerFront, gl_PointCoord);\n\tgl_FragColor *= opacity;\n}";c=this.createShaderProgram({src:p},"attribute vec4 aPos;\nvarying float opacity;\nuniform mat4 matP;\nuniform mat4 matMV;\nvoid main(void) {\n\tgl_Position = matP * matMV * vec4(aPos.x, aPos.y, 0.0, 1.0);\n\tgl_PointSize = aPos.z;\n\topacity = aPos.w;\n}","<point>"),this.shaderPrograms.push(c),p="varying mediump vec2 vTex;\nuniform lowp sampler2D samplerFront;\nvoid main(void) {\n\tif (texture2D(samplerFront, vTex).a < 1.0)\n\t\tdiscard;\n}";var c=this.createShaderProgram({src:p},d,"<earlyz>");this.shaderPrograms.push(c),p="uniform lowp vec4 colorFill;\nvoid main(void) {\n\tgl_FragColor = colorFill;\n}";var c=this.createShaderProgram({src:p},d,"<fill>");for(var u in this.shaderPrograms.push(c),cr.shaders)cr.shaders.hasOwnProperty(u)&&this.shaderPrograms.push(this.createShaderProgram(cr.shaders[u],d,u));e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,null),this.batch=[],this.batchPtr=0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.lastProgram=-1,this.currentProgram=-1,this.currentShader=null,this.fbo=e.createFramebuffer(),this.renderToTex=null,this.depthBuffer=null,this.attachedDepthBuffer=!1,this.enableFrontToBack&&(this.depthBuffer=e.createRenderbuffer()),this.tmpVec3=vec3.create([0,0,0]);var g=e.getParameter(e.ALIASED_POINT_SIZE_RANGE);this.minPointSize=g[0],this.maxPointSize=g[1],2048<this.maxPointSize&&(this.maxPointSize=2048),this.switchProgram(0),cr.seal(this)};t.prototype.updateMatMV=function(e){r(this.lpMatMV,e)||(mat4.set(e,this.lpMatMV),this.gl.uniformMatrix4fv(this.locMatMV,!1,e))},e.prototype.createShaderProgram=function(e,r,n){var o=this.gl,a=o.createShader(o.FRAGMENT_SHADER);if(o.shaderSource(a,e.src),o.compileShader(a),!o.getShaderParameter(a,o.COMPILE_STATUS)){var s=o.getShaderInfoLog(a);throw o.deleteShader(a),new Error("error compiling fragment shader: "+s)}var l=o.createShader(o.VERTEX_SHADER);if(o.shaderSource(l,r),o.compileShader(l),!o.getShaderParameter(l,o.COMPILE_STATUS)){var s=o.getShaderInfoLog(l);throw o.deleteShader(a),o.deleteShader(l),new Error("error compiling vertex shader: "+s)}var p=o.createProgram();if(o.attachShader(p,a),o.attachShader(p,l),o.linkProgram(p),!o.getProgramParameter(p,o.LINK_STATUS)){var s=o.getProgramInfoLog(p);throw o.deleteShader(a),o.deleteShader(l),o.deleteProgram(p),new Error("error linking shader program: "+s)}o.useProgram(p),o.deleteShader(a),o.deleteShader(l);var d=new t(o,p,n);d.extendBoxHorizontal=e.extendBoxHorizontal||0,d.extendBoxVertical=e.extendBoxVertical||0,d.crossSampling=!!e.crossSampling,d.preservesOpaqueness=!!e.preservesOpaqueness,d.animated=!!e.animated,d.parameters=e.parameters||[];var c,u;for(c=0,u=d.parameters.length;c<u;c++)d.parameters[c][1]=o.getUniformLocation(p,d.parameters[c][0]),d.lastCustomParams.push(0),o.uniform1f(d.parameters[c][1],0);return cr.seal(d),d},e.prototype.getShaderIndex=function(e){var t,r;for(t=0,r=this.shaderPrograms.length;t<r;t++)if(this.shaderPrograms[t].name===e)return t;return-1},e.prototype.project=function(e,t,r){var n=this.matMV,o=this.matP,a=[0,0,0,0,0,0,0,0];a[0]=n[0]*e+n[4]*t+n[12],a[1]=n[1]*e+n[5]*t+n[13],a[2]=n[2]*e+n[6]*t+n[14],a[3]=n[3]*e+n[7]*t+n[15],a[4]=o[0]*a[0]+o[4]*a[1]+o[8]*a[2]+o[12]*a[3],a[5]=o[1]*a[0]+o[5]*a[1]+o[9]*a[2]+o[13]*a[3],a[6]=o[2]*a[0]+o[6]*a[1]+o[10]*a[2]+o[14]*a[3],a[7]=-a[2];0===a[7]||(a[7]=1/a[7],a[4]*=a[7],a[5]*=a[7],a[6]*=a[7],r[0]=(.5*a[4]+.5)*this.width,r[1]=(.5*a[5]+.5)*this.height)},e.prototype.setSize=function(e,t,r){if(this.width!==e||this.height!==t||r){this.endBatch();var n=this.gl;if(this.width=e,this.height=t,n.viewport(0,0,e,t),mat4.lookAt(this.cam,this.look,this.up,this.matMV),this.enableFrontToBack)mat4.ortho(-e/2,e/2,t/2,-t/2,this.zNear,this.zFar,this.matP),this.worldScale[0]=1,this.worldScale[1]=1;else{mat4.perspective(45,e/t,this.zNear,this.zFar,this.matP);var o=[0,0],a=[0,0];this.project(0,0,o),this.project(1,1,a),this.worldScale[0]=1/(a[0]-o[0]),this.worldScale[1]=-1/(a[1]-o[1])}var l,p,d;for(l=0,p=this.shaderPrograms.length;l<p;l++)d=this.shaderPrograms[l],d.hasCurrentMatMV=!1,d.locMatP&&(n.useProgram(d.shaderProgram),n.uniformMatrix4fv(d.locMatP,!1,this.matP));n.useProgram(this.shaderPrograms[this.lastProgram].shaderProgram),n.bindTexture(n.TEXTURE_2D,null),n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,null),n.activeTexture(n.TEXTURE0),this.lastTexture0=null,this.lastTexture1=null,this.depthBuffer&&(n.bindFramebuffer(n.FRAMEBUFFER,this.fbo),n.bindRenderbuffer(n.RENDERBUFFER,this.depthBuffer),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,this.width,this.height),!this.attachedDepthBuffer&&(n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,this.depthBuffer),this.attachedDepthBuffer=!0),n.bindRenderbuffer(n.RENDERBUFFER,null),n.bindFramebuffer(n.FRAMEBUFFER,null),this.renderToTex=null)}},e.prototype.resetModelView=function(){mat4.lookAt(this.cam,this.look,this.up,this.matMV),mat4.scale(this.matMV,this.worldScale)},e.prototype.translate=function(e,t){0===e&&0===t||(this.tmpVec3[0]=e,this.tmpVec3[1]=t,this.tmpVec3[2]=0,mat4.translate(this.matMV,this.tmpVec3))},e.prototype.scale=function(e,t){1===e&&1===t||(this.tmpVec3[0]=e,this.tmpVec3[1]=t,this.tmpVec3[2]=1,mat4.scale(this.matMV,this.tmpVec3))},e.prototype.rotateZ=function(e){0===e||mat4.rotateZ(this.matMV,e)},e.prototype.updateModelView=function(){if(!r(this.lastMV,this.matMV)){var e=this.pushBatch();e.type=5,e.mat4param?mat4.set(this.matMV,e.mat4param):e.mat4param=mat4.create(this.matMV),mat4.set(this.matMV,this.lastMV),this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},e.prototype.setEarlyZIndex=function(e){this.enableFrontToBack&&(32760<e&&(e=32760),this.currentZ=this.cam[2]-this.zNear-e*this.zIncrement)};n.prototype.doSetEarlyZPass=function(){var e=this.gl,t=this.glwrap;0===this.startIndex?(e.depthMask(!1),e.colorMask(!0,!0,!0,!0),e.enable(e.BLEND),t.isBatchInEarlyZPass=!1):(e.depthMask(!0),e.colorMask(!1,!1,!1,!1),e.disable(e.BLEND),e.bindFramebuffer(e.FRAMEBUFFER,t.fbo),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0),e.clear(e.DEPTH_BUFFER_BIT),e.bindFramebuffer(e.FRAMEBUFFER,null),t.isBatchInEarlyZPass=!0)},n.prototype.doSetTexture=function(){this.gl.bindTexture(this.gl.TEXTURE_2D,this.texParam)},n.prototype.doSetTexture1=function(){var e=this.gl;e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,this.texParam),e.activeTexture(e.TEXTURE0)},n.prototype.doSetOpacity=function(){var e=this.opacityParam,t=this.glwrap;t.currentOpacity=e;var r=t.currentShader;r.locOpacity&&r.lpOpacity!==e&&(r.lpOpacity=e,this.gl.uniform1f(r.locOpacity,e))},n.prototype.doQuad=function(){this.gl.drawElements(this.gl.TRIANGLES,this.indexCount,this.gl.UNSIGNED_SHORT,this.startIndex)},n.prototype.doSetBlend=function(){this.gl.blendFunc(this.startIndex,this.indexCount)},n.prototype.doUpdateModelView=function(){var e=this.glwrap.shaderPrograms,t=this.glwrap.currentProgram,r,n,o;for(r=0,n=e.length;r<n;r++)o=e[r],r===t&&o.locMatMV?(o.updateMatMV(this.mat4param),o.hasCurrentMatMV=!0):o.hasCurrentMatMV=!1;mat4.set(this.mat4param,this.glwrap.currentMV)},n.prototype.doRenderToTexture=function(){var e=this.gl,t=this.glwrap;this.texParam?(t.lastTexture1===this.texParam&&(e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,null),t.lastTexture1=null,e.activeTexture(e.TEXTURE0)),e.bindFramebuffer(e.FRAMEBUFFER,t.fbo),!t.isBatchInEarlyZPass&&e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texParam,0)):(!t.enableFrontToBack&&e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0),e.bindFramebuffer(e.FRAMEBUFFER,null))},n.prototype.doClear=function(){var e=this.gl,t=this.startIndex;0===t?(e.clearColor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),e.clear(e.COLOR_BUFFER_BIT)):1===t?(e.enable(e.SCISSOR_TEST),e.scissor(this.mat4param[0],this.mat4param[1],this.mat4param[2],this.mat4param[3]),e.clearColor(0,0,0,0),e.clear(e.COLOR_BUFFER_BIT),e.disable(e.SCISSOR_TEST)):e.clear(e.DEPTH_BUFFER_BIT)},n.prototype.doSetDepthTestEnabled=function(){var e=this.gl,t=this.startIndex;0===t?e.disable(e.DEPTH_TEST):e.enable(e.DEPTH_TEST)},n.prototype.doPoints=function(){var e=this.gl,t=this.glwrap;t.enableFrontToBack&&e.disable(e.DEPTH_TEST);var r=t.shaderPrograms[1];e.useProgram(r.shaderProgram),!r.hasCurrentMatMV&&r.locMatMV&&(r.updateMatMV(t.currentMV),r.hasCurrentMatMV=!0),e.enableVertexAttribArray(r.locAPos),e.bindBuffer(e.ARRAY_BUFFER,t.pointBuffer),e.vertexAttribPointer(r.locAPos,4,e.FLOAT,!1,0,0),e.drawArrays(e.POINTS,this.startIndex/4,this.indexCount),r=t.currentShader,e.useProgram(r.shaderProgram),0<=r.locAPos&&(e.enableVertexAttribArray(r.locAPos),e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffers[t.curBuffer]),e.vertexAttribPointer(r.locAPos,t.enableFrontToBack?3:2,e.FLOAT,!1,0,0)),0<=r.locATex&&(e.enableVertexAttribArray(r.locATex),e.bindBuffer(e.ARRAY_BUFFER,t.texcoordBuffers[t.curBuffer]),e.vertexAttribPointer(r.locATex,2,e.FLOAT,!1,0,0)),t.enableFrontToBack&&e.enable(e.DEPTH_TEST)},n.prototype.doSetProgram=function(){var e=this.gl,t=this.glwrap,r=t.shaderPrograms[this.startIndex];t.currentProgram=this.startIndex,t.currentShader=r,e.useProgram(r.shaderProgram),!r.hasCurrentMatMV&&r.locMatMV&&(r.updateMatMV(t.currentMV),r.hasCurrentMatMV=!0),r.locOpacity&&r.lpOpacity!==t.currentOpacity&&(r.lpOpacity=t.currentOpacity,e.uniform1f(r.locOpacity,t.currentOpacity)),0<=r.locAPos&&(e.enableVertexAttribArray(r.locAPos),e.bindBuffer(e.ARRAY_BUFFER,t.vertexBuffers[t.curBuffer]),e.vertexAttribPointer(r.locAPos,t.enableFrontToBack?3:2,e.FLOAT,!1,0,0)),0<=r.locATex&&(e.enableVertexAttribArray(r.locATex),e.bindBuffer(e.ARRAY_BUFFER,t.texcoordBuffers[t.curBuffer]),e.vertexAttribPointer(r.locATex,2,e.FLOAT,!1,0,0))},n.prototype.doSetColor=function(){var e=this.glwrap.currentShader,t=this.mat4param;this.gl.uniform4f(e.locColorFill,t[0],t[1],t[2],t[3])},n.prototype.doSetProgramParameters=function(){var e=this.glwrap.currentShader,t=this.gl,r=this.mat4param,n,o;e.locSamplerBack&&this.glwrap.lastTexture1!==this.texParam&&(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.texParam),this.glwrap.lastTexture1=this.texParam,t.activeTexture(t.TEXTURE0));var a=r[0],s;if(e.locPixelWidth&&a!==e.lpPixelWidth&&(e.lpPixelWidth=a,t.uniform1f(e.locPixelWidth,a)),a=r[1],e.locPixelHeight&&a!==e.lpPixelHeight&&(e.lpPixelHeight=a,t.uniform1f(e.locPixelHeight,a)),a=r[2],s=r[3],e.locDestStart&&(a!==e.lpDestStartX||s!==e.lpDestStartY)&&(e.lpDestStartX=a,e.lpDestStartY=s,t.uniform2f(e.locDestStart,a,s)),a=r[4],s=r[5],e.locDestEnd&&(a!==e.lpDestEndX||s!==e.lpDestEndY)&&(e.lpDestEndX=a,e.lpDestEndY=s,t.uniform2f(e.locDestEnd,a,s)),a=r[6],e.locLayerScale&&a!==e.lpLayerScale&&(e.lpLayerScale=a,t.uniform1f(e.locLayerScale,a)),a=r[7],e.locLayerAngle&&a!==e.lpLayerAngle&&(e.lpLayerAngle=a,t.uniform1f(e.locLayerAngle,a)),a=r[8],s=r[9],e.locViewOrigin&&(a!==e.lpViewOriginX||s!==e.lpViewOriginY)&&(e.lpViewOriginX=a,e.lpViewOriginY=s,t.uniform2f(e.locViewOrigin,a,s)),a=r[10],s=r[11],e.locScrollPos&&(a!==e.lpScrollPosX||s!==e.lpScrollPosY)&&(e.lpScrollPosX=a,e.lpScrollPosY=s,t.uniform2f(e.locScrollPos,a,s)),a=r[12],e.locSeconds&&a!==e.lpSeconds&&(e.lpSeconds=a,t.uniform1f(e.locSeconds,a)),e.parameters.length)for(n=0,o=e.parameters.length;n<o;n++)a=this.shaderParams[n],a!==e.lastCustomParams[n]&&(e.lastCustomParams[n]=a,t.uniform1f(e.parameters[n][1],a))},e.prototype.pushBatch=function(){return this.batchPtr===this.batch.length&&this.batch.push(new n(0,this)),this.batch[this.batchPtr++]},e.prototype.endBatch=function(){if(0!==this.batchPtr&&!this.gl.isContextLost()){var e=this.gl;if(0<this.pointPtr&&(e.bindBuffer(e.ARRAY_BUFFER,this.pointBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this.pointData.subarray(0,this.pointPtr)),t&&0<=t.locAPos&&"<point>"===t.name&&e.vertexAttribPointer(t.locAPos,4,e.FLOAT,!1,0,0)),0<this.vertexPtr){var t=this.currentShader;e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffers[this.curBuffer]),e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexData.subarray(0,this.vertexPtr)),t&&0<=t.locAPos&&"<point>"!==t.name&&e.vertexAttribPointer(t.locAPos,this.enableFrontToBack?3:2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.texcoordBuffers[this.curBuffer]),e.bufferSubData(e.ARRAY_BUFFER,0,this.texcoordData.subarray(0,this.texPtr)),t&&0<=t.locATex&&"<point>"!==t.name&&e.vertexAttribPointer(t.locATex,2,e.FLOAT,!1,0,0)}var r,n,o;for(r=0,n=this.batchPtr;r<n;r++)switch(o=this.batch[r],o.type){case 1:o.doQuad();break;case 2:o.doSetTexture();break;case 3:o.doSetOpacity();break;case 4:o.doSetBlend();break;case 5:o.doUpdateModelView();break;case 6:o.doRenderToTexture();break;case 7:o.doClear();break;case 8:o.doPoints();break;case 9:o.doSetProgram();break;case 10:o.doSetProgramParameters();break;case 11:o.doSetTexture1();break;case 12:o.doSetColor();break;case 13:o.doSetDepthTestEnabled();break;case 14:o.doSetEarlyZPass();}this.batchPtr=0,this.vertexPtr=0,this.texPtr=0,this.pointPtr=0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.isBatchInEarlyZPass=!1,this.curBuffer++,this.curBuffer>=l&&(this.curBuffer=0)}},e.prototype.setOpacity=function(e){if(e!==this.lastOpacity&&!this.isEarlyZPass){var t=this.pushBatch();t.type=3,t.opacityParam=e,this.lastOpacity=e,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},e.prototype.setTexture=function(e){if(e!==this.lastTexture0){var t=this.pushBatch();t.type=2,t.texParam=e,this.lastTexture0=e,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},e.prototype.setBlend=function(e,t){if((e!==this.lastSrcBlend||t!==this.lastDestBlend)&&!this.isEarlyZPass){var r=this.pushBatch();r.type=4,r.startIndex=e,r.indexCount=t,this.lastSrcBlend=e,this.lastDestBlend=t,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},e.prototype.isPremultipliedAlphaBlend=function(){return this.lastSrcBlend===this.gl.ONE&&this.lastDestBlend===this.gl.ONE_MINUS_SRC_ALPHA},e.prototype.setAlphaBlend=function(){this.setBlend(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)},e.prototype.setNoPremultiplyAlphaBlend=function(){this.setBlend(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)};e.prototype.quad=function(e,r,n,o,a,i,s,l){this.vertexPtr>=15992&&this.endBatch();var d=this.vertexPtr,c=this.texPtr,u=this.vertexData,g=this.texcoordData,y=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var m=this.pushBatch();m.type=p,m.startIndex=this.enableFrontToBack?d:3*(d/2),m.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1}this.enableFrontToBack?(u[d++]=e,u[d++]=r,u[d++]=y,u[d++]=n,u[d++]=o,u[d++]=y,u[d++]=a,u[d++]=i,u[d++]=y,u[d++]=s,u[d++]=l,u[d++]=y):(u[d++]=e,u[d++]=r,u[d++]=n,u[d++]=o,u[d++]=a,u[d++]=i,u[d++]=s,u[d++]=l),g[c++]=0,g[c++]=0,g[c++]=1,g[c++]=0,g[c++]=1,g[c++]=1,g[c++]=0,g[c++]=1,this.vertexPtr=d,this.texPtr=c},e.prototype.quadTex=function(e,r,n,o,a,i,s,l,d){this.vertexPtr>=15992&&this.endBatch();var c=this.vertexPtr,u=this.texPtr,g=this.vertexData,y=this.texcoordData,m=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var _=this.pushBatch();_.type=p,_.startIndex=this.enableFrontToBack?c:3*(c/2),_.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1}var h=d.left,f=d.top,b=d.right,x=d.bottom;this.enableFrontToBack?(g[c++]=e,g[c++]=r,g[c++]=m,g[c++]=n,g[c++]=o,g[c++]=m,g[c++]=a,g[c++]=i,g[c++]=m,g[c++]=s,g[c++]=l,g[c++]=m):(g[c++]=e,g[c++]=r,g[c++]=n,g[c++]=o,g[c++]=a,g[c++]=i,g[c++]=s,g[c++]=l),y[u++]=h,y[u++]=f,y[u++]=b,y[u++]=f,y[u++]=b,y[u++]=x,y[u++]=h,y[u++]=x,this.vertexPtr=c,this.texPtr=u},e.prototype.quadTexUV=function(e,r,n,o,a,i,s,l,d,c,u,g,y,m,_,h){this.vertexPtr>=15992&&this.endBatch();var f=this.vertexPtr,x=this.texPtr,w=this.vertexData,S=this.texcoordData,T=this.currentZ;if(this.hasQuadBatchTop)this.batch[this.batchPtr-1].indexCount+=6;else{var C=this.pushBatch();C.type=p,C.startIndex=this.enableFrontToBack?f:3*(f/2),C.indexCount=6,this.hasQuadBatchTop=!0,this.hasPointBatchTop=!1}this.enableFrontToBack?(w[f++]=e,w[f++]=r,w[f++]=T,w[f++]=n,w[f++]=o,w[f++]=T,w[f++]=a,w[f++]=i,w[f++]=T,w[f++]=s,w[f++]=l,w[f++]=T):(w[f++]=e,w[f++]=r,w[f++]=n,w[f++]=o,w[f++]=a,w[f++]=i,w[f++]=s,w[f++]=l),S[x++]=d,S[x++]=c,S[x++]=u,S[x++]=g,S[x++]=y,S[x++]=m,S[x++]=_,S[x++]=h,this.vertexPtr=f,this.texPtr=x},e.prototype.convexPoly=function(e){var t=e.length/2;var r=t-2,n=e[0],o=e[1],a,s,l,p,d,c,u,g;for(a=0;a<r;a+=2)s=2*a,l=e[s+2],p=e[s+3],d=e[s+4],c=e[s+5],a===r-1?this.quad(n,o,l,p,d,c,d,c):(u=e[s+6],g=e[s+7],this.quad(n,o,l,p,d,c,u,g))};e.prototype.point=function(e,t,r,n){this.pointPtr>=a-4&&this.endBatch();var o=this.pointPtr,i=this.pointData;if(this.hasPointBatchTop)this.batch[this.batchPtr-1].indexCount++;else{var s=this.pushBatch();s.type=8,s.startIndex=o,s.indexCount=1,this.hasPointBatchTop=!0,this.hasQuadBatchTop=!1}i[o++]=e,i[o++]=t,i[o++]=r,i[o++]=n,this.pointPtr=o},e.prototype.switchProgram=function(e){if(this.lastProgram!==e){var t=this.shaderPrograms[e];if(!t){if(0===this.lastProgram)return;e=0,t=this.shaderPrograms[0]}var r=this.pushBatch();r.type=9,r.startIndex=e,this.lastProgram=e,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},e.prototype.programUsesDest=function(e){var t=this.shaderPrograms[e];return!!(t.locDestStart||t.locDestEnd)},e.prototype.programUsesCrossSampling=function(e){var t=this.shaderPrograms[e];return!!(t.locDestStart||t.locDestEnd||t.crossSampling)},e.prototype.programPreservesOpaqueness=function(e){return this.shaderPrograms[e].preservesOpaqueness},e.prototype.programExtendsBox=function(e){var t=this.shaderPrograms[e];return 0!==t.extendBoxHorizontal||0!==t.extendBoxVertical},e.prototype.getProgramBoxExtendHorizontal=function(e){return this.shaderPrograms[e].extendBoxHorizontal},e.prototype.getProgramBoxExtendVertical=function(e){return this.shaderPrograms[e].extendBoxVertical},e.prototype.getProgramParameterType=function(e,t){return this.shaderPrograms[e].parameters[t][2]},e.prototype.programIsAnimated=function(e){return this.shaderPrograms[e].animated},e.prototype.setProgramParameters=function(e,t,r,n,o,a,l,p,d,c,u,g,y,m,_){var h=this.shaderPrograms[this.lastProgram],s,f,x,v,w;if(h.hasAnyOptionalUniforms||_.length){if(x=this.pushBatch(),x.type=10,x.mat4param?mat4.set(this.matMV,x.mat4param):x.mat4param=mat4.create(),v=x.mat4param,v[0]=t,v[1]=r,v[2]=n,v[3]=o,v[4]=a,v[5]=l,v[6]=p,v[7]=d,v[8]=c,v[9]=u,v[10]=g,v[11]=y,v[12]=m,(x.texParam=h.locSamplerBack?e:null,_.length))for(w=x.shaderParams,w.length=_.length,(s=0,f=_.length);s<f;s++)w[s]=_[s];this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},e.prototype.clear=function(e,t,r,n){var o=this.pushBatch();o.type=d,o.startIndex=0,o.mat4param||(o.mat4param=mat4.create()),o.mat4param[0]=e,o.mat4param[1]=t,o.mat4param[2]=r,o.mat4param[3]=n,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},e.prototype.clearRect=function(e,t,r,n){if(!(0>r||0>n)){var o=this.pushBatch();o.type=d,o.startIndex=1,o.mat4param||(o.mat4param=mat4.create()),o.mat4param[0]=e,o.mat4param[1]=t,o.mat4param[2]=r,o.mat4param[3]=n,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},e.prototype.clearDepth=function(){var e=this.pushBatch();e.type=d,e.startIndex=2,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},e.prototype.setEarlyZPass=function(t){if(this.enableFrontToBack&&(t=!!t,this.isEarlyZPass!==t)){var r=this.pushBatch();r.type=14,r.startIndex=t?1:0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1,this.isEarlyZPass=t,this.renderToTex=null,this.isEarlyZPass?this.switchProgram(2):this.switchProgram(0)}},e.prototype.setDepthTestEnabled=function(t){if(this.enableFrontToBack){var e=this.pushBatch();e.type=13,e.startIndex=t?1:0,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},e.prototype.fullscreenQuad=function(){mat4.set(this.lastMV,c),this.resetModelView(),this.updateModelView();var e=this.width/2,t=this.height/2;this.quad(-e,t,e,t,e,-t,-e,-t),mat4.set(c,this.matMV),this.updateModelView()},e.prototype.setColorFillMode=function(e,t,r,n){this.switchProgram(3);var o=this.pushBatch();o.type=12,o.mat4param||(o.mat4param=mat4.create()),o.mat4param[0]=e,o.mat4param[1]=t,o.mat4param[2]=r,o.mat4param[3]=n,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1},e.prototype.setTextureFillMode=function(){this.switchProgram(0)},e.prototype.restoreEarlyZMode=function(){this.switchProgram(2)},e.prototype.present=function(){this.endBatch(),this.gl.flush()};var u=[],g={};e.prototype.contextLost=function(){cr.clearArray(u),g={}};e.prototype.loadTexture=function(e,t,r,n,o,a){t=!!t,r=!!r;var i=e.src+","+t+","+r+(t?","+o:""),s=null;if("undefined"!=typeof e.src&&g.hasOwnProperty(i))return s=g[i],s.c2refcount++,s;this.endBatch();var l=this.gl,p=cr.isPOT(e.width)&&cr.isPOT(e.height);s=l.createTexture(),l.bindTexture(l.TEXTURE_2D,s),l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);var d=l.RGBA,c=l.RGBA,y=l.UNSIGNED_BYTE;if(n&&!this.isIE&&(n===1?(d=l.RGB,c=l.RGB):n===2?y=l.UNSIGNED_SHORT_4_4_4_4:n===3?y=l.UNSIGNED_SHORT_5_5_5_1:n===4?(d=l.RGB,c=l.RGB,y=l.UNSIGNED_SHORT_5_6_5):void 0),1===this.version&&!p&&t){var m=document.createElement("canvas");m.width=cr.nextHighestPowerOfTwo(e.width),m.height=cr.nextHighestPowerOfTwo(e.height);var _=m.getContext("2d");"undefined"==typeof _.imageSmoothingEnabled?(_.webkitImageSmoothingEnabled=r,_.mozImageSmoothingEnabled=r,_.msImageSmoothingEnabled=r):_.imageSmoothingEnabled=r,_.drawImage(e,0,0,e.width,e.height,0,0,m.width,m.height),l.texImage2D(l.TEXTURE_2D,0,d,c,y,m)}else l.texImage2D(l.TEXTURE_2D,0,d,c,y,e);return t?"repeat-x"===o?(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE)):"repeat-y"===o?(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.REPEAT)):(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.REPEAT),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.REPEAT)):(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE)),r?(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR),(p||2<=this.version)&&this.enable_mipmaps&&!a?(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR_MIPMAP_LINEAR),l.generateMipmap(l.TEXTURE_2D)):l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR)):(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST)),l.bindTexture(l.TEXTURE_2D,null),this.lastTexture0=null,s.c2width=e.width,s.c2height=e.height,s.c2refcount=1,s.c2texkey=i,u.push(s),g[i]=s,s},e.prototype.createEmptyTexture=function(e,t,r,n,o){this.endBatch();var a=this.gl;this.isIE&&(n=!1);var i=a.createTexture();return a.bindTexture(a.TEXTURE_2D,i),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,e,t,0,a.RGBA,n?a.UNSIGNED_SHORT_4_4_4_4:a.UNSIGNED_BYTE,null),o?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT)):(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE)),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,r?a.LINEAR:a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,r?a.LINEAR:a.NEAREST),a.bindTexture(a.TEXTURE_2D,null),this.lastTexture0=null,i.c2width=e,i.c2height=t,u.push(i),i},e.prototype.videoToTexture=function(e,t,r){this.endBatch();var n=this.gl;this.isIE&&(r=!1),n.bindTexture(n.TEXTURE_2D,t),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0);try{n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,r?n.UNSIGNED_SHORT_4_4_4_4:n.UNSIGNED_BYTE,e)}catch(t){console&&console.error&&console.error("Error updating WebGL texture: ",t)}n.bindTexture(n.TEXTURE_2D,null),this.lastTexture0=null},e.prototype.deleteTexture=function(e){return e?"undefined"!=typeof e.c2refcount&&1<e.c2refcount?void e.c2refcount--:void(this.endBatch(),e===this.lastTexture0&&(this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.lastTexture0=null),e===this.lastTexture1&&(this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.activeTexture(this.gl.TEXTURE0),this.lastTexture1=null),cr.arrayFindRemove(u,e),"undefined"!=typeof e.c2texkey&&delete g[e.c2texkey],this.gl.deleteTexture(e)):void 0},e.prototype.estimateVRAM=function(){var e=2*(4*(this.width*this.height)),r,n,o;for(r=0,n=u.length;r<n;r++)o=u[r],e+=4*(o.c2width*o.c2height);return e},e.prototype.textureCount=function(){return u.length},e.prototype.setRenderingToTexture=function(e){if(e!==this.renderToTex){var t=this.pushBatch();t.type=6,t.texParam=e,this.renderToTex=e,this.hasQuadBatchTop=!1,this.hasPointBatchTop=!1}},cr.GLWrap=e}();(function(){function e(e){if(e&&(e.getContext||e.dc)&&!e.c2runtime){e.c2runtime=this;var t=this;this.isCrosswalk=/crosswalk/i.test(navigator.userAgent)||/xwalk/i.test(navigator.userAgent)||!!("undefined"!=typeof window.c2isCrosswalk&&window.c2isCrosswalk),this.isCordova=this.isCrosswalk||"undefined"!=typeof window.device&&("undefined"!=typeof window.device.cordova||"undefined"!=typeof window.device.phonegap)||"undefined"!=typeof window.c2iscordova&&window.c2iscordova,this.isPhoneGap=this.isCordova,this.isDirectCanvas=!!e.dc,this.isAppMobi="undefined"!=typeof window.AppMobi||this.isDirectCanvas,this.isCocoonJs=!!window.c2cocoonjs,this.isEjecta=!!window.c2ejecta,this.isCocoonJs&&(CocoonJS.App.onSuspended.addEventListener(function(){t.setSuspended(!0)}),CocoonJS.App.onActivated.addEventListener(function(){t.setSuspended(!1)})),this.isEjecta&&(document.addEventListener("pagehide",function(){t.setSuspended(!0)}),document.addEventListener("pageshow",function(){t.setSuspended(!1)}),document.addEventListener("resize",function(){t.setSize(window.innerWidth,window.innerHeight)})),this.isDomFree=this.isDirectCanvas||this.isCocoonJs||this.isEjecta,this.isMicrosoftEdge=/edge\//i.test(navigator.userAgent),this.isIE=(/msie/i.test(navigator.userAgent)||/trident/i.test(navigator.userAgent)||/iemobile/i.test(navigator.userAgent))&&!this.isMicrosoftEdge,this.isTizen=/tizen/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)&&!this.isTizen&&!this.isIE&&!this.isMicrosoftEdge,this.isiPhone=(/iphone/i.test(navigator.userAgent)||/ipod/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge,this.isiPad=/ipad/i.test(navigator.userAgent),this.isiOS=this.isiPhone||this.isiPad||this.isEjecta,this.isiPhoneiOS6=this.isiPhone&&/os\s6/i.test(navigator.userAgent),this.isChrome=(/chrome/i.test(navigator.userAgent)||/chromium/i.test(navigator.userAgent))&&!this.isIE&&!this.isMicrosoftEdge,this.isAmazonWebApp=/amazonwebappplatform/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isSafari=/safari/i.test(navigator.userAgent)&&!this.isChrome&&!this.isIE&&!this.isMicrosoftEdge,this.isWindows=/windows/i.test(navigator.userAgent),this.isNWjs="undefined"!=typeof window.c2nodewebkit||"undefined"!=typeof window.c2nwjs||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent),this.isNodeWebkit=this.isNWjs,this.isArcade="undefined"!=typeof window.is_scirra_arcade,this.isWindows8App=!!("undefined"!=typeof window.c2isWindows8&&window.c2isWindows8),this.isWindows8Capable=!!("undefined"!=typeof window.c2isWindows8Capable&&window.c2isWindows8Capable),this.isWindowsPhone8=!!("undefined"!=typeof window.c2isWindowsPhone8&&window.c2isWindowsPhone8),this.isWindowsPhone81=!!("undefined"!=typeof window.c2isWindowsPhone81&&window.c2isWindowsPhone81),this.isWindows10=!!window.cr_windows10,this.isWinJS=this.isWindows8App||this.isWindows8Capable||this.isWindowsPhone81||this.isWindows10,this.isBlackberry10=!!("undefined"!=typeof window.c2isBlackberry10&&window.c2isBlackberry10),this.isAndroidStockBrowser=this.isAndroid&&!this.isChrome&&!this.isCrosswalk&&!this.isFirefox&&!this.isAmazonWebApp&&!this.isDomFree,this.devicePixelRatio=1,this.isMobile=this.isCordova||this.isCrosswalk||this.isAppMobi||this.isCocoonJs||this.isAndroid||this.isiOS||this.isWindowsPhone8||this.isWindowsPhone81||this.isBlackberry10||this.isTizen||this.isEjecta,this.isMobile||(this.isMobile=/(blackberry|bb10|playbook|palm|symbian|nokia|windows\s+ce|phone|mobile|tablet|kindle|silk)/i.test(navigator.userAgent)),this.isWKWebView=!!(this.isiOS&&this.isCordova&&window.webkit),"undefined"!=typeof cr_is_preview&&!this.isNWjs&&("?nw"===window.location.search||/nodewebkit/i.test(navigator.userAgent)||/nwjs/i.test(navigator.userAgent))&&(this.isNWjs=!0),this.isDebug="undefined"!=typeof cr_is_preview&&-1<window.location.search.indexOf("debug"),this.canvas=e,this.canvasdiv=document.getElementById("c2canvasdiv"),this.gl=null,this.glwrap=null,this.glUnmaskedRenderer="(unavailable)",this.enableFrontToBack=!1,this.earlyz_index=0,this.ctx=null,this.firstInFullscreen=!1,this.oldWidth=0,this.oldHeight=0,this.canvas.oncontextmenu=function(t){return t.preventDefault&&t.preventDefault(),!1},this.canvas.onselectstart=function(t){return t.preventDefault&&t.preventDefault(),!1},this.canvas.ontouchstart=function(t){return t.preventDefault&&t.preventDefault(),!1},this.isDirectCanvas&&(window.c2runtime=this),this.isNWjs&&(window.ondragover=function(t){return t.preventDefault(),!1},window.ondrop=function(t){return t.preventDefault(),!1},window.nwgui&&window.nwgui.App.clearCache&&window.nwgui.App.clearCache()),this.isAndroidStockBrowser&&"undefined"!=typeof jQuery&&jQuery("canvas").parents("*").css("overflow","visible"),this.width=e.width,this.height=e.height,this.draw_width=this.width,this.draw_height=this.height,this.cssWidth=this.width,this.cssHeight=this.height,this.lastWindowWidth=window.innerWidth,this.lastWindowHeight=window.innerHeight,this.forceCanvasAlpha=!1,this.redraw=!0,this.isSuspended=!1,Date.now||(Date.now=function(){return+new Date}),this.plugins=[],this.types={},this.types_by_index=[],this.behaviors=[],this.layouts={},this.layouts_by_index=[],this.eventsheets={},this.eventsheets_by_index=[],this.wait_for_textures=[],this.triggers_to_postinit=[],this.all_global_vars=[],this.all_local_vars=[],this.solidBehavior=null,this.jumpthruBehavior=null,this.shadowcasterBehavior=null,this.deathRow={},this.hasPendingInstances=!1,this.isInClearDeathRow=!1,this.isInOnDestroy=0,this.isRunningEvents=!1,this.isEndingLayout=!1,this.createRow=[],this.isLoadingState=!1,this.saveToSlot="",this.loadFromSlot="",this.loadFromJson=null,this.lastSaveJson="",this.signalledContinuousPreview=!1,this.suspendDrawing=!1,this.fireOnCreateAfterLoad=[],this.dt=0,this.dt1=0,this.minimumFramerate=30,this.logictime=0,this.cpuutilisation=0,this.timescale=1,this.kahanTime=new cr.KahanAdder,this.wallTime=new cr.KahanAdder,this.last_tick_time=0,this.fps=0,this.last_fps_time=0,this.tickcount=0,this.tickcount_nosave=0,this.execcount=0,this.framecount=0,this.objectcount=0,this.changelayout=null,this.destroycallbacks=[],this.event_stack=[],this.event_stack_index=-1,this.localvar_stack=[[]],this.localvar_stack_index=0,this.trigger_depth=0,this.pushEventStack(null),this.loop_stack=[],this.loop_stack_index=-1,this.next_uid=0,this.next_puid=0,this.layout_first_tick=!0,this.family_count=0,this.suspend_events=[],this.raf_id=-1,this.timeout_id=-1,this.isloading=!0,this.loadingprogress=0,this.isNodeFullscreen=!1,this.stackLocalCount=0,this.audioInstance=null,this.had_a_click=!1,this.isInUserInputEvent=!1,this.objects_to_pretick=new cr.ObjectSet,this.objects_to_tick=new cr.ObjectSet,this.objects_to_tick2=new cr.ObjectSet,this.registered_collisions=[],this.temp_poly=new cr.CollisionPoly([]),this.temp_poly2=new cr.CollisionPoly([]),this.allGroups=[],this.groups_by_name={},this.cndsBySid={},this.actsBySid={},this.varsBySid={},this.blocksBySid={},this.running_layout=null,this.layer_canvas=null,this.layer_ctx=null,this.layer_tex=null,this.layout_tex=null,this.layout_canvas=null,this.layout_ctx=null,this.is_WebGL_context_lost=!1,this.uses_background_blending=!1,this.fx_tex=[null,null],this.fullscreen_scaling=0,this.files_subfolder="",this.objectsByUid={},this.loaderlogos=null,this.snapshotCanvas=null,this.snapshotData="",this.objectRefTable=[],this.requestProjectData()}}function t(e,t){P&&P.width===e&&P.height===t||(P=document.createElement("canvas"),P.width=e,P.height=t,I=P.getContext("2d"))}function r(e,t){return 128>=t?e[3]:256>=t?e[2]:512>=t?e[1]:e[0]}function n(){return L.length?L.pop():new cr.ObjectSet}function o(e){e.clear(),L.push(e)}function a(){try{return!!window.indexedDB}catch(t){return!1}}function i(t){var e=t.target.result;e.createObjectStore("saves",{keyPath:"slot"})}function s(t,r,n,o){try{var a=indexedDB.open("_C2SaveStates");a.onupgradeneeded=i,a.onerror=o,a.onsuccess=function(a){var e=a.target.result;e.onerror=o;var i=e.transaction(["saves"],"readwrite"),s=i.objectStore("saves"),l=s.put({slot:t,data:r});l.onsuccess=n}}catch(e){o(e)}}function l(t,r,n){try{var o=indexedDB.open("_C2SaveStates");o.onupgradeneeded=i,o.onerror=n,o.onsuccess=function(o){var e=o.target.result;e.onerror=n;var a=e.transaction(["saves"]),i=a.objectStore("saves"),s=i.get(t);s.onsuccess=function(){s.result?r(s.result.data):r(null)}}}catch(e){n(e)}}function p(){cr.logexport("Reloading for continuous preview"),!window.c2cocoonjs?-1<window.location.search.indexOf("continuous")?window.location.reload(!0):window.location+="?continuous":CocoonJS.App.reload()}function d(e){var t={},r;for(r in e)if(e.hasOwnProperty(r)){if(e[r]instanceof cr.ObjectSet)continue;if(e[r]&&"undefined"!=typeof e[r].c2userdata)continue;if("spriteCreatedDestroyCallback"===r)continue;t[r]=e[r]}return t}var c=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame;e.prototype.requestProjectData=function(){var e=this;if(this.isWKWebView)return void this.fetchLocalFileViaCordovaAsText("data.js",function(t){e.loadProject(JSON.parse(t))},function(){alert("Error fetching data.js")});var t=this.isWindowsPhone8?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;var r="data.js";(this.isWindows8App||this.isWindowsPhone8||this.isWindowsPhone81||this.isWindows10)&&(r="data.json"),t.open("GET",r,!0);var n=!1;if(!this.isDomFree&&"response"in t&&"responseType"in t)try{t.responseType="json",n="json"===t.responseType}catch(t){n=!1}if(!n&&"responseType"in t)try{t.responseType="text"}catch(t){}if("overrideMimeType"in t)try{t.overrideMimeType("application/json; charset=utf-8")}catch(t){}this.isWindowsPhone8?t.onreadystatechange=function(){4!==t.readyState||e.loadProject(JSON.parse(t.responseText))}:(t.onload=function(){if(n)e.loadProject(t.response);else if(e.isEjecta){var r=t.responseText;r=r.substr(r.indexOf("{")),e.loadProject(JSON.parse(r))}else e.loadProject(JSON.parse(t.responseText))},t.onerror=function(t){cr.logerror("Error requesting "+r+":"),cr.logerror(t)}),t.send()},e.prototype.initRendererAndLoader=function(){var e=this,r,n,o,a,p,d,c,u,g,m;this.isRetina=(!this.isDomFree||this.isEjecta||this.isCordova)&&this.useHighDpi&&!this.isAndroidStockBrowser,0===this.fullscreen_mode&&this.isiOS&&(this.isRetina=!1),this.devicePixelRatio=this.isRetina?window.devicePixelRatio||window.webkitDevicePixelRatio||window.mozDevicePixelRatio||window.msDevicePixelRatio||1:1,"object"==typeof window.StatusBar&&window.StatusBar.hide(),this.ClearDeathRow();var _;0<this.fullscreen_mode&&this.setSize(window.innerWidth,window.innerHeight,!0),this.canvas.addEventListener("webglcontextlost",function(t){t.preventDefault(),e.onContextLost(),cr.logexport("[Construct 2] WebGL context lost"),window.cr_setSuspended(!0)},!1),this.canvas.addEventListener("webglcontextrestored",function(){e.glwrap.initState(),e.glwrap.setSize(e.glwrap.width,e.glwrap.height,!0),e.layer_tex=null,e.layout_tex=null,e.fx_tex[0]=null,e.fx_tex[1]=null,e.onContextRestored(),e.redraw=!0,cr.logexport("[Construct 2] WebGL context restored"),window.cr_setSuspended(!1)},!1);try{this.enableWebGL&&(this.isCocoonJs||this.isEjecta||!this.isDomFree)&&(_={alpha:!0,depth:!1,antialias:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!0},!this.isAndroid&&(this.gl=this.canvas.getContext("webgl2",_)),!this.gl&&(this.gl=this.canvas.getContext("webgl",_)||this.canvas.getContext("experimental-webgl",_)))}catch(t){}if(this.gl){var h=0===this.gl.getParameter(this.gl.VERSION).indexOf("WebGL 2"),f=this.gl.getExtension("WEBGL_debug_renderer_info");if(f){var b=this.gl.getParameter(f.UNMASKED_VENDOR_WEBGL),x=this.gl.getParameter(f.UNMASKED_RENDERER_WEBGL);this.glUnmaskedRenderer=x+" ["+b+"]"}for(this.enableFrontToBack&&(this.glUnmaskedRenderer+=" [front-to-back enabled]"),this.isDomFree||(this.overlay_canvas=document.createElement("canvas"),jQuery(this.overlay_canvas).appendTo(this.canvas.parentNode),this.overlay_canvas.oncontextmenu=function(){return!1},this.overlay_canvas.onselectstart=function(){return!1},this.overlay_canvas.width=Math.round(this.cssWidth*this.devicePixelRatio),this.overlay_canvas.height=Math.round(this.cssHeight*this.devicePixelRatio),jQuery(this.overlay_canvas).css({width:this.cssWidth+"px",height:this.cssHeight+"px"}),this.positionOverlayCanvas(),this.overlay_ctx=this.overlay_canvas.getContext("2d")),this.glwrap=new cr.GLWrap(this.gl,this.isMobile,this.enableFrontToBack),this.glwrap.setSize(this.canvas.width,this.canvas.height),this.glwrap.enable_mipmaps=0!==this.downscalingQuality,this.ctx=null,r=0,n=this.types_by_index.length;r<n;r++)for(c=this.types_by_index[r],o=0,a=c.effect_types.length;o<a;o++)u=c.effect_types[o],u.shaderindex=this.glwrap.getShaderIndex(u.id),u.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(u.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(u.shaderindex);for(r=0,n=this.layouts_by_index.length;r<n;r++){for(g=this.layouts_by_index[r],o=0,a=g.effect_types.length;o<a;o++)u=g.effect_types[o],u.shaderindex=this.glwrap.getShaderIndex(u.id),u.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(u.shaderindex);for(g.updateActiveEffects(),o=0,a=g.layers.length;o<a;o++){for(m=g.layers[o],p=0,d=m.effect_types.length;p<d;p++)u=m.effect_types[p],u.shaderindex=this.glwrap.getShaderIndex(u.id),u.preservesOpaqueness=this.glwrap.programPreservesOpaqueness(u.shaderindex),this.uses_background_blending=this.uses_background_blending||this.glwrap.programUsesDest(u.shaderindex);m.updateActiveEffects()}}}else{if(0<this.fullscreen_mode&&this.isDirectCanvas){this.canvas=null,document.oncontextmenu=function(){return!1},document.onselectstart=function(){return!1},this.ctx=AppMobi.canvas.getContext("2d");try{this.ctx.samplingMode=this.linearSampling?"smooth":"sharp",this.ctx.globalScale=1,this.ctx.HTML5CompatibilityMode=!0,this.ctx.imageSmoothingEnabled=this.linearSampling}catch(t){}0!==this.width&&0!==this.height&&(this.ctx.width=this.width,this.ctx.height=this.height)}this.ctx||(this.isCocoonJs?(_={antialias:!!this.linearSampling,alpha:!0},this.ctx=this.canvas.getContext("2d",_)):(_={alpha:!0},this.ctx=this.canvas.getContext("2d",_)),this.setCtxImageSmoothingEnabled(this.ctx,this.linearSampling)),this.overlay_canvas=null,this.overlay_ctx=null}if(this.tickFunc=function(t){e.tick(!1,t)},window==window.top||this.isDomFree||this.isWinJS||this.isWindowsPhone8||(document.addEventListener("mousedown",function(){window.focus()},!0),document.addEventListener("touchstart",function(){window.focus()},!0)),"undefined"!=typeof cr_is_preview&&(this.isCocoonJs&&console.log("[Construct 2] In preview-over-wifi via CocoonJS mode"),-1<window.location.search.indexOf("continuous")&&(cr.logexport("Reloading for continuous preview"),this.loadFromSlot="__c2_continuouspreview",this.suspendDrawing=!0),this.pauseOnBlur&&!this.isMobile&&(jQuery(window).focus(function(){e.setSuspended(!1)}),jQuery(window).blur(function(){var t=window.parent;t&&t.document.hasFocus()||e.setSuspended(!0)}))),window.addEventListener("blur",function(){e.onWindowBlur()}),!this.isDomFree){var v=function(t){if(cr.isCanvasInputEvent(t)&&document.activeElement&&document.activeElement!==document.getElementsByTagName("body")[0]&&document.activeElement.blur)try{document.activeElement.blur()}catch(t){}};"undefined"==typeof PointerEvent?window.navigator.msPointerEnabled?document.addEventListener("MSPointerDown",v):document.addEventListener("touchstart",v):document.addEventListener("pointerdown",v),document.addEventListener("mousedown",v)}0===this.fullscreen_mode&&this.isRetina&&1<this.devicePixelRatio&&this.setSize(this.original_width,this.original_height,!0),this.tryLockOrientation(),this.getready(),this.go(),this.extra={},cr.seal(this)};e.prototype.setSize=function(e,t,r){var n=0,o=0,a=0,i=0,s=0;if(this.lastWindowWidth!==e||this.lastWindowHeight!==t||r){this.lastWindowWidth=e,this.lastWindowHeight=t;var l=this.fullscreen_mode,p=(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||this.isNodeFullscreen)&&!this.isCordova,d,c;if(p||0!==this.fullscreen_mode||r){p&&(l=this.fullscreen_scaling);var u=this.devicePixelRatio;4<=l?(5===l&&1!==u&&(e+=1,t+=1),d=this.original_width/this.original_height,c=e/t,c>d?(a=t*d,5===l?(s=a*u/this.original_width,1<s?s=Math.floor(s):1>s&&(s=1/Math.ceil(1/s)),a=this.original_width*s/u,i=this.original_height*s/u,n=(e-a)/2,o=(t-i)/2,e=a,t=i):(n=(e-a)/2,e=a)):(i=e/d,5===l?(s=i*u/this.original_height,1<s?s=Math.floor(s):1>s&&(s=1/Math.ceil(1/s)),a=this.original_width*s/u,i=this.original_height*s/u,n=(e-a)/2,o=(t-i)/2,e=a,t=i):(o=(t-i)/2,t=i))):p&&0===l&&(n=Math.floor((e-this.original_width)/2),o=Math.floor((t-this.original_height)/2),e=this.original_width,t=this.original_height),2>l&&(this.aspect_scale=u),this.cssWidth=Math.round(e),this.cssHeight=Math.round(t),this.width=Math.round(e*u),this.height=Math.round(t*u),this.redraw=!0,this.wantFullscreenScalingQuality?(this.draw_width=this.width,this.draw_height=this.height,this.fullscreenScalingQuality=!0):this.width<this.original_width&&this.height<this.original_height||1===l?(this.draw_width=this.width,this.draw_height=this.height,this.fullscreenScalingQuality=!0):(this.draw_width=this.original_width,this.draw_height=this.original_height,this.fullscreenScalingQuality=!1,2===l?(d=this.original_width/this.original_height,c=this.lastWindowWidth/this.lastWindowHeight,c<d?this.draw_width=this.draw_height*c:c>d&&(this.draw_height=this.draw_width/c)):3===l&&(d=this.original_width/this.original_height,c=this.lastWindowWidth/this.lastWindowHeight,c>d?this.draw_width=this.draw_height*c:c<d&&(this.draw_height=this.draw_width/c))),this.canvasdiv&&!this.isDomFree&&(jQuery(this.canvasdiv).css({width:Math.round(e)+"px",height:Math.round(t)+"px","margin-left":Math.floor(n)+"px","margin-top":Math.floor(o)+"px"}),"undefined"!=typeof cr_is_preview&&jQuery("#borderwrap").css({width:Math.round(e)+"px",height:Math.round(t)+"px"})),this.canvas&&(this.canvas.width=Math.round(e*u),this.canvas.height=Math.round(t*u),this.isEjecta?(this.canvas.style.left=Math.floor(n)+"px",this.canvas.style.top=Math.floor(o)+"px",this.canvas.style.width=Math.round(e)+"px",this.canvas.style.height=Math.round(t)+"px"):this.isRetina&&!this.isDomFree&&(this.canvas.style.width=Math.round(e)+"px",this.canvas.style.height=Math.round(t)+"px")),this.overlay_canvas&&(this.overlay_canvas.width=Math.round(e*u),this.overlay_canvas.height=Math.round(t*u),this.overlay_canvas.style.width=this.cssWidth+"px",this.overlay_canvas.style.height=this.cssHeight+"px"),this.glwrap&&this.glwrap.setSize(Math.round(e*u),Math.round(t*u)),this.isDirectCanvas&&this.ctx&&(this.ctx.width=Math.round(e),this.ctx.height=Math.round(t)),this.ctx&&this.setCtxImageSmoothingEnabled(this.ctx,this.linearSampling),this.tryLockOrientation(),this.isiPhone&&!this.isCordova&&window.scrollTo(0,0)}}},e.prototype.tryLockOrientation=function(){if(this.autoLockOrientation&&0!==this.orientations){var e="portrait";2===this.orientations&&(e="landscape");try{screen.orientation&&screen.orientation.lock?screen.orientation.lock(e).catch(function(){}):screen.lockOrientation?screen.lockOrientation(e):screen.webkitLockOrientation?screen.webkitLockOrientation(e):screen.mozLockOrientation?screen.mozLockOrientation(e):screen.msLockOrientation&&screen.msLockOrientation(e)}catch(t){console&&console.warn&&console.warn("Failed to lock orientation: ",t)}}},e.prototype.onContextLost=function(){this.glwrap.contextLost(),this.is_WebGL_context_lost=!0;var e,r,n;for(e=0,r=this.types_by_index.length;e<r;e++)n=this.types_by_index[e],n.onLostWebGLContext&&n.onLostWebGLContext()},e.prototype.onContextRestored=function(){this.is_WebGL_context_lost=!1;var e,r,n;for(e=0,r=this.types_by_index.length;e<r;e++)n=this.types_by_index[e],n.onRestoreWebGLContext&&n.onRestoreWebGLContext()},e.prototype.positionOverlayCanvas=function(){if(!this.isDomFree){var e=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement||this.isNodeFullscreen)&&!this.isCordova,t=e?jQuery(this.canvas).offset():jQuery(this.canvas).position();t.position="absolute",jQuery(this.overlay_canvas).css(t)}};var u=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame;e.prototype.setSuspended=function(e){var t=this,r,n;if(e&&!this.isSuspended)for(cr.logexport("[Construct 2] Suspending"),this.isSuspended=!0,-1!==this.raf_id&&u&&u(this.raf_id),-1!==this.timeout_id&&clearTimeout(this.timeout_id),(r=0,n=this.suspend_events.length);r<n;r++)this.suspend_events[r](!0);else if(!e&&this.isSuspended){for(cr.logexport("[Construct 2] Resuming"),this.isSuspended=!1,this.last_tick_time=cr.performance_now(),this.last_fps_time=cr.performance_now(),this.framecount=0,this.logictime=0,(r=0,n=this.suspend_events.length);r<n;r++)this.suspend_events[r](!1);this.tick(!1)}},e.prototype.addSuspendCallback=function(e){this.suspend_events.push(e)},e.prototype.GetObjectReference=function(e){return this.objectRefTable[e]},e.prototype.loadProject=function(e){e&&e.project||cr.logerror("Project model unavailable");var r=e.project;if(this.name=r[0],this.first_layout=r[1],this.fullscreen_mode=r[12],this.fullscreen_mode_set=r[12],this.original_width=r[10],this.original_height=r[11],this.parallax_x_origin=this.original_width/2,this.parallax_y_origin=this.original_height/2,this.isDomFree&&!this.isEjecta&&(4<=r[12]||0===r[12])&&(cr.logexport("[Construct 2] Letterbox scale fullscreen modes are not supported on this platform - falling back to 'Scale outer'"),this.fullscreen_mode=3,this.fullscreen_mode_set=3),this.uses_loader_layout=r[18],this.loaderstyle=r[19],0===this.loaderstyle){var n=new Image;n.crossOrigin="anonymous",this.setImageSrc(n,"loading-logo.png"),this.loaderlogos={logo:n}}else if(4===this.loaderstyle){var o=new Image;o.src="";var a=new Image;a.src="";var s=new Image;s.src="";var l=new Image;l.src="";var d=new Image;d.src="";var c=new Image;c.src="";var u=new Image;u.src="";var g=new Image;g.src="";var y=new Image;y.src="";var _=new Image;_.src="";var h=new Image;h.src="";var x=new Image;x.src="",this.loaderlogos={logo:[o,a,s,l],powered:[d,c,u,g],website:[y,_,h,x]}}this.next_uid=r[21],this.objectRefTable=cr.getObjectRefTable(),this.system=new cr.system_object(this);var v,w,S,T,C,O,A,E,P,I,L,R,B;for(v=0,w=r[2].length;v<w;v++)A=r[2][v],L=this.GetObjectReference(A[0]),cr.add_common_aces(A,L.prototype),R=new L(this),R.singleglobal=A[1],R.is_world=A[2],R.is_rotatable=A[5],R.must_predraw=A[9],R.onCreate&&R.onCreate(),cr.seal(R),this.plugins.push(R);for(this.objectRefTable=cr.getObjectRefTable(),v=0,w=r[3].length;v<w;v++){for(A=r[3][v],B=this.GetObjectReference(A[1]),(R=null,S=0,T=this.plugins.length);S<T;S++)if(this.plugins[S]instanceof B){R=this.plugins[S];break}var F=new R.Type(R);for(F.name=A[0],F.is_family=A[2],F.instvar_sids=A[3].slice(0),F.vars_count=A[3].length,F.behs_count=A[4],F.fx_count=A[5],F.sid=A[11],F.is_family?(F.members=[],F.family_index=this.family_count++,F.families=null):(F.members=null,F.family_index=-1,F.families=[]),F.family_var_map=null,F.family_beh_map=null,F.family_fx_map=null,F.is_contained=!1,F.container=null,A[6]?(F.texture_file=A[6][0],F.texture_filesize=A[6][1],F.texture_pixelformat=A[6][2]):(F.texture_file=null,F.texture_filesize=0,F.texture_pixelformat=0),F.animations=A[7]?A[7]:null,F.index=v,F.instances=[],F.deadCache=[],F.solstack=[new cr.selection(F)],F.cur_sol=0,F.default_instance=null,F.default_layerindex=0,F.stale_iids=!0,F.updateIIDs=cr.type_updateIIDs,F.getFirstPicked=cr.type_getFirstPicked,F.getPairedInstance=cr.type_getPairedInstance,F.getCurrentSol=cr.type_getCurrentSol,F.pushCleanSol=cr.type_pushCleanSol,F.pushCopySol=cr.type_pushCopySol,F.popSol=cr.type_popSol,F.getBehaviorByName=cr.type_getBehaviorByName,F.getBehaviorIndexByName=cr.type_getBehaviorIndexByName,F.getEffectIndexByName=cr.type_getEffectIndexByName,F.applySolToContainer=cr.type_applySolToContainer,F.getInstanceByIID=cr.type_getInstanceByIID,F.collision_grid=new cr.SparseGrid(this.original_width,this.original_height),F.any_cell_changed=!0,F.any_instance_parallaxed=!1,F.extra={},F.toString=cr.type_toString,F.behaviors=[],(S=0,T=A[8].length);S<T;S++){E=A[8][S];var N=this.GetObjectReference(E[1]),D=null;for(C=0,O=this.behaviors.length;C<O;C++)if(this.behaviors[C]instanceof N){D=this.behaviors[C];break}D||(D=new N(this),D.my_types=[],D.my_instances=new cr.ObjectSet,D.onCreate&&D.onCreate(),cr.seal(D),this.behaviors.push(D),cr.behaviors.solid&&D instanceof cr.behaviors.solid&&(this.solidBehavior=D),cr.behaviors.jumpthru&&D instanceof cr.behaviors.jumpthru&&(this.jumpthruBehavior=D),cr.behaviors.shadowcaster&&D instanceof cr.behaviors.shadowcaster&&(this.shadowcasterBehavior=D)),-1===D.my_types.indexOf(F)&&D.my_types.push(F);var M=new D.Type(D,F);M.name=E[0],M.sid=E[2],M.onCreate(),cr.seal(M),F.behaviors.push(M)}for(F.global=A[9],F.isOnLoaderLayout=A[10],F.effect_types=[],(S=0,T=A[12].length);S<T;S++)F.effect_types.push({id:A[12][S][0],name:A[12][S][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:S});if(F.tile_poly_data=A[13],(!this.uses_loader_layout||F.is_family||F.isOnLoaderLayout||!R.is_world)&&(F.onCreate(),cr.seal(F)),F.name&&(this.types[F.name]=F),this.types_by_index.push(F),R.singleglobal){var W=new R.Instance(F);W.uid=this.next_uid++,W.puid=this.next_puid++,W.iid=0,W.get_iid=cr.inst_get_iid,W.toString=cr.inst_toString,W.properties=A[14],W.onCreate(),cr.seal(W),F.instances.push(W),this.objectsByUid[W.uid.toString()]=W}}for(v=0,w=r[4].length;v<w;v++){var V=r[4][v],z=this.types_by_index[V[0]],G;for(S=1,T=V.length;S<T;S++)G=this.types_by_index[V[S]],G.families.push(z),z.members.push(G)}for(v=0,w=r[28].length;v<w;v++){var U=r[28][v],X=[];for(S=0,T=U.length;S<T;S++)X.push(this.types_by_index[U[S]]);for(S=0,T=X.length;S<T;S++)X[S].is_contained=!0,X[S].container=X}if(0<this.family_count)for(v=0,w=this.types_by_index.length;v<w;v++)if(P=this.types_by_index[v],!P.is_family&&P.families.length){P.family_var_map=Array(this.family_count),P.family_beh_map=Array(this.family_count),P.family_fx_map=Array(this.family_count);var H=[],q=0,Y=0,K=0;for(S=0,T=P.families.length;S<T;S++)for(I=P.families[S],P.family_var_map[I.family_index]=q,q+=I.vars_count,P.family_beh_map[I.family_index]=Y,Y+=I.behs_count,P.family_fx_map[I.family_index]=K,K+=I.fx_count,(C=0,O=I.effect_types.length);C<O;C++)H.push(cr.shallowCopy({},I.effect_types[C]));for(P.effect_types=H.concat(P.effect_types),S=0,T=P.effect_types.length;S<T;S++)P.effect_types[S].index=S}for(v=0,w=r[5].length;v<w;v++){A=r[5][v];var J=new cr.layout(this,A);cr.seal(J),this.layouts[J.name]=J,this.layouts_by_index.push(J)}for(v=0,w=r[6].length;v<w;v++){A=r[6][v];var Z=new cr.eventsheet(this,A);cr.seal(Z),this.eventsheets[Z.name]=Z,this.eventsheets_by_index.push(Z)}for(v=0,w=this.eventsheets_by_index.length;v<w;v++)this.eventsheets_by_index[v].postInit();for(v=0,w=this.eventsheets_by_index.length;v<w;v++)this.eventsheets_by_index[v].updateDeepIncludes();for(v=0,w=this.triggers_to_postinit.length;v<w;v++)this.triggers_to_postinit[v].postInit();cr.clearArray(this.triggers_to_postinit),this.audio_to_preload=r[7],this.files_subfolder=r[8],this.pixel_rounding=r[9],this.aspect_scale=1,this.enableWebGL=r[13],this.linearSampling=r[14],this.clearBackground=r[15],this.versionstr=r[16],this.useHighDpi=r[17],this.orientations=r[20],this.autoLockOrientation=0<this.orientations,this.pauseOnBlur=r[22],this.wantFullscreenScalingQuality=r[23],this.fullscreenScalingQuality=this.wantFullscreenScalingQuality,this.downscalingQuality=r[24],this.preloadSounds=r[25],this.projectName=r[26],this.enableFrontToBack=r[27]&&!this.isIE,this.start_time=Date.now(),cr.clearArray(this.objectRefTable),this.initRendererAndLoader()};var g=!1,y=0,m=[];e.prototype.queueImageLoad=function(e,t){var r=this,n=function(){y--,r.maybeLoadNextImages()};e.addEventListener("load",n),e.addEventListener("error",n),m.push([e,t]),this.maybeLoadNextImages()},e.prototype.maybeLoadNextImages=function(){for(var e;m.length&&y<100;)y++,e=m.shift(),this.setImageSrc(e[0],e[1])},e.prototype.waitForImageLoad=function(t,r){t.cocoonLazyLoad=!0,t.onerror=function(r){t.c2error=!0,g=!0,console&&console.error&&console.error("Error loading image '"+t.src+"': ",r)},this.isEjecta?t.src=r:!t.src&&("undefined"==typeof XAPKReader?(t.crossOrigin="anonymous",this.queueImageLoad(t,r)):XAPKReader.get(r,function(e){t.src=e},function(n){t.c2error=!0,g=!0,console&&console.error&&console.error("Error extracting image '"+r+"' from expansion file: ",n)})),this.wait_for_textures.push(t)},e.prototype.findWaitingTexture=function(e){var t,r;for(t=0,r=this.wait_for_textures.length;t<r;t++)if(this.wait_for_textures[t].cr_src===e)return this.wait_for_textures[t];return null};var _=0,h=!1;e.prototype.getready=function(){this.audioInstance&&(_=this.audioInstance.setPreloadList(this.audio_to_preload))},e.prototype.areAllTexturesAndSoundsLoaded=function(){var e=_,t=0,r=0,n=!0,o,a,s;for(o=0,a=this.wait_for_textures.length;o<a;o++){s=this.wait_for_textures[o];var l=s.cr_filesize;(!l||0>=l)&&(l=5e4),e+=l,!!s.src&&(s.complete||s.loaded)&&!s.c2error?t+=l:n=!1}return n&&this.preloadSounds&&this.audioInstance&&(!h&&(this.audioInstance.startPreloads(),h=!0),r=this.audioInstance.getPreloadedSize(),t+=r,r<_&&(n=!1)),this.progress=0==e?1:t/e,n};var f=!1;e.prototype.go=function(){if(this.ctx||this.glwrap){var e=this.ctx||this.overlay_ctx;this.overlay_canvas&&this.positionOverlayCanvas();var t=window.innerWidth,r=window.innerHeight;(this.lastWindowWidth!==t||this.lastWindowHeight!==r)&&this.setSize(t,r),this.progress=0,this.last_progress=-1;var n=this;if(this.areAllTexturesAndSoundsLoaded()&&(4!==this.loaderstyle||f))this.go_loading_finished();else{var o=Date.now()-this.start_time;if(e){var a=this.width,i=this.height,s=this.devicePixelRatio;if(3>this.loaderstyle&&(this.isCocoonJs||500<=o&&this.last_progress!=this.progress)){e.clearRect(0,0,a,i);var l=a/2,p=i/2,d=0===this.loaderstyle&&this.loaderlogos.logo.complete,u=40*s,y=0,m=80*s,_;if(d){var h=this.loaderlogos.logo;m=h.width*s,_=h.height*s,u=m/2,y=_/2,e.drawImage(h,cr.floor(l-u),cr.floor(p-y),m,_)}if(1>=this.loaderstyle)p+=y+(d?12*s:0),l-=u,l=cr.floor(l)+.5,p=cr.floor(p)+.5,e.fillStyle=g?"red":"DodgerBlue",e.fillRect(l,p,Math.floor(m*this.progress),6*s),e.strokeStyle="black",e.strokeRect(l,p,m,6*s),e.strokeStyle="white",e.strokeRect(l-1*s,p-1*s,m+2*s,8*s);else if(2===this.loaderstyle){e.font=this.isEjecta?"12pt ArialMT":"12pt Arial",e.fillStyle=g?"#f00":"#999",e.textBaseLine="middle";var b=Math.round(100*this.progress)+"%",x=e.measureText?e.measureText(b):null,v=x?x.width:0;e.fillText(b,l-v/2,p)}this.last_progress=this.progress}else if(4===this.loaderstyle)return this.draw_c2_splash_loader(e),void(c?c(function(){n.go()}):setTimeout(function(){n.go()},16))}setTimeout(function(){n.go()},this.isCocoonJs?10:100)}}};var b=-1,x=300,v=300,S="undefined"==typeof cr_is_preview?200:0,T=!0,C=!1,O=0,A=0,E="undefined"==typeof cr_is_preview?3e3:0,P=null,I=null,k=0;e.prototype.draw_c2_splash_loader=function(e){if(!f){for(var n=Math.ceil(this.width),o=Math.ceil(this.height),a=this.devicePixelRatio,s=this.loaderlogos.logo,l=this.loaderlogos.powered,p=this.loaderlogos.website,d=0;4>d;++d)if(!s[d].complete||!l[d].complete||!p[d].complete)return;0===k&&(b=Date.now());var c=Date.now(),u=!1,y=e,m,_;T||C?(e.clearRect(0,0,n,o),t(n,o),y=I,u=!0,T&&1===k&&(b=Date.now())):e.globalAlpha=1,y.fillStyle="#333333",y.fillRect(0,0,n,o),256<this.cssHeight?(m=cr.clamp(.22*o,105,.6*n),_=.25*m,y.drawImage(r(l,m),.5*n-m/2,.2*o-_/2,m,_),m=Math.min(.395*o,.95*n),_=m,y.drawImage(r(s,m),.5*n-m/2,.485*o-_/2,m,_),m=cr.clamp(.22*o,105,.6*n),_=.25*m,y.drawImage(r(p,m),.5*n-m/2,.868*o-_/2,m,_),y.fillStyle="#3C3C3C",m=n,_=Math.max(.005*o,2),y.fillRect(0,.8*o-_/2,m,_),y.fillStyle=g?"red":"#E0FF65",m=n*this.progress,y.fillRect(.5*n-m/2,.8*o-_/2,m,_)):(m=.55*o,_=m,y.drawImage(r(s,m),.5*n-m/2,.45*o-_/2,m,_),y.fillStyle="#3C3C3C",m=n,_=Math.max(.005*o,2),y.fillRect(0,.85*o-_/2,m,_),y.fillStyle=g?"red":"#E0FF65",m=n*this.progress,y.fillRect(.5*n-m/2,.85*o-_/2,m,_)),u&&(T?0===k?e.globalAlpha=0:e.globalAlpha=Math.min((c-b)/x,1):C&&(e.globalAlpha=Math.max(1-(c-A)/v,0)),e.drawImage(P,0,0,n,o)),T&&c-b>=x&&2<=k&&(T=!1,O=c),!T&&c-O>=E&&!C&&1<=this.progress&&(C=!0,A=c),(C&&c-A>=v+S||"undefined"!=typeof cr_is_preview&&1<=this.progress&&500>Date.now()-b)&&(f=!0,T=!1,C=!1,P=null,I=null,this.loaderlogos=null),++k}},e.prototype.go_loading_finished=function(){this.overlay_canvas&&(this.canvas.parentNode.removeChild(this.overlay_canvas),this.overlay_ctx=null,this.overlay_canvas=null),this.start_time=Date.now(),this.last_fps_time=cr.performance_now();var e,r,n;if(this.uses_loader_layout)for(e=0,r=this.types_by_index.length;e<r;e++)n=this.types_by_index[e],n.is_family||n.isOnLoaderLayout||!n.plugin.is_world||(n.onCreate(),cr.seal(n));else this.isloading=!1;for(e=0,r=this.layouts_by_index.length;e<r;e++)this.layouts_by_index[e].createGlobalNonWorlds();if(2<=this.fullscreen_mode){var o=this.original_width/this.original_height,a=this.width/this.height;this.aspect_scale=2!==this.fullscreen_mode&&a>o||2===this.fullscreen_mode&&a<o?this.height/this.original_height:this.width/this.original_width}this.first_layout?this.layouts[this.first_layout].startRunning():this.layouts_by_index[0].startRunning();for(this.uses_loader_layout||(this.loadingprogress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C2_RegisterSW&&window.C2_RegisterSW()),navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide(),(e=0,r=this.types_by_index.length);e<r;e++)n=this.types_by_index[e],n.onAppBegin&&n.onAppBegin();document.hidden||document.webkitHidden||document.mozHidden||document.msHidden?window.cr_setSuspended(!0):this.tick(!1),this.isDirectCanvas&&AppMobi.webview.execute("onGameReady();")},e.prototype.tick=function(e,t,r){if(this.running_layout){var n=cr.performance_now();if(r||!this.isSuspended||e){e||(c?this.raf_id=c(this.tickFunc):this.timeout_id=setTimeout(this.tickFunc,this.isMobile?1:16));var o=this.fullscreen_mode,a=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement)&&!this.isCordova;if((a||this.isNodeFullscreen)&&0<this.fullscreen_scaling&&(o=this.fullscreen_scaling),0<o){var i=window.innerWidth,s=window.innerHeight;(this.lastWindowWidth!==i||this.lastWindowHeight!==s)&&this.setSize(i,s)}if(this.isDomFree||(a?!this.firstInFullscreen&&(this.firstInFullscreen=!0):this.firstInFullscreen?(this.firstInFullscreen=!1,0===this.fullscreen_mode&&this.setSize(Math.round(this.oldWidth/this.devicePixelRatio),Math.round(this.oldHeight/this.devicePixelRatio),!0)):(this.oldWidth=this.width,this.oldHeight=this.height)),this.isloading){var l=this.areAllTexturesAndSoundsLoaded();this.loadingprogress=this.progress,l&&(this.isloading=!1,this.progress=1,this.trigger(cr.system_object.prototype.cnds.OnLoadFinished,null),window.C2_RegisterSW&&window.C2_RegisterSW())}this.logic(t||n),!this.redraw&&!this.isCocoonJs||this.is_WebGL_context_lost||this.suspendDrawing||e||(this.redraw=!1,this.glwrap?this.drawGL():this.draw(),this.snapshotCanvas&&(this.canvas&&this.canvas.toDataURL&&(this.snapshotData=this.canvas.toDataURL(this.snapshotCanvas[0],this.snapshotCanvas[1]),window.cr_onSnapshot&&window.cr_onSnapshot(this.snapshotData),this.trigger(cr.system_object.prototype.cnds.OnCanvasSnapshot,null)),this.snapshotCanvas=null)),this.hit_breakpoint||(this.tickcount++,this.tickcount_nosave++,this.execcount++,this.framecount++),this.logictime+=cr.performance_now()-n}}},e.prototype.logic=function(e){var t,r,n,o,a,s,l,p,d;1e3<=e-this.last_fps_time&&(this.last_fps_time+=1e3,1e3<=e-this.last_fps_time&&(this.last_fps_time=e),this.fps=this.framecount,this.framecount=0,this.cpuutilisation=this.logictime,this.logictime=0);var c=0;if(0!==this.last_tick_time){var u=e-this.last_tick_time;0>u&&(u=0),c=u/1e3,this.dt1=c,.5<this.dt1?this.dt1=0:this.dt1>1/this.minimumFramerate&&(this.dt1=1/this.minimumFramerate)}this.last_tick_time=e,this.dt=this.dt1*this.timescale,this.kahanTime.add(this.dt),this.wallTime.add(c);var g=(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||!!document.msFullscreenElement||this.isNodeFullscreen)&&!this.isCordova;if(2<=this.fullscreen_mode||g&&0<this.fullscreen_scaling){var y=this.original_width/this.original_height,m=this.width/this.height,_=this.fullscreen_mode;g&&0<this.fullscreen_scaling&&(_=this.fullscreen_scaling),this.aspect_scale=2!==_&&m>y||2===_&&m<y?this.height/this.original_height:this.width/this.original_width,this.running_layout&&(this.running_layout.scrollToX(this.running_layout.scrollX),this.running_layout.scrollToY(this.running_layout.scrollY))}else this.aspect_scale=this.isRetina?this.devicePixelRatio:1;this.ClearDeathRow(),this.isInOnDestroy++,this.system.runWaits(),this.isInOnDestroy--,this.ClearDeathRow(),this.isInOnDestroy++;var h=this.objects_to_pretick.valuesRef();for(t=0,r=h.length;t<r;t++)h[t].pretick();for(t=0,r=this.types_by_index.length;t<r;t++)if(l=this.types_by_index[t],!l.is_family&&(l.behaviors.length||l.families.length))for(n=0,o=l.instances.length;n<o;n++)for(p=l.instances[n],a=0,s=p.behavior_insts.length;a<s;a++)p.behavior_insts[a].tick();for(t=0,r=this.types_by_index.length;t<r;t++)if(l=this.types_by_index[t],!l.is_family&&(l.behaviors.length||l.families.length))for(n=0,o=l.instances.length;n<o;n++)for(p=l.instances[n],a=0,s=p.behavior_insts.length;a<s;a++)d=p.behavior_insts[a],d.posttick&&d.posttick();for(h=this.objects_to_tick.valuesRef(),t=0,r=h.length;t<r;t++)h[t].tick();for(this.isInOnDestroy--,this.handleSaveLoad(),t=0;this.changelayout&&10>t++;)this.doChangeLayout(this.changelayout);for(t=0,r=this.eventsheets_by_index.length;t<r;t++)this.eventsheets_by_index[t].hasRun=!1;for(this.running_layout.event_sheet&&this.running_layout.event_sheet.run(),cr.clearArray(this.registered_collisions),this.layout_first_tick=!1,this.isInOnDestroy++,(t=0,r=this.types_by_index.length);t<r;t++)if(l=this.types_by_index[t],!l.is_family&&(l.behaviors.length||l.families.length))for(n=0,o=l.instances.length;n<o;n++){var p=l.instances[n];for(a=0,s=p.behavior_insts.length;a<s;a++)d=p.behavior_insts[a],d.tick2&&d.tick2()}for(h=this.objects_to_tick2.valuesRef(),t=0,r=h.length;t<r;t++)h[t].tick2();this.isInOnDestroy--},e.prototype.onWindowBlur=function(){var e,t,r,n,o,a,s,l,p;for(e=0,t=this.types_by_index.length;e<t;e++)if(s=this.types_by_index[e],!s.is_family)for(r=0,n=s.instances.length;r<n;r++)if(l=s.instances[r],l.onWindowBlur&&l.onWindowBlur(),l.behavior_insts)for(o=0,a=l.behavior_insts.length;o<a;o++)p=l.behavior_insts[o],p.onWindowBlur&&p.onWindowBlur()},e.prototype.doChangeLayout=function(e){var t=this.running_layout;this.running_layout.stopRunning();var r,n,o;if(this.glwrap)for(r=0,n=this.types_by_index.length;r<n;r++)o=this.types_by_index[r],o.is_family||o.unloadTextures&&(!o.global||0===o.instances.length)&&-1===e.initial_types.indexOf(o)&&o.unloadTextures();t==e&&cr.clearArray(this.system.waits),cr.clearArray(this.registered_collisions),this.runLayoutChangeMethods(!0),e.startRunning(),this.runLayoutChangeMethods(!1),this.redraw=!0,this.layout_first_tick=!0,this.ClearDeathRow()},e.prototype.runLayoutChangeMethods=function(e){var t,r,n,o,a,s,l,p,d,c;for(t=0,r=this.behaviors.length;t<r;t++)n=this.behaviors[t],e?n.onBeforeLayoutChange&&n.onBeforeLayoutChange():n.onLayoutChange&&n.onLayoutChange();for(t=0,r=this.types_by_index.length;t<r;t++)if(o=this.types_by_index[t],o.global||o.plugin.singleglobal)for(a=0,s=o.instances.length;a<s;a++)if(l=o.instances[a],e?l.onBeforeLayoutChange&&l.onBeforeLayoutChange():l.onLayoutChange&&l.onLayoutChange(),l.behavior_insts)for(p=0,d=l.behavior_insts.length;p<d;p++)c=l.behavior_insts[p],e?c.onBeforeLayoutChange&&c.onBeforeLayoutChange():c.onLayoutChange&&c.onLayoutChange()},e.prototype.pretickMe=function(e){this.objects_to_pretick.add(e)},e.prototype.unpretickMe=function(e){this.objects_to_pretick.remove(e)},e.prototype.tickMe=function(e){this.objects_to_tick.add(e)},e.prototype.untickMe=function(e){this.objects_to_tick.remove(e)},e.prototype.tick2Me=function(e){this.objects_to_tick2.add(e)},e.prototype.untick2Me=function(e){this.objects_to_tick2.remove(e)},e.prototype.getDt=function(e){return e&&-1!==e.my_timescale?this.dt1*e.my_timescale:this.dt},e.prototype.draw=function(){this.running_layout.draw(this.ctx),this.isDirectCanvas&&this.ctx.present()},e.prototype.drawGL=function(){this.enableFrontToBack&&(this.earlyz_index=1,this.running_layout.drawGL_earlyZPass(this.glwrap)),this.running_layout.drawGL(this.glwrap),this.glwrap.present()},e.prototype.addDestroyCallback=function(e){e&&this.destroycallbacks.push(e)},e.prototype.removeDestroyCallback=function(e){cr.arrayFindRemove(this.destroycallbacks,e)},e.prototype.getObjectByUID=function(e){var t=e.toString();return this.objectsByUid.hasOwnProperty(t)?this.objectsByUid[t]:null};var L=[];e.prototype.DestroyInstance=function(e){var t=e.type,r=t.name,o=this.deathRow.hasOwnProperty(r),a=null,s,l;if(!o)a=n(),this.deathRow[r]=a;else if(a=this.deathRow[r],a.contains(e))return;if(a.add(e),this.hasPendingInstances=!0,e.is_contained)for(s=0,l=e.siblings.length;s<l;s++)this.DestroyInstance(e.siblings[s]);this.isInClearDeathRow&&a.values_cache.push(e),this.isEndingLayout||(this.isInOnDestroy++,this.trigger(Object.getPrototypeOf(e.type.plugin).cnds.OnDestroyed,e),this.isInOnDestroy--)},e.prototype.ClearDeathRow=function(){if(this.hasPendingInstances){var e,t,r,n,o,a;for(this.isInClearDeathRow=!0,r=0,o=this.createRow.length;r<o;++r)for(e=this.createRow[r],t=e.type,t.instances.push(e),(n=0,a=t.families.length);n<a;++n)t.families[n].instances.push(e),t.families[n].stale_iids=!0;cr.clearArray(this.createRow),this.IterateDeathRow(),cr.wipe(this.deathRow),this.isInClearDeathRow=!1,this.hasPendingInstances=!1}},e.prototype.IterateDeathRow=function(){for(var e in this.deathRow)this.deathRow.hasOwnProperty(e)&&this.ClearDeathRowForType(this.deathRow[e])},e.prototype.ClearDeathRowForType=function(e){var t=e.valuesRef();var r=t[0].type;var n,a,s,l,p,d,c,u;for(cr.arrayRemoveAllFromObjectSet(r.instances,e),r.stale_iids=!0,0===r.instances.length&&(r.any_instance_parallaxed=!1),(n=0,a=r.families.length);n<a;++n)d=r.families[n],cr.arrayRemoveAllFromObjectSet(d.instances,e),d.stale_iids=!0;for(n=0,a=this.system.waits.length;n<a;++n)if(p=this.system.waits[n],p.sols.hasOwnProperty(r.index)&&cr.arrayRemoveAllFromObjectSet(p.sols[r.index].insts,e),!r.is_family)for(s=0,l=r.families.length;s<l;++s)d=r.families[s],p.sols.hasOwnProperty(d.index)&&cr.arrayRemoveAllFromObjectSet(p.sols[d.index].insts,e);var g=t[0].layer;if(g){if(g.useRenderCells)for(c=g.instances,n=0,a=c.length;n<a;++n)u=c[n],e.contains(u)&&(u.update_bbox(),g.render_grid.update(u,u.rendercells,null),u.rendercells.set(0,0,-1,-1));cr.arrayRemoveAllFromObjectSet(g.instances,e),g.setZIndicesStaleFrom(0)}for(n=0;n<t.length;++n)this.ClearDeathRowForSingleInstance(t[n],r);o(e),this.redraw=!0},e.prototype.ClearDeathRowForSingleInstance=function(e,t){var r,n,o;for(r=0,n=this.destroycallbacks.length;r<n;++r)this.destroycallbacks[r](e);e.collcells&&t.collision_grid.update(e,e.collcells,null);var a=e.layer;if(a&&a.removeFromInstanceList(e,!0),e.behavior_insts)for(r=0,n=e.behavior_insts.length;r<n;++r)o=e.behavior_insts[r],o.onDestroy&&o.onDestroy(),o.behavior.my_instances.remove(e);this.objects_to_pretick.remove(e),this.objects_to_tick.remove(e),this.objects_to_tick2.remove(e),e.onDestroy&&e.onDestroy(),this.objectsByUid.hasOwnProperty(e.uid.toString())&&delete this.objectsByUid[e.uid.toString()],this.objectcount--,100>t.deadCache.length&&t.deadCache.push(e)},e.prototype.createInstance=function(e,t,r,n){if(e.is_family){var o=cr.floor(Math.random()*e.members.length);return this.createInstance(e.members[o],t,r,n)}return e.default_instance?this.createInstanceFromInit(e.default_instance,t,!1,r,n,!1):null};var R=[];e.prototype.createInstanceFromInit=function(e,t,r,n,o,a){var s,l,p,d,c;if(!e)return null;var u=this.types_by_index[e[1]],g=u.plugin.is_world;if(this.isloading&&g&&!u.isOnLoaderLayout)return null;if(g&&!this.glwrap&&11===e[0][11])return null;var y=t;g||(t=null);var m;for(u.deadCache.length?(m=u.deadCache.pop(),m.recycled=!0,u.plugin.Instance.call(m,u)):(m=new u.plugin.Instance(u),m.recycled=!1),m.uid=!r||a||this.objectsByUid.hasOwnProperty(e[2].toString())?this.next_uid++:e[2],this.objectsByUid[m.uid.toString()]=m,m.puid=this.next_puid++,m.iid=u.instances.length,(s=0,l=this.createRow.length);s<l;++s)this.createRow[s].type===u&&m.iid++;m.get_iid=cr.inst_get_iid,m.toString=cr.inst_toString;var _=e[3];if(m.recycled)cr.wipe(m.extra);else{if(m.extra={},"undefined"!=typeof cr_is_preview)for(m.instance_var_names=[],m.instance_var_names.length=_.length,(s=0,l=_.length);s<l;s++)m.instance_var_names[s]=_[s][1];m.instance_vars=[],m.instance_vars.length=_.length}for(s=0,l=_.length;s<l;s++)m.instance_vars[s]=_[s][0];if(g){var h=e[0];if(m.x=cr.is_undefined(n)?h[0]:n,m.y=cr.is_undefined(o)?h[1]:o,m.z=h[2],m.width=h[3],m.height=h[4],m.depth=h[5],m.angle=h[6],m.opacity=h[7],m.hotspotX=h[8],m.hotspotY=h[9],m.blend_mode=h[10],c=h[11],!this.glwrap&&u.effect_types.length&&(m.blend_mode=c),m.compositeOp=cr.effectToCompositeOp(m.blend_mode),this.gl&&cr.setGLBlend(m,m.blend_mode,this.gl),m.recycled){for(s=0,l=h[12].length;s<l;s++)for(p=0,d=h[12][s].length;p<d;p++)m.effect_params[s][p]=h[12][s][p];m.bbox.set(0,0,0,0),m.collcells.set(0,0,-1,-1),m.rendercells.set(0,0,-1,-1),m.bquad.set_from_rect(m.bbox),cr.clearArray(m.bbox_changed_callbacks)}else{for(m.effect_params=h[12].slice(0),s=0,l=m.effect_params.length;s<l;s++)m.effect_params[s]=h[12][s].slice(0);m.active_effect_types=[],m.active_effect_flags=[],m.active_effect_flags.length=u.effect_types.length,m.bbox=new cr.rect(0,0,0,0),m.collcells=new cr.rect(0,0,-1,-1),m.rendercells=new cr.rect(0,0,-1,-1),m.bquad=new cr.quad,m.bbox_changed_callbacks=[],m.set_bbox_changed=cr.set_bbox_changed,m.add_bbox_changed_callback=cr.add_bbox_changed_callback,m.contains_pt=cr.inst_contains_pt,m.update_bbox=cr.update_bbox,m.update_render_cell=cr.update_render_cell,m.update_collision_cell=cr.update_collision_cell,m.get_zindex=cr.inst_get_zindex}for(m.tilemap_exists=!1,m.tilemap_width=0,m.tilemap_height=0,m.tilemap_data=null,14===h.length&&(m.tilemap_exists=!0,m.tilemap_width=h[13][0],m.tilemap_height=h[13][1],m.tilemap_data=h[13][2]),(s=0,l=u.effect_types.length);s<l;s++)m.active_effect_flags[s]=!0;m.shaders_preserve_opaqueness=!0,m.updateActiveEffects=cr.inst_updateActiveEffects,m.updateActiveEffects(),m.uses_shaders=!!m.active_effect_types.length,m.bbox_changed=!0,m.cell_changed=!0,u.any_cell_changed=!0,m.visible=!0,m.my_timescale=-1,m.layer=t,m.zindex=t.instances.length,m.earlyz_index=0,"undefined"==typeof m.collision_poly&&(m.collision_poly=null),m.collisionsEnabled=!0,this.redraw=!0}var f,b;for(cr.clearArray(R),s=0,l=u.families.length;s<l;s++)R.push.apply(R,u.families[s].behaviors);if(R.push.apply(R,u.behaviors),m.recycled)for(s=0,l=R.length;s<l;s++){var x=R[s];for(b=m.behavior_insts[s],b.recycled=!0,x.behavior.Instance.call(b,x,m),f=e[4][s],(p=0,d=f.length);p<d;p++)b.properties[p]=f[p];b.onCreate(),x.behavior.my_instances.add(m)}else for(m.behavior_insts=[],s=0,l=R.length;s<l;s++){var x=R[s],b=new x.behavior.Instance(x,m);b.recycled=!1,b.properties=e[4][s].slice(0),b.onCreate(),cr.seal(b),m.behavior_insts.push(b),x.behavior.my_instances.add(m)}if(f=e[5],m.recycled)for(s=0,l=f.length;s<l;s++)m.properties[s]=f[s];else m.properties=f.slice(0);if(this.createRow.push(m),this.hasPendingInstances=!0,(t&&(t.appendToInstanceList(m,!0),(1!==t.parallaxX||1!==t.parallaxY)&&(u.any_instance_parallaxed=!0)),this.objectcount++,!u.is_contained))m.is_contained=!1,m.siblings=null;else if(m.is_contained=!0,m.recycled?cr.clearArray(m.siblings):m.siblings=[],!r&&!a){for(s=0,l=u.container.length;s<l;s++)if(u.container[s]!==u){if(!u.container[s].default_instance)return null;m.siblings.push(this.createInstanceFromInit(u.container[s].default_instance,y,!1,g?m.x:n,g?m.y:o,!0))}for(s=0,l=m.siblings.length;s<l;s++)for(m.siblings[s].siblings.push(m),p=0;p<l;p++)s!==p&&m.siblings[s].siblings.push(m.siblings[p])}for(m.onCreate(),m.recycled||cr.seal(m),(s=0,l=m.behavior_insts.length);s<l;s++)m.behavior_insts[s].postCreate&&m.behavior_insts[s].postCreate();return m},e.prototype.getLayerByName=function(e){var t,r;for(t=0,r=this.running_layout.layers.length;t<r;t++){var n=this.running_layout.layers[t];if(cr.equals_nocase(n.name,e))return n}return null},e.prototype.getLayerByNumber=function(e){return e=cr.floor(e),0>e&&(e=0),e>=this.running_layout.layers.length&&(e=this.running_layout.layers.length-1),this.running_layout.layers[e]},e.prototype.getLayer=function(e){return cr.is_number(e)?this.getLayerByNumber(e):this.getLayerByName(e.toString())},e.prototype.clearSol=function(e){var t,r;for(t=0,r=e.length;t<r;t++)e[t].getCurrentSol().select_all=!0},e.prototype.pushCleanSol=function(e){var t,r;for(t=0,r=e.length;t<r;t++)e[t].pushCleanSol()},e.prototype.pushCopySol=function(e){var t,r;for(t=0,r=e.length;t<r;t++)e[t].pushCopySol()},e.prototype.popSol=function(e){var t,r;for(t=0,r=e.length;t<r;t++)e[t].popSol()},e.prototype.updateAllCells=function(e){if(e.any_cell_changed){var t=e.instances,r,n;for(r=0,n=t.length;r<n;++r)t[r].update_collision_cell();var o=this.createRow;for(r=0,n=o.length;r<n;++r)o[r].type===e&&o[r].update_collision_cell();e.any_cell_changed=!1}},e.prototype.getCollisionCandidates=function(e,r,n,o){var a=!!e&&(1!==e.parallaxX||1!==e.parallaxY),s,l,p;if(r.is_family)for(s=0,l=r.members.length;s<l;++s)p=r.members[s],a||p.any_instance_parallaxed?cr.appendArray(o,p.instances):(this.updateAllCells(p),p.collision_grid.queryRange(n,o));else a||r.any_instance_parallaxed?cr.appendArray(o,r.instances):(this.updateAllCells(r),r.collision_grid.queryRange(n,o))},e.prototype.getTypesCollisionCandidates=function(e,t,r,n){var o,a;for(o=0,a=t.length;o<a;++o)this.getCollisionCandidates(e,t[o],r,n)},e.prototype.getSolidCollisionCandidates=function(e,t,r){var n=this.getSolidBehavior();return n?void this.getTypesCollisionCandidates(e,n.my_types,t,r):null},e.prototype.getJumpthruCollisionCandidates=function(e,t,r){var n=this.getJumpthruBehavior();return n?void this.getTypesCollisionCandidates(e,n.my_types,t,r):null},e.prototype.testAndSelectCanvasPointOverlap=function(e,t,r,n){var o=e.getCurrentSol(),a=this.getCurrentEventStack().current_event.orblock,s,l,p,d,c,u,g;if(o.select_all){for(n||(o.select_all=!1,cr.clearArray(o.instances)),s=0,d=e.instances.length;s<d;s++)if(p=e.instances[s],p.update_bbox(),c=p.layer.canvasToLayer(t,r,!0),u=p.layer.canvasToLayer(t,r,!1),p.contains_pt(c,u)){if(n)return!1;o.instances.push(p)}else a&&o.else_instances.push(p);}else{for(l=0,g=a?o.else_instances:o.instances,(s=0,d=g.length);s<d;s++)if(p=g[s],p.update_bbox(),c=p.layer.canvasToLayer(t,r,!0),u=p.layer.canvasToLayer(t,r,!1),p.contains_pt(c,u)){if(n)return!1;a?o.instances.push(p):(o.instances[l]=o.instances[s],l++)}n||(g.length=l)}return e.applySolToContainer(),!!n||o.hasObjects()},e.prototype.testOverlap=function(e,t){if(!e||!t||e===t||!e.collisionsEnabled||!t.collisionsEnabled)return!1;e.update_bbox(),t.update_bbox();var r=e.layer,n=t.layer,o=r!==n&&(r.parallaxX!==n.parallaxX||n.parallaxY!==n.parallaxY||r.scale!==n.scale||r.angle!==n.angle||r.zoomRate!==n.zoomRate),a,s,l,p,d,c,u,g,m,_;if(!o)return!!e.bbox.intersects_rect(t.bbox)&&!!e.bquad.intersects_quad(t.bquad)&&!(e.tilemap_exists&&t.tilemap_exists)&&(e.tilemap_exists?this.testTilemapOverlap(e,t):t.tilemap_exists?this.testTilemapOverlap(t,e):(u=e.collision_poly&&!e.collision_poly.is_empty(),g=t.collision_poly&&!t.collision_poly.is_empty(),!(u||g))||(u?(e.collision_poly.cache_poly(e.width,e.height,e.angle),m=e.collision_poly):(this.temp_poly.set_from_quad(e.bquad,e.x,e.y,e.width,e.height),m=this.temp_poly),g?(t.collision_poly.cache_poly(t.width,t.height,t.angle),_=t.collision_poly):(this.temp_poly.set_from_quad(t.bquad,t.x,t.y,t.width,t.height),_=this.temp_poly),m.intersects_poly(_,t.x-e.x,t.y-e.y)));for(u=e.collision_poly&&!e.collision_poly.is_empty(),g=t.collision_poly&&!t.collision_poly.is_empty(),u?(e.collision_poly.cache_poly(e.width,e.height,e.angle),this.temp_poly.set_from_poly(e.collision_poly)):this.temp_poly.set_from_quad(e.bquad,e.x,e.y,e.width,e.height),m=this.temp_poly,g?(t.collision_poly.cache_poly(t.width,t.height,t.angle),this.temp_poly2.set_from_poly(t.collision_poly)):this.temp_poly2.set_from_quad(t.bquad,t.x,t.y,t.width,t.height),_=this.temp_poly2,(a=0,s=m.pts_count);a<s;a++)l=2*a,p=l+1,d=m.pts_cache[l],c=m.pts_cache[p],m.pts_cache[l]=r.layerToCanvas(d+e.x,c+e.y,!0),m.pts_cache[p]=r.layerToCanvas(d+e.x,c+e.y,!1);for(m.update_bbox(),a=0,s=_.pts_count;a<s;a++)l=2*a,p=l+1,d=_.pts_cache[l],c=_.pts_cache[p],_.pts_cache[l]=n.layerToCanvas(d+t.x,c+t.y,!0),_.pts_cache[p]=n.layerToCanvas(d+t.x,c+t.y,!1);return _.update_bbox(),m.intersects_poly(_,0,0)};var B=new cr.quad,F=new cr.rect(0,0,0,0),N=[];e.prototype.testTilemapOverlap=function(e,t){var r=t.bbox,n=e.x,o=e.y,a,s,l,p;e.getCollisionRectCandidates(r,N);var d=N,u=t.collision_poly&&!t.collision_poly.is_empty();for(a=0,s=d.length;a<s;++a)if(l=d[a],p=l.rc,r.intersects_rect_off(p,n,o)&&(B.set_from_rect(p),B.offset(n,o),B.intersects_quad(t.bquad)))if(!u){if(!l.poly)return cr.clearArray(N),!0;if(this.temp_poly.set_from_quad(t.bquad,0,0,t.width,t.height),l.poly.intersects_poly(this.temp_poly,-(n+p.left),-(o+p.top)))return cr.clearArray(N),!0}else if(t.collision_poly.cache_poly(t.width,t.height,t.angle),l.poly){if(l.poly.intersects_poly(t.collision_poly,t.x-(n+p.left),t.y-(o+p.top)))return cr.clearArray(N),!0;}else if(this.temp_poly.set_from_quad(B,0,0,p.right-p.left,p.bottom-p.top),this.temp_poly.intersects_poly(t.collision_poly,t.x,t.y))return cr.clearArray(N),!0;return cr.clearArray(N),!1},e.prototype.testRectOverlap=function(e,t){if(!t||!t.collisionsEnabled)return!1;t.update_bbox();var r=t.layer,n;if(!t.bbox.intersects_rect(e))return!1;if(t.tilemap_exists){t.getCollisionRectCandidates(e,N);var o=N,a=t.x,s=t.y,l,p,d,u;for(l=0,p=o.length;l<p;++l)if(d=o[l],u=d.rc,e.intersects_rect_off(u,a,s)){if(!d.poly)return cr.clearArray(N),!0;if(this.temp_poly.set_from_rect(e,0,0),d.poly.intersects_poly(this.temp_poly,-(a+u.left),-(s+u.top)))return cr.clearArray(N),!0}return cr.clearArray(N),!1}return(B.set_from_rect(e),!!t.bquad.intersects_quad(B))&&((n=t.collision_poly&&!t.collision_poly.is_empty(),!!!n)||(t.collision_poly.cache_poly(t.width,t.height,t.angle),B.offset(-e.left,-e.top),this.temp_poly.set_from_quad(B,0,0,1,1),t.collision_poly.intersects_poly(this.temp_poly,e.left-t.x,e.top-t.y)))},e.prototype.testSegmentOverlap=function(e,t,r,n,o){if(!o||!o.collisionsEnabled)return!1;o.update_bbox();var a=o.layer,s;if(F.set(cr.min(e,r),cr.min(t,n),cr.max(e,r),cr.max(t,n)),!o.bbox.intersects_rect(F))return!1;if(o.tilemap_exists){o.getCollisionRectCandidates(F,N);var l=N,p=o.x,d=o.y,u,g,y,m;for(u=0,g=l.length;u<g;++u)if(y=l[u],m=y.rc,F.intersects_rect_off(m,p,d)&&(B.set_from_rect(m),B.offset(p,d),B.intersects_segment(e,t,r,n))){if(!y.poly)return cr.clearArray(N),!0;if(y.poly.intersects_segment(p+m.left,d+m.top,e,t,r,n))return cr.clearArray(N),!0}return cr.clearArray(N),!1}return!!o.bquad.intersects_segment(e,t,r,n)&&((s=o.collision_poly&&!o.collision_poly.is_empty(),!!!s)||(o.collision_poly.cache_poly(o.width,o.height,o.angle),o.collision_poly.intersects_segment(o.x,o.y,e,t,r,n)))},e.prototype.typeHasBehavior=function(e,t){if(!t)return!1;var r,n,o,a,s;for(r=0,n=e.behaviors.length;r<n;r++)if(e.behaviors[r].behavior instanceof t)return!0;if(!e.is_family)for(r=0,n=e.families.length;r<n;r++)for(s=e.families[r],o=0,a=s.behaviors.length;o<a;o++)if(s.behaviors[o].behavior instanceof t)return!0;return!1},e.prototype.typeHasNoSaveBehavior=function(e){return this.typeHasBehavior(e,cr.behaviors.NoSave)},e.prototype.typeHasPersistBehavior=function(e){return this.typeHasBehavior(e,cr.behaviors.Persist)},e.prototype.getSolidBehavior=function(){return this.solidBehavior},e.prototype.getJumpthruBehavior=function(){return this.jumpthruBehavior};var D=[];e.prototype.testOverlapSolid=function(e){var t,r,n;for(e.update_bbox(),this.getSolidCollisionCandidates(e.layer,e.bbox,D),(t=0,r=D.length);t<r;++t)if(n=D[t],n.extra.solidEnabled&&this.testOverlap(e,n))return cr.clearArray(D),n;return cr.clearArray(D),null},e.prototype.testRectOverlapSolid=function(e){var t,r,n;for(this.getSolidCollisionCandidates(null,e,D),t=0,r=D.length;t<r;++t)if(n=D[t],n.extra.solidEnabled&&this.testRectOverlap(e,n))return cr.clearArray(D),n;return cr.clearArray(D),null};var M=[];e.prototype.testOverlapJumpThru=function(e,t){var r=null;t&&(r=M,cr.clearArray(r)),e.update_bbox(),this.getJumpthruCollisionCandidates(e.layer,e.bbox,D);var n,o,a;for(n=0,o=D.length;n<o;++n)if(a=D[n],a.extra.jumpthruEnabled&&this.testOverlap(e,a))if(t)r.push(a);else return cr.clearArray(D),a;return cr.clearArray(D),r},e.prototype.pushOutSolid=function(e,t,r,n,o,a){var s=e.x,l=e.y,p=null,d=null,c;for(c=0;c<(n||50);c++)if(e.x=s+t*c,e.y=l+r*c,e.set_bbox_changed(),!this.testOverlap(e,p)&&(p=this.testOverlapSolid(e),p&&(d=p),!p&&(o&&(p=a?this.testOverlap(e,a)?a:null:this.testOverlapJumpThru(e),p&&(d=p)),!p)))return d&&this.pushInFractional(e,t,r,d,16),!0;return e.x=s,e.y=l,e.set_bbox_changed(),!1},e.prototype.pushOutSolidAxis=function(e,t,r,n){n=n||50;var o=e.x,a=e.y,s=null,l=null,p,d,c;for(p=0;p<n;++p)for(d=0;2>d;++d)if(c=2*d-1,e.x=o+t*p*c,e.y=a+r*p*c,e.set_bbox_changed(),!this.testOverlap(e,s))if(s=this.testOverlapSolid(e),s)l=s;else return l&&this.pushInFractional(e,t*c,r*c,l,16),!0;return e.x=o,e.y=a,e.set_bbox_changed(),!1},e.prototype.pushOut=function(e,t,r,n,o){var a=e.x,s=e.y,l;for(l=0;l<(n||50);l++)if(e.x=a+t*l,e.y=s+r*l,e.set_bbox_changed(),!this.testOverlap(e,o))return!0;return e.x=a,e.y=s,e.set_bbox_changed(),!1},e.prototype.pushInFractional=function(e,t,r,n,o){for(var a=2,i=!1,s=!1,l=e.x,p=e.y,d;a<=o;)d=1/a,a*=2,e.x+=t*d*(i?1:-1),e.y+=r*d*(i?1:-1),e.set_bbox_changed(),this.testOverlap(e,n)?(i=!0,s=!0):(i=!1,s=!1,l=e.x,p=e.y);s&&(e.x=l,e.y=p,e.set_bbox_changed())},e.prototype.pushOutSolidNearest=function(e,t){var r=cr.is_undefined(t)?100:t,n=0,o=e.x,a=e.y,i=0,s=0,l=0,p=this.testOverlapSolid(e);if(!p)return!0;for(;n<=r;)if(0===i?(s=0,l=-1,n++):1===i?(s=1,l=-1):2===i?(s=1,l=0):3===i?(s=1,l=1):4===i?(s=0,l=1):5===i?(s=-1,l=1):6===i?(s=-1,l=0):7===i?(s=-1,l=-1):void 0,i=(i+1)%8,e.x=cr.floor(o+s*n),e.y=cr.floor(a+l*n),e.set_bbox_changed(),!this.testOverlap(e,p)&&(p=this.testOverlapSolid(e),!p))return!0;return e.x=o,e.y=a,e.set_bbox_changed(),!1},e.prototype.registerCollision=function(e,t){e.collisionsEnabled&&t.collisionsEnabled&&this.registered_collisions.push([e,t])},e.prototype.addRegisteredCollisionCandidates=function(e,t,n){var o,a,s,l;for(o=0,a=this.registered_collisions.length;o<a;++o){if(s=this.registered_collisions[o],s[0]===e)l=s[1];else if(s[1]===e)l=s[0];else continue;if(t.is_family){if(-1===t.members.indexOf(t))continue;}else if(l.type!==t)continue;-1===n.indexOf(l)&&n.push(l)}},e.prototype.checkRegisteredCollision=function(e,t){var r,n,o;for(r=0,n=this.registered_collisions.length;r<n;r++)if(o=this.registered_collisions[r],o[0]===e&&o[1]===t||o[0]===t&&o[1]===e)return!0;return!1},e.prototype.calculateSolidBounceAngle=function(e,t,r,n){var o=e.x,a=e.y,s=cr.max(10,cr.distanceTo(t,r,o,a)),l=cr.angleTo(t,r,o,a),p=n||this.testOverlapSolid(e);if(!p)return cr.clamp_angle(l+cr.PI);var d=p,c=cr.to_radians(5),u,g,y,m;for(u=1;36>u;u++)if(g=l-u*c,e.x=t+Math.cos(g)*s,e.y=r+Math.sin(g)*s,e.set_bbox_changed(),!this.testOverlap(e,d)&&(d=n?null:this.testOverlapSolid(e),!d)){y=g;break}36===u&&(y=cr.clamp_angle(l+cr.PI));var d=p;for(u=1;36>u;u++)if(g=l+u*c,e.x=t+Math.cos(g)*s,e.y=r+Math.sin(g)*s,e.set_bbox_changed(),!this.testOverlap(e,d)&&(d=n?null:this.testOverlapSolid(e),!d)){m=g;break}if(36===u&&(m=cr.clamp_angle(l+cr.PI)),e.x=o,e.y=a,e.set_bbox_changed(),m===y)return m;var _=cr.angleDiff(m,y)/2,h;h=cr.angleClockwise(m,y)?cr.clamp_angle(y+_+cr.PI):cr.clamp_angle(m+_);var f=Math.cos(l),b=Math.sin(l),x=Math.cos(h),v=Math.sin(h),w=f*x+b*v;return cr.angleTo(0,0,f-2*w*x,b-2*w*v)};var W=-1;e.prototype.trigger=function(e,t,n){if(!this.running_layout)return!1;var o=this.running_layout.event_sheet;if(!o)return!1;var a=!1,s,l,p;W++;var d=o.deep_includes;for(l=0,p=d.length;l<p;++l)s=this.triggerOnSheet(e,t,d[l],n),a=a||s;return s=this.triggerOnSheet(e,t,o,n),a=a||s,W--,a},e.prototype.triggerOnSheet=function(e,t,n,o){var a=!1,s,l,p,d;if(!t)p=this.triggerOnSheetForTypeName(e,t,"system",n,o),a=a||p;else for(p=this.triggerOnSheetForTypeName(e,t,t.type.name,n,o),a=a||p,d=t.type.families,(s=0,l=d.length);s<l;++s)p=this.triggerOnSheetForTypeName(e,t,d[s].name,n,o),a=a||p;return a},e.prototype.triggerOnSheetForTypeName=function(e,t,r,n,o){var a=!1,s=!1,l="undefined"!=typeof o,p=l?n.fasttriggers:n.triggers,d=p[r],c,u,g,y;if(!d)return a;var m=null;for(c=0,u=d.length;c<u;++c)if(d[c].method==e){m=d[c].evs;break}if(!m)return a;var _;if(_=l?m[o]:m,!_)return null;for(c=0,u=_.length;c<u;c++)g=_[c][0],y=_[c][1],s=this.executeSingleTrigger(t,r,g,y),a=a||s;return a},e.prototype.executeSingleTrigger=function(e,t,r,n){var o=!1,a,s;this.trigger_depth++;var l=this.getCurrentEventStack().current_event;l&&this.pushCleanSol(l.solModifiersIncludingParents);var p=1<this.trigger_depth;this.pushCleanSol(r.solModifiersIncludingParents),p&&this.pushLocalVarStack();var d=this.pushEventStack(r);if(d.current_event=r,e){var c=this.types[t].getCurrentSol();c.select_all=!1,cr.clearArray(c.instances),c.instances[0]=e,this.types[t].applySolToContainer()}var u=!0;if(r.parent){for(var g=d.temp_parents_arr,y=r.parent;y;)g.push(y),y=y.parent;for(g.reverse(),a=0,s=g.length;a<s;a++)if(!g[a].run_pretrigger()){u=!1;break}}return u&&(this.execcount++,r.orblock?r.run_orblocktrigger(n):r.run(),o=o||d.last_event_true),this.popEventStack(),p&&this.popLocalVarStack(),this.popSol(r.solModifiersIncludingParents),l&&this.popSol(l.solModifiersIncludingParents),this.hasPendingInstances&&0===this.isInOnDestroy&&0===W&&!this.isRunningEvents&&this.ClearDeathRow(),this.trigger_depth--,o},e.prototype.getCurrentCondition=function(){var e=this.getCurrentEventStack();return e.current_event.conditions[e.cndindex]},e.prototype.getCurrentConditionObjectType=function(){var e=this.getCurrentCondition();return e.type},e.prototype.isCurrentConditionFirst=function(){var e=this.getCurrentEventStack();return 0===e.cndindex},e.prototype.getCurrentAction=function(){var e=this.getCurrentEventStack();return e.current_event.actions[e.actindex]},e.prototype.pushLocalVarStack=function(){this.localvar_stack_index++,this.localvar_stack_index>=this.localvar_stack.length&&this.localvar_stack.push([])},e.prototype.popLocalVarStack=function(){this.localvar_stack_index--},e.prototype.getCurrentLocalVarStack=function(){return this.localvar_stack[this.localvar_stack_index]},e.prototype.pushEventStack=function(e){this.event_stack_index++,this.event_stack_index>=this.event_stack.length&&this.event_stack.push(new cr.eventStackFrame);var t=this.getCurrentEventStack();return t.reset(e),t},e.prototype.popEventStack=function(){this.event_stack_index--},e.prototype.getCurrentEventStack=function(){return this.event_stack[this.event_stack_index]},e.prototype.pushLoopStack=function(e){this.loop_stack_index++,this.loop_stack_index>=this.loop_stack.length&&this.loop_stack.push(cr.seal({name:e,index:0,stopped:!1}));var t=this.getCurrentLoop();return t.name=e,t.index=0,t.stopped=!1,t},e.prototype.popLoopStack=function(){this.loop_stack_index--},e.prototype.getCurrentLoop=function(){return this.loop_stack[this.loop_stack_index]},e.prototype.getEventVariableByName=function(t,r){for(var n,o,a,s,l,p;r;){for(n=0,o=r.subevents.length;n<o;n++)if(p=r.subevents[n],p instanceof cr.eventvariable&&cr.equals_nocase(t,p.name))return p;r=r.parent}for(n=0,o=this.eventsheets_by_index.length;n<o;n++)for(l=this.eventsheets_by_index[n],a=0,s=l.events.length;a<s;a++)if(p=l.events[a],p instanceof cr.eventvariable&&cr.equals_nocase(t,p.name))return p;return null},e.prototype.getLayoutBySid=function(e){var t,r;for(t=0,r=this.layouts_by_index.length;t<r;t++)if(this.layouts_by_index[t].sid===e)return this.layouts_by_index[t];return null},e.prototype.getObjectTypeBySid=function(e){var t,r;for(t=0,r=this.types_by_index.length;t<r;t++)if(this.types_by_index[t].sid===e)return this.types_by_index[t];return null},e.prototype.getGroupBySid=function(e){var t,r;for(t=0,r=this.allGroups.length;t<r;t++)if(this.allGroups[t].sid===e)return this.allGroups[t];return null},e.prototype.doCanvasSnapshot=function(e,t){this.snapshotCanvas=[e,t],this.redraw=!0};e.prototype.signalContinuousPreview=function(){this.signalledContinuousPreview=!0};e.prototype.handleSaveLoad=function(){var t=this,r=this.saveToSlot,n=this.lastSaveJson,o=this.loadFromSlot,i=!1;if(this.signalledContinuousPreview&&(i=!0,r="__c2_continuouspreview",this.signalledContinuousPreview=!1),r.length){if(this.ClearDeathRow(),n=this.saveToJSONString(),a()&&!this.isCocoonJs)s(r,n,function(){cr.logexport("Saved state to IndexedDB storage ("+n.length+" bytes)"),t.lastSaveJson=n,t.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),t.lastSaveJson="",n="",i&&p()},function(o){try{localStorage.setItem("__c2save_"+r,n),cr.logexport("Saved state to WebStorage ("+n.length+" bytes)"),t.lastSaveJson=n,t.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),t.lastSaveJson="",n="",i&&p()}catch(e){cr.logexport("Failed to save game state: "+o+"; "+e),t.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}});else try{localStorage.setItem("__c2save_"+r,n),cr.logexport("Saved state to WebStorage ("+n.length+" bytes)"),t.lastSaveJson=n,this.trigger(cr.system_object.prototype.cnds.OnSaveComplete,null),t.lastSaveJson="",n="",i&&p()}catch(r){cr.logexport("Error saving to WebStorage: "+r),t.trigger(cr.system_object.prototype.cnds.OnSaveFailed,null)}this.saveToSlot="",this.loadFromSlot="",this.loadFromJson=null}if(o.length){if(a()&&!this.isCocoonJs)l(o,function(e){e?(t.loadFromJson=e,cr.logexport("Loaded state from IndexedDB storage ("+t.loadFromJson.length+" bytes)")):(t.loadFromJson=localStorage.getItem("__c2save_"+o)||"",cr.logexport("Loaded state from WebStorage ("+t.loadFromJson.length+" bytes)")),t.suspendDrawing=!1,t.loadFromJson||(t.loadFromJson=null,t.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))},function(){t.loadFromJson=localStorage.getItem("__c2save_"+o)||"",cr.logexport("Loaded state from WebStorage ("+t.loadFromJson.length+" bytes)"),t.suspendDrawing=!1,t.loadFromJson||(t.loadFromJson=null,t.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))});else{try{this.loadFromJson=localStorage.getItem("__c2save_"+o)||"",cr.logexport("Loaded state from WebStorage ("+this.loadFromJson.length+" bytes)")}catch(t){this.loadFromJson=null}this.suspendDrawing=!1,t.loadFromJson||(t.loadFromJson=null,t.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null))}this.loadFromSlot="",this.saveToSlot=""}if(null!==this.loadFromJson){this.ClearDeathRow();var d=this.loadFromJSONString(this.loadFromJson);d?(this.lastSaveJson=this.loadFromJson,this.trigger(cr.system_object.prototype.cnds.OnLoadComplete,null),this.lastSaveJson=""):t.trigger(cr.system_object.prototype.cnds.OnLoadFailed,null),this.loadFromJson=null}};e.prototype.saveToJSONString=function(){var e={c2save:!0,version:1,rt:{time:this.kahanTime.sum,walltime:this.wallTime.sum,timescale:this.timescale,tickcount:this.tickcount,execcount:this.execcount,next_uid:this.next_uid,running_layout:this.running_layout.sid,start_time_offset:Date.now()-this.start_time},types:{},layouts:{},events:{groups:{},cnds:{},acts:{},vars:{}}},t,r,n,o,s,l,u,y,m,_,h,f;for(t=0,r=this.types_by_index.length;t<r;t++)if(s=this.types_by_index[t],!(s.is_family||this.typeHasNoSaveBehavior(s))){for(u={instances:[]},cr.hasAnyOwnProperty(s.extra)&&(u.ex=d(s.extra)),(n=0,o=s.instances.length);n<o;n++)u.instances.push(this.saveInstanceToJSON(s.instances[n]));e.types[s.sid.toString()]=u}for(t=0,r=this.layouts_by_index.length;t<r;t++)l=this.layouts_by_index[t],e.layouts[l.sid.toString()]=l.saveToJSON();var b=e.events.groups;for(t=0,r=this.allGroups.length;t<r;t++)y=this.allGroups[t],b[y.sid.toString()]=this.groups_by_name[y.group_name].group_active;var x=e.events.cnds;for(f in this.cndsBySid)this.cndsBySid.hasOwnProperty(f)&&(m=this.cndsBySid[f],cr.hasAnyOwnProperty(m.extra)&&(x[f]={ex:d(m.extra)}));var w=e.events.acts;for(f in this.actsBySid)this.actsBySid.hasOwnProperty(f)&&(_=this.actsBySid[f],cr.hasAnyOwnProperty(_.extra)&&(w[f]={ex:d(_.extra)}));var S=e.events.vars;for(f in this.varsBySid)this.varsBySid.hasOwnProperty(f)&&(h=this.varsBySid[f],h.is_constant||h.parent&&!h.is_static||(S[f]=h.data));return e.system=this.system.saveToJSON(),JSON.stringify(e)},e.prototype.refreshUidMap=function(){var e,t,r,n,o,a;for(this.objectsByUid={},e=0,t=this.types_by_index.length;e<t;e++)if(r=this.types_by_index[e],!r.is_family)for(n=0,o=r.instances.length;n<o;n++)a=r.instances[n],this.objectsByUid[a.uid.toString()]=a},e.prototype.loadFromJSONString=function(e){var r;try{r=JSON.parse(e)}catch(t){return!1}if(!r.c2save)return!1;if(1<r.version)return!1;this.isLoadingState=!0;var n=r.rt;this.kahanTime.reset(),this.kahanTime.sum=n.time,this.wallTime.reset(),this.wallTime.sum=n.walltime||0,this.timescale=n.timescale,this.tickcount=n.tickcount,this.execcount=n.execcount,this.start_time=Date.now()-n.start_time_offset;var a=n.running_layout;if(a!==this.running_layout.sid){var s=this.getLayoutBySid(a);if(s)this.doChangeLayout(s);else return}var l=r.types,d,c,u,y,m,_,h,f,b,x,v,w,S,T,C,O,A;for(h in l)if(l.hasOwnProperty(h)){if(f=this.getObjectTypeBySid(parseInt(h,10)),!f||f.is_family||this.typeHasNoSaveBehavior(f))continue;for(l[h].ex?f.extra=l[h].ex:cr.wipe(f.extra),b=f.instances,x=l[h].instances,(d=0,c=cr.min(b.length,x.length));d<c;d++)this.loadInstanceFromJSON(b[d],x[d]);for(d=x.length,c=b.length;d<c;d++)this.DestroyInstance(b[d]);for(d=b.length,c=x.length;d<c;d++)(T=null,!(f.plugin.is_world&&(T=this.running_layout.getLayerBySid(x[d].w.l),!T)))&&(v=this.createInstanceFromInit(f.default_instance,T,!1,0,0,!0),this.loadInstanceFromJSON(v,x[d]));f.stale_iids=!0}this.ClearDeathRow(),this.refreshUidMap();var E=r.layouts;for(h in E)if(E.hasOwnProperty(h)){if(S=this.getLayoutBySid(parseInt(h,10)),!S)continue;S.loadFromJSON(E[h])}var P=r.events.groups;for(h in P)P.hasOwnProperty(h)&&(C=this.getGroupBySid(parseInt(h,10)),C&&this.groups_by_name[C.group_name]&&this.groups_by_name[C.group_name].setGroupActive(P[h]));var I=r.events.cnds;for(h in this.cndsBySid)this.cndsBySid.hasOwnProperty(h)&&(this.cndsBySid[h].extra=I.hasOwnProperty(h)?I[h].ex:{});var L=r.events.acts;for(h in this.actsBySid)this.actsBySid.hasOwnProperty(h)&&(this.actsBySid[h].extra=L.hasOwnProperty(h)?L[h].ex:{});var R=r.events.vars;for(h in R)R.hasOwnProperty(h)&&this.varsBySid.hasOwnProperty(h)&&(this.varsBySid[h].data=R[h]);for(this.next_uid=n.next_uid,this.isLoadingState=!1,(d=0,c=this.fireOnCreateAfterLoad.length);d<c;++d)v=this.fireOnCreateAfterLoad[d],this.trigger(Object.getPrototypeOf(v.type.plugin).cnds.OnCreated,v);for(cr.clearArray(this.fireOnCreateAfterLoad),this.system.loadFromJSON(r.system),(d=0,c=this.types_by_index.length);d<c;d++)if(f=this.types_by_index[d],!(f.is_family||this.typeHasNoSaveBehavior(f)))for(u=0,y=f.instances.length;u<y;u++){if(v=f.instances[u],f.is_contained)for(O=v.get_iid(),cr.clearArray(v.siblings),(m=0,_=f.container.length);m<_;m++)A=f.container[m],f!==A&&v.siblings.push(A.instances[O]);if(v.afterLoad&&v.afterLoad(),v.behavior_insts)for(m=0,_=v.behavior_insts.length;m<_;m++)w=v.behavior_insts[m],w.afterLoad&&w.afterLoad()}return this.redraw=!0,!0},e.prototype.saveInstanceToJSON=function(e,t){var r=e.type,n=r.plugin,a={},o,s,l,p,c;if(t?a.c2=!0:a.uid=e.uid,cr.hasAnyOwnProperty(e.extra)&&(a.ex=d(e.extra)),e.instance_vars&&e.instance_vars.length)for(a.ivs={},o=0,s=e.instance_vars.length;o<s;o++)a.ivs[e.type.instvar_sids[o].toString()]=e.instance_vars[o];if(n.is_world){if(l={x:e.x,y:e.y,w:e.width,h:e.height,l:e.layer.sid,zi:e.get_zindex()},0!==e.angle&&(l.a=e.angle),1!==e.opacity&&(l.o=e.opacity),.5!==e.hotspotX&&(l.hX=e.hotspotX),.5!==e.hotspotY&&(l.hY=e.hotspotY),0!==e.blend_mode&&(l.bm=e.blend_mode),e.visible||(l.v=e.visible),e.collisionsEnabled||(l.ce=e.collisionsEnabled),-1!==e.my_timescale&&(l.mts=e.my_timescale),r.effect_types.length)for(l.fx=[],o=0,s=r.effect_types.length;o<s;o++)c=r.effect_types[o],l.fx.push({name:c.name,active:e.active_effect_flags[c.index],params:e.effect_params[c.index]});a.w=l}if(e.behavior_insts&&e.behavior_insts.length)for(a.behs={},o=0,s=e.behavior_insts.length;o<s;o++)p=e.behavior_insts[o],p.saveToJSON&&(a.behs[p.type.sid.toString()]=p.saveToJSON());return e.saveToJSON&&(a.data=e.saveToJSON()),a},e.prototype.getInstanceVarIndexBySid=function(e,t){var r,n;for(r=0,n=e.instvar_sids.length;r<n;r++)if(e.instvar_sids[r]===t)return r;return-1},e.prototype.getBehaviorIndexBySid=function(e,t){var r,n;for(r=0,n=e.behavior_insts.length;r<n;r++)if(e.behavior_insts[r].type.sid===t)return r;return-1},e.prototype.loadInstanceFromJSON=function(e,t,r){var n=e.type,o=n.plugin,a,s,l,d,c,u,g,y,m,_,h;if(!r)e.uid=t.uid;else if(!t.c2)return;if(t.ex?e.extra=t.ex:cr.wipe(e.extra),c=t.ivs,c)for(a in c)if(c.hasOwnProperty(a)){if(d=this.getInstanceVarIndexBySid(n,parseInt(a,10)),0>d||d>=e.instance_vars.length)continue;_=c[a],null===_&&(_=NaN),e.instance_vars[d]=_}if(o.is_world){if(u=t.w,e.layer.sid!==u.l&&(h=e.layer,e.layer=this.running_layout.getLayerBySid(u.l),e.layer?(h.removeFromInstanceList(e,!0),e.layer.appendToInstanceList(e,!0),e.set_bbox_changed(),e.layer.setZIndicesStaleFrom(0)):(e.layer=h,!r&&this.DestroyInstance(e))),e.x=u.x,e.y=u.y,e.width=u.w,e.height=u.h,e.zindex=u.zi,e.angle=u.hasOwnProperty("a")?u.a:0,e.opacity=u.hasOwnProperty("o")?u.o:1,e.hotspotX=u.hasOwnProperty("hX")?u.hX:.5,e.hotspotY=u.hasOwnProperty("hY")?u.hY:.5,e.visible=!u.hasOwnProperty("v")||u.v,e.collisionsEnabled=!u.hasOwnProperty("ce")||u.ce,e.my_timescale=u.hasOwnProperty("mts")?u.mts:-1,e.blend_mode=u.hasOwnProperty("bm")?u.bm:0,(e.compositeOp=cr.effectToCompositeOp(e.blend_mode),this.gl&&cr.setGLBlend(e,e.blend_mode,this.gl),e.set_bbox_changed(),u.hasOwnProperty("fx")))for(s=0,l=u.fx.length;s<l;s++)g=n.getEffectIndexByName(u.fx[s].name),0>g||(e.active_effect_flags[g]=u.fx[s].active,e.effect_params[g]=u.fx[s].params);e.updateActiveEffects()}if(y=t.behs,y)for(a in y)if(y.hasOwnProperty(a)){if(m=this.getBehaviorIndexBySid(e,parseInt(a,10)),0>m)continue;e.behavior_insts[m].loadFromJSON(y[a])}t.data&&e.loadFromJSON(t.data)},e.prototype.fetchLocalFileViaCordova=function(e,t,r){var n=cordova.file.applicationDirectory+"www/"+e;window.resolveLocalFileSystemURL(n,function(e){e.file(t,r)},r)},e.prototype.fetchLocalFileViaCordovaAsText=function(e,t,r){this.fetchLocalFileViaCordova(e,function(e){var n=new FileReader;n.onload=function(r){t(r.target.result)},n.onerror=r,n.readAsText(e)},r)};var V=[],z=0;e.prototype.maybeStartNextArrayBufferRead=function(){if(V.length&&!(z>=8)){z++;var e=V.shift();this.doFetchLocalFileViaCordovaAsArrayBuffer(e.filename,e.successCallback,e.errorCallback)}},e.prototype.fetchLocalFileViaCordovaAsArrayBuffer=function(e,t,r){var n=this;V.push({filename:e,successCallback:function(e){z--,n.maybeStartNextArrayBufferRead(),t(e)},errorCallback:function(e){z--,n.maybeStartNextArrayBufferRead(),r(e)}}),this.maybeStartNextArrayBufferRead()},e.prototype.doFetchLocalFileViaCordovaAsArrayBuffer=function(e,t,r){this.fetchLocalFileViaCordova(e,function(e){var r=new FileReader;r.onload=function(r){t(r.target.result)},r.readAsArrayBuffer(e)},r)},e.prototype.fetchLocalFileViaCordovaAsURL=function(e,t,r){var n="",o=e.toLowerCase(),a=o.substr(o.length-4),i=o.substr(o.length-5);".mp4"===a?n="video/mp4":".webm"===i?n="video/webm":".m4a"===a?n="audio/mp4":".mp3"===a&&(n="audio/mpeg"),this.fetchLocalFileViaCordovaAsArrayBuffer(e,function(e){var r=new Blob([e],{type:n}),o=URL.createObjectURL(r);t(o)},r)},e.prototype.isAbsoluteUrl=function(e){return /^(?:[a-z]+:)?\/\//.test(e)||"data:"===e.substr(0,5)||"blob:"===e.substr(0,5)},e.prototype.setImageSrc=function(e,t){this.isWKWebView&&!this.isAbsoluteUrl(t)?this.fetchLocalFileViaCordovaAsURL(t,function(t){e.src=t},function(e){alert("Failed to load image: "+e)}):e.src=t},e.prototype.setCtxImageSmoothingEnabled=function(t,r){"undefined"==typeof t.imageSmoothingEnabled?(t.webkitImageSmoothingEnabled=r,t.mozImageSmoothingEnabled=r,t.msImageSmoothingEnabled=r):t.imageSmoothingEnabled=r},cr.runtime=e,cr.createRuntime=function(t){return new e(document.getElementById(t))},cr.createDCRuntime=function(t,r){return new e({dc:!0,width:t,height:r})},window.cr_createRuntime=cr.createRuntime,window.cr_createDCRuntime=cr.createDCRuntime,window.createCocoonJSRuntime=function(){window.c2cocoonjs=!0;var t=document.createElement("screencanvas")||document.createElement("canvas");t.screencanvas=!0,document.body.appendChild(t);var r=new e(t);return window.c2runtime=r,window.addEventListener("orientationchange",function(){window.c2runtime.setSize(window.innerWidth,window.innerHeight)}),window.c2runtime.setSize(window.innerWidth,window.innerHeight),r},window.createEjectaRuntime=function(){var t=document.getElementById("canvas"),r=new e(t);return window.c2runtime=r,window.c2runtime.setSize(window.innerWidth,window.innerHeight),r}})(),window.cr_getC2Runtime=function(){var e=document.getElementById("c2canvas");return e?e.c2runtime:window.c2runtime?window.c2runtime:null},window.cr_getSnapshot=function(e,t){var r=window.cr_getC2Runtime();r&&r.doCanvasSnapshot(e,t)},window.cr_sizeCanvas=function(e,t){if(0!==e&&0!==t){var r=window.cr_getC2Runtime();r&&r.setSize(e,t)}},window.cr_setSuspended=function(e){var t=window.cr_getC2Runtime();t&&t.setSuspended(e)},function(){function e(e,t){this.runtime=e,this.event_sheet=null,this.scrollX=this.runtime.original_width/2,this.scrollY=this.runtime.original_height/2,this.scale=1,this.angle=0,this.first_visit=!0,this.name=t[0],this.originalWidth=t[1],this.originalHeight=t[2],this.width=t[1],this.height=t[2],this.unbounded_scrolling=t[3],this.sheetname=t[4],this.sid=t[5];var r=t[6],n,o;for(this.layers=[],this.initial_types=[],(n=0,o=r.length);n<o;n++){var a=new cr.layer(this,r[n]);a.number=n,cr.seal(a),this.layers.push(a)}var s=t[7];for(this.initial_nonworld=[],n=0,o=s.length;n<o;n++){var l=s[n],p=this.runtime.types_by_index[l[1]];p.default_instance||(p.default_instance=l),this.initial_nonworld.push(l),-1===this.initial_types.indexOf(p)&&this.initial_types.push(p)}for(this.effect_types=[],this.active_effect_types=[],this.shaders_preserve_opaqueness=!0,this.effect_params=[],(n=0,o=t[8].length);n<o;n++)this.effect_types.push({id:t[8][n][0],name:t[8][n][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:n}),this.effect_params.push(t[8][n][2].slice(0));this.updateActiveEffects(),this.rcTex=new cr.rect(0,0,1,1),this.rcTex2=new cr.rect(0,0,1,1),this.persist_data={}}function t(e,t){return e.zindex-t.zindex}function r(e,t){this.layout=e,this.runtime=e.runtime,this.instances=[],this.scale=1,this.angle=0,this.disableAngle=!1,this.tmprect=new cr.rect(0,0,0,0),this.tmpquad=new cr.quad,this.viewLeft=0,this.viewRight=0,this.viewTop=0,this.viewBottom=0,this.zindices_stale=!1,this.zindices_stale_from=-1,this.clear_earlyz_index=0,this.name=t[0],this.index=t[1],this.sid=t[2],this.visible=t[3],this.background_color=t[4],this.transparent=t[5],this.parallaxX=t[6],this.parallaxY=t[7],this.opacity=t[8],this.forceOwnTexture=t[9],this.useRenderCells=t[10],this.zoomRate=t[11],this.blend_mode=t[12],this.effect_fallback=t[13],this.compositeOp="source-over",this.srcBlend=0,this.destBlend=0,this.render_grid=null,this.last_render_list=n(),this.render_list_stale=!0,this.last_render_cells=new cr.rect(0,0,-1,-1),this.cur_render_cells=new cr.rect(0,0,-1,-1),this.useRenderCells&&(this.render_grid=new cr.RenderGrid(this.runtime.original_width,this.runtime.original_height)),this.render_offscreen=!1;var r=t[14],o,a;for(this.startup_initial_instances=[],this.initial_instances=[],this.created_globals=[],(o=0,a=r.length);o<a;o++){var s=r[o],l=this.runtime.types_by_index[s[1]];l.default_instance||(l.default_instance=s,l.default_layerindex=this.index),this.initial_instances.push(s),-1===this.layout.initial_types.indexOf(l)&&this.layout.initial_types.push(l)}for(cr.shallowAssignArray(this.startup_initial_instances,this.initial_instances),this.effect_types=[],this.active_effect_types=[],this.shaders_preserve_opaqueness=!0,this.effect_params=[],(o=0,a=t[15].length);o<a;o++)this.effect_types.push({id:t[15][o][0],name:t[15][o][1],shaderindex:-1,preservesOpaqueness:!1,active:!0,index:o}),this.effect_params.push(t[15][o][2].slice(0));this.updateActiveEffects(),this.rcTex=new cr.rect(0,0,1,1),this.rcTex2=new cr.rect(0,0,1,1)}function n(){return u.length?u.pop():[]}function o(e){cr.clearArray(e),u.push(e)}function a(e,t,r){var n=0,o=0,a=0,s=e.length,l=t.length,p,d;for(r.length=s+l;n<s&&o<l;++a)p=e[n],d=t[o],p.zindex<d.zindex?(r[a]=p,++n):(r[a]=d,++o);for(;n<s;++n,++a)r[a]=e[n];for(;o<l;++o,++a)r[a]=t[o]}function i(e,t){var r,s,l,p,d;for(r=0,s=e.length;r<s-1;r+=2)l=e[r],p=e[r+1],d=n(),a(l,p,d),t||(o(l),o(p)),g.push(d);1==s%2&&(t?(l=n(),cr.shallowAssignArray(l,e[s-1]),g.push(l)):g.push(e[s-1])),cr.shallowAssignArray(e,g),cr.clearArray(g)}function s(e){for(var t=!0;1<e.length;)i(e,t),t=!1;return e[0]}e.prototype.saveObjectToPersist=function(e){var t=e.type.sid.toString();this.persist_data.hasOwnProperty(t)||(this.persist_data[t]=[]);var r=this.persist_data[t];r.push(this.runtime.saveInstanceToJSON(e))},e.prototype.hasOpaqueBottomLayer=function(){var e=this.layers[0];return!e.transparent&&1===e.opacity&&!e.forceOwnTexture&&e.visible},e.prototype.updateActiveEffects=function(){cr.clearArray(this.active_effect_types),this.shaders_preserve_opaqueness=!0;var e,t,r;for(e=0,t=this.effect_types.length;e<t;e++)r=this.effect_types[e],r.active&&(this.active_effect_types.push(r),!r.preservesOpaqueness&&(this.shaders_preserve_opaqueness=!1))},e.prototype.getEffectByName=function(e){var t,r,n;for(t=0,r=this.effect_types.length;t<r;t++)if(n=this.effect_types[t],n.name===e)return n;return null};var l=[];var d=!0;e.prototype.startRunning=function(){this.sheetname&&(this.event_sheet=this.runtime.eventsheets[this.sheetname],this.event_sheet.updateDeepIncludes()),this.runtime.running_layout=this,this.width=this.originalWidth,this.height=this.originalHeight,this.scrollX=this.runtime.original_width/2,this.scrollY=this.runtime.original_height/2;var e,r,n,o,a,c,u,g,y,m,_,h,f,b;for(e=0,n=this.runtime.types_by_index.length;e<n;e++)if(a=this.runtime.types_by_index[e],!a.is_family)for(c=a.instances,r=0,o=c.length;r<o;r++)if(g=c[r],g.layer){var x=g.layer.number;x>=this.layers.length&&(x=this.layers.length-1),g.layer=this.layers[x],-1===g.layer.instances.indexOf(g)&&g.layer.instances.push(g),g.layer.zindices_stale=!0}if(!d)for(e=0,n=this.layers.length;e<n;++e)this.layers[e].instances.sort(t);var b;for(cr.clearArray(l),this.boundScrolling(),(e=0,n=this.layers.length);e<n;e++)b=this.layers[e],b.createInitialInstances(),b.updateViewport(null);var v=!1;if(!this.first_visit){for(h in this.persist_data)if(this.persist_data.hasOwnProperty(h)){if(a=this.runtime.getObjectTypeBySid(parseInt(h,10)),!a||a.is_family||!this.runtime.typeHasPersistBehavior(a))continue;for(f=this.persist_data[h],e=0,n=f.length;e<n;e++)(b=null,!(a.plugin.is_world&&(b=this.getLayerBySid(f[e].w.l),!b)))&&(g=this.runtime.createInstanceFromInit(a.default_instance,b,!1,0,0,!0),this.runtime.loadInstanceFromJSON(g,f[e]),v=!0,l.push(g));cr.clearArray(f)}for(e=0,n=this.layers.length;e<n;e++)this.layers[e].instances.sort(t),this.layers[e].zindices_stale=!0}for(v&&(this.runtime.ClearDeathRow(),this.runtime.refreshUidMap()),e=0;e<l.length;e++)if(g=l[e],g.type.is_contained)for(y=g.get_iid(),r=0,o=g.type.container.length;r<o;r++)m=g.type.container[r],g.type!==m&&(m.instances.length>y?g.siblings.push(m.instances[y]):!m.default_instance||(_=this.runtime.createInstanceFromInit(m.default_instance,g.layer,!0,g.x,g.y,!0),this.runtime.ClearDeathRow(),m.updateIIDs(),g.siblings.push(_),l.push(_)));for(e=0,n=this.initial_nonworld.length;e<n;e++)u=this.initial_nonworld[e],a=this.runtime.types_by_index[u[1]],a.is_contained||(g=this.runtime.createInstanceFromInit(this.initial_nonworld[e],null,!0));if(this.runtime.changelayout=null,this.runtime.ClearDeathRow(),this.runtime.ctx&&!this.runtime.isDomFree)for(e=0,n=this.runtime.types_by_index.length;e<n;e++)m=this.runtime.types_by_index[e],!m.is_family&&m.instances.length&&m.preloadCanvas2D&&m.preloadCanvas2D(this.runtime.ctx);if(this.runtime.isLoadingState)cr.shallowAssignArray(this.runtime.fireOnCreateAfterLoad,l);else for(e=0,n=l.length;e<n;e++)g=l[e],this.runtime.trigger(Object.getPrototypeOf(g.type.plugin).cnds.OnCreated,g);cr.clearArray(l),this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutStart,null),this.first_visit=!1},e.prototype.createGlobalNonWorlds=function(){var e,t,r,n,o,a;for(e=0,t=0,r=this.initial_nonworld.length;e<r;e++)n=this.initial_nonworld[e],a=this.runtime.types_by_index[n[1]],a.global?!a.is_contained&&(o=this.runtime.createInstanceFromInit(n,null,!0)):(this.initial_nonworld[t]=n,t++);cr.truncateArray(this.initial_nonworld,t)},e.prototype.stopRunning=function(){this.runtime.isLoadingState||this.runtime.trigger(cr.system_object.prototype.cnds.OnLayoutEnd,null),this.runtime.isEndingLayout=!0,cr.clearArray(this.runtime.system.waits);var e,t,r,n,o,a,s;if(!this.first_visit)for(e=0,t=this.layers.length;e<t;e++)for(this.layers[e].updateZIndices(),o=this.layers[e].instances,(r=0,n=o.length);r<n;r++)a=o[r],!a.type.global&&this.runtime.typeHasPersistBehavior(a.type)&&this.saveObjectToPersist(a);for(e=0,t=this.layers.length;e<t;e++){for(o=this.layers[e].instances,r=0,n=o.length;r<n;r++)a=o[r],a.type.global||this.runtime.DestroyInstance(a);this.runtime.ClearDeathRow(),cr.clearArray(o),this.layers[e].zindices_stale=!0}for(e=0,t=this.runtime.types_by_index.length;e<t;e++)if(s=this.runtime.types_by_index[e],!(s.global||s.plugin.is_world||s.plugin.singleglobal||s.is_family)){for(r=0,n=s.instances.length;r<n;r++)this.runtime.DestroyInstance(s.instances[r]);this.runtime.ClearDeathRow()}d=!1,this.runtime.isEndingLayout=!1};var c=new cr.rect(0,0,0,0);e.prototype.recreateInitialObjects=function(e,t,r,n,o){c.set(t,r,n,o);var a,s;for(a=0,s=this.layers.length;a<s;a++)this.layers[a].recreateInitialObjects(e,c)},e.prototype.draw=function(e){var t=e,r=!1,n=!this.runtime.fullscreenScalingQuality,o;n&&(!this.runtime.layout_canvas&&(this.runtime.layout_canvas=document.createElement("canvas"),o=this.runtime.layout_canvas,o.width=this.runtime.draw_width,o.height=this.runtime.draw_height,this.runtime.layout_ctx=o.getContext("2d"),r=!0),o=this.runtime.layout_canvas,t=this.runtime.layout_ctx,o.width!==this.runtime.draw_width&&(o.width=this.runtime.draw_width,r=!0),o.height!==this.runtime.draw_height&&(o.height=this.runtime.draw_height,r=!0),r&&this.runtime.setCtxImageSmoothingEnabled(t,this.runtime.linearSampling)),t.globalAlpha=1,t.globalCompositeOperation="source-over",this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&t.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height);var a,s,p;for(a=0,s=this.layers.length;a<s;a++)p=this.layers[a],p.visible&&0<p.opacity&&11!==p.blend_mode&&(p.instances.length||!p.transparent)?p.draw(t):p.updateViewport(null);n&&e.drawImage(o,0,0,this.runtime.width,this.runtime.height)},e.prototype.drawGL_earlyZPass=function(e){e.setEarlyZPass(!0),this.runtime.layout_tex||(this.runtime.layout_tex=e.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),(this.runtime.layout_tex.c2width!==this.runtime.draw_width||this.runtime.layout_tex.c2height!==this.runtime.draw_height)&&(e.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=e.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),e.setRenderingToTexture(this.runtime.layout_tex),this.runtime.fullscreenScalingQuality||e.setSize(this.runtime.draw_width,this.runtime.draw_height);var t,r;for(t=this.layers.length-1;0<=t;--t)r=this.layers[t],r.visible&&1===r.opacity&&r.shaders_preserve_opaqueness&&0===r.blend_mode&&(r.instances.length||!r.transparent)?r.drawGL_earlyZPass(e):r.updateViewport(null);e.setEarlyZPass(!1)},e.prototype.drawGL=function(e){var t=0<this.active_effect_types.length||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack;t?(!this.runtime.layout_tex&&(this.runtime.layout_tex=e.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),(this.runtime.layout_tex.c2width!==this.runtime.draw_width||this.runtime.layout_tex.c2height!==this.runtime.draw_height)&&(e.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=e.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),e.setRenderingToTexture(this.runtime.layout_tex),!this.runtime.fullscreenScalingQuality&&e.setSize(this.runtime.draw_width,this.runtime.draw_height)):this.runtime.layout_tex&&(e.setRenderingToTexture(null),e.deleteTexture(this.runtime.layout_tex),this.runtime.layout_tex=null),this.runtime.clearBackground&&!this.hasOpaqueBottomLayer()&&e.clear(0,0,0,0);var r,n,o;for(r=0,n=this.layers.length;r<n;r++)o=this.layers[r],o.visible&&0<o.opacity&&(o.instances.length||!o.transparent)?o.drawGL(e):o.updateViewport(null);if(t)if(0===this.active_effect_types.length||1===this.active_effect_types.length&&this.runtime.fullscreenScalingQuality){if(1===this.active_effect_types.length){var a=this.active_effect_types[0].index;e.switchProgram(this.active_effect_types[0].shaderindex),e.setProgramParameters(null,1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,this.scale,this.angle,0,0,this.runtime.draw_width/2,this.runtime.draw_height/2,this.runtime.kahanTime.sum,this.effect_params[a]),e.programIsAnimated(this.active_effect_types[0].shaderindex)&&(this.runtime.redraw=!0)}else e.switchProgram(0);this.runtime.fullscreenScalingQuality||e.setSize(this.runtime.width,this.runtime.height),e.setRenderingToTexture(null),e.setDepthTestEnabled(!1),e.setOpacity(1),e.setTexture(this.runtime.layout_tex),e.setAlphaBlend(),e.resetModelView(),e.updateModelView();var s=this.runtime.width/2,p=this.runtime.height/2;e.quad(-s,p,s,p,s,-p,-s,-p),e.setTexture(null),e.setDepthTestEnabled(!0)}else this.renderEffectChain(e,null,null,null)},e.prototype.getRenderTarget=function(){return 0<this.active_effect_types.length||this.runtime.uses_background_blending||!this.runtime.fullscreenScalingQuality||this.runtime.enableFrontToBack?this.runtime.layout_tex:null},e.prototype.getMinLayerScale=function(){var e=this.layers[0].getScale(),t,r,n;for(t=1,r=this.layers.length;t<r;t++)n=this.layers[t],(0!==n.parallaxX||0!==n.parallaxY)&&n.getScale()<e&&(e=n.getScale());return e},e.prototype.scrollToX=function(e){if(!this.unbounded_scrolling){var t=this.runtime.draw_width*(1/this.getMinLayerScale())/2;e>this.width-t&&(e=this.width-t),e<t&&(e=t)}this.scrollX!==e&&(this.scrollX=e,this.runtime.redraw=!0)},e.prototype.scrollToY=function(e){if(!this.unbounded_scrolling){var t=this.runtime.draw_height*(1/this.getMinLayerScale())/2;e>this.height-t&&(e=this.height-t),e<t&&(e=t)}this.scrollY!==e&&(this.scrollY=e,this.runtime.redraw=!0)},e.prototype.boundScrolling=function(){this.scrollToX(this.scrollX),this.scrollToY(this.scrollY)},e.prototype.renderEffectChain=function(e,t,r,n){var o=r?r.active_effect_types:t?t.active_effect_types:this.active_effect_types,a=1,s=0,l=0,p=0,d=this.runtime.draw_width,c=this.runtime.draw_height;r?(a=r.layer.getScale(),s=r.layer.getAngle(),l=r.layer.viewLeft,p=r.layer.viewTop,d=r.layer.viewRight,c=r.layer.viewBottom):t&&(a=t.getScale(),s=t.getAngle(),l=t.viewLeft,p=t.viewTop,d=t.viewRight,c=t.viewBottom);var u=this.runtime.fx_tex,g=0,m=1,_=this.runtime.draw_width,f=this.runtime.draw_height,b=_/2,x=f/2,v=t?t.rcTex:this.rcTex,w=t?t.rcTex2:this.rcTex2,S=0,T=0,C=0,O=0,A=_,E=_,P=f,I=f,k=0,L=0,R=r?r.layer.getAngle():0,B,F,N,D,j,M;if(r){for(B=0,F=o.length;B<F;B++)k+=e.getProgramBoxExtendHorizontal(o[B].shaderindex),L+=e.getProgramBoxExtendVertical(o[B].shaderindex);var W=r.bbox;if(S=t.layerToCanvas(W.left,W.top,!0,!0),C=t.layerToCanvas(W.left,W.top,!1,!0),A=t.layerToCanvas(W.right,W.bottom,!0,!0),P=t.layerToCanvas(W.right,W.bottom,!1,!0),0!==R){var V=t.layerToCanvas(W.right,W.top,!0,!0),z=t.layerToCanvas(W.right,W.top,!1,!0),G=t.layerToCanvas(W.left,W.bottom,!0,!0),U=t.layerToCanvas(W.left,W.bottom,!1,!0);D=Math.min(S,A,V,G),A=Math.max(S,A,V,G),S=D,D=Math.min(C,P,z,U),P=Math.max(C,P,z,U),C=D}S-=k,C-=L,A+=k,P+=L,w.left=S/_,w.top=1-C/f,w.right=A/_,w.bottom=1-P/f,T=S=cr.floor(S),O=C=cr.floor(C),E=A=cr.ceil(A),I=P=cr.ceil(P),T-=k,O-=L,E+=k,I+=L,0>S&&(S=0),0>C&&(C=0),A>_&&(A=_),P>f&&(P=f),0>T&&(T=0),0>O&&(O=0),E>_&&(E=_),I>f&&(I=f),v.left=S/_,v.top=1-C/f,v.right=A/_,v.bottom=1-P/f}else v.left=w.left=0,v.top=w.top=0,v.right=w.right=1,v.bottom=w.bottom=1;var X=r&&(e.programUsesDest(o[0].shaderindex)||0!==k||0!==L||1!==r.opacity||r.type.plugin.must_predraw)||t&&!r&&1!==t.opacity;e.setAlphaBlend(),X&&(!u[g]&&(u[g]=e.createEmptyTexture(_,f,this.runtime.linearSampling)),(u[g].c2width!==_||u[g].c2height!==f)&&(e.deleteTexture(u[g]),u[g]=e.createEmptyTexture(_,f,this.runtime.linearSampling)),e.switchProgram(0),e.setRenderingToTexture(u[g]),M=I-O,j=f-O-M,e.clearRect(T,j,E-T,M),r?r.drawGL(e):(e.setTexture(this.runtime.layer_tex),e.setOpacity(t.opacity),e.resetModelView(),e.translate(-b,-x),e.updateModelView(),e.quadTex(S,P,A,P,A,C,S,C,v)),w.left=w.top=0,w.right=w.bottom=1,r&&(D=v.top,v.top=v.bottom,v.bottom=D),g=1,m=0),e.setOpacity(1);var N=o.length-1,H=e.programUsesCrossSampling(o[N].shaderindex)||!t&&!r&&!this.runtime.fullscreenScalingQuality,q=0;for(B=0,F=o.length;B<F;B++){if(u[g]||(u[g]=e.createEmptyTexture(_,f,this.runtime.linearSampling)),(u[g].c2width!==_||u[g].c2height!==f)&&(e.deleteTexture(u[g]),u[g]=e.createEmptyTexture(_,f,this.runtime.linearSampling)),e.switchProgram(o[B].shaderindex),q=o[B].index,e.programIsAnimated(o[B].shaderindex)&&(this.runtime.redraw=!0),0==B&&!X){if(e.setRenderingToTexture(u[g]),M=I-O,j=f-O-M,e.clearRect(T,j,E-T,M),r){var Y,K;if(r.curFrame&&r.curFrame.texture_img){var J=r.curFrame.texture_img;Y=1/J.width,K=1/J.height}else Y=1/r.width,K=1/r.height;e.setProgramParameters(n,Y,K,w.left,w.top,w.right,w.bottom,a,s,l,p,(l+d)/2,(p+c)/2,this.runtime.kahanTime.sum,r.effect_params[q]),r.drawGL(e)}else e.setProgramParameters(n,1/_,1/f,0,0,1,1,a,s,l,p,(l+d)/2,(p+c)/2,this.runtime.kahanTime.sum,t?t.effect_params[q]:this.effect_params[q]),e.setTexture(t?this.runtime.layer_tex:this.runtime.layout_tex),e.resetModelView(),e.translate(-b,-x),e.updateModelView(),e.quadTex(S,P,A,P,A,C,S,C,v);w.left=w.top=0,w.right=w.bottom=1,r&&!H&&(D=P,P=C,C=D)}else e.setProgramParameters(n,1/_,1/f,w.left,w.top,w.right,w.bottom,a,s,l,p,(l+d)/2,(p+c)/2,this.runtime.kahanTime.sum,r?r.effect_params[q]:t?t.effect_params[q]:this.effect_params[q]),e.setTexture(null),B!==N||H?(e.setRenderingToTexture(u[g]),M=I-O,j=f-O-M,e.clearRect(T,j,E-T,M)):(r?e.setBlend(r.srcBlend,r.destBlend):t&&e.setBlend(t.srcBlend,t.destBlend),e.setRenderingToTexture(n)),e.setTexture(u[m]),e.resetModelView(),e.translate(-b,-x),e.updateModelView(),e.quadTex(S,P,A,P,A,C,S,C,v),B!==N||H||e.setTexture(null);g=0===g?1:0,m=0===g?1:0}H&&(e.switchProgram(0),r?e.setBlend(r.srcBlend,r.destBlend):t?e.setBlend(t.srcBlend,t.destBlend):!this.runtime.fullscreenScalingQuality&&(e.setSize(this.runtime.width,this.runtime.height),b=this.runtime.width/2,x=this.runtime.height/2,S=0,C=0,A=this.runtime.width,P=this.runtime.height),e.setRenderingToTexture(n),e.setTexture(u[m]),e.resetModelView(),e.translate(-b,-x),e.updateModelView(),r&&1===o.length&&!X?e.quadTex(S,C,A,C,A,P,S,P,v):e.quadTex(S,P,A,P,A,C,S,C,v),e.setTexture(null))},e.prototype.getLayerBySid=function(e){var t,r;for(t=0,r=this.layers.length;t<r;t++)if(this.layers[t].sid===e)return this.layers[t];return null},e.prototype.saveToJSON=function(){var e={sx:this.scrollX,sy:this.scrollY,s:this.scale,a:this.angle,w:this.width,h:this.height,fv:this.first_visit,persist:this.persist_data,fx:[],layers:{}},t,r,n,o;for(t=0,r=this.effect_types.length;t<r;t++)o=this.effect_types[t],e.fx.push({name:o.name,active:o.active,params:this.effect_params[o.index]});for(t=0,r=this.layers.length;t<r;t++)n=this.layers[t],e.layers[n.sid.toString()]=n.saveToJSON();return e},e.prototype.loadFromJSON=function(e){var t,r,n,o,a;this.scrollX=e.sx,this.scrollY=e.sy,this.scale=e.s,this.angle=e.a,this.width=e.w,this.height=e.h,this.persist_data=e.persist,"undefined"!=typeof e.fv&&(this.first_visit=e.fv);var s=e.fx;for(t=0,r=s.length;t<r;t++)n=this.getEffectByName(s[t].name),n&&(n.active=s[t].active,this.effect_params[n.index]=s[t].params);this.updateActiveEffects();var l=e.layers;for(o in l)if(l.hasOwnProperty(o)){if(a=this.getLayerBySid(parseInt(o,10)),!a)continue;a.loadFromJSON(l[o])}},cr.layout=e;r.prototype.updateActiveEffects=function(){cr.clearArray(this.active_effect_types),this.shaders_preserve_opaqueness=!0;var e,t,r;for(e=0,t=this.effect_types.length;e<t;e++)r=this.effect_types[e],r.active&&(this.active_effect_types.push(r),!r.preservesOpaqueness&&(this.shaders_preserve_opaqueness=!1))},r.prototype.getEffectByName=function(e){var t,r,n;for(t=0,r=this.effect_types.length;t<r;t++)if(n=this.effect_types[t],n.name===e)return n;return null},r.prototype.createInitialInstances=function(){var e,t,r,n,o,a,s,p;for(e=0,t=0,r=this.initial_instances.length;e<r;e++){if(o=this.initial_instances[e],a=this.runtime.types_by_index[o[1]],(p=this.runtime.typeHasPersistBehavior(a),s=!0,!p||this.layout.first_visit)){if(n=this.runtime.createInstanceFromInit(o,this,!0),!n)continue;l.push(n),n.type.global&&(s=!1,this.created_globals.push(n.uid))}s&&(this.initial_instances[t]=this.initial_instances[e],t++)}this.initial_instances.length=t,this.runtime.ClearDeathRow(),!this.runtime.glwrap&&this.effect_types.length&&(this.blend_mode=this.effect_fallback),this.compositeOp=cr.effectToCompositeOp(this.blend_mode),this.runtime.gl&&cr.setGLBlend(this,this.blend_mode,this.runtime.gl),this.render_list_stale=!0},r.prototype.recreateInitialObjects=function(e,t){var r=this.runtime.types_by_index,n=e.is_family,o=e.members,a,l,p,d,c,u,g,m,_,h,f;for(a=0,l=this.initial_instances.length;a<l;++a)if(p=this.initial_instances[a],c=p[0],(u=c[0],g=c[1],t.contains_pt(u,g))){if(d=r[p[1]],d!==e)if(!n)continue;else if(0>o.indexOf(d))continue;if(m=this.runtime.createInstanceFromInit(p,this,!1),this.runtime.isInOnDestroy++,this.runtime.trigger(Object.getPrototypeOf(d.plugin).cnds.OnCreated,m),m.is_contained)for(_=0,h=m.siblings.length;_<h;_++)f=m.siblings[a],this.runtime.trigger(Object.getPrototypeOf(f.type.plugin).cnds.OnCreated,f);this.runtime.isInOnDestroy--}},r.prototype.removeFromInstanceList=function(e,t){var r=cr.fastIndexOf(this.instances,e);0>r||(t&&this.useRenderCells&&e.rendercells&&e.rendercells.right>=e.rendercells.left&&(e.update_bbox(),this.render_grid.update(e,e.rendercells,null),e.rendercells.set(0,0,-1,-1)),r===this.instances.length-1?this.instances.pop():(cr.arrayRemove(this.instances,r),this.setZIndicesStaleFrom(r)),this.render_list_stale=!0)},r.prototype.appendToInstanceList=function(e,t){e.zindex=this.instances.length,this.instances.push(e),t&&this.useRenderCells&&e.rendercells&&e.set_bbox_changed(),this.render_list_stale=!0},r.prototype.prependToInstanceList=function(e,t){this.instances.unshift(e),this.setZIndicesStaleFrom(0),t&&this.useRenderCells&&e.rendercells&&e.set_bbox_changed()},r.prototype.moveInstanceAdjacent=function(e,t,r){var n=e.get_zindex(),o=t.get_zindex();cr.arrayRemove(this.instances,n),n<o&&o--,r&&o++,o===this.instances.length?this.instances.push(e):this.instances.splice(o,0,e),this.setZIndicesStaleFrom(n<o?n:o)},r.prototype.setZIndicesStaleFrom=function(e){-1===this.zindices_stale_from?this.zindices_stale_from=e:e<this.zindices_stale_from&&(this.zindices_stale_from=e),this.zindices_stale=!0,this.render_list_stale=!0},r.prototype.updateZIndices=function(){if(this.zindices_stale){-1===this.zindices_stale_from&&(this.zindices_stale_from=0);var e,t,r;if(this.useRenderCells)for(e=this.zindices_stale_from,t=this.instances.length;e<t;++e)r=this.instances[e],r.zindex=e,this.render_grid.markRangeChanged(r.rendercells);else for(e=this.zindices_stale_from,t=this.instances.length;e<t;++e)this.instances[e].zindex=e;this.zindices_stale=!1,this.zindices_stale_from=-1}},r.prototype.getScale=function(e){return this.getNormalScale()*(this.runtime.fullscreenScalingQuality||e?this.runtime.aspect_scale:1)},r.prototype.getNormalScale=function(){return(this.scale*this.layout.scale-1)*this.zoomRate+1},r.prototype.getAngle=function(){return this.disableAngle?0:cr.clamp_angle(this.layout.angle+this.angle)};var u=[];var g=[];var y=[];r.prototype.getRenderCellInstancesToDraw=function(){if(this.updateZIndices(),this.render_grid.queryRange(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom,y),!y.length)return n();if(1===y.length){var e=n();return cr.shallowAssignArray(e,y[0]),cr.clearArray(y),e}var t=s(y);return cr.clearArray(y),t},r.prototype.draw=function(e){this.render_offscreen=this.forceOwnTexture||1!==this.opacity||0!==this.blend_mode;var t=this.runtime.canvas,r=e,n=!1;this.render_offscreen&&(this.runtime.layer_canvas||(this.runtime.layer_canvas=document.createElement("canvas"),t=this.runtime.layer_canvas,t.width=this.runtime.draw_width,t.height=this.runtime.draw_height,this.runtime.layer_ctx=t.getContext("2d"),n=!0),t=this.runtime.layer_canvas,r=this.runtime.layer_ctx,t.width!==this.runtime.draw_width&&(t.width=this.runtime.draw_width,n=!0),t.height!==this.runtime.draw_height&&(t.height=this.runtime.draw_height,n=!0),n&&this.runtime.setCtxImageSmoothingEnabled(r,this.runtime.linearSampling),this.transparent&&r.clearRect(0,0,this.runtime.draw_width,this.runtime.draw_height));r.globalAlpha=1,r.globalCompositeOperation="source-over",this.transparent||(r.fillStyle="rgb("+this.background_color[0]+","+this.background_color[1]+","+this.background_color[2]+")",r.fillRect(0,0,this.runtime.draw_width,this.runtime.draw_height)),r.save(),this.disableAngle=!0;var a=this.canvasToLayer(0,0,!0,!0),s=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(a=Math.round(a),s=Math.round(s)),this.rotateViewport(a,s,r);var l=this.getScale();r.scale(l,l),r.translate(-a,-s);var p;this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(o(this.last_render_list),p=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):p=this.last_render_list):p=this.instances;var d=null,c,u,g;for(c=0,u=p.length;c<u;++c)g=p[c],g!==d&&(this.drawInstance(g,r),d=g);this.useRenderCells&&(this.last_render_list=p),r.restore(),this.render_offscreen&&(e.globalCompositeOperation=this.compositeOp,e.globalAlpha=this.opacity,e.drawImage(t,0,0))},r.prototype.drawInstance=function(e,t){if(e.visible&&0!==e.width&&0!==e.height){e.update_bbox();var r=e.bbox;r.right<this.viewLeft||r.bottom<this.viewTop||r.left>this.viewRight||r.top>this.viewBottom||(t.globalCompositeOperation=e.compositeOp,e.draw(t))}},r.prototype.updateViewport=function(e){this.disableAngle=!0;var t=this.canvasToLayer(0,0,!0,!0),r=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(t=Math.round(t),r=Math.round(r)),this.rotateViewport(t,r,e)},r.prototype.rotateViewport=function(e,t,r){var n=this.getScale();this.viewLeft=e,this.viewTop=t,this.viewRight=e+this.runtime.draw_width*(1/n),this.viewBottom=t+this.runtime.draw_height*(1/n);var o;this.viewLeft>this.viewRight&&(o=this.viewLeft,this.viewLeft=this.viewRight,this.viewRight=o),this.viewTop>this.viewBottom&&(o=this.viewTop,this.viewTop=this.viewBottom,this.viewBottom=o);var a=this.getAngle();0!==a&&(r&&(r.translate(this.runtime.draw_width/2,this.runtime.draw_height/2),r.rotate(-a),r.translate(this.runtime.draw_width/-2,this.runtime.draw_height/-2)),this.tmprect.set(this.viewLeft,this.viewTop,this.viewRight,this.viewBottom),this.tmprect.offset((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),this.tmpquad.set_from_rotated_rect(this.tmprect,a),this.tmpquad.bounding_box(this.tmprect),this.tmprect.offset((this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2),this.viewLeft=this.tmprect.left,this.viewTop=this.tmprect.top,this.viewRight=this.tmprect.right,this.viewBottom=this.tmprect.bottom)},r.prototype.drawGL_earlyZPass=function(e){var t=this.runtime.draw_width,r=this.runtime.draw_height;this.render_offscreen=this.forceOwnTexture,this.render_offscreen&&(!this.runtime.layer_tex&&(this.runtime.layer_tex=e.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),(this.runtime.layer_tex.c2width!==this.runtime.draw_width||this.runtime.layer_tex.c2height!==this.runtime.draw_height)&&(e.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=e.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),e.setRenderingToTexture(this.runtime.layer_tex)),this.disableAngle=!0;var n=this.canvasToLayer(0,0,!0,!0),a=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(n=Math.round(n),a=Math.round(a)),this.rotateViewport(n,a,null);var s=this.getScale();e.resetModelView(),e.scale(s,s),e.rotateZ(-this.getAngle()),e.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),e.updateModelView();var l;this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(o(this.last_render_list),l=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):l=this.last_render_list):l=this.instances;var p=null,d,c;for(d=l.length-1;0<=d;--d)c=l[d],c!==p&&(this.drawInstanceGL_earlyZPass(l[d],e),p=c);this.useRenderCells&&(this.last_render_list=l),this.transparent||(this.clear_earlyz_index=this.runtime.earlyz_index++,e.setEarlyZIndex(this.clear_earlyz_index),e.setColorFillMode(1,1,1,1),e.fullscreenQuad(),e.restoreEarlyZMode())},r.prototype.drawGL=function(e){var t=this.runtime.draw_width,r=this.runtime.draw_height,n=0,a=0;this.render_offscreen=this.forceOwnTexture||1!==this.opacity||0<this.active_effect_types.length||0!==this.blend_mode,this.render_offscreen&&(!this.runtime.layer_tex&&(this.runtime.layer_tex=e.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),(this.runtime.layer_tex.c2width!==this.runtime.draw_width||this.runtime.layer_tex.c2height!==this.runtime.draw_height)&&(e.deleteTexture(this.runtime.layer_tex),this.runtime.layer_tex=e.createEmptyTexture(this.runtime.draw_width,this.runtime.draw_height,this.runtime.linearSampling)),e.setRenderingToTexture(this.runtime.layer_tex),this.transparent&&e.clear(0,0,0,0)),this.transparent||(this.runtime.enableFrontToBack?(e.setEarlyZIndex(this.clear_earlyz_index),e.setColorFillMode(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1),e.fullscreenQuad(),e.setTextureFillMode()):e.clear(this.background_color[0]/255,this.background_color[1]/255,this.background_color[2]/255,1)),this.disableAngle=!0;var s=this.canvasToLayer(0,0,!0,!0),l=this.canvasToLayer(0,0,!1,!0);this.disableAngle=!1,this.runtime.pixel_rounding&&(s=Math.round(s),l=Math.round(l)),this.rotateViewport(s,l,null);var p=this.getScale();e.resetModelView(),e.scale(p,p),e.rotateZ(-this.getAngle()),e.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),e.updateModelView();var d;this.useRenderCells?(this.cur_render_cells.left=this.render_grid.XToCell(this.viewLeft),this.cur_render_cells.top=this.render_grid.YToCell(this.viewTop),this.cur_render_cells.right=this.render_grid.XToCell(this.viewRight),this.cur_render_cells.bottom=this.render_grid.YToCell(this.viewBottom),this.render_list_stale||!this.cur_render_cells.equals(this.last_render_cells)?(o(this.last_render_list),d=this.getRenderCellInstancesToDraw(),this.render_list_stale=!1,this.last_render_cells.copy(this.cur_render_cells)):d=this.last_render_list):d=this.instances;var c=null,u,g,y;for(u=0,g=d.length;u<g;++u)y=d[u],y!==c&&(this.drawInstanceGL(d[u],e),c=y);if(this.useRenderCells&&(this.last_render_list=d),this.render_offscreen)if(n=this.active_effect_types.length?this.active_effect_types[0].shaderindex:0,a=this.active_effect_types.length?this.active_effect_types[0].index:0,0===this.active_effect_types.length||1===this.active_effect_types.length&&!e.programUsesCrossSampling(n)&&1===this.opacity){1===this.active_effect_types.length?(e.switchProgram(n),e.setProgramParameters(this.layout.getRenderTarget(),1/this.runtime.draw_width,1/this.runtime.draw_height,0,0,1,1,p,this.getAngle(),this.viewLeft,this.viewTop,(this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2,this.runtime.kahanTime.sum,this.effect_params[a]),e.programIsAnimated(n)&&(this.runtime.redraw=!0)):e.switchProgram(0),e.setRenderingToTexture(this.layout.getRenderTarget()),e.setOpacity(this.opacity),e.setTexture(this.runtime.layer_tex),e.setBlend(this.srcBlend,this.destBlend),e.resetModelView(),e.updateModelView();var m=this.runtime.draw_width/2,_=this.runtime.draw_height/2;e.quad(-m,_,m,_,m,-_,-m,-_),e.setTexture(null)}else this.layout.renderEffectChain(e,this,null,this.layout.getRenderTarget())},r.prototype.drawInstanceGL=function(e,t){if(e.visible&&0!==e.width&&0!==e.height){e.update_bbox();var r=e.bbox;r.right<this.viewLeft||r.bottom<this.viewTop||r.left>this.viewRight||r.top>this.viewBottom||(t.setEarlyZIndex(e.earlyz_index),e.uses_shaders?this.drawInstanceWithShadersGL(e,t):(t.switchProgram(0),t.setBlend(e.srcBlend,e.destBlend),e.drawGL(t)))}},r.prototype.drawInstanceGL_earlyZPass=function(e,t){if(e.visible&&0!==e.width&&0!==e.height){e.update_bbox();var r=e.bbox;r.right<this.viewLeft||r.bottom<this.viewTop||r.left>this.viewRight||r.top>this.viewBottom||(e.earlyz_index=this.runtime.earlyz_index++,0===e.blend_mode&&1===e.opacity&&e.shaders_preserve_opaqueness&&e.drawGL_earlyZPass&&(t.setEarlyZIndex(e.earlyz_index),e.drawGL_earlyZPass(t)))}},r.prototype.drawInstanceWithShadersGL=function(e,t){var r=e.active_effect_types[0].shaderindex,n=e.active_effect_types[0].index,o=this.getScale();if(1===e.active_effect_types.length&&!t.programUsesCrossSampling(r)&&!t.programExtendsBox(r)&&(!e.angle&&!e.layer.getAngle()||!t.programUsesDest(r))&&1===e.opacity&&!e.type.plugin.must_predraw){t.switchProgram(r),t.setBlend(e.srcBlend,e.destBlend),t.programIsAnimated(r)&&(this.runtime.redraw=!0);var a=0,i=0,s=0,l=0;if(t.programUsesDest(r)){var p=e.bbox,d=this.layerToCanvas(p.left,p.top,!0,!0),c=this.layerToCanvas(p.left,p.top,!1,!0),u=this.layerToCanvas(p.right,p.bottom,!0,!0),g=this.layerToCanvas(p.right,p.bottom,!1,!0);a=d/windowWidth,i=1-c/windowHeight,s=u/windowWidth,l=1-g/windowHeight}var y,m;if(e.curFrame&&e.curFrame.texture_img){var _=e.curFrame.texture_img;y=1/_.width,m=1/_.height}else y=1/e.width,m=1/e.height;t.setProgramParameters(this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget(),y,m,a,i,s,l,o,this.getAngle(),this.viewLeft,this.viewTop,(this.viewLeft+this.viewRight)/2,(this.viewTop+this.viewBottom)/2,this.runtime.kahanTime.sum,e.effect_params[n]),e.drawGL(t)}else this.layout.renderEffectChain(t,this,e,this.render_offscreen?this.runtime.layer_tex:this.layout.getRenderTarget()),t.resetModelView(),t.scale(o,o),t.rotateZ(-this.getAngle()),t.translate((this.viewLeft+this.viewRight)/-2,(this.viewTop+this.viewBottom)/-2),t.updateModelView()},r.prototype.canvasToLayer=function(e,t,r,n){var o=this.runtime.devicePixelRatio;this.runtime.isRetina&&(e*=o,t*=o);var i=this.runtime.parallax_x_origin,s=this.runtime.parallax_y_origin,l=(this.layout.scrollX-i)*this.parallaxX+i,p=(this.layout.scrollY-s)*this.parallaxY+s,d=l,c=p,u=1/this.getScale(!n);n?(d-=this.runtime.draw_width*u/2,c-=this.runtime.draw_height*u/2):(d-=this.runtime.width*u/2,c-=this.runtime.height*u/2),d+=e*u,c+=t*u;var g=this.getAngle();if(0!==g){d-=l,c-=p;var a=Math.cos(g),m=Math.sin(g),_=d*a-c*m;c=c*a+d*m,d=_,d+=l,c+=p}return r?d:c},r.prototype.layerToCanvas=function(e,t,r,n){var o=this.runtime.parallax_x_origin,i=this.runtime.parallax_y_origin,s=(this.layout.scrollX-o)*this.parallaxX+o,l=(this.layout.scrollY-i)*this.parallaxY+i,p=s,d=l,c=this.getAngle();if(0!==c){e-=s,t-=l;var a=Math.cos(-c),u=Math.sin(-c),g=e*a-t*u;t=t*a+e*u,e=g,e+=s,t+=l}var m=1/this.getScale(!n);n?(p-=this.runtime.draw_width*m/2,d-=this.runtime.draw_height*m/2):(p-=this.runtime.width*m/2,d-=this.runtime.height*m/2),p=(e-p)/m,d=(t-d)/m;var _=this.runtime.devicePixelRatio;return this.runtime.isRetina&&!n&&(p/=_,d/=_),r?p:d},r.prototype.rotatePt=function(e,t,r){if(0===this.getAngle())return r?e:t;var n=this.layerToCanvas(e,t,!0),o=this.layerToCanvas(e,t,!1);this.disableAngle=!0;var a=this.canvasToLayer(n,o,!0),i=this.canvasToLayer(n,o,!0);return this.disableAngle=!1,r?a:i},r.prototype.saveToJSON=function(){var e={s:this.scale,a:this.angle,vl:this.viewLeft,vt:this.viewTop,vr:this.viewRight,vb:this.viewBottom,v:this.visible,bc:this.background_color,t:this.transparent,px:this.parallaxX,py:this.parallaxY,o:this.opacity,zr:this.zoomRate,fx:[],cg:this.created_globals,instances:[]},t,r,n;for(t=0,r=this.effect_types.length;t<r;t++)n=this.effect_types[t],e.fx.push({name:n.name,active:n.active,params:this.effect_params[n.index]});return e},r.prototype.loadFromJSON=function(e){var r,n,o,a;this.scale=e.s,this.angle=e.a,this.viewLeft=e.vl,this.viewTop=e.vt,this.viewRight=e.vr,this.viewBottom=e.vb,this.visible=e.v,this.background_color=e.bc,this.transparent=e.t,this.parallaxX=e.px,this.parallaxY=e.py,this.opacity=e.o,this.zoomRate=e.zr,this.created_globals=e.cg||[],cr.shallowAssignArray(this.initial_instances,this.startup_initial_instances);var s=new cr.ObjectSet;for(r=0,o=this.created_globals.length;r<o;++r)s.add(this.created_globals[r]);for(r=0,n=0,o=this.initial_instances.length;r<o;++r)s.contains(this.initial_instances[r][2])||(this.initial_instances[n]=this.initial_instances[r],++n);cr.truncateArray(this.initial_instances,n);var l=e.fx;for(r=0,o=l.length;r<o;r++)a=this.getEffectByName(l[r].name),a&&(a.active=l[r].active,this.effect_params[a.index]=l[r].params);this.updateActiveEffects(),this.instances.sort(t),this.zindices_stale=!0},cr.layer=r}();(function(){function e(e,t){var r=e.length,n;switch(r){case 0:return!0;case 1:return e[0]===t[0];case 2:return e[0]===t[0]&&e[1]===t[1];default:for(n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0;}}function t(e,t){return e.index-t.index}function r(r){var n,o,a,s,l;for(2===r.length?r[0].index>r[1].index&&(s=r[0],r[0]=r[1],r[1]=s):2<r.length&&r.sort(t),r.length>=_.length&&(_.length=r.length+1),_[r.length]||(_[r.length]=[]),l=_[r.length],(n=0,o=l.length);n<o;n++)if(a=l[n],e(r,a))return a;return l.push(r),r}function n(e,t){this.runtime=e,this.triggers={},this.fasttriggers={},this.hasRun=!1,this.includes=new cr.ObjectSet,this.deep_includes=[],this.already_included_sheets=[],this.name=t[0];var r=t[1];this.events=[];var n,o;for(n=0,o=r.length;n<o;n++)this.init_event(r[n],null,this.events)}function o(e){return!!(cr.plugins_.Sprite&&e===cr.plugins_.Sprite.prototype.cnds.OnFrameChanged)}function a(e){this.type=e,this.instances=[],this.else_instances=[],this.select_all=!0}function i(e,t,r){this.sheet=e,this.parent=t,this.runtime=e.runtime,this.solModifiers=[],this.solModifiersIncludingParents=[],this.solWriterAfterCnds=!1,this.group=!1,this.initially_activated=!1,this.toplevelevent=!1,this.toplevelgroup=!1,this.has_else_block=!1;this.conditions=[],this.actions=[],this.subevents=[],this.group_name="",this.group=!1,this.initially_activated=!1,this.group_active=!1,this.contained_includes=null,r[1]&&(this.group_name=r[1][1].toLowerCase(),this.group=!0,this.initially_activated=!!r[1][0],this.contained_includes=[],this.group_active=this.initially_activated,this.runtime.allGroups.push(this),this.runtime.groups_by_name[this.group_name]=this),this.orblock=r[2],this.sid=r[4],this.group||(this.runtime.blocksBySid[this.sid.toString()]=this);var n=r[5],o,a;for(o=0,a=n.length;o<a;o++){var s=new cr.condition(this,n[o]);s.index=o,cr.seal(s),this.conditions.push(s),this.addSolModifier(s.type)}var l=r[6];for(o=0,a=l.length;o<a;o++){var p=new cr.action(this,l[o]);p.index=o,cr.seal(p),this.actions.push(p)}if(8===r.length){var d=r[7];for(o=0,a=d.length;o<a;o++)this.sheet.init_event(d[o],this,this.subevents)}this.is_else_block=!1,this.conditions.length&&(this.is_else_block=null==this.conditions[0].type&&this.conditions[0].func==cr.system_object.prototype.cnds.Else)}function s(e,r){var n,o,a;if(e&&(-1===r.indexOf(e)&&r.push(e),e.is_contained))for(n=0,o=e.container.length;n<o;n++)a=e.container[n],e!==a&&-1===r.indexOf(a)&&r.push(a)}function l(e,t){if(this.block=e,this.sheet=e.sheet,this.runtime=e.runtime,this.parameters=[],this.results=[],this.extra={},this.index=-1,this.anyParamVariesPerInstance=!1,this.func=this.runtime.GetObjectReference(t[1]),this.trigger=0<t[3],this.fasttrigger=2===t[3],this.looping=t[4],this.inverted=t[5],this.isstatic=t[6],this.sid=t[7],this.runtime.cndsBySid[this.sid.toString()]=this,-1===t[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[t[0]],this.run=this.isstatic?this.run_static:this.run_object,t[2]?(this.behaviortype=this.type.getBehaviorByName(t[2]),this.beh_index=this.type.getBehaviorIndexByName(t[2])):(this.behaviortype=null,this.beh_index=-1),this.block.parent&&this.block.parent.setSolWriterAfterCnds()),(this.fasttrigger&&(this.run=this.run_true),10===t.length)){var r=t[9],n,o;for(n=0,o=r.length;n<o;n++){var a=new cr.parameter(this,r[n]);cr.seal(a),this.parameters.push(a)}this.results.length=r.length}}function p(e,t){if(this.block=e,this.sheet=e.sheet,this.runtime=e.runtime,this.parameters=[],this.results=[],this.extra={},this.index=-1,this.anyParamVariesPerInstance=!1,this.func=this.runtime.GetObjectReference(t[1]),-1===t[0]?(this.type=null,this.run=this.run_system,this.behaviortype=null,this.beh_index=-1):(this.type=this.runtime.types_by_index[t[0]],this.run=this.run_object,t[2]?(this.behaviortype=this.type.getBehaviorByName(t[2]),this.beh_index=this.type.getBehaviorIndexByName(t[2])):(this.behaviortype=null,this.beh_index=-1)),(this.sid=t[3],this.runtime.actsBySid[this.sid.toString()]=this,6===t.length)){var r=t[5],n,o;for(n=0,o=r.length;n<o;n++){var a=new cr.parameter(this,r[n]);cr.seal(a),this.parameters.push(a)}this.results.length=r.length}}function d(){return f++,h.length===f&&h.push(new cr.expvalue),h[f]}function c(){f--}function u(e,t){this.owner=e,this.block=e.block,this.sheet=e.sheet,this.runtime=e.runtime,this.type=t[0],this.expression=null,this.solindex=0,this.get=null,this.combosel=0,this.layout=null,this.key=0,this.object=null,this.index=0,this.varname=null,this.eventvar=null,this.fileinfo=null,this.subparams=null,this.variadicret=null,this.subparams=null,this.variadicret=null,this.variesPerInstance=!1;var r,n,o;switch(t[0]){case 0:case 7:this.expression=new cr.expNode(this,t[1]),this.solindex=0,this.get=this.get_exp;break;case 1:this.expression=new cr.expNode(this,t[1]),this.solindex=0,this.get=this.get_exp_str;break;case 5:this.expression=new cr.expNode(this,t[1]),this.solindex=0,this.get=this.get_layer;break;case 3:case 8:this.combosel=t[1],this.get=this.get_combosel;break;case 6:this.layout=this.runtime.layouts[t[1]];;this.get=this.get_layout;break;case 9:this.key=t[1],this.get=this.get_key;break;case 4:this.object=this.runtime.types_by_index[t[1]];;this.get=this.get_object,this.block.addSolModifier(this.object),this.owner instanceof cr.action?this.block.setSolWriterAfterCnds():this.block.parent&&this.block.parent.setSolWriterAfterCnds();break;case 10:this.index=t[1],e.type&&e.type.is_family?(this.get=this.get_familyvar,this.variesPerInstance=!0):this.get=this.get_instvar;break;case 11:this.varname=t[1],this.eventvar=null,this.get=this.get_eventvar;break;case 2:case 12:this.fileinfo=t[1],this.get=this.get_audiofile;break;case 13:for(this.get=this.get_variadic,this.subparams=[],this.variadicret=[],(r=1,n=t.length);r<n;r++)o=new cr.parameter(this.owner,t[r]),cr.seal(o),this.subparams.push(o),this.variadicret.push(0);break;default:;}}function g(e,t,r){this.sheet=e,this.parent=t,this.runtime=e.runtime,this.solModifiers=[],this.name=r[1],this.vartype=r[2],this.initial=r[3],this.is_static=!!r[4],this.is_constant=!!r[5],this.sid=r[6],this.runtime.varsBySid[this.sid.toString()]=this,this.data=this.initial,this.parent?(this.localIndex=this.is_static||this.is_constant?-1:this.runtime.stackLocalCount++,this.runtime.all_local_vars.push(this)):(this.localIndex=-1,this.runtime.all_global_vars.push(this))}function y(e,t,r){this.sheet=e,this.parent=t,this.runtime=e.runtime,this.solModifiers=[],this.include_sheet=null,this.include_sheet_name=r[1],this.active=!0}function m(){this.temp_parents_arr=[],this.reset(null),cr.seal(this)}var _=[];n.prototype.toString=function(){return this.name},n.prototype.init_event=function(e,t,r){switch(e[0]){case 0:{var n=new cr.eventblock(this,t,e);if(cr.seal(n),n.orblock){r.push(n);var o,a;for(o=0,a=n.conditions.length;o<a;o++)n.conditions[o].trigger&&this.init_trigger(n,o)}else n.is_trigger()?this.init_trigger(n,0):r.push(n);break}case 1:{var s=new cr.eventvariable(this,t,e);cr.seal(s),r.push(s);break}case 2:{var l=new cr.eventinclude(this,t,e);cr.seal(l),r.push(l);break}default:;}},n.prototype.postInit=function(){var e,t;for(e=0,t=this.events.length;e<t;e++)this.events[e].postInit(e<t-1&&this.events[e+1].is_else_block)},n.prototype.updateDeepIncludes=function(){cr.clearArray(this.deep_includes),cr.clearArray(this.already_included_sheets),this.addDeepIncludes(this),cr.clearArray(this.already_included_sheets)},n.prototype.addDeepIncludes=function(e){var t=e.deep_includes,r=e.already_included_sheets,n=this.includes.valuesRef(),o,a,s,l;for(o=0,a=n.length;o<a;++o)s=n[o],l=s.include_sheet,s.isActive()&&e!==l&&!(-1<r.indexOf(l))&&(r.push(l),l.addDeepIncludes(e),t.push(l))},n.prototype.run=function(e){this.runtime.resuming_breakpoint||(this.hasRun=!0,!e&&(this.runtime.isRunningEvents=!0));var t,r;for(t=0,r=this.events.length;t<r;t++){var n=this.events[t];n.run(),this.runtime.clearSol(n.solModifiers),this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()}e||(this.runtime.isRunningEvents=!1)};n.prototype.init_trigger=function(e,t){e.orblock||this.runtime.triggers_to_postinit.push(e);var r=e.conditions[t],n,a,s;s=r.type?r.type.name:"system";var l=r.fasttrigger,p=l?this.fasttriggers:this.triggers;p[s]||(p[s]=[]);var d=p[s],c=r.func;if(l){if(!r.parameters.length)return;var u=r.parameters[0];if(1!==u.type||2!==u.expression.type)return;var g=u.expression.value.toLowerCase(),y,n,a;for(n=0,a=d.length;n<a;n++)if(d[n].method==c)return y=d[n].evs,void(y[g]?y[g].push([e,t]):y[g]=[[e,t]]);y={},y[g]=[[e,t]],d.push({method:c,evs:y})}else{for(n=0,a=d.length;n<a;n++)if(d[n].method==c)return void d[n].evs.push([e,t]);o(c)?d.unshift({method:c,evs:[[e,t]]}):d.push({method:c,evs:[[e,t]]})}},cr.eventsheet=n;a.prototype.hasObjects=function(){return this.select_all?this.type.instances.length:this.instances.length},a.prototype.getObjects=function(){return this.select_all?this.type.instances:this.instances},a.prototype.pick_one=function(e){if(e)if(e.runtime.getCurrentEventStack().current_event.orblock){this.select_all&&(cr.clearArray(this.instances),cr.shallowAssignArray(this.else_instances,e.type.instances),this.select_all=!1);var t=this.else_instances.indexOf(e);-1!==t&&(this.instances.push(this.else_instances[t]),this.else_instances.splice(t,1))}else this.select_all=!1,cr.clearArray(this.instances),this.instances[0]=e},cr.selection=a;window._c2hh_="0E3864629B7C48439DCEA2FC147C74F2A9BCA3C1",i.prototype.postInit=function(e){var t=this.parent,n,o;if(this.group)for(this.toplevelgroup=!0;t;){if(!t.group){this.toplevelgroup=!1;break}t=t.parent}for(this.toplevelevent=!this.is_trigger()&&(!this.parent||this.parent.group&&this.parent.toplevelgroup),this.has_else_block=!!e,this.solModifiersIncludingParents=this.solModifiers.slice(0),t=this.parent;t;){for(n=0,o=t.solModifiers.length;n<o;n++)this.addParentSolModifier(t.solModifiers[n]);t=t.parent}this.solModifiers=r(this.solModifiers),this.solModifiersIncludingParents=r(this.solModifiersIncludingParents);var n,o;for(n=0,o=this.conditions.length;n<o;n++)this.conditions[n].postInit();for(n=0,o=this.actions.length;n<o;n++)this.actions[n].postInit();for(n=0,o=this.subevents.length;n<o;n++)this.subevents[n].postInit(n<o-1&&this.subevents[n+1].is_else_block)},i.prototype.setGroupActive=function(e){if(this.group_active!==!!e){this.group_active=!!e;var t,r;for(t=0,r=this.contained_includes.length;t<r;++t)this.contained_includes[t].updateActive();0<r&&this.runtime.running_layout.event_sheet&&this.runtime.running_layout.event_sheet.updateDeepIncludes()}};i.prototype.addSolModifier=function(e){s(e,this.solModifiers)},i.prototype.addParentSolModifier=function(e){s(e,this.solModifiersIncludingParents)},i.prototype.setSolWriterAfterCnds=function(){this.solWriterAfterCnds=!0,this.parent&&this.parent.setSolWriterAfterCnds()},i.prototype.is_trigger=function(){return!!this.conditions.length&&this.conditions[0].trigger},i.prototype.run=function(){var e=!1,t=this.runtime,r=this.runtime.getCurrentEventStack(),n,o,a;r.current_event=this;var i=this.conditions;if(this.is_else_block||(r.else_branch_ran=!1),this.orblock){for(0===i.length&&(e=!0),r.cndindex=0,n=i.length;r.cndindex<n;r.cndindex++)o=i[r.cndindex],o.trigger||(a=o.run(),a&&(e=!0));r.last_event_true=e,e&&this.run_actions_and_subevents()}else{for(r.cndindex=0,n=i.length;r.cndindex<n;r.cndindex++)if(a=i[r.cndindex].run(),!a)return r.last_event_true=!1,void(this.toplevelevent&&t.hasPendingInstances&&t.ClearDeathRow());r.last_event_true=!0,this.run_actions_and_subevents()}this.end_run(r)},i.prototype.end_run=function(e){e.last_event_true&&this.has_else_block&&(e.else_branch_ran=!0),this.toplevelevent&&this.runtime.hasPendingInstances&&this.runtime.ClearDeathRow()},i.prototype.run_orblocktrigger=function(e){var t=this.runtime.getCurrentEventStack();t.current_event=this,this.conditions[e].run()&&(this.run_actions_and_subevents(),this.runtime.getCurrentEventStack().last_event_true=!0)},i.prototype.run_actions_and_subevents=function(){var e=this.runtime.getCurrentEventStack(),t;for(e.actindex=0,t=this.actions.length;e.actindex<t;e.actindex++)if(this.actions[e.actindex].run())return;this.run_subevents()},i.prototype.resume_actions_and_subevents=function(){var e=this.runtime.getCurrentEventStack(),t;for(t=this.actions.length;e.actindex<t;e.actindex++)if(this.actions[e.actindex].run())return;this.run_subevents()},i.prototype.run_subevents=function(){if(this.subevents.length){var e=this.subevents.length-1,t,r,n,o;if(this.runtime.pushEventStack(this),this.solWriterAfterCnds)for(t=0,r=this.subevents.length;t<r;t++)n=this.subevents[t],o=!this.toplevelgroup||!this.group&&t<e,o&&this.runtime.pushCopySol(n.solModifiers),n.run(),o?this.runtime.popSol(n.solModifiers):this.runtime.clearSol(n.solModifiers);else for(t=0,r=this.subevents.length;t<r;t++)this.subevents[t].run();this.runtime.popEventStack()}},i.prototype.run_pretrigger=function(){var e=this.runtime.getCurrentEventStack();e.current_event=this;var t=!1,r;for(e.cndindex=0,r=this.conditions.length;e.cndindex<r;e.cndindex++)if(this.conditions[e.cndindex].run())t=!0;else if(!this.orblock)return!1;return!this.orblock||t},i.prototype.retrigger=function(){this.runtime.execcount++;var e=this.runtime.getCurrentEventStack().cndindex,t=this.runtime.pushEventStack(this),r;if(!this.orblock)for(t.cndindex=e+1,r=this.conditions.length;t.cndindex<r;t.cndindex++)if(!this.conditions[t.cndindex].run())return this.runtime.popEventStack(),!1;return this.run_actions_and_subevents(),this.runtime.popEventStack(),!0},i.prototype.isFirstConditionOfType=function(e){var t=e.index;if(0===t)return!0;for(--t;0<=t;--t)if(this.conditions[t].type===e.type)return!1;return!0},cr.eventblock=i;l.prototype.postInit=function(){var e,t,r;for(e=0,t=this.parameters.length;e<t;e++)r=this.parameters[e],r.postInit(),r.variesPerInstance&&(this.anyParamVariesPerInstance=!0)},l.prototype.run_true=function(){return!0},l.prototype.run_system=function(){var e,t;for(e=0,t=this.parameters.length;e<t;e++)this.results[e]=this.parameters[e].get();return cr.xor(this.func.apply(this.runtime.system,this.results),this.inverted)},l.prototype.run_static=function(){var e,t;for(e=0,t=this.parameters.length;e<t;e++)this.results[e]=this.parameters[e].get();var r=this.func.apply(this.behaviortype?this.behaviortype:this.type,this.results);return this.type.applySolToContainer(),r},l.prototype.run_object=function(){var e=this.type,t=e.getCurrentSol(),r=this.block.orblock&&!this.trigger,n=0,o=e.is_contained,a=e.is_family,l=e.family_index,d=this.beh_index,c=-1<d,u=this.anyParamVariesPerInstance,g=this.parameters,y=this.results,m=this.inverted,_=this.func,h,f,b,x,v,w,S,T,C,O,A,E,P;if(u)for(f=0,v=g.length;f<v;++f)w=g[f],w.variesPerInstance||(y[f]=w.get(0));else for(f=0,v=g.length;f<v;++f)y[f]=g[f].get(0);if(t.select_all){for(cr.clearArray(t.instances),cr.clearArray(t.else_instances),E=e.instances,(h=0,x=E.length);h<x;++h){if(C=E[h],u)for(f=0,v=g.length;f<v;++f)w=g[f],w.variesPerInstance&&(y[f]=w.get(h));c?(n=0,a&&(n=C.type.family_beh_map[l]),S=_.apply(C.behavior_insts[d+n],y)):S=_.apply(C,y),T=cr.xor(S,m),T?t.instances.push(C):r&&t.else_instances.push(C)}return e.finish&&e.finish(!0),t.select_all=!1,e.applySolToContainer(),t.hasObjects()}b=0;var I=r&&!this.block.isFirstConditionOfType(this);E=I?t.else_instances:t.instances;var L=!1;for(h=0,x=E.length;h<x;++h){if(C=E[h],u)for(f=0,v=g.length;f<v;++f)w=g[f],w.variesPerInstance&&(y[f]=w.get(h));if(c?(n=0,a&&(n=C.type.family_beh_map[l]),S=_.apply(C.behavior_insts[d+n],y)):S=_.apply(C,y),cr.xor(S,m)){if(L=!0,!I){if(E[b]=C,o)for(f=0,v=C.siblings.length;f<v;f++)O=C.siblings[f],O.type.getCurrentSol().instances[b]=O;b++}else if(t.instances.push(C),o)for(f=0,v=C.siblings.length;f<v;f++)O=C.siblings[f],O.type.getCurrentSol().instances.push(O);}else if(I){if(E[b]=C,o)for(f=0,v=C.siblings.length;f<v;f++)O=C.siblings[f],O.type.getCurrentSol().else_instances[b]=O;b++}else if(r&&(t.else_instances.push(C),o))for(f=0,v=C.siblings.length;f<v;f++)O=C.siblings[f],O.type.getCurrentSol().else_instances.push(O)}if(cr.truncateArray(E,b),o)for(P=e.container,h=0,x=P.length;h<x;h++)A=P[h].getCurrentSol(),I?cr.truncateArray(A.else_instances,b):cr.truncateArray(A.instances,b);var R=L;if(I&&!L)for(h=0,x=t.instances.length;h<x;h++){if(C=t.instances[h],u)for(f=0,v=g.length;f<v;f++)w=g[f],w.variesPerInstance&&(y[f]=w.get(h));if(S=c?_.apply(C.behavior_insts[d],y):_.apply(C,y),cr.xor(S,m)){L=!0;break}}return e.finish&&e.finish(R||r),r?L:t.hasObjects()},cr.condition=l;p.prototype.postInit=function(){var e,t,r;for(e=0,t=this.parameters.length;e<t;e++)r=this.parameters[e],r.postInit(),r.variesPerInstance&&(this.anyParamVariesPerInstance=!0)},p.prototype.run_system=function(){var e=this.runtime,t=this.parameters,r=this.results,n,o;for(n=0,o=t.length;n<o;++n)r[n]=t[n].get();return this.func.apply(e.system,r)},p.prototype.run_object=function(){var e=this.type,t=this.beh_index,r=e.family_index,n=this.anyParamVariesPerInstance,o=this.parameters,a=this.results,s=this.func,l=e.getCurrentSol().getObjects(),d=e.is_family,c,u,g,y,m,_,h;if(n)for(u=0,y=o.length;u<y;++u)m=o[u],m.variesPerInstance||(a[u]=m.get(0));else for(u=0,y=o.length;u<y;++u)a[u]=o[u].get(0);for(c=0,g=l.length;c<g;++c){if(_=l[c],n)for(u=0,y=o.length;u<y;++u)m=o[u],m.variesPerInstance&&(a[u]=m.get(c));-1<t?(h=0,d&&(h=_.type.family_beh_map[r]),s.apply(_.behavior_insts[t+h],a)):s.apply(_,a)}return!1},cr.action=p;var h=[],f=-1;u.prototype.postInit=function(){var e,t;if(11===this.type)this.eventvar=this.runtime.getEventVariableByName(this.varname,this.block.parent);else if(13===this.type)for(e=0,t=this.subparams.length;e<t;e++)this.subparams[e].postInit();this.expression&&this.expression.postInit()},u.prototype.maybeVaryForType=function(e){return this.variesPerInstance?void 0:e?e.plugin.singleglobal?void 0:void(this.variesPerInstance=!0):void 0},u.prototype.setVaries=function(){this.variesPerInstance=!0},u.prototype.get_exp=function(e){this.solindex=e||0;var t=d();return this.expression.get(t),c(),t.data},u.prototype.get_exp_str=function(e){this.solindex=e||0;var t=d();return this.expression.get(t),c(),cr.is_string(t.data)?t.data:""},u.prototype.get_object=function(){return this.object},u.prototype.get_combosel=function(){return this.combosel},u.prototype.get_layer=function(e){this.solindex=e||0;var t=d();return this.expression.get(t),c(),t.is_number()?this.runtime.getLayerByNumber(t.data):this.runtime.getLayerByName(t.data)},u.prototype.get_layout=function(){return this.layout},u.prototype.get_key=function(){return this.key},u.prototype.get_instvar=function(){return this.index},u.prototype.get_familyvar=function(e){var t=e||0,r=this.owner.type,n=null,o=r.getCurrentSol(),a=o.getObjects();if(a.length)n=a[t%a.length].type;else if(o.else_instances.length)n=o.else_instances[t%o.else_instances.length].type;else if(r.instances.length)n=r.instances[t%r.instances.length].type;else return 0;return this.index+n.family_var_map[r.family_index]},u.prototype.get_eventvar=function(){return this.eventvar},u.prototype.get_audiofile=function(){return this.fileinfo},u.prototype.get_variadic=function(){var e,t;for(e=0,t=this.subparams.length;e<t;e++)this.variadicret[e]=this.subparams[e].get();return this.variadicret},cr.parameter=u;g.prototype.postInit=function(){this.solModifiers=r(this.solModifiers)},g.prototype.setValue=function(e){var t=this.runtime.getCurrentLocalVarStack();this.parent&&!this.is_static&&t?(this.localIndex>=t.length&&(t.length=this.localIndex+1),t[this.localIndex]=e):this.data=e},g.prototype.getValue=function(){var e=this.runtime.getCurrentLocalVarStack();return!this.parent||this.is_static||!e||this.is_constant?this.data:this.localIndex>=e.length?this.initial:"undefined"==typeof e[this.localIndex]?this.initial:e[this.localIndex]},g.prototype.run=function(){!this.parent||this.is_static||this.is_constant||this.setValue(this.initial)},cr.eventvariable=g;y.prototype.toString=function(){return"include:"+this.include_sheet.toString()},y.prototype.postInit=function(){this.include_sheet=this.runtime.eventsheets[this.include_sheet_name];this.sheet.includes.add(this),this.solModifiers=r(this.solModifiers);for(var e=this.parent;e;)e.group&&e.contained_includes.push(this),e=e.parent;this.updateActive()},y.prototype.run=function(){this.parent&&this.runtime.pushCleanSol(this.runtime.types_by_index),this.include_sheet.hasRun||this.include_sheet.run(!0),this.parent&&this.runtime.popSol(this.runtime.types_by_index)},y.prototype.updateActive=function(){for(var e=this.parent;e;){if(e.group&&!e.group_active)return void(this.active=!1);e=e.parent}this.active=!0},y.prototype.isActive=function(){return this.active},cr.eventinclude=y;m.prototype.reset=function(e){this.current_event=e,this.cndindex=0,this.actindex=0,cr.clearArray(this.temp_parents_arr),this.last_event_true=!1,this.else_branch_ran=!1,this.any_true_state=!1},m.prototype.isModifierAfterCnds=function(){return!!this.current_event.solWriterAfterCnds||!!(this.cndindex<this.current_event.conditions.length-1)&&!!this.current_event.solModifiers.length},cr.eventStackFrame=m})(),function(){function e(e,t){this.owner=e,this.runtime=e.runtime,this.type=t[0],this.get=[this.eval_int,this.eval_float,this.eval_string,this.eval_unaryminus,this.eval_add,this.eval_subtract,this.eval_multiply,this.eval_divide,this.eval_mod,this.eval_power,this.eval_and,this.eval_or,this.eval_equal,this.eval_notequal,this.eval_less,this.eval_lessequal,this.eval_greater,this.eval_greaterequal,this.eval_conditional,this.eval_system_exp,this.eval_object_exp,this.eval_instvar_exp,this.eval_behavior_exp,this.eval_eventvar_exp][this.type];var r=null;switch(this.value=null,this.first=null,this.second=null,this.third=null,this.func=null,this.results=null,this.parameters=null,this.object_type=null,this.beh_index=-1,this.instance_expr=null,this.varindex=-1,this.behavior_type=null,this.varname=null,this.eventvar=null,this.return_string=!1,this.type){case 0:case 1:case 2:this.value=t[1];break;case 3:this.first=new cr.expNode(e,t[1]);break;case 18:this.first=new cr.expNode(e,t[1]),this.second=new cr.expNode(e,t[2]),this.third=new cr.expNode(e,t[3]);break;case 19:this.func=this.runtime.GetObjectReference(t[1]);;(this.func===cr.system_object.prototype.exps.random||this.func===cr.system_object.prototype.exps.choose)&&this.owner.setVaries(),this.results=[],this.parameters=[],3===t.length?(r=t[2],this.results.length=r.length+1):this.results.length=1;break;case 20:this.object_type=this.runtime.types_by_index[t[1]];;this.beh_index=-1,this.func=this.runtime.GetObjectReference(t[2]),this.return_string=t[3],cr.plugins_.Function&&this.func===cr.plugins_.Function.prototype.exps.Call&&this.owner.setVaries(),this.instance_expr=t[4]?new cr.expNode(e,t[4]):null,this.results=[],this.parameters=[],6===t.length?(r=t[5],this.results.length=r.length+1):this.results.length=1;break;case 21:this.object_type=this.runtime.types_by_index[t[1]];;this.return_string=t[2],this.instance_expr=t[3]?new cr.expNode(e,t[3]):null,this.varindex=t[4];break;case 22:this.object_type=this.runtime.types_by_index[t[1]];;this.behavior_type=this.object_type.getBehaviorByName(t[2]);;this.beh_index=this.object_type.getBehaviorIndexByName(t[2]),this.func=this.runtime.GetObjectReference(t[3]),this.return_string=t[4],this.instance_expr=t[5]?new cr.expNode(e,t[5]):null,this.results=[],this.parameters=[],7===t.length?(r=t[6],this.results.length=r.length+1):this.results.length=1;break;case 23:this.varname=t[1],this.eventvar=null;}if(this.owner.maybeVaryForType(this.object_type),4<=this.type&&17>=this.type&&(this.first=new cr.expNode(e,t[1]),this.second=new cr.expNode(e,t[2])),r){var n,o;for(n=0,o=r.length;n<o;n++)this.parameters.push(new cr.expNode(e,r[n]))}cr.seal(this)}function t(){return++i,a.length===i&&a.push(new cr.expvalue),a[i]}function r(){--i}function n(e,t,r){var n,o;for(n=0,o=e.length;n<o;++n)e[n].get(r),t[n+1]=r.data}function o(e,t){this.type=e||cr.exptype.Integer,this.data=t||0,this.object_class=null;this.type==cr.exptype.Integer&&(this.data=Math.floor(this.data)),cr.seal(this)}e.prototype.postInit=function(){if(23===this.type&&(this.eventvar=this.owner.runtime.getEventVariableByName(this.varname,this.owner.block.parent)),this.first&&this.first.postInit(),this.second&&this.second.postInit(),this.third&&this.third.postInit(),this.instance_expr&&this.instance_expr.postInit(),this.parameters){var e,t;for(e=0,t=this.parameters.length;e<t;e++)this.parameters[e].postInit()}};var a=[],i=-1;e.prototype.eval_system_exp=function(e){var o=this.parameters,a=this.results;a[0]=e;var i=t();n(o,a,i),r(),this.func.apply(this.runtime.system,a)},e.prototype.eval_object_exp=function(e){var o=this.object_type,a=this.results,i=this.parameters,s=this.instance_expr,l=this.func,p=this.owner.solindex,d=o.getCurrentSol(),c=d.getObjects();if(!c.length)if(d.else_instances.length)c=d.else_instances;else return void(this.return_string?e.set_string(""):e.set_int(0));a[0]=e,e.object_class=o;var u=t();n(i,a,u),s&&(s.get(u),u.is_number()&&(p=u.data,c=o.instances)),r();var g=c.length;(p>=g||p<=-g)&&(p%=g),0>p&&(p+=g);l.apply(c[p],a)},e.prototype.eval_behavior_exp=function(e){var o=this.object_type,a=this.results,i=this.parameters,s=this.instance_expr,l=this.beh_index,p=this.func,d=this.owner.solindex,c=o.getCurrentSol(),u=c.getObjects();if(!u.length)if(c.else_instances.length)u=c.else_instances;else return void(this.return_string?e.set_string(""):e.set_int(0));a[0]=e,e.object_class=o;var g=t();n(i,a,g),s&&(s.get(g),g.is_number()&&(d=g.data,u=o.instances)),r();var y=u.length;(d>=y||d<=-y)&&(d%=y),0>d&&(d+=y);var m=u[d],_=0;o.is_family&&(_=m.type.family_beh_map[o.family_index]);p.apply(m.behavior_insts[l+_],a)},e.prototype.eval_instvar_exp=function(e){var n=this.instance_expr,o=this.object_type,a=this.varindex,i=this.owner.solindex,s=o.getCurrentSol(),l=s.getObjects(),p;if(!l.length)if(s.else_instances.length)l=s.else_instances;else return void(this.return_string?e.set_string(""):e.set_int(0));if(n){var d=t();if(n.get(d),d.is_number()){i=d.data;var c=o.instances;0!==c.length&&(i%=c.length,0>i&&(i+=c.length)),p=o.getInstanceByIID(i);var u=p.instance_vars[a];return cr.is_string(u)?e.set_string(u):e.set_float(u),void r()}r()}var g=l.length;(i>=g||i<=-g)&&(i%=g),0>i&&(i+=g),p=l[i];var y=0;o.is_family&&(y=p.type.family_var_map[o.family_index]);var u=p.instance_vars[a+y];cr.is_string(u)?e.set_string(u):e.set_float(u)},e.prototype.eval_int=function(e){e.type=cr.exptype.Integer,e.data=this.value},e.prototype.eval_float=function(e){e.type=cr.exptype.Float,e.data=this.value},e.prototype.eval_string=function(e){e.type=cr.exptype.String,e.data=this.value},e.prototype.eval_unaryminus=function(e){this.first.get(e),e.is_number()&&(e.data=-e.data)},e.prototype.eval_add=function(e){this.first.get(e);var n=t();this.second.get(n),e.is_number()&&n.is_number()&&(e.data+=n.data,n.is_float()&&e.make_float()),r()},e.prototype.eval_subtract=function(e){this.first.get(e);var n=t();this.second.get(n),e.is_number()&&n.is_number()&&(e.data-=n.data,n.is_float()&&e.make_float()),r()},e.prototype.eval_multiply=function(e){this.first.get(e);var n=t();this.second.get(n),e.is_number()&&n.is_number()&&(e.data*=n.data,n.is_float()&&e.make_float()),r()},e.prototype.eval_divide=function(e){this.first.get(e);var n=t();this.second.get(n),e.is_number()&&n.is_number()&&(e.data/=n.data,e.make_float()),r()},e.prototype.eval_mod=function(e){this.first.get(e);var n=t();this.second.get(n),e.is_number()&&n.is_number()&&(e.data%=n.data,n.is_float()&&e.make_float()),r()},e.prototype.eval_power=function(e){this.first.get(e);var n=t();this.second.get(n),e.is_number()&&n.is_number()&&(e.data=Math.pow(e.data,n.data),n.is_float()&&e.make_float()),r()},e.prototype.eval_and=function(e){this.first.get(e);var n=t();this.second.get(n),n.is_string()||e.is_string()?this.eval_and_stringconcat(e,n):this.eval_and_logical(e,n),r()},e.prototype.eval_and_stringconcat=function(e,t){e.is_string()&&t.is_string()?this.eval_and_stringconcat_str_str(e,t):this.eval_and_stringconcat_num(e,t)},e.prototype.eval_and_stringconcat_str_str=function(e,t){e.data+=t.data},e.prototype.eval_and_stringconcat_num=function(e,t){e.is_string()?e.data+=(Math.round(1e10*t.data)/1e10).toString():e.set_string(e.data.toString()+t.data)},e.prototype.eval_and_logical=function(e,t){e.set_int(e.data&&t.data?1:0)},e.prototype.eval_or=function(e){this.first.get(e);var n=t();this.second.get(n),e.is_number()&&n.is_number()&&(e.data||n.data?e.set_int(1):e.set_int(0)),r()},e.prototype.eval_conditional=function(e){this.first.get(e),e.data?this.second.get(e):this.third.get(e)},e.prototype.eval_equal=function(e){this.first.get(e);var n=t();this.second.get(n),e.set_int(e.data===n.data?1:0),r()},e.prototype.eval_notequal=function(e){this.first.get(e);var n=t();this.second.get(n),e.set_int(e.data===n.data?0:1),r()},e.prototype.eval_less=function(e){this.first.get(e);var n=t();this.second.get(n),e.set_int(e.data<n.data?1:0),r()},e.prototype.eval_lessequal=function(e){this.first.get(e);var n=t();this.second.get(n),e.set_int(e.data<=n.data?1:0),r()},e.prototype.eval_greater=function(e){this.first.get(e);var n=t();this.second.get(n),e.set_int(e.data>n.data?1:0),r()},e.prototype.eval_greaterequal=function(e){this.first.get(e);var n=t();this.second.get(n),e.set_int(e.data>=n.data?1:0),r()},e.prototype.eval_eventvar_exp=function(e){var t=this.eventvar.getValue();cr.is_number(t)?e.set_float(t):e.set_string(t)},cr.expNode=e;o.prototype.is_int=function(){return this.type===cr.exptype.Integer},o.prototype.is_float=function(){return this.type===cr.exptype.Float},o.prototype.is_number=function(){return this.type===cr.exptype.Integer||this.type===cr.exptype.Float},o.prototype.is_string=function(){return this.type===cr.exptype.String},o.prototype.make_int=function(){this.is_int()||(this.is_float()?this.data=Math.floor(this.data):this.is_string()&&(this.data=parseInt(this.data,10)),this.type=cr.exptype.Integer)},o.prototype.make_float=function(){this.is_float()||(this.is_string()&&(this.data=parseFloat(this.data)),this.type=cr.exptype.Float)},o.prototype.make_string=function(){this.is_string()||(this.data=this.data.toString(),this.type=cr.exptype.String)},o.prototype.set_int=function(e){this.type=cr.exptype.Integer,this.data=Math.floor(e)},o.prototype.set_float=function(e){this.type=cr.exptype.Float,this.data=e},o.prototype.set_string=function(e){this.type=cr.exptype.String,this.data=e},o.prototype.set_any=function(e){cr.is_number(e)?(this.type=cr.exptype.Float,this.data=e):cr.is_string(e)?(this.type=cr.exptype.String,this.data=e.toString()):(this.type=cr.exptype.Integer,this.data=0)},cr.expvalue=o,cr.exptype={Integer:0,Float:1,String:2}}();cr.system_object=function(e){this.runtime=e,this.waits=[]},cr.system_object.prototype.saveToJSON=function(){var e={},r,n,o,a,s,l,d,c;e.waits=[];var u=e.waits,g;for(r=0,n=this.waits.length;r<n;r++){for(l=this.waits[r],g={t:l.time,st:l.signaltag,s:l.signalled,ev:l.ev.sid,sm:[],sols:{}},l.ev.actions[l.actindex]&&(g.act=l.ev.actions[l.actindex].sid),(o=0,a=l.solModifiers.length);o<a;o++)g.sm.push(l.solModifiers[o].sid);for(s in l.sols)if(l.sols.hasOwnProperty(s)){d=this.runtime.types_by_index[parseInt(s,10)];for(c={sa:l.sols[s].sa,insts:[]},o=0,a=l.sols[s].insts.length;o<a;o++)c.insts.push(l.sols[s].insts[o].uid);g.sols[d.sid.toString()]=c}u.push(g)}return e},cr.system_object.prototype.loadFromJSON=function(r){var n=r.waits,o,a,s,l,d,c,u,g,y,m,_,h,f;for(cr.clearArray(this.waits),o=0,a=n.length;o<a;o++)if(c=n[o],g=this.runtime.blocksBySid[c.ev.toString()],g){for(y=-1,s=0,l=g.actions.length;s<l;s++)if(g.actions[s].sid===c.act){y=s;break}if(-1!==y){for(u={},u.sols={},u.solModifiers=[],u.deleteme=!1,u.time=c.t,u.signaltag=c.st||"",u.signalled=!!c.s,u.ev=g,u.actindex=y,(s=0,l=c.sm.length);s<l;s++)m=this.runtime.getObjectTypeBySid(c.sm[s]),m&&u.solModifiers.push(m);for(d in c.sols)if(c.sols.hasOwnProperty(d)){if(m=this.runtime.getObjectTypeBySid(parseInt(d,10)),!m)continue;for(_=c.sols[d],h={sa:_.sa,insts:[]},(s=0,l=_.insts.length);s<l;s++)f=this.runtime.getObjectByUID(_.insts[s]),f&&h.insts.push(f);u.sols[m.index.toString()]=h}this.waits.push(u)}}},function(){function e(){}function t(e,t){var r=e.extra.c2_feo_val,n=t.extra.c2_feo_val;return cr.is_number(r)&&cr.is_number(n)?r-n:(r=""+r,n=""+n,r<n?-1:r>n?1:0)}function r(e,t){return h&&e===f&&t===b||(h=new RegExp(e,t),f=e,b=t),h.lastIndex=0,h}function n(){}function o(){var e;return v.length?e=v.pop():(e={},e.sols={},e.solModifiers=[]),e.deleteme=!1,e}function a(e){cr.wipe(e.sols),cr.clearArray(e.solModifiers),v.push(e)}function l(){var e;return w.length?e=w.pop():(e={},e.insts=[]),e.sa=!1,e}function p(e){cr.clearArray(e.insts),w.push(e)}function d(e,t){var r=e[0],n=t[0],o=r-n;if(0!==o)return o;var a=e[1],i=t[1];return a-i}function c(e,t){return e[1]-t[1]}function u(){}function g(e,t,n){if(e!==T||t!==C||n!==O){var o=r(t,n);S=e.match(o),T=e,C=t,O=n}}var y=cr.system_object.prototype;e.prototype.EveryTick=function(){return!0},e.prototype.OnLayoutStart=function(){return!0},e.prototype.OnLayoutEnd=function(){return!0},e.prototype.Compare=function(e,t,r){return cr.do_cmp(e,t,r)},e.prototype.CompareTime=function(e,r){var t=this.runtime.kahanTime.sum;if(0===e){var n=this.runtime.getCurrentCondition();return!(n.extra.CompareTime_executed||!(t>=r))&&(n.extra.CompareTime_executed=!0,!0)}return cr.do_cmp(t,e,r)},e.prototype.LayerVisible=function(e){return!!e&&e.visible},e.prototype.LayerEmpty=function(e){return!!e&&!e.instances.length},e.prototype.LayerCmpOpacity=function(e,t,r){return!!e&&cr.do_cmp(100*e.opacity,t,r)},e.prototype.Repeat=function(e){var t=this.runtime.getCurrentEventStack(),r=t.current_event,n=t.isModifierAfterCnds(),o=this.runtime.pushLoopStack(),a;if(n)for(a=0;a<e&&!o.stopped;a++)this.runtime.pushCopySol(r.solModifiers),o.index=a,r.retrigger(),this.runtime.popSol(r.solModifiers);else for(a=0;a<e&&!o.stopped;a++)o.index=a,r.retrigger();return this.runtime.popLoopStack(),!1},e.prototype.While=function(){var e=this.runtime.getCurrentEventStack(),t=e.current_event,r=e.isModifierAfterCnds(),n=this.runtime.pushLoopStack(),o;if(r)for(o=0;!n.stopped;o++)this.runtime.pushCopySol(t.solModifiers),n.index=o,t.retrigger()||(n.stopped=!0),this.runtime.popSol(t.solModifiers);else for(o=0;!n.stopped;o++)n.index=o,t.retrigger()||(n.stopped=!0);return this.runtime.popLoopStack(),!1},e.prototype.For=function(e,t,r){var n=this.runtime.getCurrentEventStack(),o=n.current_event,a=n.isModifierAfterCnds(),s=this.runtime.pushLoopStack(e),l;if(r<t){if(a)for(l=t;l>=r&&!s.stopped;--l)this.runtime.pushCopySol(o.solModifiers),s.index=l,o.retrigger(),this.runtime.popSol(o.solModifiers);else for(l=t;l>=r&&!s.stopped;--l)s.index=l,o.retrigger();}else if(a)for(l=t;l<=r&&!s.stopped;++l)this.runtime.pushCopySol(o.solModifiers),s.index=l,o.retrigger(),this.runtime.popSol(o.solModifiers);else for(l=t;l<=r&&!s.stopped;++l)s.index=l,o.retrigger();return this.runtime.popLoopStack(),!1};var m=[],_=-1;e.prototype.ForEach=function(e){var t=e.getCurrentSol();_++,m.length===_&&m.push([]);var r=m[_];cr.shallowAssignArray(r,t.getObjects());var n=this.runtime.getCurrentEventStack(),o=n.current_event,a=n.isModifierAfterCnds(),l=this.runtime.pushLoopStack(),p=e.is_contained,d,c,u,g,y,h,f;if(a)for(d=0,c=r.length;d<c&&!l.stopped;d++){if(this.runtime.pushCopySol(o.solModifiers),y=r[d],t=e.getCurrentSol(),t.select_all=!1,cr.clearArray(t.instances),t.instances[0]=y,p)for(u=0,g=y.siblings.length;u<g;u++)h=y.siblings[u],f=h.type.getCurrentSol(),f.select_all=!1,cr.clearArray(f.instances),f.instances[0]=h;l.index=d,o.retrigger(),this.runtime.popSol(o.solModifiers)}else for(t.select_all=!1,cr.clearArray(t.instances),(d=0,c=r.length);d<c&&!l.stopped;d++){if(y=r[d],t.instances[0]=y,p)for(u=0,g=y.siblings.length;u<g;u++)h=y.siblings[u],f=h.type.getCurrentSol(),f.select_all=!1,cr.clearArray(f.instances),f.instances[0]=h;l.index=d,o.retrigger()}return cr.clearArray(r),this.runtime.popLoopStack(),_--,!1};e.prototype.ForEachOrdered=function(e,r,n){var o=e.getCurrentSol();_++,m.length===_&&m.push([]);var a=m[_];cr.shallowAssignArray(a,o.getObjects());var l=this.runtime.getCurrentEventStack(),p=l.current_event,d=this.runtime.getCurrentCondition(),c=l.isModifierAfterCnds(),u=this.runtime.pushLoopStack(),g,y,h,f,b,x,v;for(g=0,y=a.length;g<y;g++)a[g].extra.c2_feo_val=d.parameters[1].get(g);a.sort(t),1===n&&a.reverse();var w=e.is_contained;if(c)for(g=0,y=a.length;g<y&&!u.stopped;g++){if(this.runtime.pushCopySol(p.solModifiers),b=a[g],o=e.getCurrentSol(),o.select_all=!1,cr.clearArray(o.instances),o.instances[0]=b,w)for(h=0,f=b.siblings.length;h<f;h++)x=b.siblings[h],v=x.type.getCurrentSol(),v.select_all=!1,cr.clearArray(v.instances),v.instances[0]=x;u.index=g,p.retrigger(),this.runtime.popSol(p.solModifiers)}else for(o.select_all=!1,cr.clearArray(o.instances),(g=0,y=a.length);g<y&&!u.stopped;g++){if(b=a[g],o.instances[0]=b,w)for(h=0,f=b.siblings.length;h<f;h++)x=b.siblings[h],v=x.type.getCurrentSol(),v.select_all=!1,cr.clearArray(v.instances),v.instances[0]=x;u.index=g,p.retrigger()}return cr.clearArray(a),this.runtime.popLoopStack(),_--,!1},e.prototype.PickByComparison=function(e,t,r,n){var o,a,s,l;if(e){_++,m.length===_&&m.push([]);var p=m[_],d=e.getCurrentSol();cr.shallowAssignArray(p,d.getObjects()),d.select_all&&cr.clearArray(d.else_instances);var c=this.runtime.getCurrentCondition();for(o=0,s=0,a=p.length;o<a;o++)l=p[o],p[s]=l,t=c.parameters[1].get(o),n=c.parameters[3].get(o),cr.do_cmp(t,r,n)?s++:d.else_instances.push(l);return cr.truncateArray(p,s),d.select_all=!1,cr.shallowAssignArray(d.instances,p),cr.clearArray(p),_--,e.applySolToContainer(),!!d.instances.length}},e.prototype.PickByEvaluate=function(e,t){var r,n,o,a;if(e){_++,m.length===_&&m.push([]);var s=m[_],l=e.getCurrentSol();cr.shallowAssignArray(s,l.getObjects()),l.select_all&&cr.clearArray(l.else_instances);var p=this.runtime.getCurrentCondition();for(r=0,o=0,n=s.length;r<n;r++)a=s[r],s[o]=a,t=p.parameters[1].get(r),t?o++:l.else_instances.push(a);return cr.truncateArray(s,o),l.select_all=!1,cr.shallowAssignArray(l.instances,s),cr.clearArray(s),_--,e.applySolToContainer(),!!l.instances.length}},e.prototype.TriggerOnce=function(){var e=this.runtime.getCurrentCondition().extra;"undefined"==typeof e.TriggerOnce_lastTick&&(e.TriggerOnce_lastTick=-1);var t=e.TriggerOnce_lastTick,r=this.runtime.tickcount;return e.TriggerOnce_lastTick=r,this.runtime.layout_first_tick||t!==r-1},e.prototype.Every=function(e){var t=this.runtime.getCurrentCondition(),r=t.extra.Every_lastTime||0,n=this.runtime.kahanTime.sum;"undefined"==typeof t.extra.Every_seconds&&(t.extra.Every_seconds=e);var o=t.extra.Every_seconds;return n>=r+o?(t.extra.Every_lastTime=r+o,n>=t.extra.Every_lastTime+.04&&(t.extra.Every_lastTime=n),t.extra.Every_seconds=e,!0):(n<r-.1&&(t.extra.Every_lastTime=n),!1)},e.prototype.PickNth=function(e,t){if(!e)return!1;var r=e.getCurrentSol(),n=r.getObjects();if(t=cr.floor(t),0>t||t>=n.length)return!1;var o=n[t];return r.pick_one(o),e.applySolToContainer(),!0},e.prototype.PickRandom=function(e){if(!e)return!1;var t=e.getCurrentSol(),r=t.getObjects(),n=cr.floor(Math.random()*r.length);if(n>=r.length)return!1;var o=r[n];return t.pick_one(o),e.applySolToContainer(),!0},e.prototype.CompareVar=function(e,t,r){return cr.do_cmp(e.getValue(),t,r)},e.prototype.IsGroupActive=function(e){var t=this.runtime.groups_by_name[e.toLowerCase()];return t&&t.group_active},e.prototype.IsPreview=function(){return"undefined"!=typeof cr_is_preview},e.prototype.PickAll=function(e){if(!e)return!1;if(!e.instances.length)return!1;var t=e.getCurrentSol();return t.select_all=!0,e.applySolToContainer(),!0},e.prototype.IsMobile=function(){return this.runtime.isMobile},e.prototype.CompareBetween=function(e,t,r){return e>=t&&e<=r},e.prototype.Else=function(){var e=this.runtime.getCurrentEventStack();return!e.else_branch_ran&&!e.last_event_true},e.prototype.OnLoadFinished=function(){return!0},e.prototype.OnCanvasSnapshot=function(){return!0},e.prototype.EffectsSupported=function(){return!!this.runtime.glwrap},e.prototype.OnSaveComplete=function(){return!0},e.prototype.OnSaveFailed=function(){return!0},e.prototype.OnLoadComplete=function(){return!0},e.prototype.OnLoadFailed=function(){return!0},e.prototype.ObjectUIDExists=function(e){return!!this.runtime.getObjectByUID(e)},e.prototype.IsOnPlatform=function(e){var t=this.runtime;return 0===e?!t.isDomFree&&!t.isNodeWebkit&&!t.isCordova&&!t.isWinJS&&!t.isWindowsPhone8&&!t.isBlackberry10&&!t.isAmazonWebApp:1===e?t.isiOS:2===e?t.isAndroid:3===e?t.isWindows8App:4===e?t.isWindowsPhone8:5===e?t.isBlackberry10:6===e?t.isTizen:7===e?t.isCocoonJs:8===e?t.isCordova:9===e?t.isArcade:10===e?t.isNodeWebkit:11===e?t.isCrosswalk:12===e?t.isAmazonWebApp:!(13!=e)&&t.isWindows10};var h=null,f="",b="";e.prototype.RegexTest=function(e,t,n){var o=r(t,n);return o.test(e)};var x=[];e.prototype.PickOverlappingPoint=function(e,t,r){if(!e)return!1;var n=e.getCurrentSol(),o=n.getObjects(),a=this.runtime.getCurrentEventStack().current_event,s=a.orblock,l=this.runtime.getCurrentCondition(),p,d,c,u;for(n.select_all?(cr.shallowAssignArray(x,o),cr.clearArray(n.else_instances),n.select_all=!1,cr.clearArray(n.instances)):s?(cr.shallowAssignArray(x,n.else_instances),cr.clearArray(n.else_instances)):(cr.shallowAssignArray(x,o),cr.clearArray(n.instances)),p=0,d=x.length;p<d;++p)c=x[p],c.update_bbox(),u=cr.xor(c.contains_pt(t,r),l.inverted),u?n.instances.push(c):n.else_instances.push(c);return e.applySolToContainer(),cr.xor(!!n.instances.length,l.inverted)},e.prototype.IsNaN=function(e){return!!isNaN(e)},e.prototype.AngleWithin=function(e,t,r){return cr.angleDiff(cr.to_radians(e),cr.to_radians(r))<=cr.to_radians(t)},e.prototype.IsClockwiseFrom=function(e,t){return cr.angleClockwise(cr.to_radians(e),cr.to_radians(t))},e.prototype.IsBetweenAngles=function(e,t,r){var n=cr.to_clamped_radians(e),o=cr.to_clamped_radians(t),a=cr.to_clamped_radians(r),i=!cr.angleClockwise(a,o);return i?cr.angleClockwise(n,o)||!cr.angleClockwise(n,a):cr.angleClockwise(n,o)&&!cr.angleClockwise(n,a)},e.prototype.IsValueType=function(e,r){return"number"==typeof e?0===r:1===r},y.cnds=new e;n.prototype.GoToLayout=function(e){this.runtime.isloading||this.runtime.changelayout||(this.runtime.changelayout=e)},n.prototype.NextPrevLayout=function(e){if(!this.runtime.isloading&&!this.runtime.changelayout){var t=this.runtime.layouts_by_index.indexOf(this.runtime.running_layout);if(!(e&&0===t)&&(e||t!==this.runtime.layouts_by_index.length-1)){var r=this.runtime.layouts_by_index[t+(e?-1:1)];this.runtime.changelayout=r}}},n.prototype.CreateObject=function(e,t,r,n){if(t&&e){var o=this.runtime.createInstance(e,t,r,n);if(o){this.runtime.isInOnDestroy++;var a,l,p;if(this.runtime.trigger(Object.getPrototypeOf(e.plugin).cnds.OnCreated,o),o.is_contained)for(a=0,l=o.siblings.length;a<l;a++)p=o.siblings[a],this.runtime.trigger(Object.getPrototypeOf(p.type.plugin).cnds.OnCreated,p);this.runtime.isInOnDestroy--;var d=e.getCurrentSol();if(d.select_all=!1,cr.clearArray(d.instances),d.instances[0]=o,o.is_contained)for(a=0,l=o.siblings.length;a<l;a++)p=o.siblings[a],d=p.type.getCurrentSol(),d.select_all=!1,cr.clearArray(d.instances),d.instances[0]=p}}},n.prototype.SetLayerVisible=function(e,t){e&&(e.visible===t||(e.visible=t,this.runtime.redraw=!0))},n.prototype.SetLayerOpacity=function(e,t){e&&(t=cr.clamp(t/100,0,1),e.opacity!==t&&(e.opacity=t,this.runtime.redraw=!0))},n.prototype.SetLayerScaleRate=function(e,t){e&&(e.zoomRate===t||(e.zoomRate=t,this.runtime.redraw=!0))},n.prototype.SetLayerForceOwnTexture=function(e,t){e&&(t=!!t,e.forceOwnTexture!==t&&(e.forceOwnTexture=t,this.runtime.redraw=!0))},n.prototype.SetLayoutScale=function(e){this.runtime.running_layout&&(this.runtime.running_layout.scale===e||(this.runtime.running_layout.scale=e,this.runtime.running_layout.boundScrolling(),this.runtime.redraw=!0))},n.prototype.ScrollX=function(e){this.runtime.running_layout.scrollToX(e)},n.prototype.ScrollY=function(e){this.runtime.running_layout.scrollToY(e)},n.prototype.Scroll=function(e,t){this.runtime.running_layout.scrollToX(e),this.runtime.running_layout.scrollToY(t)},n.prototype.ScrollToObject=function(e){var t=e.getFirstPicked();t&&(this.runtime.running_layout.scrollToX(t.x),this.runtime.running_layout.scrollToY(t.y))},n.prototype.SetVar=function(e,t){0===e.vartype?cr.is_number(t)?e.setValue(t):e.setValue(parseFloat(t)):1===e.vartype&&e.setValue(t.toString())},n.prototype.AddVar=function(e,t){0===e.vartype?cr.is_number(t)?e.setValue(e.getValue()+t):e.setValue(e.getValue()+parseFloat(t)):1===e.vartype&&e.setValue(e.getValue()+t.toString())},n.prototype.SubVar=function(e,t){0===e.vartype&&(cr.is_number(t)?e.setValue(e.getValue()-t):e.setValue(e.getValue()-parseFloat(t)))},n.prototype.SetGroupActive=function(e,t){var r=this.runtime.groups_by_name[e.toLowerCase()];r&&(0===t?r.setGroupActive(!1):1===t?r.setGroupActive(!0):2===t?r.setGroupActive(!r.group_active):void 0)},n.prototype.SetTimescale=function(e){var t=e;0>t&&(t=0),this.runtime.timescale=t},n.prototype.SetObjectTimescale=function(e,t){var r=t;if(0>r&&(r=0),!!e){var n=e.getCurrentSol(),o=n.getObjects(),a,s;for(a=0,s=o.length;a<s;a++)o[a].my_timescale=r}},n.prototype.RestoreObjectTimescale=function(e){if(!e)return!1;var t=e.getCurrentSol(),r=t.getObjects(),n,o;for(n=0,o=r.length;n<o;n++)r[n].my_timescale=-1};var v=[];var w=[];n.prototype.Wait=function(e){if(!(0>e)){var r=this.runtime.getCurrentEventStack(),n=o(),a,p,d,c,u;for(n.time=this.runtime.kahanTime.sum+e,n.signaltag="",n.signalled=!1,n.ev=r.current_event,n.actindex=r.actindex+1,(a=0,p=this.runtime.types_by_index.length);a<p;a++)c=this.runtime.types_by_index[a],d=c.getCurrentSol(),d.select_all&&-1===r.current_event.solModifiers.indexOf(c)||(n.solModifiers.push(c),u=l(),u.sa=d.select_all,cr.shallowAssignArray(u.insts,d.instances),n.sols[a.toString()]=u);return this.waits.push(n),!0}},n.prototype.WaitForSignal=function(e){var r=this.runtime.getCurrentEventStack(),n=o(),a,p,d,c,u;for(n.time=-1,n.signaltag=e.toLowerCase(),n.signalled=!1,n.ev=r.current_event,n.actindex=r.actindex+1,(a=0,p=this.runtime.types_by_index.length);a<p;a++)c=this.runtime.types_by_index[a],d=c.getCurrentSol(),d.select_all&&-1===r.current_event.solModifiers.indexOf(c)||(n.solModifiers.push(c),u=l(),u.sa=d.select_all,cr.shallowAssignArray(u.insts,d.instances),n.sols[a.toString()]=u);return this.waits.push(n),!0},n.prototype.Signal=function(e){var t=e.toLowerCase(),r,n,o;for(r=0,n=this.waits.length;r<n;++r)o=this.waits[r],-1===o.time&&o.signaltag===t&&(o.signalled=!0)},n.prototype.SetLayerScale=function(e,t){e&&e.scale!==t&&(e.scale=t,this.runtime.redraw=!0)},n.prototype.ResetGlobals=function(){var e,t,r;for(e=0,t=this.runtime.all_global_vars.length;e<t;e++)r=this.runtime.all_global_vars[e],r.data=r.initial},n.prototype.SetLayoutAngle=function(e){e=cr.to_radians(e),e=cr.clamp_angle(e),this.runtime.running_layout&&this.runtime.running_layout.angle!==e&&(this.runtime.running_layout.angle=e,this.runtime.redraw=!0)},n.prototype.SetLayerAngle=function(e,t){e&&(t=cr.to_radians(t),t=cr.clamp_angle(t),e.angle===t||(e.angle=t,this.runtime.redraw=!0))},n.prototype.SetLayerParallax=function(e,t,r){if(e&&(e.parallaxX!==t/100||e.parallaxY!==r/100)){if(e.parallaxX=t/100,e.parallaxY=r/100,1!==e.parallaxX||1!==e.parallaxY){var n=e.instances,o,a;for(o=0,a=n.length;o<a;++o)n[o].type.any_instance_parallaxed=!0}this.runtime.redraw=!0}},n.prototype.SetLayerBackground=function(e,t){if(e){var n=cr.GetRValue(t),r=cr.GetGValue(t),o=cr.GetBValue(t);e.background_color[0]===n&&e.background_color[1]===r&&e.background_color[2]===o||(e.background_color[0]=n,e.background_color[1]=r,e.background_color[2]=o,this.runtime.redraw=!0)}},n.prototype.SetLayerTransparent=function(e,r){e&&!!r!=!!e.transparent&&(e.transparent=!!r,this.runtime.redraw=!0)},n.prototype.SetLayerBlendMode=function(e,t){e&&e.blend_mode!==t&&(e.blend_mode=t,e.compositeOp=cr.effectToCompositeOp(e.blend_mode),this.runtime.gl&&cr.setGLBlend(e,e.blend_mode,this.runtime.gl),this.runtime.redraw=!0)},n.prototype.StopLoop=function(){0>this.runtime.loop_stack_index||(this.runtime.getCurrentLoop().stopped=!0)},n.prototype.GoToLayoutByName=function(e){if(!this.runtime.isloading&&!this.runtime.changelayout){for(var t in this.runtime.layouts)if(this.runtime.layouts.hasOwnProperty(t)&&cr.equals_nocase(t,e))return void(this.runtime.changelayout=this.runtime.layouts[t])}},n.prototype.RestartLayout=function(){if(!this.runtime.isloading&&!this.runtime.changelayout&&this.runtime.running_layout){this.runtime.changelayout=this.runtime.running_layout;var e,t,r;for(e=0,t=this.runtime.allGroups.length;e<t;e++)r=this.runtime.allGroups[e],r.setGroupActive(r.initially_activated)}},n.prototype.SnapshotCanvas=function(e,t){this.runtime.doCanvasSnapshot(0===e?"image/png":"image/jpeg",t/100)},n.prototype.SetCanvasSize=function(e,t){if(!(0>=e||0>=t)){var r=this.runtime.fullscreen_mode,n=document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||this.runtime.isNodeFullscreen;n&&0<this.runtime.fullscreen_scaling&&(r=this.runtime.fullscreen_scaling),0===r?this.runtime.setSize(e,t,!0):(this.runtime.original_width=e,this.runtime.original_height=t,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0))}},n.prototype.SetLayoutEffectEnabled=function(e,t){if(this.runtime.running_layout&&this.runtime.glwrap){var r=this.runtime.running_layout.getEffectByName(t);if(r){var n=1===e;r.active==n||(r.active=n,this.runtime.running_layout.updateActiveEffects(),this.runtime.redraw=!0)}}},n.prototype.SetLayerEffectEnabled=function(e,t,r){if(e&&this.runtime.glwrap){var n=e.getEffectByName(r);if(n){var o=1===t;n.active==o||(n.active=o,e.updateActiveEffects(),this.runtime.redraw=!0)}}},n.prototype.SetLayoutEffectParam=function(e,t,r){if(this.runtime.running_layout&&this.runtime.glwrap){var n=this.runtime.running_layout.getEffectByName(e);if(n){var o=this.runtime.running_layout.effect_params[n.index];(t=Math.floor(t),!(0>t||t>=o.length))&&(1===this.runtime.glwrap.getProgramParameterType(n.shaderindex,t)&&(r/=100),o[t]===r||(o[t]=r,n.active&&(this.runtime.redraw=!0)))}}},n.prototype.SetLayerEffectParam=function(e,t,r,n){if(e&&this.runtime.glwrap){var o=e.getEffectByName(t);if(o){var a=e.effect_params[o.index];(r=Math.floor(r),!(0>r||r>=a.length))&&(1===this.runtime.glwrap.getProgramParameterType(o.shaderindex,r)&&(n/=100),a[r]===n||(a[r]=n,o.active&&(this.runtime.redraw=!0)))}}},n.prototype.SaveState=function(e){this.runtime.saveToSlot=e},n.prototype.LoadState=function(e){this.runtime.loadFromSlot=e},n.prototype.LoadStateJSON=function(e){this.runtime.loadFromJson=e},n.prototype.SetHalfFramerateMode=function(e){this.runtime.halfFramerateMode=0!==e},n.prototype.SetFullscreenQuality=function(e){var t=document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||this.isNodeFullscreen;(t||0!==this.runtime.fullscreen_mode)&&(this.runtime.wantFullscreenScalingQuality=0!==e,this.runtime.setSize(this.runtime.lastWindowWidth,this.runtime.lastWindowHeight,!0))},n.prototype.ResetPersisted=function(){var e,t;for(e=0,t=this.runtime.layouts_by_index.length;e<t;++e)this.runtime.layouts_by_index[e].persist_data={},this.runtime.layouts_by_index[e].first_visit=!0},n.prototype.RecreateInitialObjects=function(e,t,r,n,o){e&&this.runtime.running_layout.recreateInitialObjects(e,t,r,n,o)},n.prototype.SetPixelRounding=function(e){this.runtime.pixel_rounding=0!==e,this.runtime.redraw=!0},n.prototype.SetMinimumFramerate=function(e){1>e&&(e=1),120<e&&(e=120),this.runtime.minimumFramerate=e};n.prototype.SortZOrderByInstVar=function(e,t){if(e){var r=e.getCurrentSol(),n=r.getObjects(),o=[],a=[],s=this.runtime.running_layout,l=e.is_family,p=e.family_index,u,g,y,m,_,h;for(u=0,g=n.length;u<g;++u)y=n[u],y.layer&&(m=l?y.instance_vars[t+y.type.family_var_map[p]]:y.instance_vars[t],o.push([y.layer.index,y.get_zindex()]),a.push([y,m]));if(o.length)for(o.sort(d),a.sort(c),(u=0,g=o.length);u<g;++u)y=a[u][0],_=s.layers[o[u][0]],h=o[u][1],_.instances[h]!==y&&(_.instances[h]=y,y.layer=_,_.setZIndicesStaleFrom(h))}},y.acts=new n;u.prototype.int=function(e,t){cr.is_string(t)?(e.set_int(parseInt(t,10)),isNaN(e.data)&&(e.data=0)):e.set_int(t)},u.prototype.float=function(e,t){cr.is_string(t)?(e.set_float(parseFloat(t)),isNaN(e.data)&&(e.data=0)):e.set_float(t)},u.prototype.str=function(e,t){cr.is_string(t)?e.set_string(t):e.set_string(t.toString())},u.prototype.len=function(e,t){e.set_int(t.length||0)},u.prototype.random=function(e,t,r){r===void 0?e.set_float(Math.random()*t):e.set_float(Math.random()*(r-t)+t)},u.prototype.sqrt=function(e,t){e.set_float(Math.sqrt(t))},u.prototype.abs=function(e,t){e.set_float(Math.abs(t))},u.prototype.round=function(e,t){e.set_int(Math.round(t))},u.prototype.floor=function(e,t){e.set_int(Math.floor(t))},u.prototype.ceil=function(e,t){e.set_int(Math.ceil(t))},u.prototype.sin=function(e,t){e.set_float(Math.sin(cr.to_radians(t)))},u.prototype.cos=function(e,t){e.set_float(Math.cos(cr.to_radians(t)))},u.prototype.tan=function(e,t){e.set_float(Math.tan(cr.to_radians(t)))},u.prototype.asin=function(e,t){e.set_float(cr.to_degrees(Math.asin(t)))},u.prototype.acos=function(e,t){e.set_float(cr.to_degrees(Math.acos(t)))},u.prototype.atan=function(e,t){e.set_float(cr.to_degrees(Math.atan(t)))},u.prototype.exp=function(e,t){e.set_float(Math.exp(t))},u.prototype.ln=function(e,t){e.set_float(Math.log(t))},u.prototype.log10=function(e,t){e.set_float(Math.log(t)/Math.LN10)},u.prototype.max=function(e){var t=arguments[1];"number"!=typeof t&&(t=0);var r,n,o;for(r=2,n=arguments.length;r<n;r++)o=arguments[r],"number"==typeof o&&t<o&&(t=o);e.set_float(t)},u.prototype.min=function(e){var t=arguments[1];"number"!=typeof t&&(t=0);var r,n,o;for(r=2,n=arguments.length;r<n;r++)o=arguments[r],"number"==typeof o&&t>o&&(t=o);e.set_float(t)},u.prototype.dt=function(e){e.set_float(this.runtime.dt)},u.prototype.timescale=function(e){e.set_float(this.runtime.timescale)},u.prototype.wallclocktime=function(e){e.set_float((Date.now()-this.runtime.start_time)/1e3)},u.prototype.time=function(e){e.set_float(this.runtime.kahanTime.sum)},u.prototype.tickcount=function(e){e.set_int(this.runtime.tickcount)},u.prototype.objectcount=function(e){e.set_int(this.runtime.objectcount)},u.prototype.fps=function(e){e.set_int(this.runtime.fps)},u.prototype.loopindex=function(e,t){var r,n;if(!this.runtime.loop_stack.length)return void e.set_int(0);if(t){for(n=this.runtime.loop_stack_index;0<=n;--n)if(r=this.runtime.loop_stack[n],r.name===t)return void e.set_int(r.index);e.set_int(0)}else r=this.runtime.getCurrentLoop(),e.set_int(r?r.index:-1)},u.prototype.distance=function(e,t,r,n,o){e.set_float(cr.distanceTo(t,r,n,o))},u.prototype.angle=function(e,t,r,n,o){e.set_float(cr.to_degrees(cr.angleTo(t,r,n,o)))},u.prototype.scrollx=function(e){e.set_float(this.runtime.running_layout.scrollX)},u.prototype.scrolly=function(e){e.set_float(this.runtime.running_layout.scrollY)},u.prototype.newline=function(e){e.set_string("\n")},u.prototype.lerp=function(e,t,r,n){e.set_float(cr.lerp(t,r,n))},u.prototype.qarp=function(e,t,r,n,o){e.set_float(cr.qarp(t,r,n,o))},u.prototype.cubic=function(e,t,r,n,o,a){e.set_float(cr.cubic(t,r,n,o,a))},u.prototype.cosp=function(e,t,r,n){e.set_float(cr.cosp(t,r,n))},u.prototype.windowwidth=function(e){e.set_int(this.runtime.width)},u.prototype.windowheight=function(e){e.set_int(this.runtime.height)},u.prototype.uppercase=function(e,t){e.set_string(cr.is_string(t)?t.toUpperCase():"")},u.prototype.lowercase=function(e,t){e.set_string(cr.is_string(t)?t.toLowerCase():"")},u.prototype.clamp=function(e,t,r,n){t<r?e.set_float(r):t>n?e.set_float(n):e.set_float(t)},u.prototype.layerscale=function(e,t){var r=this.runtime.getLayer(t);r?e.set_float(r.scale):e.set_float(0)},u.prototype.layeropacity=function(e,t){var r=this.runtime.getLayer(t);r?e.set_float(100*r.opacity):e.set_float(0)},u.prototype.layerscalerate=function(e,t){var r=this.runtime.getLayer(t);r?e.set_float(r.zoomRate):e.set_float(0)},u.prototype.layerparallaxx=function(e,t){var r=this.runtime.getLayer(t);r?e.set_float(100*r.parallaxX):e.set_float(0)},u.prototype.layerparallaxy=function(e,t){var r=this.runtime.getLayer(t);r?e.set_float(100*r.parallaxY):e.set_float(0)},u.prototype.layerindex=function(e,t){var r=this.runtime.getLayer(t);r?e.set_int(r.index):e.set_int(-1)},u.prototype.layoutscale=function(e){this.runtime.running_layout?e.set_float(this.runtime.running_layout.scale):e.set_float(0)},u.prototype.layoutangle=function(e){e.set_float(cr.to_degrees(this.runtime.running_layout.angle))},u.prototype.layerangle=function(e,t){var r=this.runtime.getLayer(t);r?e.set_float(cr.to_degrees(r.angle)):e.set_float(0)},u.prototype.layoutwidth=function(e){e.set_int(this.runtime.running_layout.width)},u.prototype.layoutheight=function(e){e.set_int(this.runtime.running_layout.height)},u.prototype.find=function(e,t,r){cr.is_string(t)&&cr.is_string(r)?e.set_int(t.search(new RegExp(cr.regexp_escape(r),"i"))):e.set_int(-1)},u.prototype.findcase=function(e,t,r){cr.is_string(t)&&cr.is_string(r)?e.set_int(t.search(new RegExp(cr.regexp_escape(r),""))):e.set_int(-1)},u.prototype.left=function(e,t,r){e.set_string(cr.is_string(t)?t.substr(0,r):"")},u.prototype.right=function(e,t,r){e.set_string(cr.is_string(t)?t.substr(t.length-r):"")},u.prototype.mid=function(e,t,r,n){e.set_string(cr.is_string(t)?t.substr(r,n):"")},u.prototype.tokenat=function(e,t,r,n){if(cr.is_string(t)&&cr.is_string(n)){var o=t.split(n),a=cr.floor(r);0>a||a>=o.length?e.set_string(""):e.set_string(o[a])}else e.set_string("")},u.prototype.tokencount=function(e,t,r){cr.is_string(t)&&t.length?e.set_int(t.split(r).length):e.set_int(0)},u.prototype.replace=function(e,t,r,n){cr.is_string(t)&&cr.is_string(r)&&cr.is_string(n)?e.set_string(t.replace(new RegExp(cr.regexp_escape(r),"gi"),n)):e.set_string(cr.is_string(t)?t:"")},u.prototype.trim=function(e,t){e.set_string(cr.is_string(t)?t.trim():"")},u.prototype.pi=function(e){e.set_float(cr.PI)},u.prototype.layoutname=function(e){this.runtime.running_layout?e.set_string(this.runtime.running_layout.name):e.set_string("")},u.prototype.renderer=function(e){e.set_string(this.runtime.gl?"webgl":"canvas2d")},u.prototype.rendererdetail=function(e){e.set_string(this.runtime.glUnmaskedRenderer)},u.prototype.anglediff=function(e,t,r){e.set_float(cr.to_degrees(cr.angleDiff(cr.to_radians(t),cr.to_radians(r))))},u.prototype.choose=function(e){var t=cr.floor(Math.random()*(arguments.length-1));e.set_any(arguments[t+1])},u.prototype.rgb=function(e,t,r,n){e.set_int(cr.RGB(t,r,n))},u.prototype.projectversion=function(e){e.set_string(this.runtime.versionstr)},u.prototype.projectname=function(e){e.set_string(this.runtime.projectName)},u.prototype.anglelerp=function(e,t,r,n){t=cr.to_radians(t),r=cr.to_radians(r);var o=cr.angleDiff(t,r);cr.angleClockwise(r,t)?e.set_float(cr.to_clamped_degrees(t+o*n)):e.set_float(cr.to_clamped_degrees(t-o*n))},u.prototype.anglerotate=function(e,t,r,n){t=cr.to_radians(t),r=cr.to_radians(r),n=cr.to_radians(n),e.set_float(cr.to_clamped_degrees(cr.angleRotate(t,r,n)))},u.prototype.zeropad=function(e,t,r){var o=0>t?"-":"";0>t&&(t=-t);for(var a=r-t.toString().length,l=0;l<a;l++)o+="0";e.set_string(o+t.toString())},u.prototype.cpuutilisation=function(e){e.set_float(this.runtime.cpuutilisation/1e3)},u.prototype.viewportleft=function(e,t){var r=this.runtime.getLayer(t);e.set_float(r?r.viewLeft:0)},u.prototype.viewporttop=function(e,t){var r=this.runtime.getLayer(t);e.set_float(r?r.viewTop:0)},u.prototype.viewportright=function(e,t){var r=this.runtime.getLayer(t);e.set_float(r?r.viewRight:0)},u.prototype.viewportbottom=function(e,t){var r=this.runtime.getLayer(t);e.set_float(r?r.viewBottom:0)},u.prototype.loadingprogress=function(e){e.set_float(this.runtime.loadingprogress)},u.prototype.unlerp=function(e,t,r,n){e.set_float(cr.unlerp(t,r,n))},u.prototype.canvassnapshot=function(e){e.set_string(this.runtime.snapshotData)},u.prototype.urlencode=function(e,t){e.set_string(encodeURIComponent(t))},u.prototype.urldecode=function(e,t){e.set_string(decodeURIComponent(t))},u.prototype.canvastolayerx=function(e,t,r,n){var o=this.runtime.getLayer(t);e.set_float(o?o.canvasToLayer(r,n,!0):0)},u.prototype.canvastolayery=function(e,t,r,n){var o=this.runtime.getLayer(t);e.set_float(o?o.canvasToLayer(r,n,!1):0)},u.prototype.layertocanvasx=function(e,t,r,n){var o=this.runtime.getLayer(t);e.set_float(o?o.layerToCanvas(r,n,!0):0)},u.prototype.layertocanvasy=function(e,t,r,n){var o=this.runtime.getLayer(t);e.set_float(o?o.layerToCanvas(r,n,!1):0)},u.prototype.savestatejson=function(e){e.set_string(this.runtime.lastSaveJson)},u.prototype.imagememoryusage=function(e){this.runtime.glwrap?e.set_float(Math.round(100*this.runtime.glwrap.estimateVRAM()/1048576)/100):e.set_float(0)},u.prototype.regexsearch=function(e,t,n,o){var a=r(n,o);e.set_int(t?t.search(a):-1)},u.prototype.regexreplace=function(e,t,n,o,a){var i=r(n,o);e.set_string(t?t.replace(i,a):"")};var S=[],T="",C="",O="";u.prototype.regexmatchcount=function(e,t,n,o){r(n,o);g(t.toString(),n,o),e.set_int(S?S.length:0)},u.prototype.regexmatchat=function(e,t,n,o,a){a=Math.floor(a);r(n,o);g(t.toString(),n,o),!S||0>a||a>=S.length?e.set_string(""):e.set_string(S[a])},u.prototype.infinity=function(e){e.set_float(1/0)},u.prototype.setbit=function(e,t,r,o){t|=0,r|=0,o=0===o?0:1,e.set_int(t&~(1<<r)|o<<r)},u.prototype.togglebit=function(e,t,r){t|=0,r|=0,e.set_int(t^1<<r)},u.prototype.getbit=function(e,t,r){t|=0,r|=0,e.set_int(t&1<<r?1:0)},u.prototype.originalwindowwidth=function(e){e.set_int(this.runtime.original_width)},u.prototype.originalwindowheight=function(e){e.set_int(this.runtime.original_height)},y.exps=new u,y.runWaits=function(){var e=this.runtime.getCurrentEventStack(),t,r,n,o,l,d,c;for(t=0,n=this.waits.length;t<n;t++){if(o=this.waits[t],-1===o.time){if(!o.signalled)continue;}else if(o.time>this.runtime.kahanTime.sum)continue;for(l in e.current_event=o.ev,e.actindex=o.actindex,e.cndindex=0,o.sols)o.sols.hasOwnProperty(l)&&(d=this.runtime.types_by_index[parseInt(l,10)].getCurrentSol(),c=o.sols[l],d.select_all=c.sa,cr.shallowAssignArray(d.instances,c.insts),p(c));o.ev.resume_actions_and_subevents(),this.runtime.clearSol(o.solModifiers),o.deleteme=!0}for(t=0,r=0,n=this.waits.length;t<n;t++)o=this.waits[t],this.waits[r]=o,o.deleteme?a(o):r++;cr.truncateArray(this.waits,r)}}();(function(){cr.add_common_aces=function(e,t){var r=e[1],n=e[3],o=e[4],a=e[5],i=e[6],s=e[7],l=e[8];t.cnds||(t.cnds={}),t.acts||(t.acts={}),t.exps||(t.exps={});var p=t.cnds,d=t.acts,c=t.exps;n&&(p.CompareX=function(e,t){return cr.do_cmp(this.x,e,t)},p.CompareY=function(e,t){return cr.do_cmp(this.y,e,t)},p.IsOnScreen=function(){var e=this.layer;this.update_bbox();var t=this.bbox;return!(t.right<e.viewLeft||t.bottom<e.viewTop||t.left>e.viewRight||t.top>e.viewBottom)},p.IsOutsideLayout=function(){this.update_bbox();var e=this.bbox,t=this.runtime.running_layout;return 0>e.right||0>e.bottom||e.left>t.width||e.top>t.height},p.PickDistance=function(e,t,r){var n=this.getCurrentSol(),o=n.getObjects();if(!o.length)return!1;var a=o[0],s=a,l=cr.distanceTo(a.x,a.y,t,r),p,c,u;for(p=1,c=o.length;p<c;p++)a=o[p],u=cr.distanceTo(a.x,a.y,t,r),(0===e&&u<l||1===e&&u>l)&&(l=u,s=a);return n.pick_one(s),!0},d.SetX=function(e){this.x!==e&&(this.x=e,this.set_bbox_changed())},d.SetY=function(e){this.y!==e&&(this.y=e,this.set_bbox_changed())},d.SetPos=function(e,t){(this.x!==e||this.y!==t)&&(this.x=e,this.y=t,this.set_bbox_changed())},d.SetPosToObject=function(e,t){var r=e.getPairedInstance(this);if(r){var n,o;r.getImagePoint?(n=r.getImagePoint(t,!0),o=r.getImagePoint(t,!1)):(n=r.x,o=r.y),(this.x!==n||this.y!==o)&&(this.x=n,this.y=o,this.set_bbox_changed())}},d.MoveForward=function(e){0!==e&&(this.x+=Math.cos(this.angle)*e,this.y+=Math.sin(this.angle)*e,this.set_bbox_changed())},d.MoveAtAngle=function(e,t){0!==t&&(this.x+=Math.cos(cr.to_radians(e))*t,this.y+=Math.sin(cr.to_radians(e))*t,this.set_bbox_changed())},c.X=function(e){e.set_float(this.x)},c.Y=function(e){e.set_float(this.y)},c.dt=function(e){e.set_float(this.runtime.getDt(this))}),o&&(p.CompareWidth=function(e,t){return cr.do_cmp(this.width,e,t)},p.CompareHeight=function(e,t){return cr.do_cmp(this.height,e,t)},d.SetWidth=function(e){this.width!==e&&(this.width=e,this.set_bbox_changed())},d.SetHeight=function(e){this.height!==e&&(this.height=e,this.set_bbox_changed())},d.SetSize=function(e,t){(this.width!==e||this.height!==t)&&(this.width=e,this.height=t,this.set_bbox_changed())},c.Width=function(e){e.set_float(this.width)},c.Height=function(e){e.set_float(this.height)},c.BBoxLeft=function(e){this.update_bbox(),e.set_float(this.bbox.left)},c.BBoxTop=function(e){this.update_bbox(),e.set_float(this.bbox.top)},c.BBoxRight=function(e){this.update_bbox(),e.set_float(this.bbox.right)},c.BBoxBottom=function(e){this.update_bbox(),e.set_float(this.bbox.bottom)}),a&&(p.AngleWithin=function(e,t){return cr.angleDiff(this.angle,cr.to_radians(t))<=cr.to_radians(e)},p.IsClockwiseFrom=function(e){return cr.angleClockwise(this.angle,cr.to_radians(e))},p.IsBetweenAngles=function(e,t){var r=cr.to_clamped_radians(e),n=cr.to_clamped_radians(t),o=cr.clamp_angle(this.angle),a=!cr.angleClockwise(n,r);return a?cr.angleClockwise(o,r)||!cr.angleClockwise(o,n):cr.angleClockwise(o,r)&&!cr.angleClockwise(o,n)},d.SetAngle=function(e){var t=cr.to_radians(cr.clamp_angle_degrees(e));isNaN(t)||this.angle!==t&&(this.angle=t,this.set_bbox_changed())},d.RotateClockwise=function(e){0===e||isNaN(e)||(this.angle+=cr.to_radians(e),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},d.RotateCounterclockwise=function(e){0===e||isNaN(e)||(this.angle-=cr.to_radians(e),this.angle=cr.clamp_angle(this.angle),this.set_bbox_changed())},d.RotateTowardAngle=function(e,t){var r=cr.angleRotate(this.angle,cr.to_radians(t),cr.to_radians(e));isNaN(r)||this.angle!==r&&(this.angle=r,this.set_bbox_changed())},d.RotateTowardPosition=function(e,t,r){var n=t-this.x,o=r-this.y,a=Math.atan2(o,n),i=cr.angleRotate(this.angle,a,cr.to_radians(e));isNaN(i)||this.angle!==i&&(this.angle=i,this.set_bbox_changed())},d.SetTowardPosition=function(e,t){var r=e-this.x,n=t-this.y,o=Math.atan2(n,r);isNaN(o)||this.angle!==o&&(this.angle=o,this.set_bbox_changed())},c.Angle=function(e){e.set_float(cr.to_clamped_degrees(this.angle))}),r||(p.CompareInstanceVar=function(e,t,r){return cr.do_cmp(this.instance_vars[e],t,r)},p.IsBoolInstanceVarSet=function(e){return this.instance_vars[e]},p.PickInstVarHiLow=function(e,t){var r=this.getCurrentSol(),n=r.getObjects();if(!n.length)return!1;var o=n[0],a=o,s=o.instance_vars[t],l,p,d;for(l=1,p=n.length;l<p;l++)o=n[l],d=o.instance_vars[t],(0===e&&d<s||1===e&&d>s)&&(s=d,a=o);return r.pick_one(a),!0},p.PickByUID=function(e){var t=this.runtime.getCurrentCondition(),r,n,o,a,s,l,p;if(t.inverted){if(p=this.getCurrentSol(),p.select_all){for(p.select_all=!1,cr.clearArray(p.instances),cr.clearArray(p.else_instances),l=this.instances,(r=0,n=l.length);r<n;r++)a=l[r],a.uid===e?p.else_instances.push(a):p.instances.push(a);return this.applySolToContainer(),!!p.instances.length}for(r=0,o=0,n=p.instances.length;r<n;r++)a=p.instances[r],p.instances[o]=a,a.uid===e?p.else_instances.push(a):o++;return cr.truncateArray(p.instances,o),this.applySolToContainer(),!!p.instances.length}if(a=this.runtime.getObjectByUID(e),!a)return!1;if(p=this.getCurrentSol(),!p.select_all&&-1===p.instances.indexOf(a))return!1;if(this.is_family){for(s=a.type.families,r=0,n=s.length;r<n;r++)if(s[r]===this)return p.pick_one(a),this.applySolToContainer(),!0;}else if(a.type===this)return p.pick_one(a),this.applySolToContainer(),!0;return!1},p.OnCreated=function(){return!0},p.OnDestroyed=function(){return!0},d.SetInstanceVar=function(e,t){var r=this.instance_vars;if(cr.is_number(r[e]))r[e]=cr.is_number(t)?t:parseFloat(t);else if(cr.is_string(r[e]))r[e]=cr.is_string(t)?t:t.toString();else;},d.AddInstanceVar=function(e,t){var r=this.instance_vars;if(cr.is_number(r[e]))r[e]+=cr.is_number(t)?t:parseFloat(t);else if(cr.is_string(r[e]))r[e]+=cr.is_string(t)?t:t.toString();else;},d.SubInstanceVar=function(e,t){var r=this.instance_vars;if(cr.is_number(r[e]))r[e]-=cr.is_number(t)?t:parseFloat(t);else;},d.SetBoolInstanceVar=function(e,t){this.instance_vars[e]=t?1:0},d.ToggleBoolInstanceVar=function(e){this.instance_vars[e]=1-this.instance_vars[e]},d.Destroy=function(){this.runtime.DestroyInstance(this)},!d.LoadFromJsonString&&(d.LoadFromJsonString=function(e){var t,r,n,a;try{t=JSON.parse(e)}catch(t){return}if(this.runtime.loadInstanceFromJSON(this,t,!0),this.afterLoad&&this.afterLoad(),this.behavior_insts)for(r=0,n=this.behavior_insts.length;r<n;++r)a=this.behavior_insts[r],a.afterLoad&&a.afterLoad()}),c.Count=function(e){var t=e.object_class.instances.length,r,n,o;for(r=0,n=this.runtime.createRow.length;r<n;r++)o=this.runtime.createRow[r],e.object_class.is_family?0<=o.type.families.indexOf(e.object_class)&&t++:o.type===e.object_class&&t++;e.set_int(t)},c.PickedCount=function(e){e.set_int(e.object_class.getCurrentSol().getObjects().length)},c.UID=function(e){e.set_int(this.uid)},c.IID=function(e){e.set_int(this.get_iid())},!c.AsJSON&&(c.AsJSON=function(e){e.set_string(JSON.stringify(this.runtime.saveInstanceToJSON(this,!0)))})),i&&(p.IsVisible=function(){return this.visible},d.SetVisible=function(e){!e!=!this.visible&&(this.visible=!!e,this.runtime.redraw=!0)},p.CompareOpacity=function(e,t){return cr.do_cmp(cr.round6dp(100*this.opacity),e,t)},d.SetOpacity=function(e){var t=e/100;0>t?t=0:1<t&&(t=1),t!==this.opacity&&(this.opacity=t,this.runtime.redraw=!0)},c.Opacity=function(e){e.set_float(cr.round6dp(100*this.opacity))}),s&&(p.IsOnLayer=function(e){return!!e&&this.layer===e},p.PickTopBottom=function(e){var t=this.getCurrentSol(),r=t.getObjects();if(!r.length)return!1;var n=r[0],o=n,a,s;for(a=1,s=r.length;a<s;a++)n=r[a],0===e?(n.layer.index>o.layer.index||n.layer.index===o.layer.index&&n.get_zindex()>o.get_zindex())&&(o=n):(n.layer.index<o.layer.index||n.layer.index===o.layer.index&&n.get_zindex()<o.get_zindex())&&(o=n);return t.pick_one(o),!0},d.MoveToTop=function(){var e=this.layer,t=e.instances;t.length&&t[t.length-1]===this||(e.removeFromInstanceList(this,!1),e.appendToInstanceList(this,!1),this.runtime.redraw=!0)},d.MoveToBottom=function(){var e=this.layer,t=e.instances;t.length&&t[0]===this||(e.removeFromInstanceList(this,!1),e.prependToInstanceList(this,!1),this.runtime.redraw=!0)},d.MoveToLayer=function(e){e&&e!=this.layer&&(this.layer.removeFromInstanceList(this,!0),this.layer=e,e.appendToInstanceList(this,!0),this.runtime.redraw=!0)},d.ZMoveToObject=function(e,t){if(t){var r=t.getFirstPicked(this);r&&r.uid!==this.uid&&(this.layer.index!==r.layer.index&&(this.layer.removeFromInstanceList(this,!0),this.layer=r.layer,r.layer.appendToInstanceList(this,!0)),this.layer.moveInstanceAdjacent(this,r,0===e),this.runtime.redraw=!0)}},c.LayerNumber=function(e){e.set_int(this.layer.number)},c.LayerName=function(e){e.set_string(this.layer.name)},c.ZIndex=function(e){e.set_int(this.get_zindex())}),l&&(d.SetEffectEnabled=function(e,t){if(this.runtime.glwrap){var r=this.type.getEffectIndexByName(t);if(!(0>r)){var n=1===e;this.active_effect_flags[r]===n||(this.active_effect_flags[r]=n,this.updateActiveEffects(),this.runtime.redraw=!0)}}},d.SetEffectParam=function(e,t,r){if(this.runtime.glwrap){var n=this.type.getEffectIndexByName(e);if(!(0>n)){var o=this.type.effect_types[n],a=this.effect_params[n];(t=Math.floor(t),!(0>t||t>=a.length))&&(1===this.runtime.glwrap.getProgramParameterType(o.shaderindex,t)&&(r/=100),a[t]===r||(a[t]=r,o.active&&(this.runtime.redraw=!0)))}}})},cr.set_bbox_changed=function(){this.bbox_changed=!0,this.cell_changed=!0,this.type.any_cell_changed=!0,this.runtime.redraw=!0;var e=this.bbox_changed_callbacks,t,r;for(t=0,r=e.length;t<r;++t)e[t](this);this.layer.useRenderCells&&this.update_bbox()},cr.add_bbox_changed_callback=function(e){e&&this.bbox_changed_callbacks.push(e)},cr.update_bbox=function(){if(this.bbox_changed){var e=this.bbox,t=this.bquad;e.set(this.x,this.y,this.x+this.width,this.y+this.height),e.offset(-this.hotspotX*this.width,-this.hotspotY*this.height),this.angle?(e.offset(-this.x,-this.y),t.set_from_rotated_rect(e,this.angle),t.offset(this.x,this.y),t.bounding_box(e)):t.set_from_rect(e),e.normalize(),this.bbox_changed=!1,this.update_render_cell()}};var e=new cr.rect(0,0,0,0);cr.update_render_cell=function(){if(this.layer.useRenderCells){var t=this.layer.render_grid,r=this.bbox;e.set(t.XToCell(r.left),t.YToCell(r.top),t.XToCell(r.right),t.YToCell(r.bottom)),this.rendercells.equals(e)||(this.rendercells.right<this.rendercells.left?t.update(this,null,e):t.update(this,this.rendercells,e),this.rendercells.copy(e),this.layer.render_list_stale=!0)}},cr.update_collision_cell=function(){if(this.cell_changed&&this.collisionsEnabled){this.update_bbox();var t=this.type.collision_grid,r=this.bbox;e.set(t.XToCell(r.left),t.YToCell(r.top),t.XToCell(r.right),t.YToCell(r.bottom)),this.collcells.equals(e)||(this.collcells.right<this.collcells.left?t.update(this,null,e):t.update(this,this.collcells,e),this.collcells.copy(e),this.cell_changed=!1)}},cr.inst_contains_pt=function(e,t){return!!this.bbox.contains_pt(e,t)&&!!this.bquad.contains_pt(e,t)&&(this.tilemap_exists?this.testPointOverlapTile(e,t):!this.collision_poly||this.collision_poly.is_empty()||(this.collision_poly.cache_poly(this.width,this.height,this.angle),this.collision_poly.contains_pt(e-this.x,t-this.y)))},cr.inst_get_iid=function(){return this.type.updateIIDs(),this.iid},cr.inst_get_zindex=function(){return this.layer.updateZIndices(),this.zindex},cr.inst_updateActiveEffects=function(){cr.clearArray(this.active_effect_types);var e=!0,t,r,n;for(t=0,r=this.active_effect_flags.length;t<r;t++)this.active_effect_flags[t]&&(n=this.type.effect_types[t],this.active_effect_types.push(n),n.preservesOpaqueness||(e=!1));this.uses_shaders=!!this.active_effect_types.length,this.shaders_preserve_opaqueness=e},cr.inst_toString=function(){return"Inst"+this.puid},cr.type_getFirstPicked=function(e){if(e&&e.is_contained&&e.type!=this){var t,r,n;for(t=0,r=e.siblings.length;t<r;t++)if(n=e.siblings[t],n.type==this)return n}var o=this.getCurrentSol().getObjects();return o.length?o[0]:null},cr.type_getPairedInstance=function(e){var t=this.getCurrentSol().getObjects();return t.length?t[e.get_iid()%t.length]:null},cr.type_updateIIDs=function(){if(this.stale_iids&&!this.is_family){var e,t;for(e=0,t=this.instances.length;e<t;e++)this.instances[e].iid=e;var r=e,n=this.runtime.createRow;for(e=0,t=n.length;e<t;++e)n[e].type===this&&(n[e].iid=r++);this.stale_iids=!1}},cr.type_getInstanceByIID=function(e){if(e<this.instances.length)return this.instances[e];e-=this.instances.length;var t=this.runtime.createRow,r,n;for(r=0,n=t.length;r<n;++r)if(t[r].type===this){if(0===e)return t[r];--e}return null},cr.type_getCurrentSol=function(){return this.solstack[this.cur_sol]},cr.type_pushCleanSol=function(){this.cur_sol++,this.cur_sol===this.solstack.length?this.solstack.push(new cr.selection(this)):(this.solstack[this.cur_sol].select_all=!0,cr.clearArray(this.solstack[this.cur_sol].else_instances))},cr.type_pushCopySol=function(){this.cur_sol++,this.cur_sol===this.solstack.length&&this.solstack.push(new cr.selection(this));var e=this.solstack[this.cur_sol],t=this.solstack[this.cur_sol-1];t.select_all?e.select_all=!0:(e.select_all=!1,cr.shallowAssignArray(e.instances,t.instances)),cr.clearArray(e.else_instances)},cr.type_popSol=function(){this.cur_sol--},cr.type_getBehaviorByName=function(e){var t=0,r,n,o,a,s;if(!this.is_family)for(r=0,n=this.families.length;r<n;r++)for(s=this.families[r],o=0,a=s.behaviors.length;o<a;o++){if(e===s.behaviors[o].name)return this.extra.lastBehIndex=t,s.behaviors[o];t++}for(r=0,n=this.behaviors.length;r<n;r++){if(e===this.behaviors[r].name)return this.extra.lastBehIndex=t,this.behaviors[r];t++}return null},cr.type_getBehaviorIndexByName=function(e){var t=this.getBehaviorByName(e);return t?this.extra.lastBehIndex:-1},cr.type_getEffectIndexByName=function(e){var t,r;for(t=0,r=this.effect_types.length;t<r;t++)if(this.effect_types[t].name===e)return t;return-1},cr.type_applySolToContainer=function(){if(this.is_contained&&!this.is_family){var e,r,n,o,a,s,l;this.updateIIDs(),s=this.getCurrentSol();var p=s.select_all,d=this.runtime.getCurrentEventStack(),c=d&&d.current_event&&d.current_event.orblock;for(e=0,r=this.container.length;e<r;e++)if(a=this.container[e],a!==this&&(a.updateIIDs(),l=a.getCurrentSol(),l.select_all=p,!p)){for(cr.clearArray(l.instances),n=0,o=s.instances.length;n<o;++n)l.instances[n]=a.getInstanceByIID(s.instances[n].iid);if(c)for(cr.clearArray(l.else_instances),n=0,o=s.else_instances.length;n<o;++n)l.else_instances[n]=a.getInstanceByIID(s.else_instances[n].iid)}}},cr.type_toString=function(){return"Type"+this.sid},cr.do_cmp=function(e,t,r){if("undefined"==typeof e||"undefined"==typeof r)return!1;switch(t){case 0:return e===r;case 1:return e!==r;case 2:return e<r;case 3:return e<=r;case 4:return e>r;case 5:return e>=r;default:;return!1;}}})(),cr.shaders={};cr.plugins_.AMG_VKbridge=function(e){this.runtime=e},function(){function Cnds(){}function Acts(){}function Exps(){}function GetLunchParamp(){vkBridge.send("VKWebAppGetLaunchParams").then(e=>{SetMethodResult("VKWebAppGetLaunchParams",e.vk_app_id),e.vk_app_id&&(sdk_lunchParams=e,Trigger(Condition().OnLunchParams))}).catch(e=>{SetMethodResult("VKWebAppGetLaunchParams",!1,e)})}function BridgeSendEval(func,param){let param_obj=eval("{"+param+"}");vkBridge.send(func,param_obj).then(e=>{SetMethodResult(func,e.result),Trigger(Condition().OnVKbridge)})}function Condition(){return cr.plugins_.AMG_VKbridge.prototype.cnds}function Trigger(e){self.runtime.trigger(e,self)}function SetMethodResult(e,t,r){sdk_event=e,sdk_result=t?1:0,sdk_error=0,r&&(console.log(`Ошибка выполнения ${e}, подробности:`),console.log(r),sdk_error=1),Trigger(Condition().OnAnyVKbridge)}var sdk_event="",sdk_result=0,sdk_error=0,sdk_storage=[{key:"key",value:"value"}],sdk_lunchParams={key:"key",value:"value"},sdk_inite=0,pluginProto=cr.plugins_.AMG_VKbridge.prototype,self;pluginProto.Type=function(e){this.plugin=e,this.runtime=e.runtime};var typeProto=pluginProto.Type.prototype;typeProto.onCreate=function(){},pluginProto.Instance=function(e){this.type=e,this.runtime=e.runtime};var instanceProto=pluginProto.Instance.prototype;instanceProto.onCreate=function(){self=this,vkBridge.send("VKWebAppInit").then(()=>{console.log("vkBridge Init"),sdk_inite=1,GetLunchParamp()}).catch(e=>{console.log(e)})},instanceProto.onDestroy=function(){},instanceProto.saveToJSON=function(){return{}},instanceProto.loadFromJSON=function(){},instanceProto.draw=function(){},instanceProto.drawGL=function(){};Cnds.prototype.OnVKbridge=function(){return!0},Cnds.prototype.OnRewardLoaded=function(){return!0},Cnds.prototype.OnInterstitialLoaded=function(){return!0},Cnds.prototype.OnRewardShown=function(){return!0},Cnds.prototype.OnInterstitialShown=function(){return!0},Cnds.prototype.OnBannerShow=function(){return!0},Cnds.prototype.OnBannerHide=function(){return!0},Cnds.prototype.OnAnyVKbridge=function(){return!0},Cnds.prototype.OnLider=function(){return!0},Cnds.prototype.OnAddToFavorite=function(){return!0},Cnds.prototype.OnMakeToHomeScreen=function(){return!0},Cnds.prototype.OnAddToHomeScreen=function(){return!0},Cnds.prototype.OnAddAddFriends=function(){return!0},Cnds.prototype.OnSaveKey=function(){return!0},Cnds.prototype.OnGetKeys=function(){return!0},Cnds.prototype.OnLunchParams=function(){return!0},Cnds.prototype.OnGetKeysErr=function(){return!0},Cnds.prototype.OnGetKeysFalse=function(){return!0},pluginProto.cnds=new Cnds;Acts.prototype.VKsend=function(e,t){BridgeSendEval(e,t)},Acts.prototype.CheckAds=function(e){let t="VKWebAppCheckNativeAds",r="";r=0===e?"reward":"interstitial",vkBridge.send("VKWebAppCheckNativeAds",{ad_format:r}).then(e=>{SetMethodResult(t,e.result),e.result?"reward"===r?Trigger(Condition().OnRewardLoaded):Trigger(Condition().OnInterstitialLoaded):console.log("\u0420\u0435\u043A\u043B\u0430\u043C\u043D\u044B\u0435 \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u044B \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u044B.")}).catch(r=>{SetMethodResult(t,!1,r)})},Acts.prototype.ShowAdsVideo=function(e){let t="VKWebAppShowNativeAds",r="";r=0===e?"reward":"interstitial",vkBridge.send("VKWebAppShowNativeAds",{ad_format:r}).then(e=>{SetMethodResult(t,e.result),e.result?"reward"===r?Trigger(Condition().OnRewardShown):Trigger(Condition().OnInterstitialShown):console.log("\u0420\u0435\u043A\u043B\u0430\u043C\u043D\u044B\u0435 \u043C\u0430\u0442\u0435\u0440\u0438\u0430\u043B\u044B \u043D\u0435 \u043D\u0430\u0439\u0434\u0435\u043D\u044B.")}).catch(r=>{SetMethodResult(t,!1,r)})},Acts.prototype.ShowBanner=function(e){let t="VKWebAppShowBannerAd",r="";r=0===e?"bottom":"top",vkBridge.send("VKWebAppShowBannerAd",{banner_location:r}).then(e=>{SetMethodResult(t,e.result),e.result&&Trigger(Condition().OnBannerShow)}).catch(r=>{SetMethodResult(t,!1,r)})},Acts.prototype.HideBanner=function(){let t="VKWebAppHideBannerAd";vkBridge.send("VKWebAppHideBannerAd").then(e=>{SetMethodResult(t,e.result),e.result&&Trigger(Condition().OnBannerHide)}).catch(r=>{SetMethodResult(t,!1,r)})},Acts.prototype.ShowLider=function(e){let t="VKWebAppShowLeaderBoardBox";vkBridge.send("VKWebAppShowLeaderBoardBox",{user_results:e}).then(e=>{SetMethodResult(t,e.result),e.result&&Trigger(Condition().OnLider)}).catch(r=>{SetMethodResult(t,!1,r)})},Acts.prototype.AddToFavorite=function(){let t="VKWebAppAddToFavorites";vkBridge.send("VKWebAppAddToFavorites").then(e=>{SetMethodResult(t,e.result),e.result&&Trigger(Condition().OnAddToFavorite)}).catch(r=>{SetMethodResult(t,!1,r)})},Acts.prototype.CheckToHomeScreen=function(){let t="VKWebAppAddToHomeScreenInfo";vkBridge.send("VKWebAppAddToHomeScreenInfo").then(e=>{SetMethodResult(t,e.is_added_to_home_screen),e.is_added_to_home_screen||Trigger(Condition().OnMakeToHomeScreen)}).catch(r=>{SetMethodResult(t,!1,r)})},Acts.prototype.AddToHomeScreen=function(){let t="VKWebAppAddToHomeScreen";vkBridge.send("VKWebAppAddToHomeScreen").then(e=>{SetMethodResult(t,e.result),e.result&&Trigger(Condition().OnAddToHomeScreen)}).catch(r=>{SetMethodResult(t,!1,r)})},Acts.prototype.AddFriends=function(e){let t="VKWebAppShowInviteBox";vkBridge.send("VKWebAppShowInviteBox",{requestKey:e}).then(e=>{SetMethodResult(t,e.success,e.notSentIds),e.success&&Trigger(Condition().OnAddAddFriends)}).catch(r=>{let{error_code:e,error_reason:n}=r.error_data;SetMethodResult(t,!1,"error_code: "+e+"; error_reason: "+n)})},Acts.prototype.AddOnWall=function(e,t){let r="VKWebAppShowWallPostBox";vkBridge.send("VKWebAppShowWallPostBox",{message:e,attachments:t}).then(e=>{SetMethodResult(r,e.result),e.post_id&&Trigger(Condition().OnAddOnWall)}).catch(t=>{SetMethodResult(r,!1,t)})},Acts.prototype.SaveKey=function(e,t){vkBridge.send("VKWebAppStorageSet",{key:e,value:t}).then(e=>{SetMethodResult("VKWebAppStorageSet",e.result),e.result&&Trigger(Condition().OnSaveKey)}).catch(t=>{SetMethodResult("VKWebAppStorageSet",!1,t)})},Acts.prototype.GetKeys=function(e,t){var r="VKWebAppStorageGetKeys";vkBridge.send(r,{count:e,offset:t}).then(e=>{SetMethodResult(r,e.keys),e.keys?(r="VKWebAppStorageGet",vkBridge.send(r,{keys:e.keys}).then(e=>{SetMethodResult(r,e.keys),e.keys?(sdk_storage=e.keys,Trigger(Condition().OnGetKeys)):Trigger(Condition().OnGetKeysFalse)}).catch(t=>{SetMethodResult(r,!1,t),Trigger(Condition().OnGetKeysErr)})):Trigger(Condition().OnGetKeysFalse)}).catch(t=>{SetMethodResult(r,!1,t),Trigger(Condition().OnGetKeysErr)})},Acts.prototype.GetLunchParams=function(){GetLunchParamp()},pluginProto.acts=new Acts;Exps.prototype.sdk_method=function(e){e.set_string(sdk_event)},Exps.prototype.sdk_result=function(e){e.set_int(sdk_result)},Exps.prototype.sdk_error=function(e){e.set_string(sdk_error)},Exps.prototype.getKey=function(e,t){var r="";for(let n of sdk_storage)n.key==t&&(r=n.value+"");e.set_string(r)},Exps.prototype.getLanchProp=function(e,t){var r="";sdk_lunchParams[t]&&(r=sdk_lunchParams[t]);e.set_string(r)},Exps.prototype.sdk_inite=function(e){e.set_int(sdk_inite)},Exps.prototype.getKeysToArrayJson=function(e){var t={c2array:!0,size:[sdk_storage.length,1,1],data:[]};for(let r of sdk_storage)t.data.push(r.key);e.set_string(JSON.stringify(t))},pluginProto.exps=new Exps}();cr.plugins_.Arr=function(e){this.runtime=e},function(){function e(){return p.length?p.pop():[]}function t(e){var r,n;for(r=0,n=e.length;r<n;r++)Array.isArray(e[r])&&t(e[r]);cr.clearArray(e),p.push(e)}function r(){}function n(){}function o(e,t){if(cr.is_number(e)&&cr.is_number(t))return e-t;var r=""+e,n=""+t;return r<n?-1:r>n?1:0}function a(){}var i=cr.plugins_.Arr.prototype;i.Type=function(e){this.plugin=e,this.runtime=e.runtime};var s=i.Type.prototype;s.onCreate=function(){},i.Instance=function(e){this.type=e,this.runtime=e.runtime};var l=i.Instance.prototype,p=[];Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)});l.onCreate=function(){this.cx=this.properties[0],this.cy=this.properties[1],this.cz=this.properties[2],this.recycled||(this.arr=e());var t=this.arr;t.length=this.cx;var r,n,o;for(r=0;r<this.cx;r++)for(t[r]||(t[r]=e()),t[r].length=this.cy,n=0;n<this.cy;n++)for(t[r][n]||(t[r][n]=e()),t[r][n].length=this.cz,o=0;o<this.cz;o++)t[r][n][o]=0;this.forX=[],this.forY=[],this.forZ=[],this.forDepth=-1},l.onDestroy=function(){var e;for(e=0;e<this.cx;e++)t(this.arr[e]);cr.clearArray(this.arr)},l.at=function(e,t,r){return e=Math.floor(e),t=Math.floor(t),r=Math.floor(r),isNaN(e)||0>e||e>this.cx-1?0:isNaN(t)||0>t||t>this.cy-1?0:isNaN(r)||0>r||r>this.cz-1?0:this.arr[e][t][r]},l.set=function(e,t,r,n){e=Math.floor(e),t=Math.floor(t),r=Math.floor(r);isNaN(e)||0>e||e>this.cx-1||isNaN(t)||0>t||t>this.cy-1||isNaN(r)||0>r||r>this.cz-1||(this.arr[e][t][r]=n)},l.getAsJSON=function(){return JSON.stringify({c2array:!0,size:[this.cx,this.cy,this.cz],data:this.arr})},l.saveToJSON=function(){return{size:[this.cx,this.cy,this.cz],data:this.arr}},l.loadFromJSON=function(e){var t=e.size;this.cx=t[0],this.cy=t[1],this.cz=t[2],this.arr=e.data},l.setSize=function(t,r,n){if(0>t&&(t=0),0>r&&(r=0),0>n&&(n=0),this.cx!==t||this.cy!==r||this.cz!==n){this.cx=t,this.cy=r,this.cz=n;var o=this.arr,a,i,s;for(o.length=t,a=0;a<this.cx;a++)for(cr.is_undefined(o[a])&&(o[a]=e()),o[a].length=r,i=0;i<this.cy;i++)for(cr.is_undefined(o[a][i])&&(o[a][i]=e()),o[a][i].length=n,s=0;s<this.cz;s++)cr.is_undefined(o[a][i][s])&&(o[a][i][s]=0)}},l.getForX=function(){return 0<=this.forDepth&&this.forDepth<this.forX.length?this.forX[this.forDepth]:0},l.getForY=function(){return 0<=this.forDepth&&this.forDepth<this.forY.length?this.forY[this.forDepth]:0},l.getForZ=function(){return 0<=this.forDepth&&this.forDepth<this.forZ.length?this.forZ[this.forDepth]:0};r.prototype.CompareX=function(e,t,r){return cr.do_cmp(this.at(e,0,0),t,r)},r.prototype.CompareXY=function(e,t,r,n){return cr.do_cmp(this.at(e,t,0),r,n)},r.prototype.CompareXYZ=function(e,t,r,n,o){return cr.do_cmp(this.at(e,t,r),n,o)},l.doForEachTrigger=function(e){this.runtime.pushCopySol(e.solModifiers),e.retrigger(),this.runtime.popSol(e.solModifiers)},r.prototype.ArrForEach=function(e){var t=this.runtime.getCurrentEventStack().current_event;this.forDepth++;var r=this.forDepth;switch(r===this.forX.length?(this.forX.push(0),this.forY.push(0),this.forZ.push(0)):(this.forX[r]=0,this.forY[r]=0,this.forZ[r]=0),e){case 0:for(this.forX[r]=0;this.forX[r]<this.cx;this.forX[r]++)for(this.forY[r]=0;this.forY[r]<this.cy;this.forY[r]++)for(this.forZ[r]=0;this.forZ[r]<this.cz;this.forZ[r]++)this.doForEachTrigger(t);break;case 1:for(this.forX[r]=0;this.forX[r]<this.cx;this.forX[r]++)for(this.forY[r]=0;this.forY[r]<this.cy;this.forY[r]++)this.doForEachTrigger(t);break;case 2:for(this.forX[r]=0;this.forX[r]<this.cx;this.forX[r]++)this.doForEachTrigger(t);}return this.forDepth--,!1},r.prototype.CompareCurrent=function(e,t){return cr.do_cmp(this.at(this.getForX(),this.getForY(),this.getForZ()),e,t)},r.prototype.Contains=function(e){var t,r,n;for(t=0;t<this.cx;t++)for(r=0;r<this.cy;r++)for(n=0;n<this.cz;n++)if(this.arr[t][r][n]===e)return!0;return!1},r.prototype.IsEmpty=function(){return 0===this.cx||0===this.cy||0===this.cz},r.prototype.CompareSize=function(e,t,r){var n=0;return 0===e?n=this.cx:1===e?n=this.cy:2===e?n=this.cz:void 0,cr.do_cmp(n,t,r)},i.cnds=new r;n.prototype.Clear=function(){var e,t,r;for(e=0;e<this.cx;e++)for(t=0;t<this.cy;t++)for(r=0;r<this.cz;r++)this.arr[e][t][r]=0},n.prototype.SetSize=function(e,t,r){this.setSize(e,t,r)},n.prototype.SetX=function(e,t){this.set(e,0,0,t)},n.prototype.SetXY=function(e,t,r){this.set(e,t,0,r)},n.prototype.SetXYZ=function(e,t,r,n){this.set(e,t,r,n)},n.prototype.Push=function(t,r,n){var o=0,i=0,s=0,l=this.arr;switch(n){case 0:for(0===t?(o=l.length,l.push(e())):(o=0,l.unshift(e())),l[o].length=this.cy;i<this.cy;i++)for(l[o][i]=e(),l[o][i].length=this.cz,s=0;s<this.cz;s++)l[o][i][s]=r;this.cx++;break;case 1:for(;o<this.cx;o++)for(0===t?(i=l[o].length,l[o].push(e())):(i=0,l[o].unshift(e())),l[o][i].length=this.cz,s=0;s<this.cz;s++)l[o][i][s]=r;this.cy++;break;case 2:for(;o<this.cx;o++)for(i=0;i<this.cy;i++)0===t?l[o][i].push(r):l[o][i].unshift(r);this.cz++;}},n.prototype.Pop=function(e,r){var n=0,o=0,i=this.arr;switch(r){case 0:if(0===this.cx)break;0===e?t(i.pop()):t(i.shift()),this.cx--;break;case 1:if(0===this.cy)break;for(;n<this.cx;n++)0===e?t(i[n].pop()):t(i[n].shift());this.cy--;break;case 2:if(0===this.cz)break;for(;n<this.cx;n++)for(o=0;o<this.cy;o++)0===e?i[n][o].pop():i[n][o].shift();this.cz--;}},n.prototype.Reverse=function(e){var t=0,r=0,n=this.arr;if(0!==this.cx&&0!==this.cy&&0!==this.cz)switch(e){case 0:n.reverse();break;case 1:for(;t<this.cx;t++)n[t].reverse();break;case 2:for(;t<this.cx;t++)for(r=0;r<this.cy;r++)n[t][r].reverse();}},n.prototype.Sort=function(e){var t=0,r=0,n=this.arr;if(0!==this.cx&&0!==this.cy&&0!==this.cz)switch(e){case 0:n.sort(function(e,t){return o(e[0][0],t[0][0])});break;case 1:for(;t<this.cx;t++)n[t].sort(function(e,t){return o(e[0],t[0])});break;case 2:for(;t<this.cx;t++)for(r=0;r<this.cy;r++)n[t][r].sort(o);}},n.prototype.Delete=function(e,r){var n=0,o=0;e=Math.floor(e);var i=this.arr;if(!(0>e))switch(r){case 0:if(e>=this.cx)break;t(i[e]),i.splice(e,1),this.cx--;break;case 1:if(e>=this.cy)break;for(;n<this.cx;n++)t(i[n][e]),i[n].splice(e,1);this.cy--;break;case 2:if(e>=this.cz)break;for(;n<this.cx;n++)for(o=0;o<this.cy;o++)i[n][o].splice(e,1);this.cz--;}},n.prototype.Insert=function(t,r,n){var o=0,i=0,s=0;r=Math.floor(r);var l=this.arr;if(!(0>r))switch(n){case 0:if(r>this.cx)return;for(o=r,l.splice(o,0,e()),l[o].length=this.cy;i<this.cy;i++)for(l[o][i]=e(),l[o][i].length=this.cz,s=0;s<this.cz;s++)l[o][i][s]=t;this.cx++;break;case 1:if(r>this.cy)return;for(;o<this.cx;o++)for(i=r,l[o].splice(i,0,e()),l[o][i].length=this.cz,s=0;s<this.cz;s++)l[o][i][s]=t;this.cy++;break;case 2:if(r>this.cz)return;for(;o<this.cx;o++)for(i=0;i<this.cy;i++)l[o][i].splice(r,0,t);this.cz++;}},n.prototype.JSONLoad=function(e){var t;try{t=JSON.parse(e)}catch(t){return}if(t.c2array){var r=t.size;this.cx=r[0],this.cy=r[1],this.cz=r[2],this.arr=t.data}},n.prototype.JSONDownload=function(e){var t=document.createElement("a");if("undefined"==typeof t.download){var r="data:text/html,"+encodeURIComponent("<p><a download='"+e+"' href=\"data:application/json,"+encodeURIComponent(this.getAsJSON())+"\">Download link</a></p>");window.open(r)}else{var n=document.getElementsByTagName("body")[0];t.textContent=e,t.href="data:application/json,"+encodeURIComponent(this.getAsJSON()),t.download=e,n.appendChild(t);var o=document.createEvent("MouseEvent");o.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),t.dispatchEvent(o),n.removeChild(t)}},i.acts=new n;a.prototype.At=function(e,t,r,n){e.set_any(this.at(t,r||0,n||0))},a.prototype.Width=function(e){e.set_int(this.cx)},a.prototype.Height=function(e){e.set_int(this.cy)},a.prototype.Depth=function(e){e.set_int(this.cz)},a.prototype.CurX=function(e){e.set_int(this.getForX())},a.prototype.CurY=function(e){e.set_int(this.getForY())},a.prototype.CurZ=function(e){e.set_int(this.getForZ())},a.prototype.CurValue=function(e){e.set_any(this.at(this.getForX(),this.getForY(),this.getForZ()))},a.prototype.Front=function(e){e.set_any(this.at(0,0,0))},a.prototype.Back=function(e){e.set_any(this.at(this.cx-1,0,0))},a.prototype.IndexOf=function(e,t){for(var r=0;r<this.cx;r++)if(this.arr[r][0][0]===t)return void e.set_int(r);e.set_int(-1)},a.prototype.LastIndexOf=function(e,t){for(var r=this.cx-1;0<=r;r--)if(this.arr[r][0][0]===t)return void e.set_int(r);e.set_int(-1)},a.prototype.AsJSON=function(e){e.set_string(this.getAsJSON())},i.exps=new a}();cr.plugins_.Audio=function(e){this.runtime=e},function(){function e(e){var t=he.indexOf(e);-1===t&&he.push(e)}function t(t){var r=t.instanceObject,n;try{n=r.play()}catch(r){return void e(t)}n?n.catch(function(){e(t)}):_e&&!z.isInUserInputEvent&&e(t)}function r(){var t,r,o,a;be||le||!Q||(n(),"running"===Q.state&&(be=!0));var s=he.slice(0);if(cr.clearArray(he),!oe)for(t=0,r=s.length;t<r;++t)o=s[t],o.stopped||o.is_paused||(a=o.instanceObject.play(),a&&a.catch(function(){e(o)}))}function n(){if("suspended"===Q.state&&Q.resume&&Q.resume(),!!Q.createBuffer){var e=Q.createBuffer(1,220,22050),t=Q.createBufferSource();t.buffer=e,t.connect(Q.destination),u(t)}}function o(e){var t=s(e);return isFinite(t)||(t=0),0>t&&(t=0),1<t&&(t=1),t}function a(e){return 0>e&&(e=0),1<e&&(e=1),l(e)}function s(e){return Math.pow(10,e/20)}function l(e){return 20*(Math.log(e)/Math.log(10))}function p(e){return e=e.toLowerCase(),xe.hasOwnProperty(e)&&xe[e].length?xe[e][0].getInputNode():Q.destination}function d(){return Q.createGain?Q.createGain():Q.createGainNode()}function c(e){return Q.createDelay?Q.createDelay(e):Q.createDelayNode(e)}function u(e,t){e.start?e.start(t||0):e.noteOn(t||0)}function g(e,t,r,n){e.start?e.start(n||0,t):e.noteGrainOn(n||0,t,r-t)}function y(e){try{e.stop?e.stop(0):e.noteOff(0)}catch(t){}}function m(e,t,r,n){if(e){if(e.cancelScheduledValues(0),0===n)return void(e.value=t);var o=Q.currentTime;n+=o,0===r?e.setValueAtTime(t,n):1===r?(e.setValueAtTime(e.value,o),e.linearRampToValueAtTime(t,n)):2===r?(e.setValueAtTime(e.value,o),e.exponentialRampToValueAtTime(t,n)):void 0}}function _(e,t,r,n,o,a){this.type="filter",this.params=[e,t,r,n,o,a],this.inputNode=d(),this.wetNode=d(),this.wetNode.gain.value=a,this.dryNode=d(),this.dryNode.gain.value=1-a,this.filterNode=Q.createBiquadFilter(),this.filterNode.type="number"==typeof this.filterNode.type?e:ve[e],this.filterNode.frequency.value=t,this.filterNode.detune&&(this.filterNode.detune.value=r),this.filterNode.Q.value=n,this.filterNode.gain.value=o,this.inputNode.connect(this.filterNode),this.inputNode.connect(this.dryNode),this.filterNode.connect(this.wetNode)}function h(e,t,r){this.type="delay",this.params=[e,t,r],this.inputNode=d(),this.wetNode=d(),this.wetNode.gain.value=r,this.dryNode=d(),this.dryNode.gain.value=1-r,this.mainNode=d(),this.delayNode=c(e),this.delayNode.delayTime.value=e,this.delayGainNode=d(),this.delayGainNode.gain.value=t,this.inputNode.connect(this.mainNode),this.inputNode.connect(this.dryNode),this.mainNode.connect(this.wetNode),this.mainNode.connect(this.delayNode),this.delayNode.connect(this.delayGainNode),this.delayGainNode.connect(this.mainNode)}function f(e,t,r,n){this.type="convolve",this.params=[t,r,n],this.inputNode=d(),this.wetNode=d(),this.wetNode.gain.value=r,this.dryNode=d(),this.dryNode.gain.value=1-r,this.convolveNode=Q.createConvolver(),e&&(this.convolveNode.normalize=t,this.convolveNode.buffer=e),this.inputNode.connect(this.convolveNode),this.inputNode.connect(this.dryNode),this.convolveNode.connect(this.wetNode)}function x(e,t,r,n,o){this.type="flanger",this.params=[e,t,r,n,o],this.inputNode=d(),this.dryNode=d(),this.dryNode.gain.value=1-o/2,this.wetNode=d(),this.wetNode.gain.value=o/2,this.feedbackNode=d(),this.feedbackNode.gain.value=n,this.delayNode=c(e+t),this.delayNode.delayTime.value=e,this.oscNode=Q.createOscillator(),this.oscNode.frequency.value=r,this.oscGainNode=d(),this.oscGainNode.gain.value=t,this.inputNode.connect(this.delayNode),this.inputNode.connect(this.dryNode),this.delayNode.connect(this.wetNode),this.delayNode.connect(this.feedbackNode),this.feedbackNode.connect(this.delayNode),this.oscNode.connect(this.oscGainNode),this.oscGainNode.connect(this.delayNode.delayTime),u(this.oscNode)}function v(e,t,r,n,o,a){this.type="phaser",this.params=[e,t,r,n,o,a],this.inputNode=d(),this.dryNode=d(),this.dryNode.gain.value=1-a/2,this.wetNode=d(),this.wetNode.gain.value=a/2,this.filterNode=Q.createBiquadFilter(),this.filterNode.type="number"==typeof this.filterNode.type?7:"allpass",this.filterNode.frequency.value=e,this.filterNode.detune&&(this.filterNode.detune.value=t),this.filterNode.Q.value=r,this.oscNode=Q.createOscillator(),this.oscNode.frequency.value=o,this.oscGainNode=d(),this.oscGainNode.gain.value=n,this.inputNode.connect(this.filterNode),this.inputNode.connect(this.dryNode),this.filterNode.connect(this.wetNode),this.oscNode.connect(this.oscGainNode),this.oscGainNode.connect(this.filterNode.frequency),u(this.oscNode)}function w(e){this.type="gain",this.params=[e],this.node=d(),this.node.gain.value=e}function S(e,t){this.type="tremolo",this.params=[e,t],this.node=d(),this.node.gain.value=1-t/2,this.oscNode=Q.createOscillator(),this.oscNode.frequency.value=e,this.oscGainNode=d(),this.oscGainNode.gain.value=t/2,this.oscNode.connect(this.oscGainNode),this.oscGainNode.connect(this.node.gain),u(this.oscNode)}function T(e,t){this.type="ringmod",this.params=[e,t],this.inputNode=d(),this.wetNode=d(),this.wetNode.gain.value=t,this.dryNode=d(),this.dryNode.gain.value=1-t,this.ringNode=d(),this.ringNode.gain.value=0,this.oscNode=Q.createOscillator(),this.oscNode.frequency.value=e,this.oscNode.connect(this.ringNode.gain),u(this.oscNode),this.inputNode.connect(this.ringNode),this.inputNode.connect(this.dryNode),this.ringNode.connect(this.wetNode)}function C(e,t,r,n,o){this.type="distortion",this.params=[e,t,r,n,o],this.inputNode=d(),this.preGain=d(),this.postGain=d(),this.setDrive(r,s(n)),this.wetNode=d(),this.wetNode.gain.value=o,this.dryNode=d(),this.dryNode.gain.value=1-o,this.waveShaper=Q.createWaveShaper(),this.curve=new Float32Array(65536),this.generateColortouchCurve(e,t),this.waveShaper.curve=this.curve,this.inputNode.connect(this.preGain),this.inputNode.connect(this.dryNode),this.preGain.connect(this.waveShaper),this.waveShaper.connect(this.postGain),this.postGain.connect(this.wetNode)}function O(e,t){return 1-Math.exp(-t*e)}function A(e,t,r,n,o){this.type="compressor",this.params=[e,t,r,n,o],this.node=Q.createDynamicsCompressor();try{this.node.threshold.value=e,this.node.knee.value=t,this.node.ratio.value=r,this.node.attack.value=n,this.node.release.value=o}catch(t){}}function E(e,t){this.type="analyser",this.params=[e,t],this.node=Q.createAnalyser(),this.node.fftSize=e,this.node.smoothingTimeConstant=t,this.freqBins=new Float32Array(this.node.frequencyBinCount),this.signal=new Uint8Array(e),this.peak=0,this.rms=0}function P(){this.obj=null,this.loadUid=0}function I(e,t){this.src=e,this.myapi=Z,this.is_music=t,this.added_end_listener=!1;var r=this;this.outNode=null,this.mediaSourceNode=null,this.panWhenReady=[],this.seekWhenReady=0,this.pauseWhenReady=!1,this.supportWebAudioAPI=!1,this.failedToLoad=!1,this.wasEverReady=!1,Z===1&&t&&!fe&&(this.myapi=0,this.outNode=d()),this.bufferObject=null,this.audioData=null;var n;switch(this.myapi){case 0:this.bufferObject=new Audio,this.bufferObject.crossOrigin="anonymous",this.bufferObject.addEventListener("canplaythrough",function(){r.wasEverReady=!0}),Z===1&&Q.createMediaElementSource&&!/wiiu/i.test(navigator.userAgent)&&(this.supportWebAudioAPI=!0,this.bufferObject.addEventListener("canplay",function(){!r.mediaSourceNode&&r.bufferObject&&(r.mediaSourceNode=Q.createMediaElementSource(r.bufferObject),r.mediaSourceNode.connect(r.outNode))})),this.bufferObject.autoplay=!1,this.bufferObject.preload="auto",this.bufferObject.src=e;break;case 1:z.isWKWebView?z.fetchLocalFileViaCordovaAsArrayBuffer(e,function(e){r.audioData=e,r.decodeAudioBuffer()},function(){r.failedToLoad=!0}):(n=new XMLHttpRequest,n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(){r.audioData=n.response,r.decodeAudioBuffer()},n.onerror=function(){r.failedToLoad=!0},n.send());break;case 2:this.bufferObject=!0;break;case 3:this.bufferObject=!0;}}function k(e,t){var r=this;this.tag=t,this.fresh=!0,this.stopped=!0,this.src=e.src,this.buffer=e,this.myapi=Z,this.is_music=e.is_music,this.playbackRate=1,this.hasPlaybackEnded=!0,this.resume_me=!1,this.is_paused=!1,this.resume_position=0,this.looping=!1,this.is_muted=!1,this.is_silent=!1,this.volume=1,this.onended_handler=function(t){if(!(r.is_paused||r.resume_me)){var e=this;e||(e=t.target),e!==r.active_buffer||(r.hasPlaybackEnded=!0,r.stopped=!0,U=r.tag,z.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,G))}},this.active_buffer=null,this.isTimescaled=1===ne&&!this.is_music||2===ne,this.mutevol=1,this.startTime=this.isTimescaled?z.kahanTime.sum:z.wallTime.sum,this.gainNode=null,this.pannerNode=null,this.pannerEnabled=!1,this.objectTracker=null,this.panX=0,this.panY=0,this.panAngle=0,this.panConeInner=0,this.panConeOuter=0,this.panConeOuterGain=0,this.instanceObject=null;var n=!1;switch(1!==this.myapi||0!==this.buffer.myapi||this.buffer.supportWebAudioAPI||(this.myapi=0),this.myapi){case 0:this.is_music?(this.instanceObject=e.bufferObject,n=!e.added_end_listener,e.added_end_listener=!0):(this.instanceObject=new Audio,this.instanceObject.crossOrigin="anonymous",this.instanceObject.autoplay=!1,this.instanceObject.src=e.bufferObject.src,n=!0),n&&this.instanceObject.addEventListener("ended",function(){U=r.tag,r.stopped=!0,z.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,G)});break;case 1:this.gainNode=d(),this.gainNode.connect(p(t)),1===this.buffer.myapi?e.bufferObject&&(this.instanceObject=Q.createBufferSource(),this.instanceObject.buffer=e.bufferObject,this.instanceObject.connect(this.gainNode)):(this.instanceObject=this.buffer.bufferObject,this.buffer.outNode.connect(this.gainNode),!this.buffer.added_end_listener&&(this.buffer.added_end_listener=!0,this.buffer.bufferObject.addEventListener("ended",function(){U=r.tag,r.stopped=!0,z.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,G)})));break;case 2:this.instanceObject=new window.Media(X+this.src,null,null,function(e){e===window.Media.MEDIA_STOPPED&&(r.hasPlaybackEnded=!0,r.stopped=!0,U=r.tag,z.trigger(cr.plugins_.Audio.prototype.cnds.OnEnded,G))});break;case 3:this.instanceObject=!0;}}function L(e,t){var r=e.isPlaying()?1:0,n=t.isPlaying()?1:0;return r===n?0:r<n?1:-1}function R(e,t){if(cr.clearArray(Ce),!e.length)return!te||te.hasEnded()?void 0:(cr.clearArray(Ce),void(Ce[0]=te));var r,n,o;for(r=0,n=ee.length;r<n;r++)o=ee[r],cr.equals_nocase(e,o.tag)&&Ce.push(o);t&&Ce.sort(L)}function B(e){var t=Q.destination,r,o,a,s;if(xe.hasOwnProperty(e)&&(a=xe[e],a.length))for(t=a[0].getInputNode(),r=0,o=a.length;r<o;r++)s=a[r],r+1===o?s.connectTo(Q.destination):s.connectTo(a[r+1].getInputNode());for(R(e),r=0,o=Ce.length;r<o;r++)Ce[r].reconnect(t);ye&&me===e&&(ye.disconnect(),ye.connect(t))}function F(e,t){xe.hasOwnProperty(e)?xe[e].push(t):xe[e]=[t],B(e)}function N(){}function D(){}function j(){}function M(e,t){var r=null;return xe.hasOwnProperty(e)&&(r=xe[e]),r&&0<=t&&t<r.length&&r[t].freqBins?r[t]:null}var W=cr.plugins_.Audio.prototype;W.Type=function(e){this.plugin=e,this.runtime=e.runtime};var V=W.Type.prototype;V.onCreate=function(){};var z=null,G=null,U="",X="",H=0,Y=1,K=2,J=3,Z=H,Q=null,$=[],ee=[],te=null,re=!1,ne=0,oe=!1,ae=1,ie=0,se=0,le=!1,pe=1,de=1,ce=10,ue=1e4,ge=1,ye=null,me="",_e=!1,he=[],fe=!1,be=!1;document.addEventListener("pointerup",r,!0),document.addEventListener("touchend",r,!0),document.addEventListener("click",r,!0),document.addEventListener("keydown",r,!0),document.addEventListener("gamepadconnected",r,!0);var xe={};var ve=["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"];_.prototype.connectTo=function(e){this.wetNode.disconnect(),this.wetNode.connect(e),this.dryNode.disconnect(),this.dryNode.connect(e)},_.prototype.remove=function(){this.inputNode.disconnect(),this.filterNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},_.prototype.getInputNode=function(){return this.inputNode},_.prototype.setParam=function(e,t,r,n){0===e?(t/=100,0>t&&(t=0),1<t&&(t=1),this.params[5]=t,m(this.wetNode.gain,t,r,n),m(this.dryNode.gain,1-t,r,n)):1===e?(this.params[1]=t,m(this.filterNode.frequency,t,r,n)):2===e?(this.params[2]=t,m(this.filterNode.detune,t,r,n)):3===e?(this.params[3]=t,m(this.filterNode.Q,t,r,n)):4===e?(this.params[4]=t,m(this.filterNode.gain,t,r,n)):void 0};h.prototype.connectTo=function(e){this.wetNode.disconnect(),this.wetNode.connect(e),this.dryNode.disconnect(),this.dryNode.connect(e)},h.prototype.remove=function(){this.inputNode.disconnect(),this.mainNode.disconnect(),this.delayNode.disconnect(),this.delayGainNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},h.prototype.getInputNode=function(){return this.inputNode},h.prototype.setParam=function(e,t,r,n){0===e?(t/=100,0>t&&(t=0),1<t&&(t=1),this.params[2]=t,m(this.wetNode.gain,t,r,n),m(this.dryNode.gain,1-t,r,n)):4===e?(this.params[1]=o(t),m(this.delayGainNode.gain,o(t),r,n)):5===e?(this.params[0]=t,m(this.delayNode.delayTime,t,r,n)):void 0};f.prototype.connectTo=function(e){this.wetNode.disconnect(),this.wetNode.connect(e),this.dryNode.disconnect(),this.dryNode.connect(e)},f.prototype.remove=function(){this.inputNode.disconnect(),this.convolveNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},f.prototype.getInputNode=function(){return this.inputNode},f.prototype.setParam=function(e,t,r,n){0===e?(t/=100,0>t&&(t=0),1<t&&(t=1),this.params[1]=t,m(this.wetNode.gain,t,r,n),m(this.dryNode.gain,1-t,r,n)):void 0};x.prototype.connectTo=function(e){this.dryNode.disconnect(),this.dryNode.connect(e),this.wetNode.disconnect(),this.wetNode.connect(e)},x.prototype.remove=function(){this.inputNode.disconnect(),this.delayNode.disconnect(),this.oscNode.disconnect(),this.oscGainNode.disconnect(),this.dryNode.disconnect(),this.wetNode.disconnect(),this.feedbackNode.disconnect()},x.prototype.getInputNode=function(){return this.inputNode},x.prototype.setParam=function(e,t,r,n){0===e?(t/=100,0>t&&(t=0),1<t&&(t=1),this.params[4]=t,m(this.wetNode.gain,t/2,r,n),m(this.dryNode.gain,1-t/2,r,n)):6===e?(this.params[1]=t/1e3,m(this.oscGainNode.gain,t/1e3,r,n)):7===e?(this.params[2]=t,m(this.oscNode.frequency,t,r,n)):8===e?(this.params[3]=t/100,m(this.feedbackNode.gain,t/100,r,n)):void 0};v.prototype.connectTo=function(e){this.dryNode.disconnect(),this.dryNode.connect(e),this.wetNode.disconnect(),this.wetNode.connect(e)},v.prototype.remove=function(){this.inputNode.disconnect(),this.filterNode.disconnect(),this.oscNode.disconnect(),this.oscGainNode.disconnect(),this.dryNode.disconnect(),this.wetNode.disconnect()},v.prototype.getInputNode=function(){return this.inputNode},v.prototype.setParam=function(e,t,r,n){0===e?(t/=100,0>t&&(t=0),1<t&&(t=1),this.params[5]=t,m(this.wetNode.gain,t/2,r,n),m(this.dryNode.gain,1-t/2,r,n)):1===e?(this.params[0]=t,m(this.filterNode.frequency,t,r,n)):2===e?(this.params[1]=t,m(this.filterNode.detune,t,r,n)):3===e?(this.params[2]=t,m(this.filterNode.Q,t,r,n)):6===e?(this.params[3]=t,m(this.oscGainNode.gain,t,r,n)):7===e?(this.params[4]=t,m(this.oscNode.frequency,t,r,n)):void 0};w.prototype.connectTo=function(e){this.node.disconnect(),this.node.connect(e)},w.prototype.remove=function(){this.node.disconnect()},w.prototype.getInputNode=function(){return this.node},w.prototype.setParam=function(e,t,r,n){4===e?(this.params[0]=o(t),m(this.node.gain,o(t),r,n)):void 0};S.prototype.connectTo=function(e){this.node.disconnect(),this.node.connect(e)},S.prototype.remove=function(){this.oscNode.disconnect(),this.oscGainNode.disconnect(),this.node.disconnect()},S.prototype.getInputNode=function(){return this.node},S.prototype.setParam=function(e,t,r,n){0===e?(t/=100,0>t&&(t=0),1<t&&(t=1),this.params[1]=t,m(this.node.gain.value,1-t/2,r,n),m(this.oscGainNode.gain.value,t/2,r,n)):7===e?(this.params[0]=t,m(this.oscNode.frequency,t,r,n)):void 0};T.prototype.connectTo=function(e){this.wetNode.disconnect(),this.wetNode.connect(e),this.dryNode.disconnect(),this.dryNode.connect(e)},T.prototype.remove=function(){this.oscNode.disconnect(),this.ringNode.disconnect(),this.inputNode.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},T.prototype.getInputNode=function(){return this.inputNode},T.prototype.setParam=function(e,t,r,n){0===e?(t/=100,0>t&&(t=0),1<t&&(t=1),this.params[1]=t,m(this.wetNode.gain,t,r,n),m(this.dryNode.gain,1-t,r,n)):7===e?(this.params[0]=t,m(this.oscNode.frequency,t,r,n)):void 0};C.prototype.setDrive=function(e,t){.01>e&&(e=.01),this.preGain.gain.value=e,this.postGain.gain.value=Math.pow(1/e,.6)*t},C.prototype.shape=function(e,t,r){var n=1.05*r*t-t,o=0>e?-1:1,a=0>e?-e:e,i=a<t?a:t+n*O(a-t,1/n);return i*=o,i},C.prototype.generateColortouchCurve=function(e,t){for(var r=s(e),n=s(t),o=65536/2,a=0,l=0;l<o;++l)a=l/o,a=this.shape(a,r,n),this.curve[o+l]=a,this.curve[o-l-1]=-a},C.prototype.connectTo=function(e){this.wetNode.disconnect(),this.wetNode.connect(e),this.dryNode.disconnect(),this.dryNode.connect(e)},C.prototype.remove=function(){this.inputNode.disconnect(),this.preGain.disconnect(),this.waveShaper.disconnect(),this.postGain.disconnect(),this.wetNode.disconnect(),this.dryNode.disconnect()},C.prototype.getInputNode=function(){return this.inputNode},C.prototype.setParam=function(e,t,r,n){0===e?(t/=100,0>t&&(t=0),1<t&&(t=1),this.params[4]=t,m(this.wetNode.gain,t,r,n),m(this.dryNode.gain,1-t,r,n)):void 0};A.prototype.connectTo=function(e){this.node.disconnect(),this.node.connect(e)},A.prototype.remove=function(){this.node.disconnect()},A.prototype.getInputNode=function(){return this.node},A.prototype.setParam=function(){};E.prototype.tick=function(){this.node.getFloatFrequencyData(this.freqBins),this.node.getByteTimeDomainData(this.signal);var e=this.node.fftSize,t=0;this.peak=0;for(var r=0,n=0;t<e;t++)n=(this.signal[t]-128)/128,0>n&&(n=-n),this.peak<n&&(this.peak=n),r+=n*n;this.peak=a(this.peak),this.rms=a(Math.sqrt(r/e))},E.prototype.connectTo=function(e){this.node.disconnect(),this.node.connect(e)},E.prototype.remove=function(){this.node.disconnect()},E.prototype.getInputNode=function(){return this.node},E.prototype.setParam=function(){};P.prototype.setObject=function(e){this.obj=e},P.prototype.hasObject=function(){return!!this.obj},P.prototype.tick=function(){};I.prototype.release=function(){var e,t,r,n;for(e=0,r=0,t=ee.length;e<t;++e)n=ee[e],ee[r]=n,n.buffer===this?n.stop():++r;ee.length=r,this.mediaSourceNode&&(this.mediaSourceNode.disconnect(),this.mediaSourceNode=null),this.outNode&&(this.outNode.disconnect(),this.outNode=null),this.bufferObject=null,this.audioData=null},I.prototype.decodeAudioBuffer=function(){if(!this.bufferObject&&this.audioData){var e=this;if(Q.decodeAudioData)Q.decodeAudioData(this.audioData,function(t){e.bufferObject=t,e.audioData=null;var r,n,o,s;if(!cr.is_undefined(e.playTagWhenReady)&&!oe){if(e.panWhenReady.length){for(n=0,o=e.panWhenReady.length;n<o;n++)if(r=e.panWhenReady[n],s=new k(e,r.thistag),s.setPannerEnabled(!0),!("undefined"!=typeof r.objUid&&(r.obj=z.getObjectByUID(r.objUid),!r.obj))){if(r.obj){var l=cr.rotatePtAround(r.obj.x,r.obj.y,-r.obj.layer.getAngle(),ie,se,!0),d=cr.rotatePtAround(r.obj.x,r.obj.y,-r.obj.layer.getAngle(),ie,se,!1);s.setPan(l,d,cr.to_degrees(r.obj.angle-r.obj.layer.getAngle()),r.ia,r.oa,r.og),s.setObject(r.obj)}else s.setPan(r.x,r.y,r.a,r.ia,r.oa,r.og);s.play(e.loopWhenReady,e.volumeWhenReady,e.seekWhenReady),e.pauseWhenReady&&s.pause(),ee.push(s)}cr.clearArray(e.panWhenReady)}else s=new k(e,e.playTagWhenReady||""),s.play(e.loopWhenReady,e.volumeWhenReady,e.seekWhenReady),e.pauseWhenReady&&s.pause(),ee.push(s);}else if(!cr.is_undefined(e.convolveWhenReady)){var c=e.convolveWhenReady.convolveNode;c.normalize=e.normalizeWhenReady,c.buffer=t}},function(){e.failedToLoad=!0});else if(this.bufferObject=Q.createBuffer(this.audioData,!1),this.audioData=null,!cr.is_undefined(this.playTagWhenReady)&&!oe){var t=new k(this,this.playTagWhenReady);t.play(this.loopWhenReady,this.volumeWhenReady,this.seekWhenReady),this.pauseWhenReady&&t.pause(),ee.push(t)}else if(!cr.is_undefined(this.convolveWhenReady)){var r=this.convolveWhenReady.convolveNode;r.normalize=this.normalizeWhenReady,r.buffer=this.bufferObject}}},I.prototype.isLoaded=function(){switch(this.myapi){case H:var e=4<=this.bufferObject.readyState;return e&&(this.wasEverReady=!0),e||this.wasEverReady;case Y:return!!this.audioData||!!this.bufferObject;case K:return!0;case J:return!0;}return!1},I.prototype.isLoadedAndDecoded=function(){switch(this.myapi){case H:return this.isLoaded();case Y:return!!this.bufferObject;case K:return!0;case J:return!0;}return!1},I.prototype.hasFailedToLoad=function(){switch(this.myapi){case H:return!!this.bufferObject.error;case Y:return this.failedToLoad;}return!1};k.prototype.hasEnded=function(){switch(this.myapi){case H:return this.instanceObject.ended;case Y:return this.buffer.myapi===Y?!!(this.fresh||this.stopped||!this.instanceObject.loop)&&!this.is_paused&&this.hasPlaybackEnded:this.instanceObject.ended;case K:return this.hasPlaybackEnded;case J:}return!0},k.prototype.canBeRecycled=function(){return!!(this.fresh||this.stopped)||this.hasEnded()},k.prototype.setPannerEnabled=function(e){if(Z===Y)if(!this.pannerEnabled&&e){if(!this.gainNode)return;this.pannerNode||(this.pannerNode=Q.createPanner(),this.pannerNode.panningModel="number"==typeof this.pannerNode.panningModel?pe:["equalpower","HRTF","soundfield"][pe],this.pannerNode.distanceModel="number"==typeof this.pannerNode.distanceModel?de:["linear","inverse","exponential"][de],this.pannerNode.refDistance=ce,this.pannerNode.maxDistance=ue,this.pannerNode.rolloffFactor=ge),this.gainNode.disconnect(),this.gainNode.connect(this.pannerNode),this.pannerNode.connect(p(this.tag)),this.pannerEnabled=!0}else if(this.pannerEnabled&&!e){if(!this.gainNode)return;this.pannerNode.disconnect(),this.gainNode.disconnect(),this.gainNode.connect(p(this.tag)),this.pannerEnabled=!1}},k.prototype.setPan=function(e,t,r,n,o,a){this.pannerEnabled&&Z===Y&&(this.pannerNode.setPosition(e,t,0),this.pannerNode.setOrientation(Math.cos(cr.to_radians(r)),Math.sin(cr.to_radians(r)),0),this.pannerNode.coneInnerAngle=n,this.pannerNode.coneOuterAngle=o,this.pannerNode.coneOuterGain=a,this.panX=e,this.panY=t,this.panAngle=r,this.panConeInner=n,this.panConeOuter=o,this.panConeOuterGain=a)},k.prototype.setObject=function(e){this.pannerEnabled&&Z===Y&&(!this.objectTracker&&(this.objectTracker=new P),this.objectTracker.setObject(e))},k.prototype.tick=function(e){if(this.pannerEnabled&&Z===Y&&this.objectTracker&&this.objectTracker.hasObject()&&this.isPlaying()){this.objectTracker.tick(e);var t=this.objectTracker.obj,r=cr.rotatePtAround(t.x,t.y,-t.layer.getAngle(),ie,se,!0),n=cr.rotatePtAround(t.x,t.y,-t.layer.getAngle(),ie,se,!1);this.pannerNode.setPosition(r,n,0);var o=0;"undefined"!=typeof this.objectTracker.obj.angle&&(o=t.angle-t.layer.getAngle(),this.pannerNode.setOrientation(Math.cos(o),Math.sin(o),0))}},k.prototype.play=function(e,r,n,o){var a=this.instanceObject;this.looping=e,this.volume=r;var i=n||0;switch(o=o||0,this.myapi){case H:if(1!==a.playbackRate&&(a.playbackRate=1),a.volume!==r*ae&&(a.volume=r*ae),a.loop!==e&&(a.loop=e),a.muted&&(a.muted=!1),a.currentTime!==i)try{a.currentTime=i}catch(e){}t(this);break;case Y:if(this.muted=!1,this.mutevol=1,this.buffer.myapi===Y)this.gainNode.gain.value=r*ae,this.fresh||(this.instanceObject=Q.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode)),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=e,this.hasPlaybackEnded=!1,0===i?u(this.instanceObject,o):g(this.instanceObject,i,this.getDuration(),o);else{if(1!==a.playbackRate&&(a.playbackRate=1),a.loop!==e&&(a.loop=e),a.volume=r*ae,a.currentTime!==i)try{a.currentTime=i}catch(e){}t(this)}break;case K:(!this.fresh&&this.stopped||0!==i)&&a.seekTo(i),a.play(),this.hasPlaybackEnded=!1;break;case J:z.isDirectCanvas?AppMobi.context.playSound(this.src,e):AppMobi.player.playSound(this.src,e);}this.playbackRate=1,this.startTime=(this.isTimescaled?z.kahanTime.sum:z.wallTime.sum)-i,this.fresh=!1,this.stopped=!1,this.is_paused=!1},k.prototype.stop=function(){switch(this.myapi){case H:this.instanceObject.paused||this.instanceObject.pause();break;case Y:this.buffer.myapi===Y?y(this.instanceObject):!this.instanceObject.paused&&this.instanceObject.pause();break;case K:this.instanceObject.stop();break;case J:z.isDirectCanvas&&AppMobi.context.stopSound(this.src);}this.stopped=!0,this.is_paused=!1},k.prototype.pause=function(){if(!(this.fresh||this.stopped||this.hasEnded()||this.is_paused)){switch(this.myapi){case H:this.instanceObject.paused||this.instanceObject.pause();break;case Y:this.buffer.myapi===Y?(this.resume_position=this.getPlaybackTime(!0),this.looping&&(this.resume_position%=this.getDuration()),this.is_paused=!0,y(this.instanceObject)):!this.instanceObject.paused&&this.instanceObject.pause();break;case K:this.instanceObject.pause();break;case J:z.isDirectCanvas&&AppMobi.context.stopSound(this.src);}this.is_paused=!0}},k.prototype.resume=function(){if(!(this.fresh||this.stopped||this.hasEnded()||!this.is_paused)){switch(this.myapi){case H:t(this);break;case Y:this.buffer.myapi===Y?(this.instanceObject=Q.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=this.looping,this.gainNode.gain.value=ae*this.volume*this.mutevol,this.updatePlaybackRate(),this.startTime=(this.isTimescaled?z.kahanTime.sum:z.wallTime.sum)-this.resume_position/(this.playbackRate||.001),g(this.instanceObject,this.resume_position,this.getDuration())):t(this);break;case K:this.instanceObject.play();break;case J:z.isDirectCanvas&&AppMobi.context.resumeSound(this.src);}this.is_paused=!1}},k.prototype.seek=function(e){if(!(this.fresh||this.stopped||this.hasEnded()))switch(this.myapi){case H:try{this.instanceObject.currentTime=e}catch(t){}break;case Y:if(this.buffer.myapi===Y)this.is_paused?this.resume_position=e:(this.pause(),this.resume_position=e,this.resume());else try{this.instanceObject.currentTime=e}catch(t){}break;case K:break;case J:z.isDirectCanvas&&AppMobi.context.seekSound(this.src,e);}},k.prototype.reconnect=function(e){this.myapi!==Y||(this.pannerEnabled?(this.pannerNode.disconnect(),this.pannerNode.connect(e)):(this.gainNode.disconnect(),this.gainNode.connect(e)))},k.prototype.getDuration=function(e){var t=0;switch(this.myapi){case H:"undefined"!=typeof this.instanceObject.duration&&(t=this.instanceObject.duration);break;case Y:t=this.buffer.bufferObject.duration;break;case K:t=this.instanceObject.getDuration();break;case J:z.isDirectCanvas&&(t=AppMobi.context.getDurationSound(this.src));}return e&&(t/=this.playbackRate||.001),t},k.prototype.getPlaybackTime=function(e){var t=this.getDuration(),r=0;switch(this.myapi){case H:"undefined"!=typeof this.instanceObject.currentTime&&(r=this.instanceObject.currentTime);break;case Y:if(this.buffer.myapi===Y){if(this.is_paused)return this.resume_position;r=(this.isTimescaled?z.kahanTime.sum:z.wallTime.sum)-this.startTime}else"undefined"!=typeof this.instanceObject.currentTime&&(r=this.instanceObject.currentTime);break;case K:break;case J:z.isDirectCanvas&&(r=AppMobi.context.getPlaybackTimeSound(this.src));}return e&&(r*=this.playbackRate),!this.looping&&r>t&&(r=t),r},k.prototype.isPlaying=function(){return!this.is_paused&&!this.fresh&&!this.stopped&&!this.hasEnded()},k.prototype.shouldSave=function(){return!this.fresh&&!this.stopped&&!this.hasEnded()},k.prototype.setVolume=function(e){this.volume=e,this.updateVolume()},k.prototype.updateVolume=function(){var e=this.volume*ae;switch(isFinite(e)||(e=0),this.myapi){case H:"undefined"!=typeof this.instanceObject.volume&&this.instanceObject.volume!==e&&(this.instanceObject.volume=e);break;case Y:this.buffer.myapi===Y?this.gainNode.gain.value=e*this.mutevol:"undefined"!=typeof this.instanceObject.volume&&this.instanceObject.volume!==e&&(this.instanceObject.volume=e);break;case K:break;case J:}},k.prototype.getVolume=function(){return this.volume},k.prototype.doSetMuted=function(e){switch(this.myapi){case H:this.instanceObject.muted!==!!e&&(this.instanceObject.muted=!!e);break;case Y:this.buffer.myapi===Y?(this.mutevol=e?0:1,this.gainNode.gain.value=ae*this.volume*this.mutevol):this.instanceObject.muted!==!!e&&(this.instanceObject.muted=!!e);break;case K:break;case J:}},k.prototype.setMuted=function(e){this.is_muted=!!e,this.doSetMuted(this.is_muted||this.is_silent)},k.prototype.setSilent=function(e){this.is_silent=!!e,this.doSetMuted(this.is_muted||this.is_silent)},k.prototype.setLooping=function(e){switch(this.looping=e,this.myapi){case H:this.instanceObject.loop!==!!e&&(this.instanceObject.loop=!!e);break;case Y:this.instanceObject.loop!==!!e&&(this.instanceObject.loop=!!e);break;case K:break;case J:z.isDirectCanvas&&AppMobi.context.setLoopingSound(this.src,e);}},k.prototype.setPlaybackRate=function(e){this.playbackRate=e,this.updatePlaybackRate()},k.prototype.updatePlaybackRate=function(){var e=this.playbackRate;switch(this.isTimescaled&&(e*=z.timescale),this.myapi){case H:this.instanceObject.playbackRate!==e&&(this.instanceObject.playbackRate=e);break;case Y:this.buffer.myapi===Y?this.instanceObject.playbackRate.value!==e&&(this.instanceObject.playbackRate.value=e):this.instanceObject.playbackRate!==e&&(this.instanceObject.playbackRate=e);break;case K:break;case J:}},k.prototype.setSuspended=function(e){switch(this.myapi){case H:e?this.isPlaying()?(this.resume_me=!0,this.instanceObject.pause()):this.resume_me=!1:this.resume_me&&(this.instanceObject.play(),this.resume_me=!1);break;case Y:e?this.isPlaying()?(this.resume_me=!0,this.buffer.myapi===Y?(this.resume_position=this.getPlaybackTime(!0),this.looping&&(this.resume_position%=this.getDuration()),y(this.instanceObject)):this.instanceObject.pause()):this.resume_me=!1:this.resume_me&&(this.buffer.myapi===Y?(this.instanceObject=Q.createBufferSource(),this.instanceObject.buffer=this.buffer.bufferObject,this.instanceObject.connect(this.gainNode),this.instanceObject.onended=this.onended_handler,this.active_buffer=this.instanceObject,this.instanceObject.loop=this.looping,this.gainNode.gain.value=ae*this.volume*this.mutevol,this.updatePlaybackRate(),this.startTime=(this.isTimescaled?z.kahanTime.sum:z.wallTime.sum)-this.resume_position/(this.playbackRate||.001),g(this.instanceObject,this.resume_position,this.getDuration())):this.instanceObject.play(),this.resume_me=!1);break;case K:e?this.isPlaying()?(this.instanceObject.pause(),this.resume_me=!0):this.resume_me=!1:this.resume_me&&(this.resume_me=!1,this.instanceObject.play());break;case J:}},W.Instance=function(e){if(this.type=e,this.runtime=e.runtime,z=this.runtime,G=this,this.listenerTracker=null,this.listenerZ=-600,this.runtime.isWKWebView&&(fe=!0),(this.runtime.isiOS||this.runtime.isAndroid&&(this.runtime.isChrome||this.runtime.isAndroidStockBrowser))&&!this.runtime.isCrosswalk&&!this.runtime.isDomFree&&!this.runtime.isAmazonWebApp&&!fe&&(_e=!0),Q=null,"undefined"==typeof AudioContext?"undefined"!=typeof webkitAudioContext&&(Z=Y,Q=new webkitAudioContext):(Z=Y,Q=new AudioContext),this.runtime.isiOS&&Q&&(Q.close&&Q.close(),"undefined"==typeof AudioContext?"undefined"!=typeof webkitAudioContext&&(Q=new webkitAudioContext):Q=new AudioContext),Z!==Y&&(this.runtime.isCordova&&"undefined"!=typeof window.Media?Z=K:this.runtime.isAppMobi&&(Z=J)),Z===K){X=location.href;var t=X.lastIndexOf("/");-1<t&&(X=X.substr(0,t+1)),X=X.replace("file://","")}if(this.runtime.isSafari&&this.runtime.isWindows&&"undefined"==typeof Audio)alert("It looks like you're using Safari for Windows without Quicktime.  Audio cannot be played until Quicktime is installed."),this.runtime.DestroyInstance(this);else{if(this.runtime.isDirectCanvas)re=this.runtime.isAndroid;else try{re=!!new Audio().canPlayType("audio/ogg; codecs=\"vorbis\"")&&!this.runtime.isWindows10}catch(t){re=!1}switch(Z){case H:;break;case Y:;break;case K:;break;case J:;break;default:;}this.runtime.tickMe(this)}};var we=W.Instance.prototype;we.onCreate=function(){this.runtime.audioInstance=this,ne=this.properties[0],this.saveload=this.properties[1],this.playinbackground=0!==this.properties[2],this.nextPlayTime=0,pe=this.properties[3],de=this.properties[4],this.listenerZ=-this.properties[5],ce=this.properties[6],ue=this.properties[7],ge=this.properties[8],this.listenerTracker=new P;var e=this.runtime.draw_width||this.runtime.width,t=this.runtime.draw_height||this.runtime.height;Z===Y&&(Q.listener.setPosition(e/2,t/2,this.listenerZ),Q.listener.setOrientation(0,0,1,0,-1,0),window.c2OnAudioMicStream=function(e,t){ye&&ye.disconnect(),me=t.toLowerCase(),ye=Q.createMediaStreamSource(e),ye.connect(p(me))}),this.runtime.addSuspendCallback(function(e){G.onSuspend(e)});var r=this;this.runtime.addDestroyCallback(function(e){r.onInstanceDestroyed(e)})},we.onInstanceDestroyed=function(e){var t,r,n;for(t=0,r=ee.length;t<r;t++)n=ee[t],n.objectTracker&&n.objectTracker.obj===e&&(n.objectTracker.obj=null,n.pannerEnabled&&n.isPlaying()&&n.looping&&n.stop());this.listenerTracker.obj===e&&(this.listenerTracker.obj=null)},we.saveToJSON=function(){var e={silent:oe,masterVolume:ae,listenerZ:this.listenerZ,listenerUid:this.listenerTracker.hasObject()?this.listenerTracker.obj.uid:-1,playing:[],effects:{}},t=e.playing,r,n,o,s,l,c,u;for(r=0,n=ee.length;r<n;r++)o=ee[r],o.shouldSave()&&3!==this.saveload&&(o.is_music&&1===this.saveload||(o.is_music||2!==this.saveload)&&(u=o.getPlaybackTime(),o.looping&&(u%=o.getDuration()),s={tag:o.tag,buffersrc:o.buffer.src,is_music:o.is_music,playbackTime:u,volume:o.volume,looping:o.looping,muted:o.is_muted,playbackRate:o.playbackRate,paused:o.is_paused,resume_position:o.resume_position},o.pannerEnabled&&(s.pan={},c=s.pan,o.objectTracker&&o.objectTracker.hasObject()?c.objUid=o.objectTracker.obj.uid:(c.x=o.panX,c.y=o.panY,c.a=o.panAngle),c.ia=o.panConeInner,c.oa=o.panConeOuter,c.og=o.panConeOuterGain),t.push(s)));var g=e.effects,y;for(l in xe)if(xe.hasOwnProperty(l)){for(y=[],r=0,n=xe[l].length;r<n;r++)y.push({type:xe[l][r].type,params:xe[l][r].params});g[l]=y}return e};var Se=[];we.loadFromJSON=function(e){var t=e.silent;ae=e.masterVolume,this.listenerZ=e.listenerZ,this.listenerTracker.setObject(null);var r=e.listenerUid;-1!==r&&(this.listenerTracker.loadUid=r,Se.push(this.listenerTracker));var n=e.playing,o,s,l,c,u,g,y,m,O,I,k,L,R,B;if(3!==this.saveload)for(o=0,s=ee.length;o<s;o++)k=ee[o],k.is_music&&1===this.saveload||(k.is_music||2!==this.saveload)&&k.stop();var N,D,j,M;for(L in xe)if(xe.hasOwnProperty(L))for(o=0,s=xe[L].length;o<s;o++)xe[L][o].remove();for(L in cr.wipe(xe),e.effects)if(e.effects.hasOwnProperty(L))for(N=e.effects[L],o=0,s=N.length;o<s;o++)D=N[o].type,j=N[o].params,"filter"===D?F(L,new _(j[0],j[1],j[2],j[3],j[4],j[5])):"delay"===D?F(L,new h(j[0],j[1],j[2])):"convolve"===D?(c=j[2],I=this.getAudioBuffer(c,!1),I.bufferObject?M=new f(I.bufferObject,j[0],j[1],c):(M=new f(null,j[0],j[1],c),I.normalizeWhenReady=j[0],I.convolveWhenReady=M),F(L,M)):"flanger"===D?F(L,new x(j[0],j[1],j[2],j[3],j[4])):"phaser"===D?F(L,new v(j[0],j[1],j[2],j[3],j[4],j[5])):"gain"===D?F(L,new w(j[0])):"tremolo"===D?F(L,new S(j[0],j[1])):"ringmod"===D?F(L,new T(j[0],j[1])):"distortion"===D?F(L,new C(j[0],j[1],j[2],j[3],j[4])):"compressor"===D?F(L,new A(j[0],j[1],j[2],j[3],j[4])):"analyser"===D?F(L,new E(j[0],j[1])):void 0;for(o=0,s=n.length;o<s;o++)if(3!==this.saveload&&(l=n[o],c=l.buffersrc,u=l.is_music,g=l.tag,y=l.playbackTime,m=l.looping,O=l.volume,R=l.pan,(B=R&&R.hasOwnProperty("objUid")?R.objUid:-1,!(u&&1===this.saveload)&&(u||2!==this.saveload)))){if(k=this.getAudioInstance(c,g,u,m,O),!k){I=this.getAudioBuffer(c,u),I.seekWhenReady=y,I.pauseWhenReady=l.paused,R&&(-1===B?I.panWhenReady.push({x:R.x,y:R.y,a:R.a,ia:R.ia,oa:R.oa,og:R.og,thistag:g}):I.panWhenReady.push({objUid:B,ia:R.ia,oa:R.oa,og:R.og,thistag:g}));continue}k.resume_position=l.resume_position,k.setPannerEnabled(!!R),k.play(m,O,y),k.updatePlaybackRate(),k.updateVolume(),k.doSetMuted(k.is_muted||k.is_silent),l.paused&&k.pause(),l.muted&&k.setMuted(!0),k.doSetMuted(k.is_muted||k.is_silent),R&&(-1===B?k.setPan(R.x,R.y,R.a,R.ia,R.oa,R.og):(k.objectTracker=k.objectTracker||new P,k.objectTracker.loadUid=B,Se.push(k.objectTracker)))}if(t&&!oe){for(o=0,s=ee.length;o<s;o++)ee[o].setSilent(!0);oe=!0}else if(!t&&oe){for(o=0,s=ee.length;o<s;o++)ee[o].setSilent(!1);oe=!1}},we.afterLoad=function(){var e,t,r,n;for(e=0,t=Se.length;e<t;e++)r=Se[e],n=this.runtime.getObjectByUID(r.loadUid),r.setObject(n),r.loadUid=-1,n&&(ie=n.x,se=n.y);cr.clearArray(Se)},we.onSuspend=function(e){if(!this.playinbackground){!e&&Q&&Q.resume&&(Q.resume(),le=!1);var t,r;for(t=0,r=ee.length;t<r;t++)ee[t].setSuspended(e);e&&Q&&Q.suspend&&(Q.suspend(),le=!0)}},we.tick=function(){var e=this.runtime.dt,t,r,n;for(t=0,r=ee.length;t<r;t++)n=ee[t],n.tick(e),0!==ne&&n.updatePlaybackRate();var o,s,l;for(o in xe)if(xe.hasOwnProperty(o))for(s=xe[o],t=0,r=s.length;t<r;t++)l=s[t],l.tick&&l.tick();Z===Y&&this.listenerTracker.hasObject()&&(this.listenerTracker.tick(e),ie=this.listenerTracker.obj.x,se=this.listenerTracker.obj.y,Q.listener.setPosition(this.listenerTracker.obj.x,this.listenerTracker.obj.y,this.listenerZ))};var Te=[];we.setPreloadList=function(e){var t=0,r,n,o,a,s,l;for(r=0,n=e.length;r<n;++r)o=e[r],a=o[0],s=2*o[1],l=4<a.length&&".ogg"===a.substr(a.length-4),(l&&re||!l&&!re)&&(Te.push({filename:a,size:s,obj:null}),t+=s);return t},we.startPreloads=function(){var e,t,r,n;for(e=0,t=Te.length;e<t;++e)r=Te[e],n=this.runtime.files_subfolder+r.filename,r.obj=this.getAudioBuffer(n,!1)},we.getPreloadedSize=function(){var e=0,t,r,n;for(t=0,r=Te.length;t<r;++t)n=Te[t],n.obj.isLoadedAndDecoded()||n.obj.hasFailedToLoad()||this.runtime.isDomFree||this.runtime.isAndroidStockBrowser?e+=n.size:n.obj.isLoaded()&&(e+=Math.floor(n.size/2));return e},we.releaseAllMusicBuffers=function(){var e,t,r,n;for(e=0,r=0,t=$.length;e<t;++e)n=$[e],$[r]=n,n.is_music?n.release():++r;$.length=r},we.getAudioBuffer=function(e,t,r){var n=null,o,s,l;for(o=0,s=$.length;o<s;o++)if(l=$[o],l.src===e){n=l;break}return n||r||(fe&&t&&this.releaseAllMusicBuffers(),n=new I(e,t),$.push(n)),n},we.getAudioInstance=function(e,t,r,n,o){var s,l,p;for(s=0,l=ee.length;s<l;s++)if(p=ee[s],p.src===e&&(p.canBeRecycled()||r))return p.tag=t,p;var d=this.getAudioBuffer(e,r);return d.bufferObject?(p=new k(d,t),ee.push(p),p):("<preload>"!==t&&(d.playTagWhenReady=t,d.loopWhenReady=n,d.volumeWhenReady=o),null)};var Ce=[];N.prototype.OnEnded=function(e){return cr.equals_nocase(U,e)},N.prototype.PreloadsComplete=function(){var e,t;for(e=0,t=$.length;e<t;e++)if(!$[e].isLoadedAndDecoded()&&!$[e].hasFailedToLoad())return!1;return!0},N.prototype.AdvancedAudioSupported=function(){return Z===Y},N.prototype.IsSilent=function(){return oe},N.prototype.IsAnyPlaying=function(){var e,t;for(e=0,t=ee.length;e<t;e++)if(ee[e].isPlaying())return!0;return!1},N.prototype.IsTagPlaying=function(e){R(e);var t,r;for(t=0,r=Ce.length;t<r;t++)if(Ce[t].isPlaying())return!0;return!1},W.cnds=new N;D.prototype.Play=function(e,t,r,n){if(!oe){var a=o(r),i=e[1],s=this.runtime.files_subfolder+e[0]+(re?".ogg":".m4a");te=this.getAudioInstance(s,n,i,0!==t,a),te&&(te.setPannerEnabled(!1),te.play(0!==t,a,0,this.nextPlayTime),this.nextPlayTime=0)}},D.prototype.PlayAtPosition=function(e,t,r,n,a,i,s,l,p,d){if(!oe){var c=o(r),u=e[1],g=this.runtime.files_subfolder+e[0]+(re?".ogg":".m4a");if(te=this.getAudioInstance(g,d,u,0!==t,c),!te){var y=this.getAudioBuffer(g,u);return void y.panWhenReady.push({x:n,y:a,a:i,ia:s,oa:l,og:o(p),thistag:d})}te.setPannerEnabled(!0),te.setPan(n,a,i,s,l,o(p)),te.play(0!==t,c,0,this.nextPlayTime),this.nextPlayTime=0}},D.prototype.PlayAtObject=function(e,t,r,n,a,i,s,l){if(!oe&&n){var p=n.getFirstPicked();if(p){var d=o(r),c=e[1],u=this.runtime.files_subfolder+e[0]+(re?".ogg":".m4a");if(te=this.getAudioInstance(u,l,c,0!==t,d),!te){var g=this.getAudioBuffer(u,c);return void g.panWhenReady.push({obj:p,ia:a,oa:i,og:o(s),thistag:l})}te.setPannerEnabled(!0);var y=cr.rotatePtAround(p.x,p.y,-p.layer.getAngle(),ie,se,!0),m=cr.rotatePtAround(p.x,p.y,-p.layer.getAngle(),ie,se,!1);te.setPan(y,m,cr.to_degrees(p.angle-p.layer.getAngle()),a,i,o(s)),te.setObject(p),te.play(0!==t,d,0,this.nextPlayTime),this.nextPlayTime=0}}},D.prototype.PlayByName=function(e,t,r,n,a){if(!oe){var i=o(n),s=this.runtime.files_subfolder+t.toLowerCase()+(re?".ogg":".m4a");te=this.getAudioInstance(s,a,1===e,0!==r,i),te&&(te.setPannerEnabled(!1),te.play(0!==r,i,0,this.nextPlayTime),this.nextPlayTime=0)}},D.prototype.PlayAtPositionByName=function(e,t,r,n,a,i,s,l,p,d,c){if(!oe){var u=o(n),g=1===e,y=this.runtime.files_subfolder+t.toLowerCase()+(re?".ogg":".m4a");if(te=this.getAudioInstance(y,c,g,0!==r,u),!te){var m=this.getAudioBuffer(y,g);return void m.panWhenReady.push({x:a,y:i,a:s,ia:l,oa:p,og:o(d),thistag:c})}te.setPannerEnabled(!0),te.setPan(a,i,s,l,p,o(d)),te.play(0!==r,u,0,this.nextPlayTime),this.nextPlayTime=0}},D.prototype.PlayAtObjectByName=function(e,t,r,n,a,i,s,l,p){if(!oe&&a){var d=a.getFirstPicked();if(d){var c=o(n),u=1===e,g=this.runtime.files_subfolder+t.toLowerCase()+(re?".ogg":".m4a");if(te=this.getAudioInstance(g,p,u,0!==r,c),!te){var y=this.getAudioBuffer(g,u);return void y.panWhenReady.push({obj:d,ia:i,oa:s,og:o(l),thistag:p})}te.setPannerEnabled(!0);var m=cr.rotatePtAround(d.x,d.y,-d.layer.getAngle(),ie,se,!0),_=cr.rotatePtAround(d.x,d.y,-d.layer.getAngle(),ie,se,!1);te.setPan(m,_,cr.to_degrees(d.angle-d.layer.getAngle()),i,s,o(l)),te.setObject(d),te.play(0!==r,c,0,this.nextPlayTime),this.nextPlayTime=0}}},D.prototype.SetLooping=function(e,t){R(e);var r,n;for(r=0,n=Ce.length;r<n;r++)Ce[r].setLooping(0===t)},D.prototype.SetMuted=function(e,t){R(e);var r,n;for(r=0,n=Ce.length;r<n;r++)Ce[r].setMuted(0===t)},D.prototype.SetVolume=function(e,t){R(e);var r=o(t),n,a;for(n=0,a=Ce.length;n<a;n++)Ce[n].setVolume(r)},D.prototype.Preload=function(e){if(!oe){var t=e[1],r=this.runtime.files_subfolder+e[0]+(re?".ogg":".m4a");return Z===J?void(this.runtime.isDirectCanvas?AppMobi.context.loadSound(r):AppMobi.player.loadSound(r)):void(Z===K||this.getAudioInstance(r,"<preload>",t,!1))}},D.prototype.PreloadByName=function(e,t){if(!oe){var r=this.runtime.files_subfolder+t.toLowerCase()+(re?".ogg":".m4a");return Z===J?void(this.runtime.isDirectCanvas?AppMobi.context.loadSound(r):AppMobi.player.loadSound(r)):void(Z===K||this.getAudioInstance(r,"<preload>",1===e,!1))}},D.prototype.SetPlaybackRate=function(e,t){R(e),0>t&&(t=0);var r,n;for(r=0,n=Ce.length;r<n;r++)Ce[r].setPlaybackRate(t)},D.prototype.Stop=function(e){R(e);var t,r;for(t=0,r=Ce.length;t<r;t++)Ce[t].stop()},D.prototype.StopAll=function(){var e,t;for(e=0,t=ee.length;e<t;e++)ee[e].stop()},D.prototype.SetPaused=function(e,t){R(e);var r,n;for(r=0,n=Ce.length;r<n;r++)0===t?Ce[r].pause():Ce[r].resume()},D.prototype.Seek=function(e,t){R(e);var r,n;for(r=0,n=Ce.length;r<n;r++)Ce[r].seek(t)},D.prototype.SetSilent=function(e){var t,r;if(2===e&&(e=oe?1:0),0===e&&!oe){for(t=0,r=ee.length;t<r;t++)ee[t].setSilent(!0);oe=!0}else if(1===e&&oe){for(t=0,r=ee.length;t<r;t++)ee[t].setSilent(!1);oe=!1}},D.prototype.SetMasterVolume=function(e){ae=o(e);var t,r;for(t=0,r=ee.length;t<r;t++)ee[t].updateVolume()},D.prototype.AddFilterEffect=function(e,t,r,n,o,a,i){Z!==Y||0>t||t>=ve.length||!Q.createBiquadFilter||(e=e.toLowerCase(),i/=100,0>i&&(i=0),1<i&&(i=1),F(e,new _(t,r,n,o,a,i)))},D.prototype.AddDelayEffect=function(e,t,r,n){Z!==Y||(e=e.toLowerCase(),n/=100,0>n&&(n=0),1<n&&(n=1),F(e,new h(t,o(r),n)))},D.prototype.AddFlangerEffect=function(e,t,r,n,o,a){Z===Y&&Q.createOscillator&&(e=e.toLowerCase(),a/=100,0>a&&(a=0),1<a&&(a=1),F(e,new x(t/1e3,r/1e3,n,o/100,a)))},D.prototype.AddPhaserEffect=function(e,t,r,n,o,a,i){Z===Y&&Q.createOscillator&&(e=e.toLowerCase(),i/=100,0>i&&(i=0),1<i&&(i=1),F(e,new v(t,r,n,o,a,i)))},D.prototype.AddConvolutionEffect=function(e,t,r,n){if(Z===Y&&Q.createConvolver){var o=0===r,a=this.runtime.files_subfolder+t[0]+(re?".ogg":".m4a"),i=this.getAudioBuffer(a,!1);e=e.toLowerCase(),n/=100,0>n&&(n=0),1<n&&(n=1);var s;i.bufferObject?s=new f(i.bufferObject,o,n,a):(s=new f(null,o,n,a),i.normalizeWhenReady=o,i.convolveWhenReady=s),F(e,s)}},D.prototype.AddGainEffect=function(e,t){Z!==Y||(e=e.toLowerCase(),F(e,new w(o(t))))},D.prototype.AddMuteEffect=function(e){Z!==Y||(e=e.toLowerCase(),F(e,new w(0)))},D.prototype.AddTremoloEffect=function(e,t,r){Z===Y&&Q.createOscillator&&(e=e.toLowerCase(),r/=100,0>r&&(r=0),1<r&&(r=1),F(e,new S(t,r)))},D.prototype.AddRingModEffect=function(e,t,r){Z===Y&&Q.createOscillator&&(e=e.toLowerCase(),r/=100,0>r&&(r=0),1<r&&(r=1),F(e,new T(t,r)))},D.prototype.AddDistortionEffect=function(e,t,r,n,o,a){Z===Y&&Q.createWaveShaper&&(e=e.toLowerCase(),a/=100,0>a&&(a=0),1<a&&(a=1),F(e,new C(t,r,n,o,a)))},D.prototype.AddCompressorEffect=function(e,t,r,n,o,a){Z===Y&&Q.createDynamicsCompressor&&(e=e.toLowerCase(),F(e,new A(t,r,n,o/1e3,a/1e3)))},D.prototype.AddAnalyserEffect=function(e,t,r){Z!==Y||(e=e.toLowerCase(),F(e,new E(t,r)))},D.prototype.RemoveEffects=function(e){if(Z===Y){e=e.toLowerCase();var t,r,n;if(xe.hasOwnProperty(e)&&(n=xe[e],n.length)){for(t=0,r=n.length;t<r;t++)n[t].remove();cr.clearArray(n),B(e)}}},D.prototype.SetEffectParameter=function(e,t,r,n,o,a){if(Z===Y){e=e.toLowerCase(),t=Math.floor(t);var i;xe.hasOwnProperty(e)&&(i=xe[e],0>t||t>=i.length||i[t].setParam(r,n,o,a))}},D.prototype.SetListenerObject=function(e){if(e&&Z===Y){var t=e.getFirstPicked();t&&(this.listenerTracker.setObject(t),ie=t.x,se=t.y)}},D.prototype.SetListenerZ=function(e){this.listenerZ=e},D.prototype.ScheduleNextPlay=function(e){Q&&(this.nextPlayTime=e)},D.prototype.UnloadAudio=function(e){var t=e[1],r=this.runtime.files_subfolder+e[0]+(re?".ogg":".m4a"),n=this.getAudioBuffer(r,t,!0);n&&(n.release(),cr.arrayFindRemove($,n))},D.prototype.UnloadAudioByName=function(e,t){var r=this.runtime.files_subfolder+t.toLowerCase()+(re?".ogg":".m4a"),n=this.getAudioBuffer(r,1===e,!0);n&&(n.release(),cr.arrayFindRemove($,n))},D.prototype.UnloadAll=function(){var e,t;for(e=0,t=$.length;e<t;++e)$[e].release();cr.clearArray($)},W.acts=new D;j.prototype.Duration=function(e,t){R(t,!0),Ce.length?e.set_float(Ce[0].getDuration()):e.set_float(0)},j.prototype.PlaybackTime=function(e,t){R(t,!0),Ce.length?e.set_float(Ce[0].getPlaybackTime(!0)):e.set_float(0)},j.prototype.Volume=function(e,t){if(R(t,!0),Ce.length){var r=Ce[0].getVolume();e.set_float(a(r))}else e.set_float(0)},j.prototype.MasterVolume=function(e){e.set_float(a(ae))},j.prototype.EffectCount=function(e,t){t=t.toLowerCase();var r=null;xe.hasOwnProperty(t)&&(r=xe[t]),e.set_int(r?r.length:0)};j.prototype.AnalyserFreqBinCount=function(e,t,r){t=t.toLowerCase(),r=Math.floor(r);var n=M(t,r);e.set_int(n?n.node.frequencyBinCount:0)},j.prototype.AnalyserFreqBinAt=function(e,t,r,n){t=t.toLowerCase(),r=Math.floor(r),n=Math.floor(n);var o=M(t,r);o?0>n||n>=o.node.frequencyBinCount?e.set_float(0):e.set_float(o.freqBins[n]):e.set_float(0)},j.prototype.AnalyserPeakLevel=function(e,t,r){t=t.toLowerCase(),r=Math.floor(r);var n=M(t,r);n?e.set_float(n.peak):e.set_float(0)},j.prototype.AnalyserRMSLevel=function(e,t,r){t=t.toLowerCase(),r=Math.floor(r);var n=M(t,r);n?e.set_float(n.rms):e.set_float(0)},j.prototype.SampleRate=function(e){e.set_int(Q?Q.sampleRate:0)},j.prototype.CurrentTime=function(e){e.set_float(Q?Q.currentTime:cr.performance_now())},W.exps=new j}();cr.plugins_.Browser=function(e){this.runtime=e},function(){function checkReady(){offlineScriptReady&&browserPluginReady&&window.OfflineClientInfo&&window.OfflineClientInfo.SetMessageCallback(function(t){browserInstance.onSWMessage(t)})}function maybeLoadBatteryManager(){if(!loadedBatteryManager&&navigator.getBattery){var e=navigator.getBattery();loadedBatteryManager=!0,e&&e.then(function(e){batteryManager=e})}}function Cnds(){}function Acts(){}function onFullscreenError(t){console&&console.warn&&console.warn("Fullscreen request failed: ",t),crruntime.setSize(window.innerWidth,window.innerHeight)}function Exps(){}var pluginProto=cr.plugins_.Browser.prototype;pluginProto.Type=function(e){this.plugin=e,this.runtime=e.runtime};var typeProto=pluginProto.Type.prototype;typeProto.onCreate=function(){};var offlineScriptReady=!1,browserPluginReady=!1;document.addEventListener("DOMContentLoaded",function(){if(window.C2_RegisterSW&&navigator.serviceWorker){var e=document.createElement("script");e.onload=function(){offlineScriptReady=!0,checkReady()},e.src="offlineClient.js",document.head.appendChild(e)}});var browserInstance=null;typeProto.onAppBegin=function(){browserPluginReady=!0,checkReady()};pluginProto.Instance=function(e){this.type=e,this.runtime=e.runtime};var instanceProto=pluginProto.Instance.prototype;instanceProto.onCreate=function(){var t=this;window.addEventListener("resize",function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnResize,t)}),browserInstance=this,"undefined"!=typeof navigator.onLine&&(window.addEventListener("online",function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOnline,t)}),window.addEventListener("offline",function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOffline,t)})),this.runtime.isDirectCanvas||(document.addEventListener("appMobi.device.update.available",function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,t)}),document.addEventListener("backbutton",function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,t)}),document.addEventListener("menubutton",function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,t)}),document.addEventListener("searchbutton",function(){t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnSearchButton,t)}),document.addEventListener("tizenhwkey",function(r){var e;switch(r.keyName){case"back":e=t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,t),!e&&window.tizen&&window.tizen.application.getCurrentApplication().exit();break;case"menu":e=t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnMenuButton,t),e||r.preventDefault();}})),this.runtime.isWindows10&&"undefined"!=typeof Windows?Windows.UI.Core.SystemNavigationManager.getForCurrentView().addEventListener("backrequested",function(r){var e=t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,t);e&&(r.handled=!0)}):this.runtime.isWinJS&&WinJS.Application&&(WinJS.Application.onbackclick=function(){return!!t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnBackButton,t)}),this.runtime.addSuspendCallback(function(e){e?t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageHidden,t):t.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnPageVisible,t)}),this.is_arcade="undefined"!=typeof window.is_scirra_arcade},instanceProto.onSWMessage=function(t){var e=t.data.type;"downloading-update"===e?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateFound,this):"update-ready"===e||"update-pending"===e?this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnUpdateReady,this):"offline-ready"===e&&this.runtime.trigger(cr.plugins_.Browser.prototype.cnds.OnOfflineReady,this)};var batteryManager=null,loadedBatteryManager=!1;Cnds.prototype.CookiesEnabled=function(){return!!navigator&&navigator.cookieEnabled},Cnds.prototype.IsOnline=function(){return!!navigator&&navigator.onLine},Cnds.prototype.HasJava=function(){return!!navigator&&navigator.javaEnabled()},Cnds.prototype.OnOnline=function(){return!0},Cnds.prototype.OnOffline=function(){return!0},Cnds.prototype.IsDownloadingUpdate=function(){return!1},Cnds.prototype.OnUpdateReady=function(){return!0},Cnds.prototype.PageVisible=function(){return!this.runtime.isSuspended},Cnds.prototype.OnPageVisible=function(){return!0},Cnds.prototype.OnPageHidden=function(){return!0},Cnds.prototype.OnResize=function(){return!0},Cnds.prototype.IsFullscreen=function(){return!!(document.mozFullScreen||document.webkitIsFullScreen||document.fullScreen||this.runtime.isNodeFullscreen)},Cnds.prototype.OnBackButton=function(){return!0},Cnds.prototype.OnMenuButton=function(){return!0},Cnds.prototype.OnSearchButton=function(){return!0},Cnds.prototype.IsMetered=function(){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return!!e&&!!e.metered},Cnds.prototype.IsCharging=function(){var e=navigator.battery||navigator.mozBattery||navigator.webkitBattery;return e?!!e.charging:(maybeLoadBatteryManager(),!batteryManager||!!batteryManager.charging)},Cnds.prototype.IsPortraitLandscape=function(e){var t=window.innerWidth<=window.innerHeight?0:1;return t===e},Cnds.prototype.SupportsFullscreen=function(){if(this.runtime.isNodeWebkit)return!0;var e=this.runtime.canvasdiv||this.runtime.canvas;return!!(e.requestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen||e.webkitRequestFullScreen)},Cnds.prototype.OnUpdateFound=function(){return!0},Cnds.prototype.OnUpdateReady=function(){return!0},Cnds.prototype.OnOfflineReady=function(){return!0},pluginProto.cnds=new Cnds;Acts.prototype.Alert=function(e){this.runtime.isDomFree||alert(e.toString())},Acts.prototype.Close=function(){this.runtime.isCocoonJs?CocoonJS.App.forceToFinish():window.tizen?window.tizen.application.getCurrentApplication().exit():navigator.app&&navigator.app.exitApp?navigator.app.exitApp():navigator.device&&navigator.device.exitApp?navigator.device.exitApp():!this.is_arcade&&!this.runtime.isDomFree&&window.close()},Acts.prototype.Focus=function(){if(this.runtime.isNodeWebkit){var e=window.nwgui.Window.get();e.focus()}else this.is_arcade||this.runtime.isDomFree||window.focus()},Acts.prototype.Blur=function(){if(this.runtime.isNodeWebkit){var e=window.nwgui.Window.get();e.blur()}else this.is_arcade||this.runtime.isDomFree||window.blur()},Acts.prototype.GoBack=function(){navigator.app&&navigator.app.backHistory?navigator.app.backHistory():!this.is_arcade&&!this.runtime.isDomFree&&window.back&&window.back()},Acts.prototype.GoForward=function(){this.is_arcade||this.runtime.isDomFree||!window.forward||window.forward()},Acts.prototype.GoHome=function(){this.is_arcade||this.runtime.isDomFree||!window.home||window.home()},Acts.prototype.GoToURL=function(e,t){this.runtime.isCocoonJs?CocoonJS.App.openURL(e):this.runtime.isEjecta?ejecta.openURL(e):this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(e)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(e,{openExternal:!0}):self.cordova&&self.cordova.InAppBrowser?self.cordova.InAppBrowser.open(e,"_system"):!this.is_arcade&&!this.runtime.isDomFree&&(2!==t||this.is_arcade?1!==t||this.is_arcade?window.location=e:window.parent.location=e:window.top.location=e)},Acts.prototype.GoToURLWindow=function(e,t){this.runtime.isCocoonJs?CocoonJS.App.openURL(e):this.runtime.isEjecta?ejecta.openURL(e):this.runtime.isWinJS?Windows.System.Launcher.launchUriAsync(new Windows.Foundation.Uri(e)):navigator.app&&navigator.app.loadUrl?navigator.app.loadUrl(e,{openExternal:!0}):self.cordova&&self.cordova.InAppBrowser?self.cordova.InAppBrowser.open(e,"_system"):!this.is_arcade&&!this.runtime.isDomFree&&window.open(e,t)},Acts.prototype.Reload=function(){this.is_arcade||this.runtime.isDomFree||window.location.reload()};var firstRequestFullscreen=!0,crruntime=null;Acts.prototype.RequestFullScreen=function(e){if(this.runtime.isDomFree)return void cr.logexport("[Construct 2] Requesting fullscreen is not supported on this platform - the request has been ignored");if(2<=e&&(e+=1),6===e&&(e=2),this.runtime.isNodeWebkit)this.runtime.isDebug?debuggerFullscreen(!0):!this.runtime.isNodeFullscreen&&window.nwgui&&(window.nwgui.Window.get().enterFullscreen(),this.runtime.isNodeFullscreen=!0,this.runtime.fullscreen_scaling=2<=e?e:0);else{if(document.mozFullScreen||document.webkitIsFullScreen||!!document.msFullscreenElement||document.fullScreen||document.fullScreenElement)return;this.runtime.fullscreen_scaling=2<=e?e:0;var t=document.documentElement;firstRequestFullscreen&&(firstRequestFullscreen=!1,crruntime=this.runtime,t.addEventListener("mozfullscreenerror",onFullscreenError),t.addEventListener("webkitfullscreenerror",onFullscreenError),t.addEventListener("MSFullscreenError",onFullscreenError),t.addEventListener("fullscreenerror",onFullscreenError)),t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen?t.msRequestFullscreen():t.webkitRequestFullScreen&&("undefined"!=typeof Element&&"undefined"!=typeof Element.ALLOW_KEYBOARD_INPUT?t.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):t.webkitRequestFullScreen())}},Acts.prototype.CancelFullScreen=function(){return this.runtime.isDomFree?void cr.logexport("[Construct 2] Exiting fullscreen is not supported on this platform - the request has been ignored"):void(this.runtime.isNodeWebkit?this.runtime.isDebug?debuggerFullscreen(!1):this.runtime.isNodeFullscreen&&window.nwgui&&(window.nwgui.Window.get().leaveFullscreen(),this.runtime.isNodeFullscreen=!1):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen())},Acts.prototype.Vibrate=function(e){try{var t=e.split(","),r,n;for(r=0,n=t.length;r<n;r++)t[r]=parseInt(t[r],10);navigator.vibrate?navigator.vibrate(t):navigator.mozVibrate?navigator.mozVibrate(t):navigator.webkitVibrate?navigator.webkitVibrate(t):navigator.msVibrate&&navigator.msVibrate(t)}catch(t){}},Acts.prototype.InvokeDownload=function(e,t){var r=document.createElement("a");if("undefined"==typeof r.download)window.open(e);else{var n=document.getElementsByTagName("body")[0];r.textContent=t,r.href=e,r.download=t,n.appendChild(r);var o=new MouseEvent("click");r.dispatchEvent(o),n.removeChild(r)}},Acts.prototype.InvokeDownloadString=function(e,t,r){var n="data:"+t+","+encodeURIComponent(e),o=document.createElement("a");if("undefined"==typeof o.download)window.open(n);else{var a=document.getElementsByTagName("body")[0];o.textContent=r,o.href=n,o.download=r,a.appendChild(o);var i=new MouseEvent("click");o.dispatchEvent(i),a.removeChild(o)}},Acts.prototype.ConsoleLog=function(e,t){"undefined"==typeof console||(0===e&&console.log&&console.log(t.toString()),1===e&&console.warn&&console.warn(t.toString()),2===e&&console.error&&console.error(t.toString()))},Acts.prototype.ConsoleGroup=function(e){console&&console.group&&console.group(e)},Acts.prototype.ConsoleGroupEnd=function(){console&&console.groupEnd&&console.groupEnd()},Acts.prototype.ExecJs=function(js_){try{eval&&eval(js_)}catch(t){console&&console.error&&console.error("Error executing Javascript: ",t)}};var orientations=["portrait","landscape","portrait-primary","portrait-secondary","landscape-primary","landscape-secondary"];Acts.prototype.LockOrientation=function(e){if(e=Math.floor(e),!(0>e||e>=orientations.length)){this.runtime.autoLockOrientation=!1;var t=orientations[e];screen.orientation&&screen.orientation.lock?screen.orientation.lock(t):screen.lockOrientation?screen.lockOrientation(t):screen.webkitLockOrientation?screen.webkitLockOrientation(t):screen.mozLockOrientation?screen.mozLockOrientation(t):screen.msLockOrientation&&screen.msLockOrientation(t)}},Acts.prototype.UnlockOrientation=function(){this.runtime.autoLockOrientation=!1,screen.orientation&&screen.orientation.unlock?screen.orientation.unlock():screen.unlockOrientation?screen.unlockOrientation():screen.webkitUnlockOrientation?screen.webkitUnlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()},pluginProto.acts=new Acts;Exps.prototype.URL=function(e){e.set_string(this.runtime.isDomFree?"":window.location.toString())},Exps.prototype.Protocol=function(e){e.set_string(this.runtime.isDomFree?"":window.location.protocol)},Exps.prototype.Domain=function(e){e.set_string(this.runtime.isDomFree?"":window.location.hostname)},Exps.prototype.PathName=function(e){e.set_string(this.runtime.isDomFree?"":window.location.pathname)},Exps.prototype.Hash=function(e){e.set_string(this.runtime.isDomFree?"":window.location.hash)},Exps.prototype.Referrer=function(e){e.set_string(this.runtime.isDomFree?"":document.referrer)},Exps.prototype.Title=function(e){e.set_string(this.runtime.isDomFree?"":document.title)},Exps.prototype.Name=function(e){e.set_string(this.runtime.isDomFree?"":navigator.appName)},Exps.prototype.Version=function(e){e.set_string(this.runtime.isDomFree?"":navigator.appVersion)},Exps.prototype.Language=function(e){navigator&&navigator.language?e.set_string(navigator.language):e.set_string("")},Exps.prototype.Platform=function(e){e.set_string(this.runtime.isDomFree?"":navigator.platform)},Exps.prototype.Product=function(e){navigator&&navigator.product?e.set_string(navigator.product):e.set_string("")},Exps.prototype.Vendor=function(e){navigator&&navigator.vendor?e.set_string(navigator.vendor):e.set_string("")},Exps.prototype.UserAgent=function(e){e.set_string(this.runtime.isDomFree?"":navigator.userAgent)},Exps.prototype.QueryString=function(e){e.set_string(this.runtime.isDomFree?"":window.location.search)},Exps.prototype.QueryParam=function(e,t){if(this.runtime.isDomFree)return void e.set_string("");var r=RegExp("[?&]"+t+"=([^&]*)").exec(window.location.search);r?e.set_string(decodeURIComponent(r[1].replace(/\+/g," "))):e.set_string("")},Exps.prototype.Bandwidth=function(e){var t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;t?"undefined"==typeof t.bandwidth?"undefined"==typeof t.downlinkMax?e.set_float(Number.POSITIVE_INFINITY):e.set_float(t.downlinkMax):e.set_float(t.bandwidth):e.set_float(Number.POSITIVE_INFINITY)},Exps.prototype.ConnectionType=function(e){var t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;t?e.set_string(t.type||"unknown"):e.set_string("unknown")},Exps.prototype.BatteryLevel=function(e){var t=navigator.battery||navigator.mozBattery||navigator.webkitBattery;t?e.set_float(t.level):(maybeLoadBatteryManager(),batteryManager?e.set_float(batteryManager.level):e.set_float(1))},Exps.prototype.BatteryTimeLeft=function(e){var t=navigator.battery||navigator.mozBattery||navigator.webkitBattery;t?e.set_float(t.dischargingTime):(maybeLoadBatteryManager(),batteryManager?e.set_float(batteryManager.dischargingTime):e.set_float(Number.POSITIVE_INFINITY))},Exps.prototype.ExecJS=function(ret,js_){if(!eval)return void ret.set_any(0);var result=0;try{result=eval(js_)}catch(t){console&&console.error&&console.error("Error executing Javascript: ",t)}"number"==typeof result?ret.set_any(result):"string"==typeof result?ret.set_any(result):"boolean"==typeof result?ret.set_any(result?1:0):ret.set_any(0)},Exps.prototype.ScreenWidth=function(e){e.set_int(screen.width)},Exps.prototype.ScreenHeight=function(e){e.set_int(screen.height)},Exps.prototype.DevicePixelRatio=function(e){e.set_float(this.runtime.devicePixelRatio)},Exps.prototype.WindowInnerWidth=function(e){e.set_int(window.innerWidth)},Exps.prototype.WindowInnerHeight=function(e){e.set_int(window.innerHeight)},Exps.prototype.WindowOuterWidth=function(e){e.set_int(window.outerWidth)},Exps.prototype.WindowOuterHeight=function(e){e.set_int(window.outerHeight)},pluginProto.exps=new Exps}();cr.plugins_.Button=function(e){this.runtime=e},function(){function e(){}function t(){}var r=cr.plugins_.Button.prototype;r.Type=function(e){this.plugin=e,this.runtime=e.runtime};var n=r.Type.prototype;n.onCreate=function(){},r.Instance=function(e){this.type=e,this.runtime=e.runtime};var o=r.Instance.prototype;o.onCreate=function(){return this.runtime.isDomFree?void cr.logexport("[Construct 2] Button plugin not supported on this platform - the object will not be created"):void(this.isCheckbox=1===this.properties[0],this.inputElem=document.createElement("input"),this.elem=this.isCheckbox?document.createElement("label"):this.inputElem,this.labelText=null,this.inputElem.type=this.isCheckbox?"checkbox":"button",this.inputElem.id=this.properties[6],jQuery(this.elem).appendTo(this.runtime.canvasdiv?this.runtime.canvasdiv:"body"),this.isCheckbox?(jQuery(this.inputElem).appendTo(this.elem),this.labelText=document.createTextNode(this.properties[1]),jQuery(this.elem).append(this.labelText),this.inputElem.checked=0!==this.properties[7],jQuery(this.elem).css("font-family","sans-serif"),jQuery(this.elem).css("display","inline-block"),jQuery(this.elem).css("color","black")):this.inputElem.value=this.properties[1],this.elem.title=this.properties[2],this.inputElem.disabled=0===this.properties[4],this.autoFontSize=0!==this.properties[5],this.element_hidden=!1,0===this.properties[3]&&(jQuery(this.elem).hide(),this.visible=!1,this.element_hidden=!0),this.inputElem.onclick=function(t){return function(r){r.stopPropagation(),t.runtime.isInUserInputEvent=!0,t.runtime.trigger(cr.plugins_.Button.prototype.cnds.OnClicked,t),t.runtime.isInUserInputEvent=!1}}(this),this.elem.addEventListener("touchstart",function(t){t.stopPropagation()},!1),this.elem.addEventListener("touchmove",function(t){t.stopPropagation()},!1),this.elem.addEventListener("touchend",function(t){t.stopPropagation()},!1),jQuery(this.elem).mousedown(function(t){t.stopPropagation()}),jQuery(this.elem).mouseup(function(t){t.stopPropagation()}),jQuery(this.elem).keydown(function(t){t.stopPropagation()}),jQuery(this.elem).keyup(function(t){t.stopPropagation()}),this.lastLeft=0,this.lastTop=0,this.lastRight=0,this.lastBottom=0,this.lastWinWidth=0,this.lastWinHeight=0,this.updatePosition(!0),this.runtime.tickMe(this))},o.saveToJSON=function(){var e={tooltip:this.elem.title,disabled:!!this.inputElem.disabled};return this.isCheckbox?(e.checked=!!this.inputElem.checked,e.text=this.labelText.nodeValue):e.text=this.elem.value,e},o.loadFromJSON=function(e){this.elem.title=e.tooltip,this.inputElem.disabled=e.disabled,this.isCheckbox?(this.inputElem.checked=e.checked,this.labelText.nodeValue=e.text):this.elem.value=e.text},o.onDestroy=function(){this.runtime.isDomFree||(jQuery(this.elem).remove(),this.elem=null)},o.tick=function(){this.updatePosition()};o.updatePosition=function(e){if(!this.runtime.isDomFree){var t=this.layer.layerToCanvas(this.x,this.y,!0),r=this.layer.layerToCanvas(this.x,this.y,!1),n=this.layer.layerToCanvas(this.x+this.width,this.y+this.height,!0),o=this.layer.layerToCanvas(this.x+this.width,this.y+this.height,!1),a=this.runtime.width/this.runtime.devicePixelRatio,i=this.runtime.height/this.runtime.devicePixelRatio;if(!this.visible||!this.layer.visible||0>=n||0>=o||t>=a||r>=i)return this.element_hidden||jQuery(this.elem).hide(),void(this.element_hidden=!0);1>t&&(t=1),1>r&&(r=1),n>=a&&(n=a-1),o>=i&&(o=i-1);var s=window.innerWidth,l=window.innerHeight;if(!e&&this.lastLeft===t&&this.lastTop===r&&this.lastRight===n&&this.lastBottom===o&&this.lastWinWidth===s&&this.lastWinHeight===l)return void(this.element_hidden&&(jQuery(this.elem).show(),this.element_hidden=!1));this.lastLeft=t,this.lastTop=r,this.lastRight=n,this.lastBottom=o,this.lastWinWidth=s,this.lastWinHeight=l,this.element_hidden&&(jQuery(this.elem).show(),this.element_hidden=!1);var p=Math.round(t)+jQuery(this.runtime.canvas).offset().left,d=Math.round(r)+jQuery(this.runtime.canvas).offset().top;jQuery(this.elem).css("position","absolute"),jQuery(this.elem).offset({left:p,top:d}),jQuery(this.elem).width(Math.round(n-t)),jQuery(this.elem).height(Math.round(o-r)),this.autoFontSize&&jQuery(this.elem).css("font-size",this.layer.getScale(!0)/this.runtime.devicePixelRatio-.2+"em")}},o.draw=function(){},o.drawGL=function(){};e.prototype.OnClicked=function(){return!0},e.prototype.IsChecked=function(){return this.isCheckbox&&this.inputElem.checked},r.cnds=new e;t.prototype.SetText=function(e){this.runtime.isDomFree||(this.isCheckbox?this.labelText.nodeValue=e:this.elem.value=e)},t.prototype.SetTooltip=function(e){this.runtime.isDomFree||(this.elem.title=e)},t.prototype.SetVisible=function(e){this.runtime.isDomFree||(this.visible=0!==e)},t.prototype.SetEnabled=function(e){this.runtime.isDomFree||(this.inputElem.disabled=0===e)},t.prototype.SetFocus=function(){this.runtime.isDomFree||this.inputElem.focus()},t.prototype.SetBlur=function(){this.runtime.isDomFree||this.inputElem.blur()},t.prototype.SetCSSStyle=function(e,t){this.runtime.isDomFree||jQuery(this.elem).css(e,t)},t.prototype.SetChecked=function(e){this.runtime.isDomFree||!this.isCheckbox||(this.inputElem.checked=1===e)},t.prototype.ToggleChecked=function(){this.runtime.isDomFree||!this.isCheckbox||(this.inputElem.checked=!this.inputElem.checked)},r.acts=new t;r.exps=new function(){}}();cr.plugins_.Dictionary=function(e){this.runtime=e},function(){function e(){}function t(){}function r(){}var n=cr.plugins_.Dictionary.prototype;n.Type=function(e){this.plugin=e,this.runtime=e.runtime};var o=n.Type.prototype;o.onCreate=function(){},n.Instance=function(e){this.type=e,this.runtime=e.runtime};var a=n.Instance.prototype;a.onCreate=function(){this.dictionary={},this.cur_key="",this.key_count=0},a.saveToJSON=function(){return this.dictionary},a.loadFromJSON=function(e){for(var t in this.dictionary=e,this.key_count=0,this.dictionary)this.dictionary.hasOwnProperty(t)&&this.key_count++};e.prototype.CompareValue=function(e,t,r){return cr.do_cmp(this.dictionary[e],t,r)},e.prototype.ForEachKey=function(){var e=this.runtime.getCurrentEventStack().current_event;for(var t in this.dictionary)this.dictionary.hasOwnProperty(t)&&(this.cur_key=t,this.runtime.pushCopySol(e.solModifiers),e.retrigger(),this.runtime.popSol(e.solModifiers));return this.cur_key="",!1},e.prototype.CompareCurrentValue=function(e,t){return cr.do_cmp(this.dictionary[this.cur_key],e,t)},e.prototype.HasKey=function(e){return this.dictionary.hasOwnProperty(e)},e.prototype.IsEmpty=function(){return 0===this.key_count},n.cnds=new e;t.prototype.AddKey=function(e,t){this.dictionary.hasOwnProperty(e)||this.key_count++,this.dictionary[e]=t},t.prototype.SetKey=function(e,t){this.dictionary.hasOwnProperty(e)&&(this.dictionary[e]=t)},t.prototype.DeleteKey=function(e){this.dictionary.hasOwnProperty(e)&&(delete this.dictionary[e],this.key_count--)},t.prototype.Clear=function(){cr.wipe(this.dictionary),this.key_count=0},t.prototype.JSONLoad=function(e){var t;try{t=JSON.parse(e)}catch(t){return}if(t.c2dictionary)for(var r in this.dictionary=t.data,this.key_count=0,this.dictionary)this.dictionary.hasOwnProperty(r)&&this.key_count++},t.prototype.JSONDownload=function(e){var t=document.createElement("a");if("undefined"==typeof t.download){var r="data:text/html,"+encodeURIComponent("<p><a download='data.json' href=\"data:application/json,"+encodeURIComponent(JSON.stringify({c2dictionary:!0,data:this.dictionary}))+"\">Download link</a></p>");window.open(r)}else{var n=document.getElementsByTagName("body")[0];t.textContent=e,t.href="data:application/json,"+encodeURIComponent(JSON.stringify({c2dictionary:!0,data:this.dictionary})),t.download=e,n.appendChild(t);var o=document.createEvent("MouseEvent");o.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),t.dispatchEvent(o),n.removeChild(t)}},n.acts=new t;r.prototype.Get=function(e,t){this.dictionary.hasOwnProperty(t)?e.set_any(this.dictionary[t]):e.set_int(0)},r.prototype.KeyCount=function(e){e.set_int(this.key_count)},r.prototype.CurrentKey=function(e){e.set_string(this.cur_key)},r.prototype.CurrentValue=function(e){this.dictionary.hasOwnProperty(this.cur_key)?e.set_any(this.dictionary[this.cur_key]):e.set_int(0)},r.prototype.AsJSON=function(e){e.set_string(JSON.stringify({c2dictionary:!0,data:this.dictionary}))},n.exps=new r}();cr.plugins_.Function=function(e){this.runtime=e},function(){function e(){this.name="",this.retVal=0,this.params=[]}function t(){return u++,u===c.length&&c.push(new e),c[u]}function r(){return 0>u?null:c[u]}function n(){if(!c.length)return null;var e=u+1;return e>=c.length&&(e=c.length-1),c[e]}function o(){u--}function a(){}function i(){}function s(){}var l=cr.plugins_.Function.prototype;l.Type=function(e){this.plugin=e,this.runtime=e.runtime};var p=l.Type.prototype;p.onCreate=function(){},l.Instance=function(e){this.type=e,this.runtime=e.runtime};var d=l.Instance.prototype,c=[],u=-1,g=!1;d.onCreate=function(){g="undefined"!=typeof cr_is_preview;var e=this;window.c2_callFunction=function(r,n){var a=t(),s,l,p;if(a.name=r.toLowerCase(),a.retVal=0,n)for(a.params.length=n.length,s=0,l=n.length;s<l;++s)p=n[s],a.params[s]="number"==typeof p||"string"==typeof p?p:"boolean"==typeof p?p?1:0:0;else cr.clearArray(a.params);return e.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,e,a.name),o(),a.retVal}};a.prototype.OnFunction=function(e){var t=r();return!!t&&cr.equals_nocase(e,t.name)},a.prototype.CompareParam=function(e,t,n){var o=r();return!!o&&(e=cr.floor(e),!(0>e||e>=o.params.length)&&cr.do_cmp(o.params[e],t,n))},l.cnds=new a;i.prototype.CallFunction=function(e,r){var n=t();n.name=e.toLowerCase(),n.retVal=0,cr.shallowAssignArray(n.params,r);var a=this.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,this,n.name);if(g&&!a);o()},i.prototype.SetReturnValue=function(e){var t=r();if(t)t.retVal=e;else;},i.prototype.CallExpression=function(){},l.acts=new i;s.prototype.ReturnValue=function(e){var t=n();t?e.set_any(t.retVal):e.set_int(0)},s.prototype.ParamCount=function(e){var t=r();t?e.set_int(t.params.length):e.set_int(0)},s.prototype.Param=function(e,t){t=cr.floor(t);var n=r();n?0<=t&&t<n.params.length?e.set_any(n.params[t]):e.set_int(0):e.set_int(0)},s.prototype.Call=function(e,r){var n=t();n.name=r.toLowerCase(),n.retVal=0,cr.clearArray(n.params);var a,s;for(a=2,s=arguments.length;a<s;a++)n.params.push(arguments[a]);var l=this.runtime.trigger(cr.plugins_.Function.prototype.cnds.OnFunction,this,n.name);if(g&&!l);o(),e.set_any(n.retVal)},l.exps=new s}();cr.plugins_.Keyboard=function(e){this.runtime=e},function(){function e(){}function t(){}function r(e){return e=Math.floor(e),8===e?"backspace":9===e?"tab":13===e?"enter":16===e?"shift":17===e?"control":18===e?"alt":19===e?"pause":20===e?"capslock":27===e?"esc":33===e?"pageup":34===e?"pagedown":35===e?"end":36===e?"home":37===e?"\u2190":38===e?"\u2191":39===e?"\u2192":40===e?"\u2193":45===e?"insert":46===e?"del":91===e?"left window key":92===e?"right window key":93===e?"select":96===e?"numpad 0":97===e?"numpad 1":98===e?"numpad 2":99===e?"numpad 3":100===e?"numpad 4":101===e?"numpad 5":102===e?"numpad 6":103===e?"numpad 7":104===e?"numpad 8":105===e?"numpad 9":106===e?"numpad *":107===e?"numpad +":109===e?"numpad -":110===e?"numpad .":111===e?"numpad /":112===e?"F1":113===e?"F2":114===e?"F3":115===e?"F4":116===e?"F5":117===e?"F6":118===e?"F7":119===e?"F8":120===e?"F9":121===e?"F10":122===e?"F11":123===e?"F12":144===e?"numlock":145===e?"scroll lock":186===e?";":187===e?"=":188===e?",":189===e?"-":190===e?".":191===e?"/":192===e?"'":219===e?"[":220===e?"\\":221===e?"]":222===e?"#":223===e?"`":String.fromCharCode(e)}var n=cr.plugins_.Keyboard.prototype;n.Type=function(e){this.plugin=e,this.runtime=e.runtime};var o=n.Type.prototype;o.onCreate=function(){},n.Instance=function(e){this.type=e,this.runtime=e.runtime,this.keyMap=Array(256),this.usedKeys=Array(256),this.triggerKey=0};var a=n.Instance.prototype;a.onCreate=function(){var e=this;this.runtime.isDomFree||(jQuery(document).keydown(function(t){e.onKeyDown(t)}),jQuery(document).keyup(function(t){e.onKeyUp(t)}))};var i=[32,33,34,35,36,37,38,39,40,44];a.onKeyDown=function(e){var t=!1;if(window!=window.top&&-1<i.indexOf(e.which)&&(e.preventDefault(),t=!0,e.stopPropagation()),this.keyMap[e.which])return void(this.usedKeys[e.which]&&!t&&e.preventDefault());this.keyMap[e.which]=!0,this.triggerKey=e.which,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKey,this);var r=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKey,this),n=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCode,this);this.runtime.isInUserInputEvent=!1,(r||n)&&(this.usedKeys[e.which]=!0,!t&&e.preventDefault())},a.onKeyUp=function(e){this.keyMap[e.which]=!1,this.triggerKey=e.which,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKeyReleased,this);var t=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased,this),r=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased,this);this.runtime.isInUserInputEvent=!1,(t||r||this.usedKeys[e.which])&&(this.usedKeys[e.which]=!0,e.preventDefault())},a.onWindowBlur=function(){var e;for(e=0;256>e;++e)if(this.keyMap[e]){this.keyMap[e]=!1,this.triggerKey=e,this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnAnyKeyReleased,this);var t=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyReleased,this),r=this.runtime.trigger(cr.plugins_.Keyboard.prototype.cnds.OnKeyCodeReleased,this);(t||r)&&(this.usedKeys[e]=!0)}},a.saveToJSON=function(){return{triggerKey:this.triggerKey}},a.loadFromJSON=function(e){this.triggerKey=e.triggerKey};e.prototype.IsKeyDown=function(e){return this.keyMap[e]},e.prototype.OnKey=function(e){return e===this.triggerKey},e.prototype.OnAnyKey=function(){return!0},e.prototype.OnAnyKeyReleased=function(){return!0},e.prototype.OnKeyReleased=function(e){return e===this.triggerKey},e.prototype.IsKeyCodeDown=function(e){return e=Math.floor(e),!(0>e||e>=this.keyMap.length)&&this.keyMap[e]},e.prototype.OnKeyCode=function(e){return e===this.triggerKey},e.prototype.OnKeyCodeReleased=function(e){return e===this.triggerKey},n.cnds=new e;n.acts=new function(){};t.prototype.LastKeyCode=function(e){e.set_int(this.triggerKey)};t.prototype.StringFromKeyCode=function(e,t){e.set_string(r(t))},n.exps=new t}();cr.plugins_.List=function(e){this.runtime=e},function(){function e(){}function t(){}function r(){}var n=cr.plugins_.List.prototype;n.Type=function(e){this.plugin=e,this.runtime=e.runtime};var o=n.Type.prototype;o.onCreate=function(){},n.Instance=function(e){this.type=e,this.runtime=e.runtime};var a=n.Instance.prototype;a.onCreate=function(){if(this.runtime.isDomFree)return void cr.logexport("[Construct 2] List plugin not supported on this platform - the object will not be created");if(this.elem=document.createElement("select"),this.elem.id=this.properties[7],jQuery(this.elem).appendTo(this.runtime.canvasdiv?this.runtime.canvasdiv:"body"),this.elem.title=this.properties[1],this.elem.disabled=0===this.properties[3],0===this.properties[4]&&(this.elem.size=2),this.elem.multiple=0!==this.properties[5],this.autoFontSize=0!==this.properties[6],0===this.properties[2]&&(jQuery(this.elem).hide(),this.visible=!1),this.properties[0]){var e=this.properties[0].split(";"),t,r,n;for(t=0,r=e.length;t<r;t++)n=document.createElement("option"),n.text=e[t],this.elem.add(n)}var a=this;this.elem.onchange=function(){a.runtime.trigger(cr.plugins_.List.prototype.cnds.OnSelectionChanged,a)},this.elem.onclick=function(t){t.stopPropagation(),a.runtime.isInUserInputEvent=!0,a.runtime.trigger(cr.plugins_.List.prototype.cnds.OnClicked,a),a.runtime.isInUserInputEvent=!1},this.elem.ondblclick=function(t){t.stopPropagation(),a.runtime.isInUserInputEvent=!0,a.runtime.trigger(cr.plugins_.List.prototype.cnds.OnDoubleClicked,a),a.runtime.isInUserInputEvent=!1},this.elem.addEventListener("touchstart",function(t){t.stopPropagation()},!1),this.elem.addEventListener("touchmove",function(t){t.stopPropagation()},!1),this.elem.addEventListener("touchend",function(t){t.stopPropagation()},!1),jQuery(this.elem).mousedown(function(t){t.stopPropagation()}),jQuery(this.elem).mouseup(function(t){t.stopPropagation()}),this.lastLeft=0,this.lastTop=0,this.lastRight=0,this.lastBottom=0,this.lastWinWidth=0,this.lastWinHeight=0,this.isVisible=!0,this.updatePosition(!0),this.runtime.tickMe(this)},a.saveToJSON=function(){var e={tooltip:this.elem.title,disabled:!!this.elem.disabled,items:[],sel:[]},t=e.items,r,n;for(r=0,n=this.elem.length;r<n;r++)t.push(this.elem.options[r].text);var o=e.sel;if(this.elem.multiple)for(r=0,n=this.elem.length;r<n;r++)this.elem.options[r].selected&&o.push(r);else o.push(this.elem.selectedIndex);return e},a.loadFromJSON=function(e){this.elem.title=e.tooltip,this.elem.disabled=e.disabled;for(var t=e.items;this.elem.length;)this.elem.remove(this.elem.length-1);var r,n,o;for(r=0,n=t.length;r<n;r++)o=document.createElement("option"),o.text=t[r],this.elem.add(o);var a=e.sel;if(this.elem.multiple)for(r=0,n=a.length;r<n;r++)a[r]<this.elem.length&&(this.elem.options[a[r]].selected=!0);else 1<=a.length&&(this.elem.selectedIndex=a[0])},a.onDestroy=function(){this.runtime.isDomFree||(jQuery(this.elem).remove(),this.elem=null)},a.tick=function(){this.updatePosition()},a.updatePosition=function(e){if(!this.runtime.isDomFree){var t=this.layer.layerToCanvas(this.x,this.y,!0),r=this.layer.layerToCanvas(this.x,this.y,!1),n=this.layer.layerToCanvas(this.x+this.width,this.y+this.height,!0),o=this.layer.layerToCanvas(this.x+this.width,this.y+this.height,!1),a=this.runtime.width/this.runtime.devicePixelRatio,i=this.runtime.height/this.runtime.devicePixelRatio;if(!this.visible||!this.layer.visible||0>=n||0>=o||t>=a||r>=i)return this.isVisible&&jQuery(this.elem).hide(),void(this.isVisible=!1);1>t&&(t=1),1>r&&(r=1),n>=a&&(n=a-1),o>=i&&(o=i-1);var s=window.innerWidth,l=window.innerHeight;if(!e&&this.lastLeft===t&&this.lastTop===r&&this.lastRight===n&&this.lastBottom===o&&this.lastWinWidth===s&&this.lastWinHeight===l)return void(this.isVisible||(jQuery(this.elem).show(),this.isVisible=!0));this.lastLeft=t,this.lastTop=r,this.lastRight=n,this.lastBottom=o,this.lastWinWidth=s,this.lastWinHeight=l,this.isVisible||(jQuery(this.elem).show(),this.isVisible=!0);var p=Math.round(t)+jQuery(this.runtime.canvas).offset().left,d=Math.round(r)+jQuery(this.runtime.canvas).offset().top;jQuery(this.elem).css("position","absolute"),jQuery(this.elem).offset({left:p,top:d}),jQuery(this.elem).width(Math.round(n-t)),jQuery(this.elem).height(Math.round(o-r)),this.autoFontSize&&jQuery(this.elem).css("font-size",this.layer.getScale(!0)/this.runtime.devicePixelRatio-.2+"em")}},a.draw=function(){},a.drawGL=function(){};e.prototype.CompareSelection=function(e,t){return cr.do_cmp(this.elem.selectedIndex,e,t)},e.prototype.OnSelectionChanged=function(){return!0},e.prototype.OnClicked=function(){return!0},e.prototype.OnDoubleClicked=function(){return!0},e.prototype.CompareSelectedText=function(e,t){var r="",n=this.elem.selectedIndex;return!(0>n||n>=this.elem.length)&&(r=this.elem.options[n].text,t?r==e:cr.equals_nocase(r,e))},e.prototype.CompareTextAt=function(e,t,r){var n="",o=Math.floor(e);return!(0>o||o>=this.elem.length)&&(n=this.elem.options[o].text,r?n==t:cr.equals_nocase(n,t))},n.cnds=new e;t.prototype.Select=function(e){this.runtime.isDomFree||(this.elem.selectedIndex=e)},t.prototype.SetTooltip=function(e){this.runtime.isDomFree||(this.elem.title=e)},t.prototype.SetVisible=function(e){this.runtime.isDomFree||(this.visible=0!==e)},t.prototype.SetEnabled=function(e){this.runtime.isDomFree||(this.elem.disabled=0===e)},t.prototype.SetFocus=function(){this.runtime.isDomFree||this.elem.focus()},t.prototype.SetBlur=function(){this.runtime.isDomFree||this.elem.blur()},t.prototype.SetCSSStyle=function(e,t){this.runtime.isDomFree||jQuery(this.elem).css(e,t)},t.prototype.AddItem=function(e){if(!this.runtime.isDomFree){var t=document.createElement("option");t.text=e,this.elem.add(t)}},t.prototype.AddItemAt=function(e,t){if(!this.runtime.isDomFree){e=Math.floor(e),0>e&&(e=0);var r=document.createElement("option");r.text=t,e>=this.elem.length?this.elem.add(r):this.elem.add(r,this.elem.options[e])}},t.prototype.Remove=function(e){this.runtime.isDomFree||(e=Math.floor(e),this.elem.remove(e))},t.prototype.SetItemText=function(e,t){this.runtime.isDomFree||(e=Math.floor(e),0>e||e>=this.elem.length||(this.elem.options[e].text=t))},t.prototype.Clear=function(){this.runtime.isDomFree||(this.elem.innerHTML="")},n.acts=new t;r.prototype.ItemCount=function(e){return this.runtime.isDomFree?void e.set_int(0):void e.set_int(this.elem.length)},r.prototype.ItemTextAt=function(e,t){return this.runtime.isDomFree?void e.set_string(""):(t=Math.floor(t),0>t||t>=this.elem.length?void e.set_string(""):void e.set_string(this.elem.options[t].text))},r.prototype.SelectedIndex=function(e){return this.runtime.isDomFree?void e.set_int(0):void e.set_int(this.elem.selectedIndex)},r.prototype.SelectedText=function(e){if(this.runtime.isDomFree)return void e.set_string("");var t=this.elem.selectedIndex;return 0>t||t>=this.elem.length?void e.set_string(""):void e.set_string(this.elem.options[t].text)},r.prototype.SelectedCount=function(e){if(this.runtime.isDomFree)return void e.set_int(0);var t=0,r,n;for(r=0,n=this.elem.length;r<n;r++)this.elem.options[r].selected&&t++;e.set_int(t)},r.prototype.SelectedIndexAt=function(e,t){if(this.runtime.isDomFree)return void e.set_int(0);t=Math.floor(t);var r=0,n=0,o,a;for(o=0,a=this.elem.length;o<a;o++)if(this.elem.options[o].selected){if(r===t){n=o;break}r++}e.set_int(n)},r.prototype.SelectedTextAt=function(e,t){if(this.runtime.isDomFree)return void e.set_string("");t=Math.floor(t);var r=0,n="",o,a;for(o=0,a=this.elem.length;o<a;o++)if(this.elem.options[o].selected){if(r===t){n=this.elem.options[o].text;break}r++}e.set_string(n)},n.exps=new r}();var localForageInitFailed=!1;try{!function(){var t,r,n,o;!function(){var s={},e={};t=function(e,t,r){s[e]={deps:t,callback:r}},o=n=r=function(t){function a(r){if("."!==r.charAt(0))return r;for(var n=r.split("/"),o=t.split("/").slice(0,-1),a=0,i=n.length,s;i>a;a++)if(s=n[a],".."===s)o.pop();else{if("."===s)continue;o.push(s)}return o.join("/")}if(o._eak_seen=s,e[t])return e[t];if(e[t]={},!s[t])throw new Error("Could not find module "+t);for(var p=s[t],d=p.deps,i=p.callback,c=[],u=0,y=d.length,m;y>u;u++)"exports"===d[u]?c.push(m={}):c.push(r(a(d[u])));var _=i.apply(this,c);return e[t]=m||_}}(),t("promise/all",["./utils","exports"],function(t,r){"use strict";var n=t.isArray,o=t.isFunction;r.all=function(e){var t=this;if(!n(e))throw new TypeError("You must pass an array to all.");return new t(function(t,r){function n(e){return function(t){s(e,t)}}function s(e,r){l[e]=r,0==--p&&t(l)}var l=[],p=e.length,a;0===p&&t([]);for(var d=0;d<e.length;d++)a=e[d],a&&o(a.then)?a.then(n(d),r):s(d,a)})}}),t("promise/asap",["exports"],function(t){"use strict";function r(){var e=0,t=new s(n),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}function n(){for(var e=0;e<i.length;e++){var t=i[e],r=t[0],n=t[1];r(n)}i=[]}function e(e,t){var r=i.push([e,t]);1===r&&l()}var o="undefined"==typeof window?{}:window,s=o.MutationObserver||o.WebKitMutationObserver,a="undefined"==typeof global?void 0===this?window:this:global,i=[],l;l="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?function(){return function(){process.nextTick(n)}}():s?r():function(){return function(){a.setTimeout(n,1)}}(),t.asap=e}),t("promise/config",["exports"],function(e){"use strict";function t(e,t){return 2===arguments.length?void(r[e]=t):r[e]}var r={instrument:!1};e.config=r,e.configure=t}),t("promise/polyfill",["./promise","./utils","exports"],function(t,r,n){"use strict";function o(){var t="undefined"==typeof global?"undefined"!=typeof window&&window.document?window:self:global;var r="Promise"in t&&"resolve"in t.Promise&&"reject"in t.Promise&&"all"in t.Promise&&"race"in t.Promise&&function(){var r;return new t.Promise(function(e){r=e}),e(r)}();r||(t.Promise=i)}var i=t.Promise,e=r.isFunction;n.polyfill=o}),t("promise/promise",["./config","./utils","./all","./race","./resolve","./reject","./asap","exports"],function(_,a,b,c,d,e,f,g){"use strict";function h(e){if(!u(e))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof h))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],i(e,this)}function i(e,t){function r(e){n(t,e)}function o(e){p(t,e)}try{e(r,o)}catch(t){o(t)}}function S(t,r,o,a){var s=u(o),i,l,d,c;if(s)try{i=o(a),d=!0}catch(e){c=!0,l=e}else i=a,d=!0;m(r,i)||(s&&d?n(r,i):c?p(r,l):t===C?n(r,i):t===I&&p(r,i))}function T(t,r,n,o){var a=t._subscribers,e=a.length;a[e]=r,a[e+C]=n,a[e+I]=o}function l(t,r){for(var n=t._subscribers,e=t._detail,o=0,a,i;o<n.length;o+=3)a=n[o],i=n[o+r],S(r,a,i,e);t._subscribers=null}function m(r,e){var a=null,i;try{if(r===e)throw new TypeError("A promises callback cannot return that same promise.");if(t(e)&&(a=e.then,u(a)))return a.call(e,function(t){return!!i||(i=!0,void(e===t?o(r,t):n(r,t)))},function(e){return!!i||(i=!0,void p(r,e))}),!0}catch(t){return!!i||(p(r,t),!0)}return!1}function n(e,t){e===t?o(e,t):m(e,t)||o(e,t)}function o(e,t){e._state===E&&(e._state=A,e._detail=t,s.async(O,e))}function p(e,t){e._state===E&&(e._state=A,e._detail=t,s.async(r,e))}function O(e){l(e,e._state=C)}function r(e){l(e,e._state=I)}var s=_.config,t=(_.configure,a.objectOrFunction),u=a.isFunction,v=(a.now,b.all),w=c.race,x=d.resolve,y=e.reject,P=f.asap;s.async=P;var A=0,C=1,I=2,E;h.prototype={constructor:h,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(t,r){var n=this,o=new this.constructor(function(){});if(this._state){var a=arguments;s.async(function(){S(n._state,o,a[n._state-1],n._detail)})}else T(this,o,t,r);return o},catch:function(e){return this.then(null,e)}},h.all=v,h.race=w,h.resolve=x,h.reject=y,g.Promise=h}),t("promise/race",["./utils","exports"],function(e,t){"use strict";var r=e.isArray;t.race=function(t){var e=this;if(!r(t))throw new TypeError("You must pass an array to race.");return new e(function(r,n){for(var o=0,a;o<t.length;o++)a=t[o],a&&"function"==typeof a.then?a.then(r,n):r(a)})}}),t("promise/reject",["exports"],function(e){"use strict";function t(e){var t=this;return new t(function(t,r){r(e)})}e.reject=t}),t("promise/resolve",["exports"],function(e){"use strict";function t(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=this;return new t(function(t){t(e)})}e.resolve=t}),t("promise/utils",["exports"],function(t){"use strict";function r(e){return"function"==typeof e}var n=Date.now||function(){return new Date().getTime()};t.objectOrFunction=function(e){return r(e)||"object"==typeof e&&null!==e},t.isFunction=r,t.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},t.now=n}),r("promise/polyfill").polyfill()}(),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.localforage=t():e.localforage=t()}(this,function(){return function(t){function r(o){if(n[o])return n[o].exports;var a=n[o]={exports:{},id:o,loaded:!1};return t[o].call(a.exports,a,a.exports,r),a.loaded=!0,a.exports}var n={};return r.m=t,r.c=n,r.p="",r(0)}([function(t,r,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}r.__esModule=!0;var a=function(t){function r(e,t){e[t]=function(){var r=arguments;return e.ready().then(function(){return e[t].apply(e,r)})}}function s(){for(var e=1,t;e<arguments.length;e++)if(t=arguments[e],t)for(var r in t)t.hasOwnProperty(r)&&(l(t[r])?arguments[0][r]=t[r].slice():arguments[0][r]=t[r]);return arguments[0]}function p(t){for(var r in e)if(e.hasOwnProperty(r)&&e[r]===t)return!0;return!1}var u={},e={INDEXEDDB:"asyncStorage",LOCALSTORAGE:"localStorageWrapper",WEBSQL:"webSQLStorage"},a=[e.INDEXEDDB,e.WEBSQL,e.LOCALSTORAGE],d=["clear","getItem","iterate","key","keys","length","removeItem","setItem"],i={description:"",driver:a.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},g=function(t){var r={};return r[e.INDEXEDDB]=!!function(){try{var e=e||t.indexedDB||t.webkitIndexedDB||t.mozIndexedDB||t.OIndexedDB||t.msIndexedDB;return!("undefined"!=typeof t.openDatabase&&t.navigator&&t.navigator.userAgent&&/Safari/.test(t.navigator.userAgent)&&!/Chrome/.test(t.navigator.userAgent))&&e&&"function"==typeof e.open&&"undefined"!=typeof t.IDBKeyRange}catch(e){return!1}}(),r[e.WEBSQL]=!!function(){try{return t.openDatabase}catch(e){return!1}}(),r[e.LOCALSTORAGE]=!!function(){try{return t.localStorage&&"setItem"in t.localStorage&&t.localStorage.setItem}catch(e){return!1}}(),r}(t),l=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},c=function(){function t(r){o(this,t),this.INDEXEDDB=e.INDEXEDDB,this.LOCALSTORAGE=e.LOCALSTORAGE,this.WEBSQL=e.WEBSQL,this._defaultConfig=s({},i),this._config=s({},this._defaultConfig,r),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver)}return t.prototype.config=function(e){if("object"==typeof e){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e)"storeName"==t&&(e[t]=e[t].replace(/\W/g,"_")),this._config[t]=e[t];return"driver"in e&&e.driver&&this.setDriver(this._config.driver),!0}return"string"==typeof e?this._config[e]:this._config},t.prototype.defineDriver=function(t,e,r){var n=new Promise(function(r,a){try{var o=t._driver,s=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver"),e=new Error("Custom driver name already in use: "+t._driver);if(!t._driver)return void a(s);if(p(t._driver))return void a(e);for(var l=d.concat("_initStorage"),i=0,c;i<l.length;i++)if(c=l[i],!c||!t[c]||"function"!=typeof t[c])return void a(s);var y=Promise.resolve(!0);"_support"in t&&(y=t._support&&"function"==typeof t._support?t._support():Promise.resolve(!!t._support)),y.then(function(e){g[o]=e,u[o]=t,r()},a)}catch(e){a(e)}});return n.then(e,r),n},t.prototype.driver=function(){return this._driver||null},t.prototype.getDriver=function(t,r,o){var a=this,e=function(){if(p(t))switch(t){case a.INDEXEDDB:return new Promise(function(e){e(n(1))});case a.LOCALSTORAGE:return new Promise(function(e){e(n(2))});case a.WEBSQL:return new Promise(function(e){e(n(4))});}else if(u[t])return Promise.resolve(u[t]);return Promise.reject(new Error("Driver not found."))}();return e.then(r,o),e},t.prototype.getSerializer=function(e){var t=new Promise(function(e){e(n(3))});return e&&"function"==typeof e&&t.then(function(t){e(t)}),t},t.prototype.ready=function(e){var t=this,r=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return r.then(e,e),r},t.prototype.setDriver=function(t,r,n){function o(){s._config.driver=s.driver()}function i(t){return function(){function r(){for(;n<t.length;){var a=t[n];return n++,s._dbInfo=null,s._ready=null,s.getDriver(a).then(function(e){return s._extend(e),o(),s._ready=s._initStorage(s._config),s._ready})["catch"](r)}o();var e=new Error("No available storage method found.");return s._driverSet=Promise.reject(e),s._driverSet}var n=0;return r()}}var s=this;l(t)||(t=[t]);var e=this._getSupportedDrivers(t),p=null===this._driverSet?Promise.resolve():this._driverSet["catch"](function(){return Promise.resolve()});return this._driverSet=p.then(function(){var t=e[0];return s._dbInfo=null,s._ready=null,s.getDriver(t).then(function(t){s._driver=t._driver,o(),s._wrapLibraryMethodsWithReady(),s._initDriver=i(e)})})["catch"](function(){o();var e=new Error("No available storage method found.");return s._driverSet=Promise.reject(e),s._driverSet}),this._driverSet.then(r,n),this._driverSet},t.prototype.supports=function(e){return!!g[e]},t.prototype._extend=function(e){s(this,e)},t.prototype._getSupportedDrivers=function(t){for(var r=[],n=0,o=t.length,a;o>n;n++)a=t[n],this.supports(a)&&r.push(a);return r},t.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0;e<d.length;e++)r(this,d[e])},t.prototype.createInstance=function(e){return new t(e)},t}();return new c}("undefined"==typeof window?self:window);r["default"]=a,t.exports=r["default"]},function(e,t){"use strict";t.__esModule=!0;var r=function(_){function S(t,r){t=t||[],r=r||{};try{return new Blob(t,r)}catch(a){if("TypeError"!==a.name)throw a;for(var n=_.BlobBuilder||_.MSBlobBuilder||_.MozBlobBuilder||_.WebKitBlobBuilder,e=new n,o=0;o<t.length;o+=1)e.append(t[o]);return e.getBlob(r.type)}}function b(t){for(var r=t.length,n=new ArrayBuffer(r),o=new Uint8Array(n),a=0;r>a;a++)o[a]=t.charCodeAt(a);return n}function T(e){return new Promise(function(t,r){var n=new XMLHttpRequest;n.open("GET",e),n.withCredentials=!0,n.responseType="arraybuffer",n.onreadystatechange=function(){return 4===n.readyState?200===n.status?t({response:n.response,type:n.getResponseHeader("Content-Type")}):void r({status:n.status,response:n.response}):void 0},n.send()})}function d(t){return new Promise(function(r,n){var e=S([""],{type:"image/png"}),o=t.transaction([A],"readwrite");o.objectStore(A).put(e,"key"),o.oncomplete=function(){var e=t.transaction([A],"readwrite"),o=e.objectStore(A).get("key");o.onerror=n,o.onsuccess=function(t){var n=t.target.result,o=URL.createObjectURL(n);T(o).then(function(e){r(e&&"image/png"===e.type)},function(){r(!1)}).then(function(){URL.revokeObjectURL(o)})}},o.onerror=o.onabort=n})["catch"](function(){return!1})}function a(e){return"boolean"==typeof P?Promise.resolve(P):d(e).then(function(e){return P=e})}function e(e){return new Promise(function(t,r){var n=new FileReader;n.onerror=r,n.onloadend=function(r){var n=btoa(r.target.result||"");t({__local_forage_encoded_blob:!0,data:n,type:e.type})},n.readAsBinaryString(e)})}function f(e){var t=b(atob(e.data));return S([t],{type:e.type})}function h(e){return e&&e.__local_forage_encoded_blob}function O(e){var t=this,r=t._initReady().then(function(){var e=I[t._dbInfo.name];return e&&e.dbReady?e.dbReady:void 0});return r.then(e,e),r}function i(e){var t=I[e.name],r={};r.promise=new Promise(function(e){r.resolve=e}),t.deferredOperations.push(r),t.dbReady=t.dbReady?t.dbReady.then(function(){return r.promise}):r.promise}function c(e){var t=I[e.name],r=t.deferredOperations.pop();r&&r.resolve()}function l(t){function r(){return Promise.resolve()}var o=this,s={db:null};if(t)for(var a in t)s[a]=t[a];I||(I={});var l=I[s.name];l||(l={forages:[],db:null,dbReady:null,deferredOperations:[]},I[s.name]=l),l.forages.push(o),o._initReady||(o._initReady=o.ready,o.ready=O);for(var e=[],d=0,c;d<l.forages.length;d++)c=l.forages[d],c!==o&&e.push(c._initReady()["catch"](r));var u=l.forages.slice(0);return Promise.all(e).then(function(){return s.db=l.db,g(s)}).then(function(e){return s.db=e,p(s,o._defaultConfig.version)?n(s):e}).then(function(t){s.db=l.db=t,o._dbInfo=s;for(var r=0,n;r<u.length;r++)n=u[r],n!==o&&(n._dbInfo.db=s.db,n._dbInfo.version=s.version)})}function g(e){return o(e,!1)}function n(e){return o(e,!0)}function o(t,r){return new Promise(function(n,o){if(t.db){if(!r)return n(t.db);i(t),t.db.close()}var e=[t.name];r&&e.push(t.version);var a=E.open.apply(E,e);r&&(a.onupgradeneeded=function(r){var e=a.result;try{e.createObjectStore(t.storeName),1>=r.oldVersion&&e.createObjectStore(A)}catch(n){if("ConstraintError"!==n.name)throw n;_.console.warn("The database \""+t.name+"\" has been upgraded from version "+r.oldVersion+" to version "+r.newVersion+", but the storage \""+t.storeName+"\" already exists.")}}),a.onerror=function(){o(a.error)},a.onsuccess=function(){n(a.result),c(t)}})}function p(t,r){if(!t.db)return!0;var n=!t.db.objectStoreNames.contains(t.storeName),o=t.version<t.db.version,e=t.version>t.db.version;if(o&&(t.version!==r&&_.console.warn("The database \""+t.name+"\" can't be downgraded from version "+t.db.version+" to version "+t.version+"."),t.version=t.db.version),e||n){if(n){var a=t.db.version+1;a>t.version&&(t.version=a)}return!0}return!1}function m(t,r){var n=this;"string"!=typeof t&&(_.console.warn(t+" used as a key, but it is not a string."),t=t+"");var o=new Promise(function(e,r){n.ready().then(function(){var o=n._dbInfo,a=o.db.transaction(o.storeName,"readonly").objectStore(o.storeName),i=a.get(t);i.onsuccess=function(){var t=i.result;void 0===t&&(t=null),h(t)&&(t=f(t)),e(t)},i.onerror=function(){r(i.error)}})["catch"](r)});return y(o,r),o}function r(t,e){var r=this,n=new Promise(function(n,e){r.ready().then(function(){var o=r._dbInfo,a=o.db.transaction(o.storeName,"readonly").objectStore(o.storeName),i=a.openCursor(),s=1;i.onsuccess=function(){var r=i.result;if(r){var o=r.value;h(o)&&(o=f(o));var a=t(o,r.key,s++);void 0===a?r["continue"]():n(a)}else n()},i.onerror=function(){e(i.error)}})["catch"](e)});return y(n,e),n}function s(t,r,n){var o=this;"string"!=typeof t&&(_.console.warn(t+" used as a key, but it is not a string."),t=t+"");var i=new Promise(function(n,i){var s;o.ready().then(function(){return s=o._dbInfo,r instanceof Blob?a(s.db).then(function(t){return t?r:e(r)}):r}).then(function(r){var o=s.db.transaction(s.storeName,"readwrite"),e=o.objectStore(s.storeName);null===r&&(r=void 0),o.oncomplete=function(){void 0===r&&(r=null),n(r)},o.onabort=o.onerror=function(){var e=l.error?l.error:l.transaction.error;i(e)};var l=e.put(r,t)})["catch"](i)});return y(i,n),i}function t(t,r){var n=this;"string"!=typeof t&&(_.console.warn(t+" used as a key, but it is not a string."),t=t+"");var o=new Promise(function(e,r){n.ready().then(function(){var o=n._dbInfo,a=o.db.transaction(o.storeName,"readwrite"),i=a.objectStore(o.storeName),s=i["delete"](t);a.oncomplete=function(){e()},a.onerror=function(){r(s.error)},a.onabort=function(){var e=s.error?s.error:s.transaction.error;r(e)}})["catch"](r)});return y(o,r),o}function u(e){var t=this,r=new Promise(function(e,r){t.ready().then(function(){var n=t._dbInfo,o=n.db.transaction(n.storeName,"readwrite"),a=o.objectStore(n.storeName),i=a.clear();o.oncomplete=function(){e()},o.onabort=o.onerror=function(){var e=i.error?i.error:i.transaction.error;r(e)}})["catch"](r)});return y(r,e),r}function v(e){var t=this,r=new Promise(function(e,r){t.ready().then(function(){var n=t._dbInfo,o=n.db.transaction(n.storeName,"readonly").objectStore(n.storeName),a=o.count();a.onsuccess=function(){e(a.result)},a.onerror=function(){r(a.error)}})["catch"](r)});return y(r,e),r}function w(e,t){var r=this,n=new Promise(function(t,n){return 0>e?void t(null):void r.ready().then(function(){var o=r._dbInfo,a=o.db.transaction(o.storeName,"readonly").objectStore(o.storeName),i=!1,s=a.openCursor();s.onsuccess=function(){var r=s.result;return r?void(0===e?t(r.key):i?t(r.key):(i=!0,r.advance(e))):void t(null)},s.onerror=function(){n(s.error)}})["catch"](n)});return y(n,t),n}function x(e){var t=this,r=new Promise(function(e,r){t.ready().then(function(){var n=t._dbInfo,o=n.db.transaction(n.storeName,"readonly").objectStore(n.storeName),a=o.openCursor(),i=[];a.onsuccess=function(){var t=a.result;return t?(i.push(t.key),void t["continue"]()):void e(i)},a.onerror=function(){r(a.error)}})["catch"](r)});return y(r,e),r}function y(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}var E=E||_.indexedDB||_.webkitIndexedDB||_.mozIndexedDB||_.OIndexedDB||_.msIndexedDB;if(E){var A="local-forage-detect-blob-support",P,I;return{_driver:"asyncStorage",_initStorage:l,iterate:r,getItem:m,setItem:s,removeItem:t,clear:u,length:v,key:w,keys:x}}}("undefined"==typeof window?self:window);t["default"]=r,e.exports=t["default"]},function(e,t,r){"use strict";t.__esModule=!0;var n=function(t){function n(t){var n=this,o={};if(t)for(var a in t)o[a]=t[a];return o.keyPrefix=o.name+"/",o.storeName!==n._defaultConfig.storeName&&(o.keyPrefix+=o.storeName+"/"),n._dbInfo=o,new Promise(function(e){e(r(3))}).then(function(e){return o.serializer=e,Promise.resolve()})}function o(r,n){var o=this;"string"!=typeof r&&(t.console.warn(r+" used as a key, but it is not a string."),r=r+"");var a=o.ready().then(function(){var e=o._dbInfo,t=s.getItem(e.keyPrefix+r);return t&&(t=e.serializer.deserialize(t)),t});return i(a,n),a}function i(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}var s=null;try{if(!(t.localStorage&&"setItem"in t.localStorage))return;s=t.localStorage}catch(e){return}return{_driver:"localStorageWrapper",_initStorage:n,iterate:function(t,e){var r=this,n=r.ready().then(function(){for(var n=r._dbInfo,o=n.keyPrefix,a=o.length,e=s.length,l=1,p=0,d;e>p;p++)if(d=s.key(p),0===d.indexOf(o)){var c=s.getItem(d);if(c&&(c=n.serializer.deserialize(c)),c=t(c,d.substring(a),l++),void 0!==c)return c}});return i(n,e),n},getItem:o,setItem:function(r,n,o){var l=this;"string"!=typeof r&&(t.console.warn(r+" used as a key, but it is not a string."),r=r+"");var e=l.ready().then(function(){void 0===n&&(n=null);var e=n;return new Promise(function(t,o){var a=l._dbInfo;a.serializer.serialize(n,function(n,i){if(i)o(i);else try{s.setItem(a.keyPrefix+r,n),t(e)}catch(e){("QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&o(e),o(e)}})})});return i(e,o),e},removeItem:function(r,n){var o=this;"string"!=typeof r&&(t.console.warn(r+" used as a key, but it is not a string."),r=r+"");var a=o.ready().then(function(){var e=o._dbInfo;s.removeItem(e.keyPrefix+r)});return i(a,n),a},clear:function(e){var t=this,r=t.ready().then(function(){for(var e=t._dbInfo.keyPrefix,r=s.length-1,n;0<=r;r--)n=s.key(r),0===n.indexOf(e)&&s.removeItem(n)});return i(r,e),r},length:function(e){var t=this,r=t.keys().then(function(e){return e.length});return i(r,e),r},key:function(e,t){var r=this,n=r.ready().then(function(){var t=r._dbInfo,n;try{n=s.key(e)}catch(t){n=null}return n&&(n=n.substring(t.keyPrefix.length)),n});return i(n,t),n},keys:function(e){var t=this,r=t.ready().then(function(){for(var r=t._dbInfo,n=s.length,o=[],a=0;n>a;a++)0===s.key(a).indexOf(r.keyPrefix)&&o.push(s.key(a).substring(r.keyPrefix.length));return o});return i(r,e),r}}}("undefined"==typeof window?self:window);t["default"]=n,e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0;var r=function(y){function a(t,r){t=t||[],r=r||{};try{return new Blob(t,r)}catch(a){if("TypeError"!==a.name)throw a;for(var n=y.BlobBuilder||y.MSBlobBuilder||y.MozBlobBuilder||y.WebKitBlobBuilder,e=new n,o=0;o<t.length;o+=1)e.append(t[o]);return e.getBlob(r.type)}}function _(y,a){var _="";if(y&&(_=y.toString()),y&&("[object ArrayBuffer]"===y.toString()||y.buffer&&"[object ArrayBuffer]"===y.buffer.toString())){var h=i,f;y instanceof ArrayBuffer?(f=y,h+=g):(f=y.buffer,"[object Int8Array]"===_?h+=m:"[object Uint8Array]"===_?h+=n:"[object Uint8ClampedArray]"===_?h+=o:"[object Int16Array]"===_?h+=p:"[object Uint16Array]"===_?h+=r:"[object Int32Array]"===_?h+=O:"[object Uint32Array]"===_?h+=s:"[object Float32Array]"===_?h+=t:"[object Float64Array]"===_?h+=u:a(new Error("Failed to get type for BinaryArray"))),a(h+x(f))}else if("[object Blob]"===_){var b=new FileReader;b.onload=function(){var t=e+y.type+"~"+x(this.result);a(i+l+t)},b.readAsArrayBuffer(y)}else try{a(JSON.stringify(y))}catch(e){console.error("Couldn't convert value into a JSON string: ",y),a(null,e)}}function c(e){if(e.substring(0,C)!==i)return JSON.parse(e);var y=e.substring(v),_=e.substring(C,v),f;if(_===l&&T.test(y)){var x=y.match(T);f=x[1],y=y.substring(x[0].length)}var w=b(y);switch(_){case g:return w;case l:return a([w],{type:f});case m:return new Int8Array(w);case n:return new Uint8Array(w);case o:return new Uint8ClampedArray(w);case p:return new Int16Array(w);case r:return new Uint16Array(w);case O:return new Int32Array(w);case s:return new Uint32Array(w);case t:return new Float32Array(w);case u:return new Float64Array(w);default:throw new Error("Unkown type: "+_);}}function b(t){var r=.75*t.length,n=t.length,o=0,a,i,s,p,u;"="===t[t.length-1]&&(r--,"="===t[t.length-2]&&r--);var g=new ArrayBuffer(r),y=new Uint8Array(g);for(a=0;n>a;a+=4)i=S.indexOf(t[a]),s=S.indexOf(t[a+1]),p=S.indexOf(t[a+2]),u=S.indexOf(t[a+3]),y[o++]=i<<2|s>>4,y[o++]=(15&s)<<4|p>>2,y[o++]=(3&p)<<6|63&u;return g}function x(e){var t=new Uint8Array(e),r="",n;for(n=0;n<t.length;n+=3)r+=S[t[n]>>2],r+=S[(3&t[n])<<4|t[n+1]>>4],r+=S[(15&t[n+1])<<2|t[n+2]>>6],r+=S[63&t[n+2]];return 2==t.length%3?r=r.substring(0,r.length-1)+"=":1==t.length%3&&(r=r.substring(0,r.length-2)+"=="),r}var S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e="~~local_forage_type~",T=/^~~local_forage_type~([^~]+)~/,i="__lfsc__:",C="__lfsc__:".length,g="arbf",l="blob",m="si08",n="ui08",o="uic8",p="si16",O="si32",r="ur16",s="ui32",t="fl32",u="fl64",v=9+"arbf".length;return{serialize:_,deserialize:c,stringToBuffer:b,bufferToString:x}}("undefined"==typeof window?self:window);t["default"]=r,e.exports=t["default"]},function(e,t,r){"use strict";t.__esModule=!0;var n=function(t){function n(t){var n=this,o={db:null};if(t)for(var a in t)o[a]="string"==typeof t[a]?t[a]:t[a].toString();var e=new Promise(function(e,t){try{o.db=l(o.name,o.version+"",o.description,o.size)}catch(r){return t(r)}o.db.transaction(function(r){r.executeSql("CREATE TABLE IF NOT EXISTS "+o.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){n._dbInfo=o,e()},function(e,r){t(r)})})});return new Promise(function(e){e(r(3))}).then(function(t){return o.serializer=t,e})}function o(r,n){var o=this;"string"!=typeof r&&(t.console.warn(r+" used as a key, but it is not a string."),r=r+"");var a=new Promise(function(t,e){o.ready().then(function(){var n=o._dbInfo;n.db.transaction(function(o){o.executeSql("SELECT * FROM "+n.storeName+" WHERE key = ? LIMIT 1",[r],function(e,r){var o=r.rows.length?r.rows.item(0).value:null;o&&(o=n.serializer.deserialize(o)),t(o)},function(t,r){e(r)})})})["catch"](e)});return u(a,n),a}function a(t,e){var r=this,n=new Promise(function(n,e){r.ready().then(function(){var o=r._dbInfo;o.db.transaction(function(r){r.executeSql("SELECT * FROM "+o.storeName,[],function(e,r){for(var a=r.rows,s=a.length,l=0;s>l;l++){var p=a.item(l),i=p.value;if(i&&(i=o.serializer.deserialize(i)),i=t(i,p.key,l+1),void 0!==i)return void n(i)}n()},function(t,r){e(r)})})})["catch"](e)});return u(n,e),n}function e(r,n,o){var i=this;"string"!=typeof r&&(t.console.warn(r+" used as a key, but it is not a string."),r=r+"");var e=new Promise(function(e,t){i.ready().then(function(){void 0===n&&(n=null);var o=n,a=i._dbInfo;a.serializer.serialize(n,function(n,i){i?t(i):a.db.transaction(function(i){i.executeSql("INSERT OR REPLACE INTO "+a.storeName+" (key, value) VALUES (?, ?)",[r,n],function(){e(o)},function(e,r){t(r)})},function(e){e.code===e.QUOTA_ERR&&t(e)})})})["catch"](t)});return u(e,o),e}function s(r,n){var o=this;"string"!=typeof r&&(t.console.warn(r+" used as a key, but it is not a string."),r=r+"");var a=new Promise(function(e,t){o.ready().then(function(){var n=o._dbInfo;n.db.transaction(function(o){o.executeSql("DELETE FROM "+n.storeName+" WHERE key = ?",[r],function(){e()},function(e,r){t(r)})})})["catch"](t)});return u(a,n),a}function p(e){var t=this,r=new Promise(function(e,r){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){t.executeSql("DELETE FROM "+n.storeName,[],function(){e()},function(e,t){r(t)})})})["catch"](r)});return u(r,e),r}function d(e){var t=this,r=new Promise(function(e,r){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){t.executeSql("SELECT COUNT(key) as c FROM "+n.storeName,[],function(t,r){var n=r.rows.item(0).c;e(n)},function(e,t){r(t)})})})["catch"](r)});return u(r,e),r}function i(t,e){var r=this,n=new Promise(function(e,n){r.ready().then(function(){var o=r._dbInfo;o.db.transaction(function(r){r.executeSql("SELECT key FROM "+o.storeName+" WHERE id = ? LIMIT 1",[t+1],function(t,r){var n=r.rows.length?r.rows.item(0).key:null;e(n)},function(e,t){n(t)})})})["catch"](n)});return u(n,e),n}function c(e){var t=this,r=new Promise(function(r,e){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){t.executeSql("SELECT key FROM "+n.storeName,[],function(t,n){for(var o=[],a=0;a<n.rows.length;a++)o.push(n.rows.item(a).key);r(o)},function(t,r){e(r)})})})["catch"](e)});return u(r,e),r}function u(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}var l=t.openDatabase;if(l){return{_driver:"webSQLStorage",_initStorage:n,iterate:a,getItem:o,setItem:e,removeItem:s,clear:p,length:d,key:i,keys:c}}}("undefined"==typeof window?self:window);t["default"]=n,e.exports=t["default"]}])})}catch(t){localForageInitFailed=!0}cr.plugins_.LocalStorage=function(e){this.runtime=e},function(){function e(e){return e?"string"==typeof e?e:"string"==typeof e.message?e.message:"string"==typeof e.name?e.name:"string"==typeof e.data?e.data:"unknown error":"unknown error"}function t(e,t){d=t,e.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,e)}function r(e){return!c||e.substr(0,c.length)===c}function n(e){return c?r(e)?e.substr(c.length):void 0:e}function o(){}function a(){}function i(){}var s="",l="",p=[],d="";var c="",u="undefined"!=typeof window.is_scirra_arcade;u&&(c="sa"+window.scirra_arcade_id+"_");var g=cr.plugins_.LocalStorage.prototype;g.Type=function(e){this.plugin=e,this.runtime=e.runtime};var y=g.Type.prototype;y.onCreate=function(){},g.Instance=function(e){this.type=e,this.runtime=e.runtime};var m=g.Instance.prototype;m.onCreate=function(){this.pendingSets=0,this.pendingGets=0},m.onDestroy=function(){},m.saveToJSON=function(){return{}},m.loadFromJSON=function(){};var _=!0;o.prototype.OnItemSet=function(e){return s===e},o.prototype.OnAnyItemSet=function(){return!0},o.prototype.OnItemGet=function(e){return s===e},o.prototype.OnAnyItemGet=function(){return!0},o.prototype.OnItemRemoved=function(e){return s===e},o.prototype.OnAnyItemRemoved=function(){return!0},o.prototype.OnCleared=function(){return!0},o.prototype.OnAllKeyNamesLoaded=function(){return!0},o.prototype.OnError=function(){return!0},o.prototype.OnItemExists=function(e){return s===e},o.prototype.OnItemMissing=function(e){return s===e},o.prototype.CompareKey=function(e,t){return cr.do_cmp(s,e,t)},o.prototype.CompareValue=function(e,t){return cr.do_cmp(l,e,t)},o.prototype.IsProcessingSets=function(){return 0<this.pendingSets},o.prototype.IsProcessingGets=function(){return 0<this.pendingGets},o.prototype.OnAllSetsComplete=function(){return!0},o.prototype.OnAllGetsComplete=function(){return!0},g.cnds=new o;a.prototype.SetItem=function(r,n){if(localForageInitFailed)return void t(this,"storage failed to initialise - may be disabled in browser settings");var o=c+r;this.pendingSets++;var a=this;localforage.setItem(o,n,function(t,n){_=!0,a.pendingSets--,t?(d=e(t),a.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,a)):(s=r,l=n,a.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemSet,a),a.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemSet,a),s="",l=""),0===a.pendingSets&&a.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAllSetsComplete,a)})},a.prototype.GetItem=function(r){if(localForageInitFailed)return void t(this,"storage failed to initialise - may be disabled in browser settings");var n=c+r;this.pendingGets++;var o=this;localforage.getItem(n,function(t,n){o.pendingGets--,t?(d=e(t),o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,o)):(s=r,l=n,("undefined"==typeof l||null===l)&&(l=""),o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemGet,o),o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemGet,o),s="",l=""),0===o.pendingGets&&o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAllGetsComplete,o)})},a.prototype.CheckItemExists=function(r){if(localForageInitFailed)return void t(this,"storage failed to initialise - may be disabled in browser settings");var n=c+r,o=this;localforage.getItem(n,function(t,n){t?(d=e(t),o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,o)):(s=r,null===n?(l="",o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemMissing,o)):(l=n,o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemExists,o)),s="",l="")})},a.prototype.RemoveItem=function(r){if(localForageInitFailed)return void t(this,"storage failed to initialise - may be disabled in browser settings");var n=c+r,o=this;localforage.removeItem(n,function(t){_=!0,t?(d=e(t),o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,o)):(s=r,l="",o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAnyItemRemoved,o),o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnItemRemoved,o),s="")})},a.prototype.ClearStorage=function(){if(localForageInitFailed)return void t(this,"storage failed to initialise - may be disabled in browser settings");if(!u){var r=this;localforage.clear(function(t){_=!0,t?(d=e(t),r.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,r)):(s="",l="",cr.clearArray(p),r.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnCleared,r))})}},a.prototype.GetAllKeyNames=function(){if(localForageInitFailed)return void t(this,"storage failed to initialise - may be disabled in browser settings");var o=this;localforage.keys(function(t,a){var s,l,c;if(t)d=e(t),o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnError,o);else{for(cr.clearArray(p),s=0,l=a.length;s<l;++s)c=a[s],r(c)&&p.push(n(c));o.runtime.trigger(cr.plugins_.LocalStorage.prototype.cnds.OnAllKeyNamesLoaded,o)}})},g.acts=new a;i.prototype.ItemValue=function(e){e.set_any(l)},i.prototype.Key=function(e){e.set_string(s)},i.prototype.KeyCount=function(e){e.set_int(p.length)},i.prototype.KeyAt=function(e,t){return t=Math.floor(t),0>t||t>=p.length?void e.set_string(""):void e.set_string(p[t])},i.prototype.ErrorMessage=function(e){e.set_string(d)},g.exps=new i}();cr.plugins_.Particles=function(e){this.runtime=e},function(){function e(e){this.owner=e,this.active=!1,this.x=0,this.y=0,this.speed=0,this.angle=0,this.opacity=1,this.grow=0,this.size=0,this.gs=0,this.age=0,cr.seal(this)}function t(){}function r(){}function n(){}var o=cr.plugins_.Particles.prototype;o.Type=function(e){this.plugin=e,this.runtime=e.runtime};var a=o.Type.prototype;a.onCreate=function(){this.is_family||(this.texture_img=new Image,this.texture_img.cr_filesize=this.texture_filesize,this.webGL_texture=null,this.runtime.waitForImageLoad(this.texture_img,this.texture_file))},a.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)},a.onRestoreWebGLContext=function(){!this.is_family&&this.instances.length&&(this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat)))},a.loadTextures=function(){this.is_family||this.webGL_texture||!this.runtime.glwrap||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat))},a.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)},a.preloadCanvas2D=function(e){e.drawImage(this.texture_img,0,0)};e.prototype.init=function(){var e=this.owner;this.x=e.x-e.xrandom/2+Math.random()*e.xrandom,this.y=e.y-e.yrandom/2+Math.random()*e.yrandom,this.speed=e.initspeed-e.speedrandom/2+Math.random()*e.speedrandom,this.angle=e.angle-e.spraycone/2+Math.random()*e.spraycone,this.opacity=e.initopacity,this.size=e.initsize-e.sizerandom/2+Math.random()*e.sizerandom,this.grow=e.growrate-e.growrandom/2+Math.random()*e.growrandom,this.gs=0,this.age=0},e.prototype.tick=function(e){var t=this.owner;return this.x+=Math.cos(this.angle)*this.speed*e,this.y+=Math.sin(this.angle)*this.speed*e,this.y+=this.gs*e,this.speed+=t.acc*e,this.size+=this.grow*e,this.gs+=t.g*e,this.age+=e,1>this.size?void(this.active=!1):void(0!==t.lifeanglerandom&&(this.angle+=Math.random()*t.lifeanglerandom*e-t.lifeanglerandom*e/2),0!==t.lifespeedrandom&&(this.speed+=Math.random()*t.lifespeedrandom*e-t.lifespeedrandom*e/2),0!==t.lifeopacityrandom&&(this.opacity+=Math.random()*t.lifeopacityrandom*e-t.lifeopacityrandom*e/2,0>this.opacity?this.opacity=0:1<this.opacity&&(this.opacity=1)),1>=t.destroymode&&this.age>=t.timeout&&(this.active=!1),2===t.destroymode&&0>=this.speed&&(this.active=!1))},e.prototype.draw=function(e){var t=this.owner.opacity*this.opacity;if(0!=t){0===this.owner.destroymode&&(t*=1-this.age/this.owner.timeout),e.globalAlpha=t;var r=this.x-this.size/2,n=this.y-this.size/2;this.owner.runtime.pixel_rounding&&(r=0|r+.5,n=0|n+.5),e.drawImage(this.owner.type.texture_img,r,n,this.size,this.size)}},e.prototype.drawGL=function(e){var t=this.owner.opacity*this.opacity;0===this.owner.destroymode&&(t*=1-this.age/this.owner.timeout);var r=this.size,n=r*this.owner.particlescale,o=this.x-r/2,a=this.y-r/2;this.owner.runtime.pixel_rounding&&(o=0|o+.5,a=0|a+.5);1>n||0===t||(n<e.minPointSize||n>e.maxPointSize?(e.setOpacity(t),e.quad(o,a,o+r,a,o+r,a+r,o,a+r)):e.point(this.x,this.y,n,t))},e.prototype.left=function(){return this.x-this.size/2},e.prototype.right=function(){return this.x+this.size/2},e.prototype.top=function(){return this.y-this.size/2},e.prototype.bottom=function(){return this.y+this.size/2},o.Instance=function(e){this.type=e,this.runtime=e.runtime};var i=o.Instance.prototype,s=[];i.onCreate=function(){var e=this.properties;if(this.rate=e[0],this.spraycone=cr.to_radians(e[1]),this.spraytype=e[2],this.spraying=!0,this.initspeed=e[3],this.initsize=e[4],this.initopacity=e[5]/100,this.growrate=e[6],this.xrandom=e[7],this.yrandom=e[8],this.speedrandom=e[9],this.sizerandom=e[10],this.growrandom=e[11],this.acc=e[12],this.g=e[13],this.lifeanglerandom=e[14],this.lifespeedrandom=e[15],this.lifeopacityrandom=e[16],this.destroymode=e[17],this.timeout=e[18],this.particleCreateCounter=0,this.particlescale=1,this.particleBoxLeft=this.x,this.particleBoxTop=this.y,this.particleBoxRight=this.x,this.particleBoxBottom=this.y,this.add_bbox_changed_callback(function(e){e.bbox.set(e.particleBoxLeft,e.particleBoxTop,e.particleBoxRight,e.particleBoxBottom),e.bquad.set_from_rect(e.bbox),e.bbox_changed=!1,e.update_collision_cell(),e.update_render_cell()}),this.recycled||(this.particles=[]),this.runtime.tickMe(this),this.type.loadTextures(),1===this.spraytype)for(var t=0;t<this.rate;t++)this.allocateParticle().opacity=0;this.first_tick=!0},i.saveToJSON=function(){var e={r:this.rate,sc:this.spraycone,st:this.spraytype,s:this.spraying,isp:this.initspeed,isz:this.initsize,io:this.initopacity,gr:this.growrate,xr:this.xrandom,yr:this.yrandom,spr:this.speedrandom,szr:this.sizerandom,grnd:this.growrandom,acc:this.acc,g:this.g,lar:this.lifeanglerandom,lsr:this.lifespeedrandom,lor:this.lifeopacityrandom,dm:this.destroymode,to:this.timeout,pcc:this.particleCreateCounter,ft:this.first_tick,p:[]},t=e.p,r,n,o;for(r=0,n=this.particles.length;r<n;r++)o=this.particles[r],t.push([o.x,o.y,o.speed,o.angle,o.opacity,o.grow,o.size,o.gs,o.age]);return e},i.loadFromJSON=function(e){this.rate=e.r,this.spraycone=e.sc,this.spraytype=e.st,this.spraying=e.s,this.initspeed=e.isp,this.initsize=e.isz,this.initopacity=e.io,this.growrate=e.gr,this.xrandom=e.xr,this.yrandom=e.yr,this.speedrandom=e.spr,this.sizerandom=e.szr,this.growrandom=e.grnd,this.acc=e.acc,this.g=e.g,this.lifeanglerandom=e.lar,this.lifespeedrandom=e.lsr,this.lifeopacityrandom=e.lor,this.destroymode=e.dm,this.timeout=e.to,this.particleCreateCounter=e.pcc,this.first_tick=e.ft,s.push.apply(s,this.particles),cr.clearArray(this.particles);var t=e.p,r,n,o,a;for(r=0,n=t.length;r<n;r++)o=this.allocateParticle(),a=t[r],o.x=a[0],o.y=a[1],o.speed=a[2],o.angle=a[3],o.opacity=a[4],o.grow=a[5],o.size=a[6],o.gs=a[7],o.age=a[8]},i.onDestroy=function(){s.push.apply(s,this.particles),cr.clearArray(this.particles)},i.allocateParticle=function(){var t;return s.length?(t=s.pop(),t.owner=this):t=new e(this),this.particles.push(t),t.active=!0,t},i.tick=function(){var e=this.runtime.getDt(this),t,r,o,a,l;if(0===this.spraytype&&this.spraying)for(this.particleCreateCounter+=e*this.rate,a=cr.floor(this.particleCreateCounter),this.particleCreateCounter-=a,t=0;t<a;t++)o=this.allocateParticle(),o.init();for(this.particleBoxLeft=this.x,this.particleBoxTop=this.y,this.particleBoxRight=this.x,this.particleBoxBottom=this.y,(t=0,l=0,r=this.particles.length);t<r;t++){if(o=this.particles[t],this.particles[l]=o,this.runtime.redraw=!0,1===this.spraytype&&this.first_tick&&o.init(),o.tick(e),!o.active){s.push(o);continue}o.left()<this.particleBoxLeft&&(this.particleBoxLeft=o.left()),o.right()>this.particleBoxRight&&(this.particleBoxRight=o.right()),o.top()<this.particleBoxTop&&(this.particleBoxTop=o.top()),o.bottom()>this.particleBoxBottom&&(this.particleBoxBottom=o.bottom()),l++}cr.truncateArray(this.particles,l),this.set_bbox_changed(),this.first_tick=!1,1===this.spraytype&&0===this.particles.length&&this.runtime.DestroyInstance(this)},i.draw=function(e){var t=this.layer,r,n,o;for(r=0,n=this.particles.length;r<n;r++)o=this.particles[r],o.right()>=t.viewLeft&&o.bottom()>=t.viewTop&&o.left()<=t.viewRight&&o.top()<=t.viewBottom&&o.draw(e)},i.drawGL=function(e){this.particlescale=this.layer.getScale(),e.setTexture(this.type.webGL_texture);var t=this.layer,r,n,o;for(r=0,n=this.particles.length;r<n;r++)o=this.particles[r],o.right()>=t.viewLeft&&o.bottom()>=t.viewTop&&o.left()<=t.viewRight&&o.top()<=t.viewBottom&&o.drawGL(e)};t.prototype.IsSpraying=function(){return this.spraying},o.cnds=new t;r.prototype.SetSpraying=function(e){this.spraying=0!==e},r.prototype.SetEffect=function(e){this.blend_mode=e,this.compositeOp=cr.effectToCompositeOp(e),cr.setGLBlend(this,e,this.runtime.gl),this.runtime.redraw=!0},r.prototype.SetRate=function(e){this.rate=e;var t,r;if(1===this.spraytype&&this.first_tick)if(e<this.particles.length)for(t=this.particles.length-e,r=0;r<t;r++)s.push(this.particles.pop());else if(e>this.particles.length)for(t=e-this.particles.length,r=0;r<t;r++)this.allocateParticle().opacity=0},r.prototype.SetSprayCone=function(e){this.spraycone=cr.to_radians(e)},r.prototype.SetInitSpeed=function(e){this.initspeed=e},r.prototype.SetInitSize=function(e){this.initsize=e},r.prototype.SetInitOpacity=function(e){this.initopacity=e/100},r.prototype.SetGrowRate=function(e){this.growrate=e},r.prototype.SetXRandomiser=function(e){this.xrandom=e},r.prototype.SetYRandomiser=function(e){this.yrandom=e},r.prototype.SetSpeedRandomiser=function(e){this.speedrandom=e},r.prototype.SetSizeRandomiser=function(e){this.sizerandom=e},r.prototype.SetGrowRateRandomiser=function(e){this.growrandom=e},r.prototype.SetParticleAcc=function(e){this.acc=e},r.prototype.SetGravity=function(e){this.g=e},r.prototype.SetAngleRandomiser=function(e){this.lifeanglerandom=e},r.prototype.SetLifeSpeedRandomiser=function(e){this.lifespeedrandom=e},r.prototype.SetOpacityRandomiser=function(e){this.lifeopacityrandom=e},r.prototype.SetTimeout=function(e){this.timeout=e},o.acts=new r;n.prototype.ParticleCount=function(e){e.set_int(this.particles.length)},n.prototype.Rate=function(e){e.set_float(this.rate)},n.prototype.SprayCone=function(e){e.set_float(cr.to_degrees(this.spraycone))},n.prototype.InitSpeed=function(e){e.set_float(this.initspeed)},n.prototype.InitSize=function(e){e.set_float(this.initsize)},n.prototype.InitOpacity=function(e){e.set_float(100*this.initopacity)},n.prototype.InitGrowRate=function(e){e.set_float(this.growrate)},n.prototype.XRandom=function(e){e.set_float(this.xrandom)},n.prototype.YRandom=function(e){e.set_float(this.yrandom)},n.prototype.InitSpeedRandom=function(e){e.set_float(this.speedrandom)},n.prototype.InitSizeRandom=function(e){e.set_float(this.sizerandom)},n.prototype.InitGrowRandom=function(e){e.set_float(this.growrandom)},n.prototype.ParticleAcceleration=function(e){e.set_float(this.acc)},n.prototype.Gravity=function(e){e.set_float(this.g)},n.prototype.ParticleAngleRandom=function(e){e.set_float(this.lifeanglerandom)},n.prototype.ParticleSpeedRandom=function(e){e.set_float(this.lifespeedrandom)},n.prototype.ParticleOpacityRandom=function(e){e.set_float(this.lifeopacityrandom)},n.prototype.Timeout=function(e){e.set_float(this.timeout)},o.exps=new n}();cr.plugins_.Sprite=function(e){this.runtime=e},function(){function e(){if(0===this.datauri.length){var e=document.createElement("canvas");e.width=this.width,e.height=this.height;var t=e.getContext("2d");this.spritesheeted?t.drawImage(this.texture_img,this.offx,this.offy,this.width,this.height,0,0,this.width,this.height):t.drawImage(this.texture_img,0,0,this.width,this.height),this.datauri=e.toDataURL("image/png")}return this.datauri}function t(){}function r(){return h.length?h.pop():[0,0,0]}function n(e){e[0]=0,e[1]=0,e[2]=0,h.push(e)}function o(e,t){return e<t?""+e+","+t:""+t+","+e}function a(e,t,n,a){var i=t.uid,s=n.uid,l=o(i,s);if(e.hasOwnProperty(l))return void(e[l][2]=a);var p=r();p[0]=i,p[1]=s,p[2]=a,e[l]=p}function i(e,t,r){var a=o(t.uid,r.uid);e.hasOwnProperty(a)&&(n(e[a]),delete e[a])}function s(e,t){var r=t.uid,o,a;for(o in e)e.hasOwnProperty(o)&&(a=e[o],(a[0]===r||a[1]===r)&&(n(e[o]),delete e[o]))}function p(e,t,r){var n=o(t.uid,r.uid);return e.hasOwnProperty(n)?(f=e[n][2],!0):(f=-2,!1)}function d(e,t,n){if(!e)return!1;var o=0!==t||0!==n,a=!1,i=this.runtime.getCurrentCondition(),s=i.type,l=i.inverted,p=e.getCurrentSol(),d=this.runtime.getCurrentEventStack().current_event.orblock,c,u,g,y,m,_;for(p.select_all?(this.update_bbox(),T.copy(this.bbox),T.offset(t,n),this.runtime.getCollisionCandidates(this.layer,e,T,S),_=S):d?this.runtime.isCurrentConditionFirst()&&!p.else_instances.length&&p.instances.length?_=p.instances:_=p.else_instances:_=p.instances,x=e,w=s!==e&&!l,o&&(c=this.x,u=this.y,this.x+=t,this.y+=n,this.set_bbox_changed()),(g=0,y=_.length);g<y;g++)if(m=_[g],this.runtime.testOverlap(this,m)){if(a=!0,l)break;s!==e&&v.add(m)}return o&&(this.x=c,this.y=u,this.set_bbox_changed()),cr.clearArray(S),a}function c(){}function u(){}var g=cr.plugins_.Sprite.prototype;g.Type=function(e){this.plugin=e,this.runtime=e.runtime};var y=g.Type.prototype;y.onCreate=function(){if(!this.is_family){var t,r,n,o,a,s,l,p,d,c;for(this.all_frames=[],this.has_loaded_textures=!1,(t=0,r=this.animations.length);t<r;t++){for(a=this.animations[t],l={},l.name=a[0],l.speed=a[1],l.loop=a[2],l.repeatcount=a[3],l.repeatto=a[4],l.pingpong=a[5],l.sid=a[6],l.frames=[],(n=0,o=a[7].length);n<o;n++)s=a[7][n],p={},p.texture_file=s[0],p.texture_filesize=s[1],p.offx=s[2],p.offy=s[3],p.width=s[4],p.height=s[5],p.duration=s[6],p.hotspotX=s[7],p.hotspotY=s[8],p.image_points=s[9],p.poly_pts=s[10],p.pixelformat=s[11],p.spritesheeted=0!==p.width,p.datauri="",p.getDataUri=e,c={},c.left=0,c.top=0,c.right=1,c.bottom=1,p.sheetTex=c,p.webGL_texture=null,d=this.runtime.findWaitingTexture(s[0]),d?p.texture_img=d:(p.texture_img=new Image,p.texture_img.cr_src=s[0],p.texture_img.cr_filesize=s[1],p.texture_img.c2webGL_texture=null,this.runtime.waitForImageLoad(p.texture_img,s[0])),cr.seal(p),l.frames.push(p),this.all_frames.push(p);cr.seal(l),this.animations[t]=l}}},y.updateAllCurrentTexture=function(){var e,t,r;for(e=0,t=this.instances.length;e<t;e++)r=this.instances[e],r.curWebGLTexture=r.curFrame.webGL_texture},y.onLostWebGLContext=function(){if(!this.is_family){var e,t,r;for(e=0,t=this.all_frames.length;e<t;++e)r=this.all_frames[e],r.texture_img.c2webGL_texture=null,r.webGL_texture=null;this.has_loaded_textures=!1,this.updateAllCurrentTexture()}},y.onRestoreWebGLContext=function(){if(!this.is_family&&this.instances.length){var e,t,r;for(e=0,t=this.all_frames.length;e<t;++e)r=this.all_frames[e],r.webGL_texture=this.runtime.glwrap.loadTexture(r.texture_img,!1,this.runtime.linearSampling,r.pixelformat);this.updateAllCurrentTexture()}},y.loadTextures=function(){if(!(this.is_family||this.has_loaded_textures||!this.runtime.glwrap)){var e,t,r;for(e=0,t=this.all_frames.length;e<t;++e)r=this.all_frames[e],r.webGL_texture=this.runtime.glwrap.loadTexture(r.texture_img,!1,this.runtime.linearSampling,r.pixelformat);this.has_loaded_textures=!0}},y.unloadTextures=function(){if(!(this.is_family||this.instances.length||!this.has_loaded_textures)){var e,t,r;for(e=0,t=this.all_frames.length;e<t;++e)r=this.all_frames[e],this.runtime.glwrap.deleteTexture(r.webGL_texture),r.webGL_texture=null;this.has_loaded_textures=!1}};var m=[];y.preloadCanvas2D=function(e){var t,r,n;for(cr.clearArray(m),t=0,r=this.all_frames.length;t<r;++t)n=this.all_frames[t].texture_img,-1===m.indexOf(n)&&(e.drawImage(n,0,0),m.push(n))},g.Instance=function(e){this.type=e,this.runtime=e.runtime;var t=this.type.animations[0].frames[0].poly_pts;this.recycled?this.collision_poly.set_pts(t):this.collision_poly=new cr.CollisionPoly(t)};var _=g.Instance.prototype;_.onCreate=function(){this.visible=0===this.properties[0],this.isTicking=!1,this.inAnimTrigger=!1,this.collisionsEnabled=0!==this.properties[3],this.cur_animation=this.getAnimationByName(this.properties[1])||this.type.animations[0],this.cur_frame=this.properties[2],0>this.cur_frame&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1);var e=this.cur_animation.frames[this.cur_frame];this.collision_poly.set_pts(e.poly_pts),this.hotspotX=e.hotspotX,this.hotspotY=e.hotspotY,this.cur_anim_speed=this.cur_animation.speed,this.cur_anim_repeatto=this.cur_animation.repeatto,1===this.type.animations.length&&1===this.type.animations[0].frames.length||0===this.cur_anim_speed||(this.runtime.tickMe(this),this.isTicking=!0),this.recycled?this.animTimer.reset():this.animTimer=new cr.KahanAdder,this.frameStart=this.getNowTime(),this.animPlaying=!0,this.animRepeats=0,this.animForwards=!0,this.animTriggerName="",this.changeAnimName="",this.changeAnimFrom=0,this.changeAnimFrame=-1,this.type.loadTextures();var t,r,n,o,a,s,l,p;for(t=0,r=this.type.animations.length;t<r;t++)for(a=this.type.animations[t],n=0,o=a.frames.length;n<o;n++)s=a.frames[n],0===s.width&&(s.width=s.texture_img.width,s.height=s.texture_img.height),s.spritesheeted&&(p=s.texture_img,l=s.sheetTex,l.left=s.offx/p.width,l.top=s.offy/p.height,l.right=(s.offx+s.width)/p.width,l.bottom=(s.offy+s.height)/p.height,0===s.offx&&0===s.offy&&s.width===p.width&&s.height===p.height&&(s.spritesheeted=!1));this.curFrame=this.cur_animation.frames[this.cur_frame],this.curWebGLTexture=this.curFrame.webGL_texture},_.saveToJSON=function(){var e={a:this.cur_animation.sid,f:this.cur_frame,cas:this.cur_anim_speed,fs:this.frameStart,ar:this.animRepeats,at:this.animTimer.sum,rt:this.cur_anim_repeatto};return this.animPlaying||(e.ap=this.animPlaying),this.animForwards||(e.af=this.animForwards),e},_.loadFromJSON=function(e){var t=this.getAnimationBySid(e.a);t&&(this.cur_animation=t),this.cur_frame=e.f,0>this.cur_frame&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),this.cur_anim_speed=e.cas,this.frameStart=e.fs,this.animRepeats=e.ar,this.animTimer.reset(),this.animTimer.sum=e.at,this.animPlaying=!e.hasOwnProperty("ap")||e.ap,this.animForwards=!e.hasOwnProperty("af")||e.af,this.cur_anim_repeatto=e.hasOwnProperty("rt")?e.rt:this.cur_animation.repeatto,this.curFrame=this.cur_animation.frames[this.cur_frame],this.curWebGLTexture=this.curFrame.webGL_texture,this.collision_poly.set_pts(this.curFrame.poly_pts),this.hotspotX=this.curFrame.hotspotX,this.hotspotY=this.curFrame.hotspotY},_.animationFinish=function(e){this.cur_frame=e?0:this.cur_animation.frames.length-1,this.animPlaying=!1,this.animTriggerName=this.cur_animation.name,this.inAnimTrigger=!0,this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnyAnimFinished,this),this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnAnimFinished,this),this.inAnimTrigger=!1,this.animRepeats=0},_.getNowTime=function(){return this.animTimer.sum},_.tick=function(){this.animTimer.add(this.runtime.getDt(this)),this.changeAnimName.length&&this.doChangeAnim(),0<=this.changeAnimFrame&&this.doChangeAnimFrame();var e=this.getNowTime(),t=this.cur_animation,r=t.frames[this.cur_frame],n=r.duration/this.cur_anim_speed,o;this.animPlaying&&e>=this.frameStart+n&&(this.animForwards?this.cur_frame++:this.cur_frame--,this.frameStart+=n,this.cur_frame>=t.frames.length&&(t.pingpong?(this.animForwards=!1,this.cur_frame=t.frames.length-2):t.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=t.repeatcount?this.animationFinish(!1):this.cur_frame=this.cur_anim_repeatto)),0>this.cur_frame&&(t.pingpong?(this.cur_frame=1,this.animForwards=!0,!t.loop&&(this.animRepeats++,this.animRepeats>=t.repeatcount&&this.animationFinish(!0))):t.loop?this.cur_frame=this.cur_anim_repeatto:(this.animRepeats++,this.animRepeats>=t.repeatcount?this.animationFinish(!0):this.cur_frame=this.cur_anim_repeatto)),0>this.cur_frame?this.cur_frame=0:this.cur_frame>=t.frames.length&&(this.cur_frame=t.frames.length-1),e>this.frameStart+t.frames[this.cur_frame].duration/this.cur_anim_speed&&(this.frameStart=e),o=t.frames[this.cur_frame],this.OnFrameChanged(r,o),this.runtime.redraw=!0)},_.getAnimationByName=function(e){var t,r,n;for(t=0,r=this.type.animations.length;t<r;t++)if(n=this.type.animations[t],cr.equals_nocase(n.name,e))return n;return null},_.getAnimationBySid=function(e){var t,r,n;for(t=0,r=this.type.animations.length;t<r;t++)if(n=this.type.animations[t],n.sid===e)return n;return null},_.doChangeAnim=function(){var e=this.cur_animation.frames[this.cur_frame],t=this.getAnimationByName(this.changeAnimName);this.changeAnimName="";!t||cr.equals_nocase(t.name,this.cur_animation.name)&&this.animPlaying||(this.cur_animation=t,this.cur_anim_speed=t.speed,this.cur_anim_repeatto=t.repeatto,0>this.cur_frame&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),1===this.changeAnimFrom&&(this.cur_frame=0),this.animPlaying=!0,this.frameStart=this.getNowTime(),this.animForwards=!0,this.OnFrameChanged(e,this.cur_animation.frames[this.cur_frame]),this.runtime.redraw=!0)},_.doChangeAnimFrame=function(){var e=this.cur_animation.frames[this.cur_frame],t=this.cur_frame;this.cur_frame=cr.floor(this.changeAnimFrame),0>this.cur_frame&&(this.cur_frame=0),this.cur_frame>=this.cur_animation.frames.length&&(this.cur_frame=this.cur_animation.frames.length-1),t!==this.cur_frame&&(this.OnFrameChanged(e,this.cur_animation.frames[this.cur_frame]),this.frameStart=this.getNowTime(),this.runtime.redraw=!0),this.changeAnimFrame=-1},_.OnFrameChanged=function(e,t){var r=e.width,n=e.height,o=t.width,a=t.height;r!=o&&(this.width*=o/r),n!=a&&(this.height*=a/n),this.hotspotX=t.hotspotX,this.hotspotY=t.hotspotY,this.collision_poly.set_pts(t.poly_pts),this.set_bbox_changed(),this.curFrame=t,this.curWebGLTexture=t.webGL_texture;var s,l,p;for(s=0,l=this.behavior_insts.length;s<l;s++)p=this.behavior_insts[s],p.onSpriteFrameChanged&&p.onSpriteFrameChanged(e,t);this.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnFrameChanged,this)},_.draw=function(e){e.globalAlpha=this.opacity;var t=this.curFrame,r=t.spritesheeted,n=t.texture_img,o=this.x,a=this.y,i=this.width,s=this.height;if(0===this.angle&&0<=i&&0<=s)o-=this.hotspotX*i,a-=this.hotspotY*s,this.runtime.pixel_rounding&&(o=Math.round(o),a=Math.round(a)),r?e.drawImage(n,t.offx,t.offy,t.width,t.height,o,a,i,s):e.drawImage(n,o,a,i,s);else{this.runtime.pixel_rounding&&(o=Math.round(o),a=Math.round(a)),e.save();var l=0<i?1:-1,p=0<s?1:-1;e.translate(o,a),(1!=l||1!==p)&&e.scale(l,p),e.rotate(this.angle*l*p);var d=0-this.hotspotX*cr.abs(i),c=0-this.hotspotY*cr.abs(s);r?e.drawImage(n,t.offx,t.offy,t.width,t.height,d,c,cr.abs(i),cr.abs(s)):e.drawImage(n,d,c,cr.abs(i),cr.abs(s)),e.restore()}},_.drawGL_earlyZPass=function(e){this.drawGL(e)},_.drawGL=function(e){e.setTexture(this.curWebGLTexture),e.setOpacity(this.opacity);var t=this.curFrame,r=this.bquad;if(this.runtime.pixel_rounding){var n=Math.round(this.x)-this.x,o=Math.round(this.y)-this.y;t.spritesheeted?e.quadTex(r.tlx+n,r.tly+o,r.trx+n,r.try_+o,r.brx+n,r.bry+o,r.blx+n,r.bly+o,t.sheetTex):e.quad(r.tlx+n,r.tly+o,r.trx+n,r.try_+o,r.brx+n,r.bry+o,r.blx+n,r.bly+o)}else t.spritesheeted?e.quadTex(r.tlx,r.tly,r.trx,r.try_,r.brx,r.bry,r.blx,r.bly,t.sheetTex):e.quad(r.tlx,r.tly,r.trx,r.try_,r.brx,r.bry,r.blx,r.bly)},_.getImagePointIndexByName=function(e){var t=this.curFrame,r,n;for(r=0,n=t.image_points.length;r<n;r++)if(cr.equals_nocase(e,t.image_points[r][0]))return r;return-1},_.getImagePoint=function(e,t){var r=this.curFrame,n=r.image_points,o;if(o=cr.is_string(e)?this.getImagePointIndexByName(e):e-1,o=cr.floor(o),0>o||o>=n.length)return t?this.x:this.y;var a=(n[o][1]-r.hotspotX)*this.width,i=n[o][2];i=(i-r.hotspotY)*this.height;var s=Math.cos(this.angle),l=Math.sin(this.angle),p=a*s-i*l;return i=i*s+a*l,a=p,a+=this.x,i+=this.y,t?a:i};var h=[];var f=-2;var b=[];t.prototype.OnCollision=function(e){if(!e)return!1;var t=this.runtime,n=t.getCurrentCondition(),o=n.type,d=null;n.extra.collmemory?d=n.extra.collmemory:(d={},n.extra.collmemory=d),n.extra.spriteCreatedDestroyCallback||(n.extra.spriteCreatedDestroyCallback=!0,t.addDestroyCallback(function(e){s(n.extra.collmemory,e)}));var c=o.getCurrentSol(),u=e.getCurrentSol(),g=c.getObjects(),y=this.runtime.tickcount,m=t.getCurrentEventStack().current_event,_=m.orblock,h,x,v,w,S,T,C,O,A;for(x=0;x<g.length;x++){for(v=g[x],u.select_all?(v.update_bbox(),this.runtime.getCollisionCandidates(v.layer,e,v.bbox,b),h=b,this.runtime.addRegisteredCollisionCandidates(v,e,h)):h=u.getObjects(),w=0;w<h.length;w++)S=h[w],t.testOverlap(v,S)||t.checkRegisteredCollision(v,S)?(O=p(d,v,S),A=!O||f<y-1,a(d,v,S,y),A&&(t.pushCopySol(m.solModifiers),T=o.getCurrentSol(),C=e.getCurrentSol(),T.select_all=!1,C.select_all=!1,o===e?(T.instances.length=2,T.instances[0]=v,T.instances[1]=S,o.applySolToContainer()):(T.instances.length=1,C.instances.length=1,T.instances[0]=v,C.instances[0]=S,o.applySolToContainer(),e.applySolToContainer()),m.retrigger(),t.popSol(m.solModifiers))):i(d,v,S);cr.clearArray(b)}return!1};var x=null,v=new cr.ObjectSet,w=!1,S=[],T=new cr.rect(0,0,0,0);y.finish=function(e){if(w){if(e){var t=this.runtime.getCurrentEventStack().current_event.orblock,r=x.getCurrentSol(),n=v.valuesRef(),o,a,s;if(r.select_all){for(r.select_all=!1,cr.clearArray(r.instances),(o=0,a=n.length);o<a;++o)r.instances[o]=n[o];if(t)for(cr.clearArray(r.else_instances),o=0,a=x.instances.length;o<a;++o)s=x.instances[o],v.contains(s)||r.else_instances.push(s)}else if(t){var l=r.instances.length;for(o=0,a=n.length;o<a;++o)r.instances[l+o]=n[o],cr.arrayFindRemove(r.else_instances,n[o])}else cr.shallowAssignArray(r.instances,n);x.applySolToContainer()}v.clear(),w=!1}},t.prototype.IsOverlapping=function(e){return d.call(this,e,0,0)},t.prototype.IsOverlappingOffset=function(e,t,r){return d.call(this,e,t,r)},t.prototype.IsAnimPlaying=function(e){return this.changeAnimName.length?cr.equals_nocase(this.changeAnimName,e):cr.equals_nocase(this.cur_animation.name,e)},t.prototype.CompareFrame=function(e,t){return cr.do_cmp(this.cur_frame,e,t)},t.prototype.CompareAnimSpeed=function(e,t){var r=this.animForwards?this.cur_anim_speed:-this.cur_anim_speed;return cr.do_cmp(r,e,t)},t.prototype.OnAnimFinished=function(e){return cr.equals_nocase(this.animTriggerName,e)},t.prototype.OnAnyAnimFinished=function(){return!0},t.prototype.OnFrameChanged=function(){return!0},t.prototype.IsMirrored=function(){return 0>this.width},t.prototype.IsFlipped=function(){return 0>this.height},t.prototype.OnURLLoaded=function(){return!0},t.prototype.IsCollisionEnabled=function(){return this.collisionsEnabled},g.cnds=new t;c.prototype.Spawn=function(e,t,r){if(e&&t){var n=this.runtime.createInstance(e,t,this.getImagePoint(r,!0),this.getImagePoint(r,!1));if(n){"undefined"!=typeof n.angle&&(n.angle=this.angle,n.set_bbox_changed()),this.runtime.isInOnDestroy++;var o,a,l;if(this.runtime.trigger(Object.getPrototypeOf(e.plugin).cnds.OnCreated,n),n.is_contained)for(o=0,a=n.siblings.length;o<a;o++)l=n.siblings[o],this.runtime.trigger(Object.getPrototypeOf(l.type.plugin).cnds.OnCreated,l);this.runtime.isInOnDestroy--;var p=this.runtime.getCurrentAction(),d=!1;(cr.is_undefined(p.extra.Spawn_LastExec)||p.extra.Spawn_LastExec<this.runtime.execcount)&&(d=!0,p.extra.Spawn_LastExec=this.runtime.execcount);var c;if(e!=this.type&&(c=e.getCurrentSol(),c.select_all=!1,d?(cr.clearArray(c.instances),c.instances[0]=n):c.instances.push(n),n.is_contained))for(o=0,a=n.siblings.length;o<a;o++)l=n.siblings[o],c=l.type.getCurrentSol(),c.select_all=!1,d?(cr.clearArray(c.instances),c.instances[0]=l):c.instances.push(l)}}},c.prototype.SetEffect=function(e){this.blend_mode=e,this.compositeOp=cr.effectToCompositeOp(e),cr.setGLBlend(this,e,this.runtime.gl),this.runtime.redraw=!0},c.prototype.StopAnim=function(){this.animPlaying=!1},c.prototype.StartAnim=function(e){this.animPlaying=!0,this.frameStart=this.getNowTime(),1===e&&0!==this.cur_frame&&(this.changeAnimFrame=0,!this.inAnimTrigger&&this.doChangeAnimFrame()),this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)},c.prototype.SetAnim=function(e,t){this.changeAnimName=e,this.changeAnimFrom=t,this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0),this.inAnimTrigger||this.doChangeAnim()},c.prototype.SetAnimFrame=function(e){this.changeAnimFrame=e,this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0),this.inAnimTrigger||this.doChangeAnimFrame()},c.prototype.SetAnimSpeed=function(e){this.cur_anim_speed=cr.abs(e),this.animForwards=0<=e,this.isTicking||(this.runtime.tickMe(this),this.isTicking=!0)},c.prototype.SetAnimRepeatToFrame=function(e){e=Math.floor(e),0>e&&(e=0),e>=this.cur_animation.frames.length&&(e=this.cur_animation.frames.length-1),this.cur_anim_repeatto=e},c.prototype.SetMirrored=function(e){var t=cr.abs(this.width)*(0===e?-1:1);this.width===t||(this.width=t,this.set_bbox_changed())},c.prototype.SetFlipped=function(e){var t=cr.abs(this.height)*(0===e?-1:1);this.height===t||(this.height=t,this.set_bbox_changed())},c.prototype.SetScale=function(e){var t=this.curFrame,r=0>this.width?-1:1,n=0>this.height?-1:1,o=t.width*e*r,a=t.height*e*n;(this.width!==o||this.height!==a)&&(this.width=o,this.height=a,this.set_bbox_changed())},c.prototype.LoadURL=function(e,t,r){var n=new Image,o=this,a=this.curFrame;n.onload=function(){return a.texture_img.src===n.src?(o.runtime.glwrap&&o.curFrame===a&&(o.curWebGLTexture=a.webGL_texture),0===t&&(o.width=n.width,o.height=n.height,o.set_bbox_changed()),o.runtime.redraw=!0,void o.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,o)):void(a.texture_img=n,a.offx=0,a.offy=0,a.width=n.width,a.height=n.height,a.spritesheeted=!1,a.datauri="",a.pixelformat=0,o.runtime.glwrap&&(a.webGL_texture&&o.runtime.glwrap.deleteTexture(a.webGL_texture),a.webGL_texture=o.runtime.glwrap.loadTexture(n,!1,o.runtime.linearSampling),o.curFrame===a&&(o.curWebGLTexture=a.webGL_texture),o.type.updateAllCurrentTexture()),0===t&&(o.width=n.width,o.height=n.height,o.set_bbox_changed()),o.runtime.redraw=!0,o.runtime.trigger(cr.plugins_.Sprite.prototype.cnds.OnURLLoaded,o))},"data:"!==e.substr(0,5)&&0===r&&(n.crossOrigin="anonymous"),this.runtime.setImageSrc(n,e)},c.prototype.SetCollisions=function(e){this.collisionsEnabled===(0!==e)||(this.collisionsEnabled=0!==e,this.collisionsEnabled?this.set_bbox_changed():(this.collcells.right>=this.collcells.left&&this.type.collision_grid.update(this,this.collcells,null),this.collcells.set(0,0,-1,-1)))},g.acts=new c;u.prototype.AnimationFrame=function(e){e.set_int(this.cur_frame)},u.prototype.AnimationFrameCount=function(e){e.set_int(this.cur_animation.frames.length)},u.prototype.AnimationName=function(e){e.set_string(this.cur_animation.name)},u.prototype.AnimationSpeed=function(e){e.set_float(this.animForwards?this.cur_anim_speed:-this.cur_anim_speed)},u.prototype.ImagePointX=function(e,t){e.set_float(this.getImagePoint(t,!0))},u.prototype.ImagePointY=function(e,t){e.set_float(this.getImagePoint(t,!1))},u.prototype.ImagePointCount=function(e){e.set_int(this.curFrame.image_points.length)},u.prototype.ImageWidth=function(e){e.set_float(this.curFrame.width)},u.prototype.ImageHeight=function(e){e.set_float(this.curFrame.height)},g.exps=new u}();cr.plugins_.Spritefont2=function(e){this.runtime=e},function(){function e(e){return e.replace(/\s\s*$/,"")}function t(e,t){return e.length?e.pop():new t}function r(e,t){e.length<1000&&e.push(t)}function n(e,t,n){if(n){var o,a;for(o=0,a=t.length;o<a;o++)r(e,t[o]);cr.clearArray(t)}else{for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(r(e,t[s]),delete t[s])}}function o(t,r,n){var o=t.lines,i;n=e(n),r>=o.length&&o.push(a()),i=o[r],i.text=n,i.width=t.measureWidth(n),t.textWidth=cr.max(t.textWidth,i.width)}function a(){return t(v,Object)}function s(e){r(v,e)}function l(e){n(v,e,!0)}function p(e,r,n,o,a,i){e[r]===void 0&&(e[r]=t(S,Object)),e[r].x=n,e[r].y=o,e[r].w=a,e[r].h=i}function d(e){n(S,e,!1)}function u(e,r,n,o,a,i){e[r]===void 0&&(e[r]=t(T,cr.rect)),e[r].left=n,e[r].top=o,e[r].right=a,e[r].bottom=i}function g(e){n(T,e,!1)}function y(e,t,r){var n;n=e.tlx*t-e.tly*r,e.tly=e.tly*t+e.tlx*r,e.tlx=n,n=e.trx*t-e.try_*r,e.try_=e.try_*t+e.trx*r,e.trx=n,n=e.blx*t-e.bly*r,e.bly=e.bly*t+e.blx*r,e.blx=n,n=e.brx*t-e.bry*r,e.bry=e.bry*t+e.brx*r,e.brx=n}function m(){}function _(){}function h(){}var f=cr.plugins_.Spritefont2.prototype;f.onCreate=function(){},f.Type=function(e){this.plugin=e,this.runtime=e.runtime};var b=f.Type.prototype;b.onCreate=function(){this.is_family||(this.texture_img=new Image,this.runtime.waitForImageLoad(this.texture_img,this.texture_file),this.webGL_texture=null)},b.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)},b.onRestoreWebGLContext=function(){if(!this.is_family&&this.instances.length){this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!1,this.runtime.linearSampling,this.texture_pixelformat));var e,t;for(e=0,t=this.instances.length;e<t;e++)this.instances[e].webGL_texture=this.webGL_texture}},b.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)},b.preloadCanvas2D=function(e){e.drawImage(this.texture_img,0,0)},f.Instance=function(e){this.type=e,this.runtime=e.runtime};var x=f.Instance.prototype;x.onDestroy=function(){l(this.lines),d(this.clipList),g(this.clipUV),cr.wipe(this.characterWidthList)},x.onCreate=function(){this.texture_img=this.type.texture_img,this.characterWidth=this.properties[0],this.characterHeight=this.properties[1],this.characterSet=this.properties[2],this.text=this.properties[3],this.characterScale=this.properties[4],this.visible=0===this.properties[5],this.halign=this.properties[6]/2,this.valign=this.properties[7]/2,this.wrapbyword=0===this.properties[9],this.characterSpacing=this.properties[10],this.lineHeight=this.properties[11],this.textWidth=0,this.textHeight=0,this.recycled?(cr.clearArray(this.lines),cr.wipe(this.clipList),cr.wipe(this.clipUV),cr.wipe(this.characterWidthList)):(this.lines=[],this.clipList={},this.clipUV={},this.characterWidthList={}),this.text_changed=!0,this.lastwrapwidth=this.width,this.runtime.glwrap&&(!this.type.webGL_texture&&(this.type.webGL_texture=this.runtime.glwrap.loadTexture(this.type.texture_img,!1,this.runtime.linearSampling,this.type.texture_pixelformat)),this.webGL_texture=this.type.webGL_texture),this.SplitSheet()},x.saveToJSON=function(){var e={t:this.text,csc:this.characterScale,csp:this.characterSpacing,lh:this.lineHeight,tw:this.textWidth,th:this.textHeight,lrt:this.last_render_tick,ha:this.halign,va:this.valign,cw:{}};for(var t in this.characterWidthList)e.cw[t]=this.characterWidthList[t];return e},x.loadFromJSON=function(e){for(var t in this.text=e.t,this.characterScale=e.csc,this.characterSpacing=e.csp,this.lineHeight=e.lh,this.textWidth=e.tw,this.textHeight=e.th,this.last_render_tick=e.lrt,e.hasOwnProperty("ha")&&(this.halign=e.ha),e.hasOwnProperty("va")&&(this.valign=e.va),e.cw)this.characterWidthList[t]=e.cw[t];this.text_changed=!0,this.lastwrapwidth=this.width};var v=[],S=[],T=[];x.SplitSheet=function(){for(var e=this.texture_img,t=e.width,r=e.height,n=this.characterWidth,o=this.characterHeight,a=n/t,i=o/r,s=this.characterSet,l=Math.floor(t/n),d=Math.floor(r/o),g=0;g<s.length&&!(g>=l*d);g++){var m=g%l,_=Math.floor(g/l),y=s.charAt(g);this.runtime.glwrap?u(this.clipUV,y,m*a,_*i,(m+1)*a,(_+1)*i):p(this.clipList,y,m*n,_*o,n,o)}};var C=[];f.TokeniseWords=function(e){cr.clearArray(C);for(var t="",r=0,n;r<e.length;)if(n=e.charAt(r),"\n"===n)t.length&&(C.push(t),t=""),C.push("\n"),++r;else if(" "===n||"\t"===n||"-"===n){do t+=e.charAt(r),r++;while(r<e.length&&(" "===e.charAt(r)||"\t"===e.charAt(r)));C.push(t),t=""}else r<e.length&&(t+=n,r++);t.length&&C.push(t)},f.WordWrap=function(e){var t=e.text,r=e.lines;if(!t||!t.length)return void l(r);var n=e.width;if(2>=n)return void l(r);var o=e.characterWidth,i=e.characterScale,s=e.characterSpacing;if(t.length*(o*i+s)-s<=n&&-1===t.indexOf("\n")){var p=e.measureWidth(t);if(p<=n)return l(r),r.push(a()),r[0].text=t,r[0].width=p,e.textWidth=p,void(e.textHeight=e.characterHeight*i+e.lineHeight)}e.wrapbyword;this.WrapText(e),e.textHeight=r.length*(e.characterHeight*i+e.lineHeight)},f.WrapText=function(t){var r=t.wrapbyword,n=t.text,a=t.lines,l=t.width,p;r?(this.TokeniseWords(n),p=C):p=n;var d="",c=0,u=!1,g,y,m;for(m=0;m<p.length;m++){if("\n"===p[m]){!0===u?u=!1:(o(t,c,d),c++),d="";continue}u=!1,g=d,d+=p[m],y=t.measureWidth(e(d)),y>l&&(""===g?(o(t,c,d),d="",u=!0):(o(t,c,g),d=p[m]),c++,!r&&" "===d&&(d=""))}for(e(d).length&&(o(t,c,d),c++),m=c;m<a.length;m++)s(a[m]);a.length=c},x.measureWidth=function(e){for(var t=this.characterSpacing,r=e.length,n=0,o=0;o<r;o++)n+=this.getCharacterWidth(e.charAt(o))*this.characterScale+t;return n-=0<n?t:0,n},x.getCharacterWidth=function(e){var t=this.characterWidthList;return void 0===t[e]?this.characterWidth:t[e]},x.rebuildText=function(){(this.text_changed||this.width!==this.lastwrapwidth)&&(this.textWidth=0,this.textHeight=0,this.type.plugin.WordWrap(this),this.text_changed=!1,this.lastwrapwidth=this.width)};var O=1e-5;x.draw=function(e){var t=this.texture_img;if(""!==this.text&&null!=t){if(this.rebuildText(),this.height<this.characterHeight*this.characterScale+this.lineHeight)return;e.globalAlpha=this.opacity;var r=this.x,n=this.y;this.runtime.pixel_rounding&&(r=Math.round(r),n=Math.round(n));var o=this.layer.viewLeft,a=this.layer.viewTop,s=this.layer.viewRight,l=this.layer.viewBottom;e.save(),e.translate(r,n),e.rotate(this.angle);var p=this.angle,d=this.halign,c=this.valign,u=this.characterScale,g=this.characterHeight*u,y=this.lineHeight,m=this.characterSpacing,_=this.lines,h=this.textHeight,f=c*cr.max(0,this.height-h),b=-(this.hotspotX*this.width),x=-(this.hotspotY*this.height),v,w;x+=f;for(var S=x,T=0,C,A,E;T<_.length;T++){var P=_[T].text,I=_[T].width;if(w=d*cr.max(0,this.width-I),C=b+w,S+=y,0===p&&n+S+g<a){S+=g;continue}for(var k=0,L;k<P.length;k++){L=P.charAt(k),v=this.getCharacterWidth(L);var R=this.clipList[L];if(0===p&&r+C+v*u+m<o){C+=v*u+m;continue}if(C+v*u>this.width+O)break;if(void 0!==R&&(A=C,E=S,0===p&&1===u&&(A=Math.round(A),E=Math.round(E)),e.drawImage(this.texture_img,R.x,R.y,R.w,R.h,A,E,R.w*u,R.h*u)),C+=v*u+m,0===p&&r+C>s)break}if(S+=g,0===p&&(S+g+y>this.height||n+S>l))break}e.restore()}};var A=new cr.quad;x.drawGL=function(e){if((e.setTexture(this.webGL_texture),e.setOpacity(this.opacity),!!this.text)&&(this.rebuildText(),!(this.height<this.characterHeight*this.characterScale+this.lineHeight))){this.update_bbox();var t=this.bquad,r=0,n=0;this.runtime.pixel_rounding&&(r=Math.round(this.x)-this.x,n=Math.round(this.y)-this.y);var o=this.layer.viewLeft,a=this.layer.viewTop,s=this.layer.viewRight,l=this.layer.viewBottom,p=this.angle,d=this.halign,c=this.valign,u=this.characterScale,g=this.characterHeight*u,m=this.lineHeight,_=this.characterSpacing,h=this.lines,f=this.textHeight,b,x,v;0!==p&&(x=Math.cos(p),v=Math.sin(p));for(var w=c*cr.max(0,this.height-f),S=t.tlx+r,T=t.tly+n,C=w,E=0,P,I,k,L;E<h.length;E++){var R=h[E].text,B=h[E].width;if(P=d*cr.max(0,this.width-B),I=P,C+=m,0===p&&T+C+g<a){C+=g;continue}for(var F=0,N;F<R.length;F++){N=R.charAt(F),b=this.getCharacterWidth(N);var D=this.clipUV[N];if(0===p&&S+I+b*u+_<o){I+=b*u+_;continue}if(I+b*u>this.width+O)break;if(void 0!==D){var M=this.characterWidth*u,W=this.characterHeight*u;k=I,L=C,0===p&&1===u&&(k=Math.round(k),L=Math.round(L)),A.tlx=k,A.tly=L,A.trx=k+M,A.try_=L,A.blx=k,A.bly=L+W,A.brx=k+M,A.bry=L+W,0!==p&&y(A,x,v),A.offset(S,T),e.quadTex(A.tlx,A.tly,A.trx,A.try_,A.brx,A.bry,A.blx,A.bly,D)}if(I+=b*u+_,0===p&&S+I>s)break}if(C+=g,0===p&&(C+g+m>this.height||T+C>l))break}}},m.prototype.CompareText=function(e,t){return t?this.text==e:cr.equals_nocase(this.text,e)},f.cnds=new m,_.prototype.SetText=function(e){cr.is_number(e)&&1e9>e&&(e=Math.round(1e10*e)/1e10);var t=e.toString();this.text!==t&&(this.text=t,this.text_changed=!0,this.runtime.redraw=!0)},_.prototype.AppendText=function(e){cr.is_number(e)&&(e=Math.round(1e10*e)/1e10);var t=e.toString();t&&(this.text+=t,this.text_changed=!0,this.runtime.redraw=!0)},_.prototype.SetScale=function(e){e!==this.characterScale&&(this.characterScale=e,this.text_changed=!0,this.runtime.redraw=!0)},_.prototype.SetCharacterSpacing=function(e){e!==this.CharacterSpacing&&(this.characterSpacing=e,this.text_changed=!0,this.runtime.redraw=!0)},_.prototype.SetLineHeight=function(e){e!==this.lineHeight&&(this.lineHeight=e,this.text_changed=!0,this.runtime.redraw=!0)},x.SetCharWidth=function(e,t){var r=parseInt(t,10);this.characterWidthList[e]!==r&&(this.characterWidthList[e]=r,this.text_changed=!0,this.runtime.redraw=!0)},_.prototype.SetCharacterWidth=function(e,t){if(""!==e)for(var r=0;r<e.length;r++)this.SetCharWidth(e.charAt(r),t)},_.prototype.SetEffect=function(e){this.blend_mode=e,this.compositeOp=cr.effectToCompositeOp(e),cr.setGLBlend(this,e,this.runtime.gl),this.runtime.redraw=!0},_.prototype.SetHAlign=function(e){this.halign=e/2,this.text_changed=!0,this.runtime.redraw=!0},_.prototype.SetVAlign=function(e){this.valign=e/2,this.text_changed=!0,this.runtime.redraw=!0},f.acts=new _,h.prototype.CharacterWidth=function(e,t){e.set_int(this.getCharacterWidth(t))},h.prototype.CharacterHeight=function(e){e.set_int(this.characterHeight)},h.prototype.CharacterScale=function(e){e.set_float(this.characterScale)},h.prototype.CharacterSpacing=function(e){e.set_int(this.characterSpacing)},h.prototype.LineHeight=function(e){e.set_int(this.lineHeight)},h.prototype.Text=function(e){e.set_string(this.text)},h.prototype.TextWidth=function(e){this.rebuildText(),e.set_float(this.textWidth)},h.prototype.TextHeight=function(e){this.rebuildText(),e.set_float(this.textHeight)},f.exps=new h}();cr.plugins_.Text=function(e){this.runtime=e},function(){function e(){return u.length?u.pop():{}}function t(e){u.push(e)}function r(e){var r,n;for(r=0,n=e.length;r<n;r++)t(e[r]);cr.clearArray(e)}function n(e){return e.length&&" "===e.charAt(e.length-1)?e.substring(0,e.length-1):e}function o(){}function a(){}function i(){}var s=cr.plugins_.Text.prototype;s.onCreate=function(){s.acts.SetWidth=function(e){this.width!==e&&(this.width=e,this.text_changed=!0,this.set_bbox_changed())}},s.Type=function(e){this.plugin=e,this.runtime=e.runtime};var l=s.Type.prototype;l.onCreate=function(){},l.onLostWebGLContext=function(){if(!this.is_family){var e,t,r;for(e=0,t=this.instances.length;e<t;e++)r=this.instances[e],r.mycanvas=null,r.myctx=null,r.mytex=null}},s.Instance=function(e){this.type=e,this.runtime=e.runtime,this.recycled?cr.clearArray(this.lines):this.lines=[],this.text_changed=!0};var p=s.Instance.prototype,d={};p.onCreate=function(){this.text=this.properties[0],this.visible=0===this.properties[1],this.font=this.properties[2],this.color=this.properties[3],this.halign=this.properties[4],this.valign=this.properties[5],this.wrapbyword=0===this.properties[7],this.lastwidth=this.width,this.lastwrapwidth=this.width,this.lastheight=this.height,this.line_height_offset=this.properties[8],this.facename="",this.fontstyle="",this.ptSize=0,this.textWidth=0,this.textHeight=0,this.parseFont(),this.mycanvas=null,this.myctx=null,this.mytex=null,this.need_text_redraw=!1,this.last_render_tick=this.runtime.tickcount,this.recycled?this.rcTex.set(0,0,1,1):this.rcTex=new cr.rect(0,0,1,1),this.runtime.glwrap&&this.runtime.tickMe(this)},p.parseFont=function(){var e=this.font.split(" "),t;for(t=0;t<e.length;t++)if("pt"===e[t].substr(e[t].length-2,2)){for(this.ptSize=parseInt(e[t].substr(0,e[t].length-2)),this.pxHeight=Math.ceil(96*(this.ptSize/72))+4,0<t&&(this.fontstyle=e[t-1]),this.facename=e[t+1],t+=2;t<e.length;t++)this.facename+=" "+e[t];break}},p.saveToJSON=function(){return{t:this.text,f:this.font,c:this.color,ha:this.halign,va:this.valign,wr:this.wrapbyword,lho:this.line_height_offset,fn:this.facename,fs:this.fontstyle,ps:this.ptSize,pxh:this.pxHeight,tw:this.textWidth,th:this.textHeight,lrt:this.last_render_tick}},p.loadFromJSON=function(e){this.text=e.t,this.font=e.f,this.color=e.c,this.halign=e.ha,this.valign=e.va,this.wrapbyword=e.wr,this.line_height_offset=e.lho,this.facename=e.fn,this.fontstyle=e.fs,this.ptSize=e.ps,this.pxHeight=e.pxh,this.textWidth=e.tw,this.textHeight=e.th,this.last_render_tick=e.lrt,this.text_changed=!0,this.lastwidth=this.width,this.lastwrapwidth=this.width,this.lastheight=this.height},p.tick=function(){if(this.runtime.glwrap&&this.mytex&&300<=this.runtime.tickcount-this.last_render_tick){var e=this.layer;this.update_bbox();var t=this.bbox;(t.right<e.viewLeft||t.bottom<e.viewTop||t.left>e.viewRight||t.top>e.viewBottom)&&(this.runtime.glwrap.deleteTexture(this.mytex),this.mytex=null,this.myctx=null,this.mycanvas=null)}},p.onDestroy=function(){this.myctx=null,this.mycanvas=null,this.runtime.glwrap&&this.mytex&&this.runtime.glwrap.deleteTexture(this.mytex),this.mytex=null},p.updateFont=function(){this.font=this.fontstyle+" "+this.ptSize.toString()+"pt "+this.facename,this.text_changed=!0,this.runtime.redraw=!0},p.draw=function(e,t){e.font=this.font,e.textBaseline="top",e.fillStyle=this.color,e.globalAlpha=t?1:this.opacity;var r=1;t&&(r=Math.abs(this.layer.getScale()),e.save(),e.scale(r,r)),(this.text_changed||this.width!==this.lastwrapwidth)&&(this.type.plugin.WordWrap(this.text,this.lines,e,this.width,this.wrapbyword),this.text_changed=!1,this.lastwrapwidth=this.width),this.update_bbox();var n=t?0:this.bquad.tlx,o=t?0:this.bquad.tly;this.runtime.pixel_rounding&&(n=0|n+.5,o=0|o+.5),0===this.angle||t||(e.save(),e.translate(n,o),e.rotate(this.angle),n=0,o=0);var a=o+this.height,s=this.pxHeight;s+=this.line_height_offset;var l,p;for(1===this.valign?o+=Math.max(this.height/2-this.lines.length*s/2,0):2===this.valign&&(o+=Math.max(this.height-this.lines.length*s-2,0)),p=0;p<this.lines.length&&(l=n,1===this.halign?l=n+(this.width-this.lines[p].width)/2:2===this.halign&&(l=n+(this.width-this.lines[p].width)),e.fillText(this.lines[p].text,l,o),o+=s,!(o>=a-s));p++);(0!==this.angle||t)&&e.restore(),this.last_render_tick=this.runtime.tickcount},p.drawGL=function(e){if(!(1>this.width||1>this.height)){var t=this.text_changed||this.need_text_redraw;this.need_text_redraw=!1;var r=this.layer.getScale(),n=this.layer.getAngle(),o=this.rcTex,a=r*this.width,i=r*this.height,s=Math.ceil(a),l=Math.ceil(i),p=Math.abs(s),d=Math.abs(l),c=this.runtime.draw_width/2,u=this.runtime.draw_height/2;this.myctx||(this.mycanvas=document.createElement("canvas"),this.mycanvas.width=p,this.mycanvas.height=d,this.lastwidth=p,this.lastheight=d,t=!0,this.myctx=this.mycanvas.getContext("2d")),(p!==this.lastwidth||d!==this.lastheight)&&(this.mycanvas.width=p,this.mycanvas.height=d,this.mytex&&(e.deleteTexture(this.mytex),this.mytex=null),t=!0),t&&(this.myctx.clearRect(0,0,p,d),this.draw(this.myctx,!0),!this.mytex&&(this.mytex=e.createEmptyTexture(p,d,this.runtime.linearSampling,this.runtime.isMobile)),e.videoToTexture(this.mycanvas,this.mytex,this.runtime.isMobile)),this.lastwidth=p,this.lastheight=d,e.setTexture(this.mytex),e.setOpacity(this.opacity),e.resetModelView(),e.translate(-c,-u),e.updateModelView();var g=this.bquad,y=this.layer.layerToCanvas(g.tlx,g.tly,!0,!0),m=this.layer.layerToCanvas(g.tlx,g.tly,!1,!0),_=this.layer.layerToCanvas(g.trx,g.try_,!0,!0),h=this.layer.layerToCanvas(g.trx,g.try_,!1,!0),f=this.layer.layerToCanvas(g.brx,g.bry,!0,!0),b=this.layer.layerToCanvas(g.brx,g.bry,!1,!0),x=this.layer.layerToCanvas(g.blx,g.bly,!0,!0),v=this.layer.layerToCanvas(g.blx,g.bly,!1,!0);if(this.runtime.pixel_rounding||0===this.angle&&0===n){var w=(0|y+.5)-y,S=(0|m+.5)-m;y+=w,m+=S,_+=w,h+=S,f+=w,b+=S,x+=w,v+=S}0===this.angle&&0===n?(_=y+s,h=m,f=_,b=m+l,x=y,v=b,o.right=1,o.bottom=1):(o.right=a/s,o.bottom=i/l),e.quadTex(y,m,_,h,f,b,x,v,o),e.resetModelView(),e.scale(r,r),e.rotateZ(-this.layer.getAngle()),e.translate((this.layer.viewLeft+this.layer.viewRight)/-2,(this.layer.viewTop+this.layer.viewBottom)/-2),e.updateModelView(),this.last_render_tick=this.runtime.tickcount}};var c=[];s.TokeniseWords=function(e){cr.clearArray(c);for(var t="",r=0,n;r<e.length;)if(n=e.charAt(r),"\n"===n)t.length&&(c.push(t),t=""),c.push("\n"),++r;else if(" "===n||"\t"===n||"-"===n){do t+=e.charAt(r),r++;while(r<e.length&&(" "===e.charAt(r)||"\t"===e.charAt(r)));c.push(t),t=""}else r<e.length&&(t+=n,r++);t.length&&c.push(t)};var u=[];s.WordWrap=function(t,n,o,a,i){if(!t||!t.length)return void r(n);if(2>=a)return void r(n);if(100>=t.length&&-1===t.indexOf("\n")){var s=o.measureText(t).width;if(s<=a)return r(n),n.push(e()),n[0].text=t,void(n[0].width=s)}this.WrapText(t,n,o,a,i)};s.WrapText=function(r,o,a,s,l){var p;l?(this.TokeniseWords(r),p=c):p=r;var d="",u=0,g,y,m,_;for(m=0;m<p.length;m++){if("\n"===p[m]){u>=o.length&&o.push(e()),d=n(d),_=o[u],_.text=d,_.width=a.measureText(d).width,u++,d="";continue}g=d,d+=p[m],y=a.measureText(d).width,y>=s&&(u>=o.length&&o.push(e()),g=n(g),_=o[u],_.text=g,_.width=a.measureText(g).width,u++,d=p[m],!l&&" "===d&&(d=""))}for(d.length&&(u>=o.length&&o.push(e()),d=n(d),_=o[u],_.text=d,_.width=a.measureText(d).width,u++),m=u;m<o.length;m++)t(o[m]);o.length=u};o.prototype.CompareText=function(e,t){return t?this.text==e:cr.equals_nocase(this.text,e)},s.cnds=new o;a.prototype.SetText=function(e){cr.is_number(e)&&1e9>e&&(e=Math.round(1e10*e)/1e10);var t=e.toString();this.text!==t&&(this.text=t,this.text_changed=!0,this.runtime.redraw=!0)},a.prototype.AppendText=function(e){cr.is_number(e)&&(e=Math.round(1e10*e)/1e10);var t=e.toString();t&&(this.text+=t,this.text_changed=!0,this.runtime.redraw=!0)},a.prototype.SetFontFace=function(e,t){var r="";1===t?r="bold":2===t?r="italic":3===t?r="bold italic":void 0;e===this.facename&&r===this.fontstyle||(this.facename=e,this.fontstyle=r,this.updateFont())},a.prototype.SetFontSize=function(e){this.ptSize===e||(this.ptSize=e,this.pxHeight=Math.ceil(96*(this.ptSize/72))+4,this.updateFont())},a.prototype.SetFontColor=function(e){var t="rgb("+cr.GetRValue(e).toString()+","+cr.GetGValue(e).toString()+","+cr.GetBValue(e).toString()+")";t===this.color||(this.color=t,this.need_text_redraw=!0,this.runtime.redraw=!0)},a.prototype.SetWebFont=function(e,t){if(this.runtime.isDomFree)return void cr.logexport("[Construct 2] Text plugin: 'Set web font' not supported on this platform - the action has been ignored");var r=this,n=function(){r.runtime.redraw=!0,r.text_changed=!0};if(d.hasOwnProperty(t)){var o="'"+e+"'";if(this.facename===o)return;this.facename=o,this.updateFont();for(var a=1;10>a;a++)setTimeout(n,100*a),setTimeout(n,1e3*a);return}var s=document.createElement("link");s.href=t,s.rel="stylesheet",s.type="text/css",s.onload=n,document.getElementsByTagName("head")[0].appendChild(s),d[t]=!0,this.facename="'"+e+"'",this.updateFont();for(var a=1;10>a;a++)setTimeout(n,100*a),setTimeout(n,1e3*a)},a.prototype.SetEffect=function(e){this.blend_mode=e,this.compositeOp=cr.effectToCompositeOp(e),cr.setGLBlend(this,e,this.runtime.gl),this.runtime.redraw=!0},s.acts=new a;i.prototype.Text=function(e){e.set_string(this.text)},i.prototype.FaceName=function(e){e.set_string(this.facename)},i.prototype.FaceSize=function(e){e.set_int(this.ptSize)},i.prototype.TextWidth=function(e){var t=0,r,n,o;for(r=0,n=this.lines.length;r<n;r++)o=this.lines[r].width,t<o&&(t=o);e.set_int(t)},i.prototype.TextHeight=function(e){e.set_int(this.lines.length*(this.pxHeight+this.line_height_offset)-this.line_height_offset)},s.exps=new i}();cr.plugins_.TextBox=function(e){this.runtime=e},function(){function e(){}function t(){}function r(){}var n=cr.plugins_.TextBox.prototype;n.Type=function(e){this.plugin=e,this.runtime=e.runtime};var o=n.Type.prototype;o.onCreate=function(){},n.Instance=function(e){this.type=e,this.runtime=e.runtime};var a=n.Instance.prototype,i=["text","password","email","number","tel","url"];-1<navigator.userAgent.indexOf("MSIE 9")&&(i[2]="text",i[3]="text",i[4]="text",i[5]="text"),a.onCreate=function(){if(this.runtime.isDomFree)return void cr.logexport("[Construct 2] Textbox plugin not supported on this platform - the object will not be created");6===this.properties[7]?(this.elem=document.createElement("textarea"),jQuery(this.elem).css("resize","none")):(this.elem=document.createElement("input"),this.elem.type=i[this.properties[7]]),this.elem.id=this.properties[9],jQuery(this.elem).appendTo(this.runtime.canvasdiv?this.runtime.canvasdiv:"body"),this.elem.autocomplete="off",this.elem.value=this.properties[0],this.elem.placeholder=this.properties[1],this.elem.title=this.properties[2],this.elem.disabled=0===this.properties[4],this.elem.readOnly=1===this.properties[5],this.elem.spellcheck=1===this.properties[6],this.autoFontSize=0!==this.properties[8],this.element_hidden=!1,0===this.properties[3]&&(jQuery(this.elem).hide(),this.visible=!1,this.element_hidden=!0);var e=function(e){return function(){e.runtime.trigger(cr.plugins_.TextBox.prototype.cnds.OnTextChanged,e)}}(this);this.elem.oninput=e,-1!==navigator.userAgent.indexOf("MSIE")&&(this.elem.oncut=e),this.elem.onclick=function(t){return function(r){r.stopPropagation(),t.runtime.isInUserInputEvent=!0,t.runtime.trigger(cr.plugins_.TextBox.prototype.cnds.OnClicked,t),t.runtime.isInUserInputEvent=!1}}(this),this.elem.ondblclick=function(t){return function(r){r.stopPropagation(),t.runtime.isInUserInputEvent=!0,t.runtime.trigger(cr.plugins_.TextBox.prototype.cnds.OnDoubleClicked,t),t.runtime.isInUserInputEvent=!1}}(this),this.elem.addEventListener("touchstart",function(t){t.stopPropagation()},!1),this.elem.addEventListener("touchmove",function(t){t.stopPropagation()},!1),this.elem.addEventListener("touchend",function(t){t.stopPropagation()},!1),jQuery(this.elem).mousedown(function(t){t.stopPropagation()}),jQuery(this.elem).mouseup(function(t){t.stopPropagation()}),jQuery(this.elem).keydown(function(t){13!==t.which&&27!=t.which&&t.stopPropagation()}),jQuery(this.elem).keyup(function(t){13!==t.which&&27!=t.which&&t.stopPropagation()}),this.lastLeft=0,this.lastTop=0,this.lastRight=0,this.lastBottom=0,this.lastWinWidth=0,this.lastWinHeight=0,this.updatePosition(!0),this.runtime.tickMe(this)},a.saveToJSON=function(){return{text:this.elem.value,placeholder:this.elem.placeholder,tooltip:this.elem.title,disabled:!!this.elem.disabled,readonly:!!this.elem.readOnly,spellcheck:!!this.elem.spellcheck}},a.loadFromJSON=function(e){this.elem.value=e.text,this.elem.placeholder=e.placeholder,this.elem.title=e.tooltip,this.elem.disabled=e.disabled,this.elem.readOnly=e.readonly,this.elem.spellcheck=e.spellcheck},a.onDestroy=function(){this.runtime.isDomFree||(jQuery(this.elem).remove(),this.elem=null)},a.tick=function(){this.updatePosition()},a.updatePosition=function(e){if(!this.runtime.isDomFree){var t=this.layer.layerToCanvas(this.x,this.y,!0),r=this.layer.layerToCanvas(this.x,this.y,!1),n=this.layer.layerToCanvas(this.x+this.width,this.y+this.height,!0),o=this.layer.layerToCanvas(this.x+this.width,this.y+this.height,!1),a=this.runtime.width/this.runtime.devicePixelRatio,i=this.runtime.height/this.runtime.devicePixelRatio;if(!this.visible||!this.layer.visible||0>=n||0>=o||t>=a||r>=i)return this.element_hidden||jQuery(this.elem).hide(),void(this.element_hidden=!0);1>t&&(t=1),1>r&&(r=1),n>=a&&(n=a-1),o>=i&&(o=i-1);var s=window.innerWidth,l=window.innerHeight;if(!e&&this.lastLeft===t&&this.lastTop===r&&this.lastRight===n&&this.lastBottom===o&&this.lastWinWidth===s&&this.lastWinHeight===l)return void(this.element_hidden&&(jQuery(this.elem).show(),this.element_hidden=!1));this.lastLeft=t,this.lastTop=r,this.lastRight=n,this.lastBottom=o,this.lastWinWidth=s,this.lastWinHeight=l,this.element_hidden&&(jQuery(this.elem).show(),this.element_hidden=!1);var p=Math.round(t)+jQuery(this.runtime.canvas).offset().left,d=Math.round(r)+jQuery(this.runtime.canvas).offset().top;jQuery(this.elem).css("position","absolute"),jQuery(this.elem).offset({left:p,top:d}),jQuery(this.elem).width(Math.round(n-t)),jQuery(this.elem).height(Math.round(o-r)),this.autoFontSize&&jQuery(this.elem).css("font-size",this.layer.getScale(!0)/this.runtime.devicePixelRatio-.2+"em")}},a.draw=function(){},a.drawGL=function(){};e.prototype.CompareText=function(e,t){return!this.runtime.isDomFree&&(0===t?cr.equals_nocase(this.elem.value,e):this.elem.value===e)},e.prototype.OnTextChanged=function(){return!0},e.prototype.OnClicked=function(){return!0},e.prototype.OnDoubleClicked=function(){return!0},n.cnds=new e;t.prototype.SetText=function(e){this.runtime.isDomFree||(this.elem.value=e)},t.prototype.SetPlaceholder=function(e){this.runtime.isDomFree||(this.elem.placeholder=e)},t.prototype.SetTooltip=function(e){this.runtime.isDomFree||(this.elem.title=e)},t.prototype.SetVisible=function(e){this.runtime.isDomFree||(this.visible=0!==e)},t.prototype.SetEnabled=function(e){this.runtime.isDomFree||(this.elem.disabled=0===e)},t.prototype.SetReadOnly=function(e){this.runtime.isDomFree||(this.elem.readOnly=0===e)},t.prototype.SetFocus=function(){this.runtime.isDomFree||this.elem.focus()},t.prototype.SetBlur=function(){this.runtime.isDomFree||this.elem.blur()},t.prototype.SetCSSStyle=function(e,t){this.runtime.isDomFree||jQuery(this.elem).css(e,t)},t.prototype.ScrollToBottom=function(){this.runtime.isDomFree||(this.elem.scrollTop=this.elem.scrollHeight)},n.acts=new t;r.prototype.Text=function(e){return this.runtime.isDomFree?void e.set_string(""):void e.set_string(this.elem.value)},n.exps=new r}();cr.plugins_.TiledBg=function(e){this.runtime=e},function(){function e(){}function t(){}function r(){}var n=cr.plugins_.TiledBg.prototype;n.Type=function(e){this.plugin=e,this.runtime=e.runtime};var o=n.Type.prototype;o.onCreate=function(){this.is_family||(this.texture_img=new Image,this.texture_img.cr_filesize=this.texture_filesize,this.runtime.waitForImageLoad(this.texture_img,this.texture_file),this.pattern=null,this.webGL_texture=null)},o.onLostWebGLContext=function(){this.is_family||(this.webGL_texture=null)},o.onRestoreWebGLContext=function(){if(!this.is_family&&this.instances.length){this.webGL_texture||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat));var e,t;for(e=0,t=this.instances.length;e<t;e++)this.instances[e].webGL_texture=this.webGL_texture}},o.loadTextures=function(){this.is_family||this.webGL_texture||!this.runtime.glwrap||(this.webGL_texture=this.runtime.glwrap.loadTexture(this.texture_img,!0,this.runtime.linearSampling,this.texture_pixelformat))},o.unloadTextures=function(){this.is_family||this.instances.length||!this.webGL_texture||(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)},o.preloadCanvas2D=function(e){e.drawImage(this.texture_img,0,0)},n.Instance=function(e){this.type=e,this.runtime=e.runtime};var a=n.Instance.prototype;a.onCreate=function(){this.visible=0===this.properties[0],this.rcTex=new cr.rect(0,0,0,0),this.has_own_texture=!1,this.texture_img=this.type.texture_img,this.runtime.glwrap?(this.type.loadTextures(),this.webGL_texture=this.type.webGL_texture):(!this.type.pattern&&(this.type.pattern=this.runtime.ctx.createPattern(this.type.texture_img,"repeat")),this.pattern=this.type.pattern)},a.afterLoad=function(){this.has_own_texture=!1,this.texture_img=this.type.texture_img},a.onDestroy=function(){this.runtime.glwrap&&this.has_own_texture&&this.webGL_texture&&(this.runtime.glwrap.deleteTexture(this.webGL_texture),this.webGL_texture=null)},a.draw=function(e){e.globalAlpha=this.opacity,e.save(),e.fillStyle=this.pattern;var t=this.x,r=this.y;this.runtime.pixel_rounding&&(t=Math.round(t),r=Math.round(r));var n=-(this.hotspotX*this.width),o=-(this.hotspotY*this.height),a=n%this.texture_img.width,i=o%this.texture_img.height;0>a&&(a+=this.texture_img.width),0>i&&(i+=this.texture_img.height),e.translate(t,r),e.rotate(this.angle),e.translate(a,i),e.fillRect(n-a,o-i,this.width,this.height),e.restore()},a.drawGL_earlyZPass=function(e){this.drawGL(e)},a.drawGL=function(e){e.setTexture(this.webGL_texture),e.setOpacity(this.opacity);var t=this.rcTex;t.right=this.width/this.texture_img.width,t.bottom=this.height/this.texture_img.height;var r=this.bquad;if(this.runtime.pixel_rounding){var n=Math.round(this.x)-this.x,o=Math.round(this.y)-this.y;e.quadTex(r.tlx+n,r.tly+o,r.trx+n,r.try_+o,r.brx+n,r.bry+o,r.blx+n,r.bly+o,t)}else e.quadTex(r.tlx,r.tly,r.trx,r.try_,r.brx,r.bry,r.blx,r.bly,t)};e.prototype.OnURLLoaded=function(){return!0},n.cnds=new e;t.prototype.SetEffect=function(e){this.blend_mode=e,this.compositeOp=cr.effectToCompositeOp(e),cr.setGLBlend(this,e,this.runtime.gl),this.runtime.redraw=!0},t.prototype.LoadURL=function(e,t){var r=new Image,n=this;r.onload=function(){n.texture_img=r,n.runtime.glwrap?(n.has_own_texture&&n.webGL_texture&&n.runtime.glwrap.deleteTexture(n.webGL_texture),n.webGL_texture=n.runtime.glwrap.loadTexture(r,!0,n.runtime.linearSampling)):n.pattern=n.runtime.ctx.createPattern(r,"repeat"),n.has_own_texture=!0,n.runtime.redraw=!0,n.runtime.trigger(cr.plugins_.TiledBg.prototype.cnds.OnURLLoaded,n)},"data:"!==e.substr(0,5)&&0===t&&(r.crossOrigin="anonymous"),this.runtime.setImageSrc(r,e)},n.acts=new t;r.prototype.ImageWidth=function(e){e.set_float(this.texture_img.width)},r.prototype.ImageHeight=function(e){e.set_float(this.texture_img.height)},n.exps=new r}();cr.plugins_.Touch=function(e){this.runtime=e},function(){function e(e){h=e.x,f=e.y,b=e.z}function r(e,t,r,n){var a;return a=v.length?v.pop():new o,a.init(e,t,r,n),a}function n(e){100>v.length&&v.push(e)}function o(){this.starttime=0,this.time=0,this.lasttime=0,this.startx=0,this.starty=0,this.x=0,this.y=0,this.lastx=0,this.lasty=0,this.id=0,this.startindex=0,this.triggeredHold=!1,this.tooFarForHold=!1}function a(t){return t.sourceCapabilities&&t.sourceCapabilities.firesTouchEvents||t.originalEvent&&t.originalEvent.sourceCapabilities&&t.originalEvent.sourceCapabilities.firesTouchEvents}function i(){}function s(){}function l(){}var p=cr.plugins_.Touch.prototype;p.Type=function(e){this.plugin=e,this.runtime=e.runtime};var d=p.Type.prototype;d.onCreate=function(){},p.Instance=function(e){this.type=e,this.runtime=e.runtime,this.touches=[],this.mouseDown=!1};var c=p.Instance.prototype,g={left:0,top:0};c.findTouch=function(e){var t,r;for(t=0,r=this.touches.length;t<r;t++)if(this.touches[t].id===e)return t;return-1};var y=0,m=0,_=0;var h=0,f=0,b=0;var x=null,v=[];var w=333;o.prototype.init=function(e,t,r,n){var o=cr.performance_now();this.time=o,this.lasttime=o,this.starttime=o,this.startx=e,this.starty=t,this.x=e,this.y=t,this.lastx=e,this.lasty=t,this.width=0,this.height=0,this.pressure=0,this.id=r,this.startindex=n,this.triggeredHold=!1,this.tooFarForHold=!1},o.prototype.update=function(e,t,r,n,o,a){this.lasttime=this.time,this.time=e,this.lastx=this.x,this.lasty=this.y,this.x=t,this.y=r,this.width=n,this.height=o,this.pressure=a,!this.tooFarForHold&&cr.distanceTo(this.startx,this.starty,this.x,this.y)>=15&&(this.tooFarForHold=!0)},o.prototype.maybeTriggerHold=function(e,t){if(!this.triggeredHold){var r=cr.performance_now();r-this.starttime>=500&&!this.tooFarForHold&&15>cr.distanceTo(this.startx,this.starty,this.x,this.y)&&(this.triggeredHold=!0,e.trigger_index=this.startindex,e.trigger_id=this.id,e.getTouchIndex=t,e.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGesture,e),e.curTouchX=this.x,e.curTouchY=this.y,e.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnHoldGestureObject,e),e.getTouchIndex=0)}};var S=-1e3,T=-1e3,C=-1e4;o.prototype.maybeTriggerTap=function(e,t){if(!this.triggeredHold){var r=cr.performance_now();r-this.starttime<=w&&!this.tooFarForHold&&15>cr.distanceTo(this.startx,this.starty,this.x,this.y)&&(e.trigger_index=this.startindex,e.trigger_id=this.id,e.getTouchIndex=t,r-C<=2*w&&cr.distanceTo(S,T,this.x,this.y)<25?(e.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGesture,e),e.curTouchX=this.x,e.curTouchY=this.y,e.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnDoubleTapGestureObject,e),S=-1e3,T=-1e3,C=-1e4):(e.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGesture,e),e.curTouchX=this.x,e.curTouchY=this.y,e.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTapGestureObject,e),S=this.x,T=this.y,C=r),e.getTouchIndex=0)}},c.onCreate=function(){x=this,this.isWindows8=!!("undefined"!=typeof window.c2isWindows8&&window.c2isWindows8),this.orient_alpha=0,this.orient_beta=0,this.orient_gamma=0,this.acc_g_x=0,this.acc_g_y=0,this.acc_g_z=0,this.acc_x=0,this.acc_y=0,this.acc_z=0,this.curTouchX=0,this.curTouchY=0,this.trigger_index=0,this.trigger_id=0,this.trigger_permission=0,this.getTouchIndex=0,this.useMouseInput=0!==this.properties[0];var t=0<this.runtime.fullscreen_mode?document:this.runtime.canvas,r=document;this.runtime.isDirectCanvas?r=t=window.Canvas:this.runtime.isCocoonJs&&(r=t=window);var n=this;if("undefined"==typeof PointerEvent?window.navigator.msPointerEnabled?(t.addEventListener("MSPointerDown",function(e){n.onPointerStart(e)},!1),t.addEventListener("MSPointerMove",function(e){n.onPointerMove(e)},!1),r.addEventListener("MSPointerUp",function(e){n.onPointerEnd(e,!1)},!1),r.addEventListener("MSPointerCancel",function(e){n.onPointerEnd(e,!0)},!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1),document.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1))):(t.addEventListener("touchstart",function(e){n.onTouchStart(e)},!1),t.addEventListener("touchmove",function(e){n.onTouchMove(e)},!1),r.addEventListener("touchend",function(e){n.onTouchEnd(e,!1)},!1),r.addEventListener("touchcancel",function(e){n.onTouchEnd(e,!0)},!1)):(t.addEventListener("pointerdown",function(e){n.onPointerStart(e)},!1),t.addEventListener("pointermove",function(e){n.onPointerMove(e)},!1),r.addEventListener("pointerup",function(e){n.onPointerEnd(e,!1)},!1),r.addEventListener("pointercancel",function(e){n.onPointerEnd(e,!0)},!1),this.runtime.canvas&&(this.runtime.canvas.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1),document.addEventListener("MSGestureHold",function(t){t.preventDefault()},!1),this.runtime.canvas.addEventListener("gesturehold",function(t){t.preventDefault()},!1),document.addEventListener("gesturehold",function(t){t.preventDefault()},!1))),this.isWindows8){var o=function(t){var e=t.reading;n.acc_x=e.accelerationX,n.acc_y=e.accelerationY,n.acc_z=e.accelerationZ},a=function(t){var e=t.reading;n.orient_alpha=e.yawDegrees,n.orient_beta=e.pitchDegrees,n.orient_gamma=e.rollDegrees},i=Windows.Devices.Sensors.Accelerometer.getDefault();i&&(i.reportInterval=Math.max(i.minimumReportInterval,16),i.addEventListener("readingchanged",o));var s=Windows.Devices.Sensors.Inclinometer.getDefault();s&&(s.reportInterval=Math.max(s.minimumReportInterval,16),s.addEventListener("readingchanged",a)),document.addEventListener("visibilitychange",function(){document.hidden||document.msHidden?(i&&i.removeEventListener("readingchanged",o),s&&s.removeEventListener("readingchanged",a)):(i&&i.addEventListener("readingchanged",o),s&&s.addEventListener("readingchanged",a))},!1)}else window.addEventListener("deviceorientation",function(e){n.orient_alpha=e.alpha||0,n.orient_beta=e.beta||0,n.orient_gamma=e.gamma||0},!1),window.addEventListener("devicemotion",function(e){e.accelerationIncludingGravity&&(n.acc_g_x=e.accelerationIncludingGravity.x||0,n.acc_g_y=e.accelerationIncludingGravity.y||0,n.acc_g_z=e.accelerationIncludingGravity.z||0),e.acceleration&&(n.acc_x=e.acceleration.x||0,n.acc_y=e.acceleration.y||0,n.acc_z=e.acceleration.z||0)},!1);this.useMouseInput&&!this.runtime.isDomFree&&(jQuery(document).mousemove(function(e){n.onMouseMove(e)}),jQuery(document).mousedown(function(e){n.onMouseDown(e)}),jQuery(document).mouseup(function(e){n.onMouseUp(e)})),!this.runtime.isiOS&&this.runtime.isCordova&&navigator.accelerometer&&navigator.accelerometer.watchAcceleration&&navigator.accelerometer.watchAcceleration(e,null,{frequency:40}),this.runtime.tick2Me(this)},c.onPointerMove=function(e){if(e.pointerType!==e.MSPOINTER_TYPE_MOUSE&&"mouse"!==e.pointerType){e.preventDefault&&e.preventDefault();var r=this.findTouch(e.pointerId),n=cr.performance_now();if(0<=r){var o=this.runtime.isDomFree?g:jQuery(this.runtime.canvas).offset(),a=this.touches[r];if(2>n-a.time)return;a.update(n,e.pageX-o.left,e.pageY-o.top,e.width||0,e.height||0,e.pressure||0)}}},c.onPointerStart=function(e){if(e.pointerType!==e.MSPOINTER_TYPE_MOUSE&&"mouse"!==e.pointerType){e.preventDefault&&cr.isCanvasInputEvent(e)&&e.preventDefault();var t=this.runtime.isDomFree?g:jQuery(this.runtime.canvas).offset(),n=e.pageX-t.left,o=e.pageY-t.top,a=cr.performance_now();this.trigger_index=this.touches.length,this.trigger_id=e.pointerId,this.touches.push(r(n,o,e.pointerId,this.trigger_index)),this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this),this.curTouchX=n,this.curTouchY=o,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this),this.runtime.isInUserInputEvent=!1}},c.onPointerEnd=function(e,t){if(e.pointerType!==e.MSPOINTER_TYPE_MOUSE&&"mouse"!==e.pointerType){e.preventDefault&&cr.isCanvasInputEvent(e)&&e.preventDefault();var r=this.findTouch(e.pointerId);this.trigger_index=0<=r?this.touches[r].startindex:-1,this.trigger_id=0<=r?this.touches[r].id:-1,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),0<=r&&(!t&&this.touches[r].maybeTriggerTap(this,r),n(this.touches[r]),this.touches.splice(r,1)),this.runtime.isInUserInputEvent=!1}},c.onTouchMove=function(e){e.preventDefault&&e.preventDefault();var r=cr.performance_now(),n,o,a,s;for(n=0,o=e.changedTouches.length;n<o;n++){a=e.changedTouches[n];var l=this.findTouch(a.identifier);if(0<=l){var p=this.runtime.isDomFree?g:jQuery(this.runtime.canvas).offset();if(s=this.touches[l],2>r-s.time)continue;var d=2*(a.radiusX||a.webkitRadiusX||a.mozRadiusX||a.msRadiusX||0),c=2*(a.radiusY||a.webkitRadiusY||a.mozRadiusY||a.msRadiusY||0),y=a.force||a.webkitForce||a.mozForce||a.msForce||0;s.update(r,a.pageX-p.left,a.pageY-p.top,d,c,y)}}},c.onTouchStart=function(e){e.preventDefault&&cr.isCanvasInputEvent(e)&&e.preventDefault();var n=this.runtime.isDomFree?g:jQuery(this.runtime.canvas).offset(),o=cr.performance_now();this.runtime.isInUserInputEvent=!0;var a,s,l,p;for(a=0,s=e.changedTouches.length;a<s;a++)if(l=e.changedTouches[a],p=this.findTouch(l.identifier),-1===p){var d=l.pageX-n.left,c=l.pageY-n.top;this.trigger_index=this.touches.length,this.trigger_id=l.identifier,this.touches.push(r(d,c,l.identifier,this.trigger_index)),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchStart,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchStart,this),this.curTouchX=d,this.curTouchY=c,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchObject,this)}this.runtime.isInUserInputEvent=!1},c.onTouchEnd=function(e,r){e.preventDefault&&cr.isCanvasInputEvent(e)&&e.preventDefault(),this.runtime.isInUserInputEvent=!0;var o,a,s,l;for(o=0,a=e.changedTouches.length;o<a;o++)s=e.changedTouches[o],l=this.findTouch(s.identifier),0<=l&&(this.trigger_index=this.touches[l].startindex,this.trigger_id=this.touches[l].id,this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnNthTouchEnd,this),this.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnTouchEnd,this),!r&&this.touches[l].maybeTriggerTap(this,l),n(this.touches[l]),this.touches.splice(l,1));this.runtime.isInUserInputEvent=!1},c.getAlpha=function(){return this.runtime.isCordova&&0===this.orient_alpha&&0!==b?90*b:this.orient_alpha},c.getBeta=function(){return this.runtime.isCordova&&0===this.orient_beta&&0!==f?90*f:this.orient_beta},c.getGamma=function(){return this.runtime.isCordova&&0===this.orient_gamma&&0!==h?90*h:this.orient_gamma};c.onMouseDown=function(e){if(!a(e)){var r={pageX:e.pageX,pageY:e.pageY,identifier:0};this.onTouchStart({changedTouches:[r]}),this.mouseDown=!0}},c.onMouseMove=function(e){if(this.mouseDown&&!a(e)){var r={pageX:e.pageX,pageY:e.pageY,identifier:0};this.onTouchMove({changedTouches:[r]})}},c.onMouseUp=function(e){if(e.preventDefault&&this.runtime.had_a_click&&!this.runtime.isMobile&&e.preventDefault(),this.runtime.had_a_click=!0,!a(e)){var r={pageX:e.pageX,pageY:e.pageY,identifier:0};this.onTouchEnd({changedTouches:[r]}),this.mouseDown=!1}},c.tick2=function(){var e=cr.performance_now(),r,n,o;for(r=0,n=this.touches.length;r<n;++r)o=this.touches[r],o.time<=e-50&&(o.lasttime=e),o.maybeTriggerHold(this,r)};i.prototype.OnTouchStart=function(){return!0},i.prototype.OnTouchEnd=function(){return!0},i.prototype.IsInTouch=function(){return this.touches.length},i.prototype.OnTouchObject=function(e){return!!e&&this.runtime.testAndSelectCanvasPointOverlap(e,this.curTouchX,this.curTouchY,!1)};var O=[];i.prototype.IsTouchingObject=function(e){if(!e)return!1;var t=e.getCurrentSol(),r=t.getObjects(),n,o,a,s,l,p;for(a=0,s=r.length;a<s;a++){var d=r[a];for(d.update_bbox(),l=0,p=this.touches.length;l<p;l++){var c=this.touches[l];if(n=d.layer.canvasToLayer(c.x,c.y,!0),o=d.layer.canvasToLayer(c.x,c.y,!1),d.contains_pt(n,o)){O.push(d);break}}}return!!O.length&&(t.select_all=!1,cr.shallowAssignArray(t.instances,O),e.applySolToContainer(),cr.clearArray(O),!0)},i.prototype.CompareTouchSpeed=function(e,r,n){if(e=Math.floor(e),0>e||e>=this.touches.length)return!1;var o=this.touches[e],t=cr.distanceTo(o.x,o.y,o.lastx,o.lasty),a=(o.time-o.lasttime)/1e3,i=0;return 0<a&&(i=t/a),cr.do_cmp(i,r,n)},i.prototype.OrientationSupported=function(){return"undefined"!=typeof window.DeviceOrientationEvent},i.prototype.MotionSupported=function(){return"undefined"!=typeof window.DeviceMotionEvent},i.prototype.CompareOrientation=function(e,t,r){var n=0;return n=0===e?this.getAlpha():1===e?this.getBeta():this.getGamma(),cr.do_cmp(n,t,r)},i.prototype.CompareAcceleration=function(e,t,r){var n=0;return 0===e?n=this.acc_g_x:1===e?n=this.acc_g_y:2===e?n=this.acc_g_z:3===e?n=this.acc_x:4===e?n=this.acc_y:5==e&&(n=this.acc_z),cr.do_cmp(n,t,r)},i.prototype.OnNthTouchStart=function(e){return e=Math.floor(e),e===this.trigger_index},i.prototype.OnNthTouchEnd=function(e){return e=Math.floor(e),e===this.trigger_index},i.prototype.HasNthTouch=function(e){return e=Math.floor(e),this.touches.length>=e+1},i.prototype.OnHoldGesture=function(){return!0},i.prototype.OnTapGesture=function(){return!0},i.prototype.OnDoubleTapGesture=function(){return!0},i.prototype.OnHoldGestureObject=function(e){return!!e&&this.runtime.testAndSelectCanvasPointOverlap(e,this.curTouchX,this.curTouchY,!1)},i.prototype.OnTapGestureObject=function(e){return!!e&&this.runtime.testAndSelectCanvasPointOverlap(e,this.curTouchX,this.curTouchY,!1)},i.prototype.OnDoubleTapGestureObject=function(e){return!!e&&this.runtime.testAndSelectCanvasPointOverlap(e,this.curTouchX,this.curTouchY,!1)},i.prototype.OnPermissionGranted=function(e){return this.trigger_permission===e},i.prototype.OnPermissionDenied=function(e){return this.trigger_permission===e},p.cnds=new i;s.prototype.RequestPermission=function(e){var t=this,r=Promise.resolve(!0);0===e?window.DeviceOrientationEvent&&window.DeviceOrientationEvent.requestPermission&&(r=window.DeviceOrientationEvent.requestPermission().then(function(e){return"granted"===e})):window.DeviceMotionEvent&&window.DeviceMotionEvent.requestPermission&&(r=window.DeviceMotionEvent.requestPermission().then(function(e){return"granted"===e})),r.then(function(r){t.trigger_permission=e,r?t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnPermissionGranted,t):t.runtime.trigger(cr.plugins_.Touch.prototype.cnds.OnPermissionDenied,t)})},p.acts=new s;l.prototype.TouchCount=function(e){e.set_int(this.touches.length)},l.prototype.X=function(e,t){var r=this.getTouchIndex;if(0>r||r>=this.touches.length)return void e.set_float(0);var n,o,a,i,s;cr.is_undefined(t)?(n=this.runtime.getLayerByNumber(0),o=n.scale,a=n.zoomRate,i=n.parallaxX,s=n.angle,n.scale=1,n.zoomRate=1,n.parallaxX=1,n.angle=0,e.set_float(n.canvasToLayer(this.touches[r].x,this.touches[r].y,!0)),n.scale=o,n.zoomRate=a,n.parallaxX=i,n.angle=s):(n=cr.is_number(t)?this.runtime.getLayerByNumber(t):this.runtime.getLayerByName(t),n?e.set_float(n.canvasToLayer(this.touches[r].x,this.touches[r].y,!0)):e.set_float(0))},l.prototype.XAt=function(e,t,r){if(t=Math.floor(t),0>t||t>=this.touches.length)return void e.set_float(0);var n,o,a,i,s;cr.is_undefined(r)?(n=this.runtime.getLayerByNumber(0),o=n.scale,a=n.zoomRate,i=n.parallaxX,s=n.angle,n.scale=1,n.zoomRate=1,n.parallaxX=1,n.angle=0,e.set_float(n.canvasToLayer(this.touches[t].x,this.touches[t].y,!0)),n.scale=o,n.zoomRate=a,n.parallaxX=i,n.angle=s):(n=cr.is_number(r)?this.runtime.getLayerByNumber(r):this.runtime.getLayerByName(r),n?e.set_float(n.canvasToLayer(this.touches[t].x,this.touches[t].y,!0)):e.set_float(0))},l.prototype.XForID=function(e,t,r){var n=this.findTouch(t);if(0>n)return void e.set_float(0);var o=this.touches[n],a,i,s,l,p;cr.is_undefined(r)?(a=this.runtime.getLayerByNumber(0),i=a.scale,s=a.zoomRate,l=a.parallaxX,p=a.angle,a.scale=1,a.zoomRate=1,a.parallaxX=1,a.angle=0,e.set_float(a.canvasToLayer(o.x,o.y,!0)),a.scale=i,a.zoomRate=s,a.parallaxX=l,a.angle=p):(a=cr.is_number(r)?this.runtime.getLayerByNumber(r):this.runtime.getLayerByName(r),a?e.set_float(a.canvasToLayer(o.x,o.y,!0)):e.set_float(0))},l.prototype.Y=function(e,t){var r=this.getTouchIndex;if(0>r||r>=this.touches.length)return void e.set_float(0);var n,o,a,i,s;cr.is_undefined(t)?(n=this.runtime.getLayerByNumber(0),o=n.scale,a=n.zoomRate,i=n.parallaxY,s=n.angle,n.scale=1,n.zoomRate=1,n.parallaxY=1,n.angle=0,e.set_float(n.canvasToLayer(this.touches[r].x,this.touches[r].y,!1)),n.scale=o,n.zoomRate=a,n.parallaxY=i,n.angle=s):(n=cr.is_number(t)?this.runtime.getLayerByNumber(t):this.runtime.getLayerByName(t),n?e.set_float(n.canvasToLayer(this.touches[r].x,this.touches[r].y,!1)):e.set_float(0))},l.prototype.YAt=function(e,t,r){if(t=Math.floor(t),0>t||t>=this.touches.length)return void e.set_float(0);var n,o,a,i,s;cr.is_undefined(r)?(n=this.runtime.getLayerByNumber(0),o=n.scale,a=n.zoomRate,i=n.parallaxY,s=n.angle,n.scale=1,n.zoomRate=1,n.parallaxY=1,n.angle=0,e.set_float(n.canvasToLayer(this.touches[t].x,this.touches[t].y,!1)),n.scale=o,n.zoomRate=a,n.parallaxY=i,n.angle=s):(n=cr.is_number(r)?this.runtime.getLayerByNumber(r):this.runtime.getLayerByName(r),n?e.set_float(n.canvasToLayer(this.touches[t].x,this.touches[t].y,!1)):e.set_float(0))},l.prototype.YForID=function(e,t,r){var n=this.findTouch(t);if(0>n)return void e.set_float(0);var o=this.touches[n],a,i,s,l,p;cr.is_undefined(r)?(a=this.runtime.getLayerByNumber(0),i=a.scale,s=a.zoomRate,l=a.parallaxY,p=a.angle,a.scale=1,a.zoomRate=1,a.parallaxY=1,a.angle=0,e.set_float(a.canvasToLayer(o.x,o.y,!1)),a.scale=i,a.zoomRate=s,a.parallaxY=l,a.angle=p):(a=cr.is_number(r)?this.runtime.getLayerByNumber(r):this.runtime.getLayerByName(r),a?e.set_float(a.canvasToLayer(o.x,o.y,!1)):e.set_float(0))},l.prototype.AbsoluteX=function(e){this.touches.length?e.set_float(this.touches[0].x):e.set_float(0)},l.prototype.AbsoluteXAt=function(e,t){return t=Math.floor(t),0>t||t>=this.touches.length?void e.set_float(0):void e.set_float(this.touches[t].x)},l.prototype.AbsoluteXForID=function(e,t){var r=this.findTouch(t);if(0>r)return void e.set_float(0);var n=this.touches[r];e.set_float(n.x)},l.prototype.AbsoluteY=function(e){this.touches.length?e.set_float(this.touches[0].y):e.set_float(0)},l.prototype.AbsoluteYAt=function(e,t){return t=Math.floor(t),0>t||t>=this.touches.length?void e.set_float(0):void e.set_float(this.touches[t].y)},l.prototype.AbsoluteYForID=function(e,t){var r=this.findTouch(t);if(0>r)return void e.set_float(0);var n=this.touches[r];e.set_float(n.y)},l.prototype.SpeedAt=function(e,r){if(r=Math.floor(r),0>r||r>=this.touches.length)return void e.set_float(0);var n=this.touches[r],t=cr.distanceTo(n.x,n.y,n.lastx,n.lasty),o=(n.time-n.lasttime)/1e3;0>=o?e.set_float(0):e.set_float(t/o)},l.prototype.SpeedForID=function(e,t){var r=this.findTouch(t);if(0>r)return void e.set_float(0);var n=this.touches[r],o=cr.distanceTo(n.x,n.y,n.lastx,n.lasty),a=(n.time-n.lasttime)/1e3;0>=a?e.set_float(0):e.set_float(o/a)},l.prototype.AngleAt=function(e,r){if(r=Math.floor(r),0>r||r>=this.touches.length)return void e.set_float(0);var n=this.touches[r];e.set_float(cr.to_degrees(cr.angleTo(n.lastx,n.lasty,n.x,n.y)))},l.prototype.AngleForID=function(e,t){var r=this.findTouch(t);if(0>r)return void e.set_float(0);var n=this.touches[r];e.set_float(cr.to_degrees(cr.angleTo(n.lastx,n.lasty,n.x,n.y)))},l.prototype.Alpha=function(e){e.set_float(this.getAlpha())},l.prototype.Beta=function(e){e.set_float(this.getBeta())},l.prototype.Gamma=function(e){e.set_float(this.getGamma())},l.prototype.AccelerationXWithG=function(e){e.set_float(this.acc_g_x)},l.prototype.AccelerationYWithG=function(e){e.set_float(this.acc_g_y)},l.prototype.AccelerationZWithG=function(e){e.set_float(this.acc_g_z)},l.prototype.AccelerationX=function(e){e.set_float(this.acc_x)},l.prototype.AccelerationY=function(e){e.set_float(this.acc_y)},l.prototype.AccelerationZ=function(e){e.set_float(this.acc_z)},l.prototype.TouchIndex=function(e){e.set_int(this.trigger_index)},l.prototype.TouchID=function(e){e.set_float(this.trigger_id)},l.prototype.WidthForID=function(e,t){var r=this.findTouch(t);if(0>r)return void e.set_float(0);var n=this.touches[r];e.set_float(n.width)},l.prototype.HeightForID=function(e,t){var r=this.findTouch(t);if(0>r)return void e.set_float(0);var n=this.touches[r];e.set_float(n.height)},l.prototype.PressureForID=function(e,t){var r=this.findTouch(t);if(0>r)return void e.set_float(0);var n=this.touches[r];e.set_float(n.pressure)},p.exps=new l}();cr.behaviors.Anchor=function(e){this.runtime=e},function(){function e(){}var t=cr.behaviors.Anchor.prototype;t.Type=function(e,t){this.behavior=e,this.objtype=t,this.runtime=e.runtime};var r=t.Type.prototype;r.onCreate=function(){},t.Instance=function(e,t){this.type=e,this.behavior=e.behavior,this.inst=t,this.runtime=e.runtime};var n=t.Instance.prototype;n.onCreate=function(){this.anch_left=this.properties[0],this.anch_top=this.properties[1],this.anch_right=this.properties[2],this.anch_bottom=this.properties[3],this.inst.update_bbox(),this.xleft=this.inst.bbox.left,this.ytop=this.inst.bbox.top,this.xright=this.runtime.original_width-this.inst.bbox.left,this.ybottom=this.runtime.original_height-this.inst.bbox.top,this.rdiff=this.runtime.original_width-this.inst.bbox.right,this.bdiff=this.runtime.original_height-this.inst.bbox.bottom,this.enabled=0!==this.properties[4]},n.saveToJSON=function(){return{xleft:this.xleft,ytop:this.ytop,xright:this.xright,ybottom:this.ybottom,rdiff:this.rdiff,bdiff:this.bdiff,enabled:this.enabled}},n.loadFromJSON=function(e){this.xleft=e.xleft,this.ytop=e.ytop,this.xright=e.xright,this.ybottom=e.ybottom,this.rdiff=e.rdiff,this.bdiff=e.bdiff,this.enabled=e.enabled},n.tick=function(){if(this.enabled){var e=this.inst.layer,t=this.inst,r=this.inst.bbox,o;0===this.anch_left?(t.update_bbox(),o=e.viewLeft+this.xleft-r.left,0!==o&&(t.x+=o,t.set_bbox_changed())):1===this.anch_left&&(t.update_bbox(),o=e.viewRight-this.xright-r.left,0!==o&&(t.x+=o,t.set_bbox_changed())),0===this.anch_top?(t.update_bbox(),o=e.viewTop+this.ytop-r.top,0!==o&&(t.y+=o,t.set_bbox_changed())):1===this.anch_top&&(t.update_bbox(),o=e.viewBottom-this.ybottom-r.top,0!==o&&(t.y+=o,t.set_bbox_changed())),1===this.anch_right&&(t.update_bbox(),o=e.viewRight-this.rdiff-r.right,0!==o&&(t.width+=o,0>t.width&&(t.width=0),t.set_bbox_changed())),1===this.anch_bottom&&(t.update_bbox(),o=e.viewBottom-this.bdiff-r.bottom,0!==o&&(t.height+=o,0>t.height&&(t.height=0),t.set_bbox_changed()))}};t.cnds=new function(){};e.prototype.SetEnabled=function(t){this.enabled&&0===t?this.enabled=!1:!this.enabled&&0!=t&&(this.inst.update_bbox(),this.xleft=this.inst.bbox.left,this.ytop=this.inst.bbox.top,this.xright=this.runtime.original_width-this.inst.bbox.left,this.ybottom=this.runtime.original_height-this.inst.bbox.top,this.rdiff=this.runtime.original_width-this.inst.bbox.right,this.bdiff=this.runtime.original_height-this.inst.bbox.bottom,this.enabled=!0)},t.acts=new e;t.exps=new function(){}}();cr.behaviors.DragnDrop=function(e){this.runtime=e;var t=this;this.runtime.isDomFree||(jQuery(document).mousemove(function(e){t.onMouseMove(e)}),jQuery(document).mousedown(function(e){t.onMouseDown(e)}),jQuery(document).mouseup(function(e){t.onMouseUp(e)}));var r=0<this.runtime.fullscreen_mode?document:this.runtime.canvas;this.runtime.isDirectCanvas?r=window.Canvas:this.runtime.isCocoonJs&&(r=window),"undefined"==typeof PointerEvent?window.navigator.msPointerEnabled?(r.addEventListener("MSPointerDown",function(e){t.onPointerStart(e)},!1),r.addEventListener("MSPointerMove",function(e){t.onPointerMove(e)},!1),r.addEventListener("MSPointerUp",function(e){t.onPointerEnd(e)},!1),r.addEventListener("MSPointerCancel",function(e){t.onPointerEnd(e)},!1)):(r.addEventListener("touchstart",function(e){t.onTouchStart(e)},!1),r.addEventListener("touchmove",function(e){t.onTouchMove(e)},!1),r.addEventListener("touchend",function(e){t.onTouchEnd(e)},!1),r.addEventListener("touchcancel",function(e){t.onTouchEnd(e)},!1)):(r.addEventListener("pointerdown",function(e){t.onPointerStart(e)},!1),r.addEventListener("pointermove",function(e){t.onPointerMove(e)},!1),r.addEventListener("pointerup",function(e){t.onPointerEnd(e)},!1),r.addEventListener("pointercancel",function(e){t.onPointerEnd(e)},!1))},function(){function e(e){var t,r;for(t=0,r=e.behavior_insts.length;t<r;t++)if(e.behavior_insts[t]instanceof n.Instance)return e.behavior_insts[t];return null}function t(){}function r(){}var n=cr.behaviors.DragnDrop.prototype,o={left:0,top:0};n.onMouseDown=function(e){1!==e.which||this.onInputDown("leftmouse",e.pageX,e.pageY)},n.onMouseMove=function(e){1!==e.which||this.onInputMove("leftmouse",e.pageX,e.pageY)},n.onMouseUp=function(e){1!==e.which||this.onInputUp("leftmouse")},n.onTouchStart=function(e){e.preventDefault&&cr.isCanvasInputEvent(e)&&e.preventDefault();var r,n,o,a;for(r=0,n=e.changedTouches.length;r<n;r++)o=e.changedTouches[r],a=o.identifier,this.onInputDown(a?a.toString():"<none>",o.pageX,o.pageY)},n.onTouchMove=function(e){e.preventDefault&&e.preventDefault();var r,n,o,a;for(r=0,n=e.changedTouches.length;r<n;r++)o=e.changedTouches[r],a=o.identifier,this.onInputMove(a?a.toString():"<none>",o.pageX,o.pageY)},n.onTouchEnd=function(e){e.preventDefault&&cr.isCanvasInputEvent(e)&&e.preventDefault();var r,n,o,a;for(r=0,n=e.changedTouches.length;r<n;r++)o=e.changedTouches[r],a=o.identifier,this.onInputUp(a?a.toString():"<none>")},n.onPointerStart=function(e){e.pointerType===e.MSPOINTER_TYPE_MOUSE||"mouse"===e.pointerType||(e.preventDefault&&cr.isCanvasInputEvent(e)&&e.preventDefault(),this.onInputDown(e.pointerId.toString(),e.pageX,e.pageY))},n.onPointerMove=function(e){e.pointerType===e.MSPOINTER_TYPE_MOUSE||"mouse"===e.pointerType||(e.preventDefault&&e.preventDefault(),this.onInputMove(e.pointerId.toString(),e.pageX,e.pageY))},n.onPointerEnd=function(e){e.pointerType===e.MSPOINTER_TYPE_MOUSE||"mouse"===e.pointerType||(e.preventDefault&&cr.isCanvasInputEvent(e)&&e.preventDefault(),this.onInputUp(e.pointerId.toString()))},n.onInputDown=function(t,r,n){var a=this.runtime.isDomFree?o:jQuery(this.runtime.canvas).offset(),s=r-a.left,l=n-a.top,p=this.my_instances.valuesRef(),d=null,c,u,g,y,m,_,h,f;for(m=0,_=p.length;m<_;m++)if(f=p[m],h=e(f),h.enabled&&!h.dragging&&(c=f.layer.canvasToLayer(s,l,!0),u=f.layer.canvasToLayer(s,l,!1),(f.update_bbox(),f.contains_pt(c,u)))){if(!d){d=f,g=c,y=u;continue}if(f.layer.index>d.layer.index){d=f,g=c,y=u;continue}if(f.layer.index===d.layer.index&&f.get_zindex()>d.get_zindex()){d=f,g=c,y=u;continue}}d&&e(d).onDown(t,g,y)},n.onInputMove=function(t,r,n){var a=this.runtime.isDomFree?o:jQuery(this.runtime.canvas).offset(),s=r-a.left,l=n-a.top,p=this.my_instances.valuesRef(),d,c,u,g,y,m;for(u=0,g=p.length;u<g;u++)m=p[u],y=e(m),y.enabled&&y.dragging&&(!y.dragging||y.dragsource===t)&&(d=m.layer.canvasToLayer(s,l,!0),c=m.layer.canvasToLayer(s,l,!1),y.onMove(d,c))},n.onInputUp=function(t){var r=this.my_instances.valuesRef(),n,o,a,s;for(n=0,o=r.length;n<o;n++)s=r[n],a=e(s),a.dragging&&a.dragsource===t&&a.onUp()},n.Type=function(e,t){this.behavior=e,this.objtype=t,this.runtime=e.runtime};var a=n.Type.prototype;a.onCreate=function(){},n.Instance=function(e,t){this.type=e,this.behavior=e.behavior,this.inst=t,this.runtime=e.runtime};var i=n.Instance.prototype;i.onCreate=function(){this.dragging=!1,this.dx=0,this.dy=0,this.dragsource="<none>",this.axes=this.properties[0],this.enabled=0!==this.properties[1]},i.saveToJSON=function(){return{enabled:this.enabled}},i.loadFromJSON=function(e){this.enabled=e.enabled,this.dragging=!1},i.onDown=function(e,t,r){this.dx=t-this.inst.x,this.dy=r-this.inst.y,this.dragging=!0,this.dragsource=e,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.behaviors.DragnDrop.prototype.cnds.OnDragStart,this.inst),this.runtime.isInUserInputEvent=!1},i.onMove=function(e,t){var r=e-this.dx,n=t-this.dy;0===this.axes?(this.inst.x!==r||this.inst.y!==n)&&(this.inst.x=r,this.inst.y=n,this.inst.set_bbox_changed()):1===this.axes?this.inst.x!==r&&(this.inst.x=r,this.inst.set_bbox_changed()):2===this.axes&&this.inst.y!==n&&(this.inst.y=n,this.inst.set_bbox_changed())},i.onUp=function(){this.dragging=!1,this.runtime.isInUserInputEvent=!0,this.runtime.trigger(cr.behaviors.DragnDrop.prototype.cnds.OnDrop,this.inst),this.runtime.isInUserInputEvent=!1},i.tick=function(){};t.prototype.IsDragging=function(){return this.dragging},t.prototype.OnDragStart=function(){return!0},t.prototype.OnDrop=function(){return!0},t.prototype.IsEnabled=function(){return!!this.enabled},n.cnds=new t;r.prototype.SetEnabled=function(e){this.enabled=0!==e,this.enabled||(this.dragging=!1)},r.prototype.Drop=function(){this.dragging&&this.onUp()},n.acts=new r;n.exps=new function(){}}();cr.behaviors.Fade=function(e){this.runtime=e},function(){function e(){}function t(){}function r(){}var n=cr.behaviors.Fade.prototype;n.Type=function(e,t){this.behavior=e,this.objtype=t,this.runtime=e.runtime};var o=n.Type.prototype;o.onCreate=function(){},n.Instance=function(e,t){this.type=e,this.behavior=e.behavior,this.inst=t,this.runtime=e.runtime};var a=n.Instance.prototype;a.onCreate=function(){this.activeAtStart=1===this.properties[0],this.setMaxOpacity=!1,this.fadeInTime=this.properties[1],this.waitTime=this.properties[2],this.fadeOutTime=this.properties[3],this.destroy=this.properties[4],this.stage=this.activeAtStart?0:3,this.recycled?this.stageTime.reset():this.stageTime=new cr.KahanAdder,this.maxOpacity=this.inst.opacity?this.inst.opacity:1,this.activeAtStart&&(0===this.fadeInTime?(this.stage=1,0===this.waitTime&&(this.stage=2)):(this.inst.opacity=0,this.runtime.redraw=!0))},a.saveToJSON=function(){return{fit:this.fadeInTime,wt:this.waitTime,fot:this.fadeOutTime,s:this.stage,st:this.stageTime.sum,mo:this.maxOpacity}},a.loadFromJSON=function(e){this.fadeInTime=e.fit,this.waitTime=e.wt,this.fadeOutTime=e.fot,this.stage=e.s,this.stageTime.reset(),this.stageTime.sum=e.st,this.maxOpacity=e.mo},a.tick=function(){this.stageTime.add(this.runtime.getDt(this.inst)),0===this.stage&&(this.inst.opacity=this.stageTime.sum/this.fadeInTime*this.maxOpacity,this.runtime.redraw=!0,this.inst.opacity>=this.maxOpacity&&(this.inst.opacity=this.maxOpacity,this.stage=1,this.stageTime.reset(),this.runtime.trigger(cr.behaviors.Fade.prototype.cnds.OnFadeInEnd,this.inst))),1===this.stage&&this.stageTime.sum>=this.waitTime&&(this.stage=2,this.stageTime.reset(),this.runtime.trigger(cr.behaviors.Fade.prototype.cnds.OnWaitEnd,this.inst)),2===this.stage&&0!==this.fadeOutTime&&(this.inst.opacity=this.maxOpacity-this.stageTime.sum/this.fadeOutTime*this.maxOpacity,this.runtime.redraw=!0,0>this.inst.opacity&&(this.inst.opacity=0,this.stage=3,this.stageTime.reset(),this.runtime.trigger(cr.behaviors.Fade.prototype.cnds.OnFadeOutEnd,this.inst),1===this.destroy&&this.runtime.DestroyInstance(this.inst)))},a.doStart=function(){this.stage=0,this.stageTime.reset(),0===this.fadeInTime?(this.stage=1,0===this.waitTime&&(this.stage=2)):(this.inst.opacity=0,this.runtime.redraw=!0)};e.prototype.OnFadeOutEnd=function(){return!0},e.prototype.OnFadeInEnd=function(){return!0},e.prototype.OnWaitEnd=function(){return!0},n.cnds=new e;t.prototype.StartFade=function(){this.activeAtStart||this.setMaxOpacity||(this.maxOpacity=this.inst.opacity?this.inst.opacity:1,this.setMaxOpacity=!0),3===this.stage&&this.doStart()},t.prototype.RestartFade=function(){this.doStart()},t.prototype.SetFadeInTime=function(e){0>e&&(e=0),this.fadeInTime=e},t.prototype.SetWaitTime=function(e){0>e&&(e=0),this.waitTime=e},t.prototype.SetFadeOutTime=function(e){0>e&&(e=0),this.fadeOutTime=e},n.acts=new t;r.prototype.FadeInTime=function(e){e.set_float(this.fadeInTime)},r.prototype.WaitTime=function(e){e.set_float(this.waitTime)},r.prototype.FadeOutTime=function(e){e.set_float(this.fadeOutTime)},n.exps=new r}();cr.behaviors.Flash=function(e){this.runtime=e},function(){function e(){}function t(){}var r=cr.behaviors.Flash.prototype;r.Type=function(e,t){this.behavior=e,this.objtype=t,this.runtime=e.runtime};var n=r.Type.prototype;n.onCreate=function(){},r.Instance=function(e,t){this.type=e,this.behavior=e.behavior,this.inst=t,this.runtime=e.runtime};var o=r.Instance.prototype;o.onCreate=function(){this.ontime=0,this.offtime=0,this.stage=0,this.stagetimeleft=0,this.timeleft=0},o.saveToJSON=function(){return{ontime:this.ontime,offtime:this.offtime,stage:this.stage,stagetimeleft:this.stagetimeleft,timeleft:this.timeleft}},o.loadFromJSON=function(e){this.ontime=e.ontime,this.offtime=e.offtime,this.stage=e.stage,this.stagetimeleft=e.stagetimeleft,this.timeleft=e.timeleft,null===this.timeleft&&(this.timeleft=1/0)},o.tick=function(){if(!(0>=this.timeleft)){var e=this.runtime.getDt(this.inst);return this.timeleft-=e,0>=this.timeleft?(this.timeleft=0,this.inst.visible=!0,this.runtime.redraw=!0,void this.runtime.trigger(cr.behaviors.Flash.prototype.cnds.OnFlashEnded,this.inst)):void(this.stagetimeleft-=e,0>=this.stagetimeleft&&(0===this.stage?(this.inst.visible=!1,this.stage=1,this.stagetimeleft+=this.offtime):(this.inst.visible=!0,this.stage=0,this.stagetimeleft+=this.ontime),this.runtime.redraw=!0))}};e.prototype.IsFlashing=function(){return 0<this.timeleft},e.prototype.OnFlashEnded=function(){return!0},r.cnds=new e;t.prototype.Flash=function(e,t,r){this.ontime=e,this.offtime=t,this.stage=1,this.stagetimeleft=t,this.timeleft=r,this.inst.visible=!1,this.runtime.redraw=!0},t.prototype.StopFlashing=function(){return this.timeleft=0,this.inst.visible=!0,void(this.runtime.redraw=!0)},r.acts=new t;r.exps=new function(){}}();cr.behaviors.NoSave=function(e){this.runtime=e},function(){var e=cr.behaviors.NoSave.prototype;e.Type=function(e,t){this.behavior=e,this.objtype=t,this.runtime=e.runtime};var t=e.Type.prototype;t.onCreate=function(){},e.Instance=function(e,t){this.type=e,this.behavior=e.behavior,this.inst=t,this.runtime=e.runtime};var r=e.Instance.prototype;r.onCreate=function(){this.myProperty=this.properties[0]},r.onDestroy=function(){},r.tick=function(){this.runtime.getDt(this.inst)};e.cnds=new function(){};e.acts=new function(){};e.exps=new function(){}}();cr.behaviors.Sin=function(e){this.runtime=e},function(){function e(){}function t(){}function r(){}var n=cr.behaviors.Sin.prototype;n.Type=function(e,t){this.behavior=e,this.objtype=t,this.runtime=e.runtime};var o=n.Type.prototype;o.onCreate=function(){},n.Instance=function(e,t){this.type=e,this.behavior=e.behavior,this.inst=t,this.runtime=e.runtime,this.i=0};var a=n.Instance.prototype,i=2*Math.PI,s=Math.PI/2,l=3*Math.PI/2;a.onCreate=function(){this.active=1===this.properties[0],this.movement=this.properties[1],this.wave=this.properties[2],this.period=this.properties[3],this.period+=Math.random()*this.properties[4],0===this.period?this.i=0:(this.i=this.properties[5]/this.period*i,this.i+=Math.random()*this.properties[6]/this.period*i),this.mag=this.properties[7],this.mag+=Math.random()*this.properties[8],this.initialValue=0,this.initialValue2=0,this.ratio=0,5===this.movement&&(this.mag=cr.to_radians(this.mag)),this.init()},a.saveToJSON=function(){return{i:this.i,a:this.active,mv:this.movement,w:this.wave,p:this.period,mag:this.mag,iv:this.initialValue,iv2:this.initialValue2,r:this.ratio,lkv:this.lastKnownValue,lkv2:this.lastKnownValue2}},a.loadFromJSON=function(e){this.i=e.i,this.active=e.a,this.movement=e.mv,this.wave=e.w,this.period=e.p,this.mag=e.mag,this.initialValue=e.iv,this.initialValue2=e.iv2||0,this.ratio=e.r,this.lastKnownValue=e.lkv,this.lastKnownValue2=e.lkv2||0},a.init=function(){switch(this.movement){case 0:this.initialValue=this.inst.x;break;case 1:this.initialValue=this.inst.y;break;case 2:this.initialValue=this.inst.width,this.ratio=this.inst.height/this.inst.width;break;case 3:this.initialValue=this.inst.width;break;case 4:this.initialValue=this.inst.height;break;case 5:this.initialValue=this.inst.angle;break;case 6:this.initialValue=this.inst.opacity;break;case 7:this.initialValue=0;break;case 8:this.initialValue=this.inst.x,this.initialValue2=this.inst.y;break;default:;}this.lastKnownValue=this.initialValue,this.lastKnownValue2=this.initialValue2},a.waveFunc=function(e){switch(e%=i,this.wave){case 0:return Math.sin(e);case 1:return e<=s?e/s:e<=l?1-2*(e-s)/Math.PI:(e-l)/s-1;case 2:return 2*e/i-1;case 3:return-2*e/i+1;case 4:return e<Math.PI?-1:1;}return 0},a.tick=function(){var e=this.runtime.getDt(this.inst);this.active&&0!==e&&(0===this.period?this.i=0:(this.i+=e/this.period*i,this.i%=i),this.updateFromPhase())},a.updateFromPhase=function(){switch(this.movement){case 0:this.inst.x!==this.lastKnownValue&&(this.initialValue+=this.inst.x-this.lastKnownValue),this.inst.x=this.initialValue+this.waveFunc(this.i)*this.mag,this.lastKnownValue=this.inst.x;break;case 1:this.inst.y!==this.lastKnownValue&&(this.initialValue+=this.inst.y-this.lastKnownValue),this.inst.y=this.initialValue+this.waveFunc(this.i)*this.mag,this.lastKnownValue=this.inst.y;break;case 2:this.inst.width=this.initialValue+this.waveFunc(this.i)*this.mag,this.inst.height=this.inst.width*this.ratio;break;case 3:this.inst.width=this.initialValue+this.waveFunc(this.i)*this.mag;break;case 4:this.inst.height=this.initialValue+this.waveFunc(this.i)*this.mag;break;case 5:this.inst.angle!==this.lastKnownValue&&(this.initialValue=cr.clamp_angle(this.initialValue+(this.inst.angle-this.lastKnownValue))),this.inst.angle=cr.clamp_angle(this.initialValue+this.waveFunc(this.i)*this.mag),this.lastKnownValue=this.inst.angle;break;case 6:this.inst.opacity=this.initialValue+this.waveFunc(this.i)*this.mag/100,0>this.inst.opacity?this.inst.opacity=0:1<this.inst.opacity&&(this.inst.opacity=1);break;case 8:this.inst.x!==this.lastKnownValue&&(this.initialValue+=this.inst.x-this.lastKnownValue),this.inst.y!==this.lastKnownValue2&&(this.initialValue2+=this.inst.y-this.lastKnownValue2),this.inst.x=this.initialValue+Math.cos(this.inst.angle)*this.waveFunc(this.i)*this.mag,this.inst.y=this.initialValue2+Math.sin(this.inst.angle)*this.waveFunc(this.i)*this.mag,this.lastKnownValue=this.inst.x,this.lastKnownValue2=this.inst.y;}this.inst.set_bbox_changed()},a.onSpriteFrameChanged=function(e,t){switch(this.movement){case 2:this.initialValue*=t.width/e.width,this.ratio=t.height/t.width;break;case 3:this.initialValue*=t.width/e.width;break;case 4:this.initialValue*=t.height/e.height;}};e.prototype.IsActive=function(){return this.active},e.prototype.CompareMovement=function(e){return this.movement===e},e.prototype.ComparePeriod=function(e,t){return cr.do_cmp(this.period,e,t)},e.prototype.CompareMagnitude=function(e,t){return 5===this.movement?cr.do_cmp(this.mag,e,cr.to_radians(t)):cr.do_cmp(this.mag,e,t)},e.prototype.CompareWave=function(e){return this.wave===e},n.cnds=new e;t.prototype.SetActive=function(e){this.active=1===e},t.prototype.SetPeriod=function(e){this.period=e},t.prototype.SetMagnitude=function(e){this.mag=e,5===this.movement&&(this.mag=cr.to_radians(this.mag))},t.prototype.SetMovement=function(e){5===this.movement&&5!==e&&(this.mag=cr.to_degrees(this.mag)),this.movement=e,this.init()},t.prototype.SetWave=function(e){this.wave=e},t.prototype.SetPhase=function(e){this.i=e*i%i,this.updateFromPhase()},t.prototype.UpdateInitialState=function(){this.init()},n.acts=new t;r.prototype.CyclePosition=function(e){e.set_float(this.i/i)},r.prototype.Period=function(e){e.set_float(this.period)},r.prototype.Magnitude=function(e){5===this.movement?e.set_float(cr.to_degrees(this.mag)):e.set_float(this.mag)},r.prototype.Value=function(e){e.set_float(this.waveFunc(this.i)*this.mag)},n.exps=new r}(),cr.getObjectRefTable=function(){return[cr.plugins_.AMG_VKbridge,cr.plugins_.Audio,cr.plugins_.Arr,cr.plugins_.Browser,cr.plugins_.Dictionary,cr.plugins_.Function,cr.plugins_.Button,cr.plugins_.List,cr.plugins_.Particles,cr.plugins_.LocalStorage,cr.plugins_.Keyboard,cr.plugins_.Text,cr.plugins_.Touch,cr.plugins_.Spritefont2,cr.plugins_.TiledBg,cr.plugins_.TextBox,cr.plugins_.Sprite,cr.behaviors.Flash,cr.behaviors.Sin,cr.behaviors.Fade,cr.behaviors.NoSave,cr.behaviors.DragnDrop,cr.behaviors.Anchor,cr.system_object.prototype.cnds.OnLayoutStart,cr.plugins_.Dictionary.prototype.acts.SetInstanceVar,cr.system_object.prototype.cnds.CompareVar,cr.plugins_.Function.prototype.acts.CallFunction,cr.plugins_.Dictionary.prototype.cnds.CompareInstanceVar,cr.plugins_.Sprite.prototype.acts.SetAnimFrame,cr.plugins_.Text.prototype.acts.SetText,cr.plugins_.Dictionary.prototype.acts.AddInstanceVar,cr.system_object.prototype.acts.Signal,cr.system_object.prototype.cnds.IsGroupActive,cr.plugins_.Function.prototype.cnds.OnFunction,cr.system_object.prototype.acts.SetVar,cr.system_object.prototype.cnds.Compare,cr.plugins_.Sprite.prototype.exps.Count,cr.system_object.prototype.acts.AddVar,cr.system_object.prototype.exps.int,cr.system_object.prototype.exps.tokenat,cr.system_object.prototype.exps.floor,cr.system_object.prototype.exps.random,cr.system_object.prototype.exps.tokencount,cr.plugins_.Sprite.prototype.acts.SetBoolInstanceVar,cr.system_object.prototype.cnds.ForEach,cr.plugins_.Sprite.prototype.acts.SetInstanceVar,cr.system_object.prototype.acts.Wait,cr.system_object.prototype.acts.SetGroupActive,cr.plugins_.Particles.prototype.acts.MoveToLayer,cr.system_object.prototype.acts.SetLayerVisible,cr.plugins_.Sprite.prototype.acts.MoveToLayer,cr.system_object.prototype.cnds.LayerCmpOpacity,cr.system_object.prototype.acts.SetLayerOpacity,cr.system_object.prototype.exps.layeropacity,cr.plugins_.Text.prototype.exps.Text,cr.plugins_.Sprite.prototype.acts.Destroy,cr.system_object.prototype.cnds.EveryTick,cr.plugins_.Sprite.prototype.cnds.IsBoolInstanceVarSet,cr.plugins_.Dictionary.prototype.acts.SubInstanceVar,cr.plugins_.Sprite.prototype.exps.X,cr.plugins_.Sprite.prototype.exps.Y,cr.plugins_.Sprite.prototype.cnds.PickByUID,cr.plugins_.Function.prototype.exps.ReturnValue,cr.plugins_.Sprite.prototype.acts.SetPosToObject,cr.behaviors.DragnDrop.prototype.acts.SetEnabled,cr.plugins_.Sprite.prototype.acts.Spawn,cr.plugins_.Sprite.prototype.exps.LayerName,cr.plugins_.Sprite.prototype.acts.ZMoveToObject,cr.system_object.prototype.acts.CreateObject,cr.plugins_.Sprite.prototype.acts.SetAnim,cr.plugins_.Sprite.prototype.acts.SetPos,cr.system_object.prototype.exps.lerp,cr.system_object.prototype.exps.round,cr.plugins_.Sprite.prototype.acts.SetSize,cr.plugins_.Sprite.prototype.exps.Width,cr.plugins_.Sprite.prototype.exps.Height,cr.plugins_.Sprite.prototype.acts.SetOpacity,cr.plugins_.Sprite.prototype.exps.Opacity,cr.plugins_.Sprite.prototype.cnds.CompareOpacity,cr.system_object.prototype.cnds.TriggerOnce,cr.plugins_.Touch.prototype.cnds.OnTouchObject,cr.plugins_.AMG_VKbridge.prototype.cnds.OnRewardShown,cr.system_object.prototype.cnds.LayerVisible,cr.plugins_.Text.prototype.exps.LayerName,cr.system_object.prototype.cnds.IsPreview,cr.plugins_.Browser.prototype.exps.ExecJS,cr.plugins_.Text.prototype.acts.MoveToLayer,cr.plugins_.Text.prototype.acts.SetOpacity,cr.plugins_.Sprite.prototype.acts.SetVisible,cr.plugins_.Text.prototype.acts.SetVisible,cr.plugins_.TiledBg.prototype.acts.SetVisible,cr.plugins_.Arr.prototype.cnds.ArrForEach,cr.plugins_.Arr.prototype.acts.SetXY,cr.plugins_.Arr.prototype.exps.CurX,cr.plugins_.Arr.prototype.exps.CurY,cr.plugins_.Sprite.prototype.exps.ImagePointX,cr.plugins_.Sprite.prototype.exps.ImagePointY,cr.system_object.prototype.acts.RestartLayout,cr.system_object.prototype.acts.GoToLayoutByName,cr.behaviors.DragnDrop.prototype.cnds.OnDrop,cr.system_object.prototype.exps.distance,cr.plugins_.Sprite.prototype.cnds.OnCreated,cr.plugins_.Sprite.prototype.cnds.IsVisible,cr.system_object.prototype.acts.SetCanvasSize,cr.system_object.prototype.exps.layoutwidth,cr.system_object.prototype.exps.layoutheight,cr.plugins_.Text.prototype.acts.SetWebFont,cr.system_object.prototype.acts.Scroll,cr.system_object.prototype.acts.WaitForSignal,cr.plugins_.Browser.prototype.cnds.SupportsFullscreen,cr.plugins_.Spritefont2.prototype.acts.SetText,cr.plugins_.Spritefont2.prototype.cnds.OnCreated,cr.plugins_.Spritefont2.prototype.acts.SetSize,cr.plugins_.Spritefont2.prototype.acts.SetCharacterWidth,cr.system_object.prototype.cnds.For,cr.plugins_.Arr.prototype.exps.Height,cr.plugins_.Arr.prototype.exps.At,cr.system_object.prototype.exps.loopindex,cr.plugins_.Spritefont2.prototype.cnds.IsOnScreen,cr.plugins_.Spritefont2.prototype.acts.SetScale,cr.plugins_.Spritefont2.prototype.exps.CharacterScale,cr.system_object.prototype.exps.dt,cr.plugins_.Spritefont2.prototype.acts.SetOpacity,cr.plugins_.Spritefont2.prototype.exps.Opacity,cr.plugins_.Spritefont2.prototype.cnds.CompareOpacity,cr.plugins_.Spritefont2.prototype.acts.Destroy,cr.system_object.prototype.cnds.Repeat,cr.plugins_.Arr.prototype.cnds.CompareXY,cr.plugins_.Function.prototype.exps.Param,cr.plugins_.Sprite.prototype.cnds.CompareFrame,cr.plugins_.Arr.prototype.acts.SetX,cr.plugins_.Arr.prototype.cnds.IsEmpty,cr.plugins_.Arr.prototype.cnds.CompareX,cr.plugins_.Sprite.prototype.cnds.CompareY,cr.plugins_.Sprite.prototype.cnds.CompareX,cr.plugins_.Sprite.prototype.cnds.CompareInstanceVar,cr.plugins_.Arr.prototype.acts.Clear,cr.plugins_.Dictionary.prototype.acts.SetKey,cr.plugins_.Arr.prototype.exps.AsJSON,cr.system_object.prototype.cnds.Every,cr.system_object.prototype.cnds.PickByComparison,cr.plugins_.Sprite.prototype.exps.AnimationName,cr.plugins_.Function.prototype.cnds.CompareParam,cr.system_object.prototype.acts.SetLayerBackground,cr.system_object.prototype.exps.rgb,cr.plugins_.Browser.prototype.acts.GoToURL,cr.system_object.prototype.exps.layoutname,cr.plugins_.Browser.prototype.acts.CancelFullScreen,cr.plugins_.Browser.prototype.acts.RequestFullScreen,cr.plugins_.Sprite.prototype.exps.AnimationFrame,cr.plugins_.Sprite.prototype.acts.StopAnim,cr.plugins_.Sprite.prototype.acts.SetCollisions,cr.system_object.prototype.exps.newline,cr.system_object.prototype.exps.zeropad,cr.system_object.prototype.cnds.Else,cr.system_object.prototype.exps.projectname,cr.system_object.prototype.exps.projectversion,cr.plugins_.Arr.prototype.exps.Width,cr.plugins_.Sprite.prototype.exps.UID,cr.plugins_.Dictionary.prototype.exps.Get,cr.behaviors.Sin.prototype.acts.SetActive,cr.system_object.prototype.exps.wallclocktime,cr.plugins_.AMG_VKbridge.prototype.acts.SaveKey,cr.plugins_.Dictionary.prototype.exps.AsJSON,cr.plugins_.AMG_VKbridge.prototype.cnds.OnSaveKey,cr.system_object.prototype.exps.viewportright,cr.plugins_.Function.prototype.exps.Call,cr.plugins_.Function.prototype.acts.SetReturnValue,cr.system_object.prototype.acts.StopLoop,cr.plugins_.Touch.prototype.cnds.OnTouchStart,cr.plugins_.Touch.prototype.cnds.IsTouchingObject,cr.plugins_.Touch.prototype.exps.X,cr.plugins_.Touch.prototype.exps.Y,cr.plugins_.Sprite.prototype.cnds.CompareWidth,cr.behaviors.DragnDrop.prototype.cnds.OnDragStart,cr.behaviors.Fade.prototype.acts.StartFade,cr.plugins_.Sprite.prototype.acts.SetAngle,cr.plugins_.Sprite.prototype.cnds.OnAnyAnimFinished,cr.plugins_.Audio.prototype.acts.PlayByName,cr.plugins_.Audio.prototype.acts.SetVolume,cr.system_object.prototype.acts.SubVar,cr.plugins_.TiledBg.prototype.acts.SetInstanceVar,cr.system_object.prototype.cnds.While,cr.plugins_.TiledBg.prototype.cnds.CompareHeight,cr.plugins_.TiledBg.prototype.acts.SetHeight,cr.plugins_.Text.prototype.acts.SetFontSize,cr.plugins_.Particles.prototype.acts.SetAngle,cr.behaviors.Flash.prototype.acts.Flash,cr.plugins_.Arr.prototype.acts.JSONLoad,cr.plugins_.Button.prototype.cnds.OnClicked,cr.plugins_.Button.prototype.cnds.CompareInstanceVar,cr.plugins_.TextBox.prototype.cnds.CompareInstanceVar,cr.plugins_.TextBox.prototype.exps.Text,cr.plugins_.Browser.prototype.acts.ExecJs,cr.plugins_.Browser.prototype.acts.Alert,cr.system_object.prototype.cnds.OnLoadFinished,cr.plugins_.Dictionary.prototype.acts.AddKey,cr.plugins_.LocalStorage.prototype.acts.CheckItemExists,cr.plugins_.LocalStorage.prototype.cnds.OnItemSet,cr.plugins_.Text.prototype.cnds.CompareInstanceVar,cr.plugins_.LocalStorage.prototype.cnds.OnItemMissing,cr.plugins_.LocalStorage.prototype.cnds.OnItemExists,cr.plugins_.LocalStorage.prototype.exps.ItemValue,cr.plugins_.LocalStorage.prototype.cnds.OnItemRemoved,cr.plugins_.LocalStorage.prototype.cnds.OnItemGet,cr.plugins_.LocalStorage.prototype.acts.RemoveItem,cr.plugins_.LocalStorage.prototype.acts.GetItem,cr.plugins_.LocalStorage.prototype.acts.SetItem,cr.plugins_.Dictionary.prototype.acts.JSONLoad,cr.plugins_.List.prototype.cnds.CompareInstanceVar,cr.plugins_.List.prototype.exps.ItemCount,cr.plugins_.List.prototype.exps.ItemTextAt,cr.plugins_.List.prototype.acts.Select,cr.plugins_.TextBox.prototype.acts.SetText,cr.plugins_.List.prototype.exps.SelectedText,cr.plugins_.TextBox.prototype.cnds.OnTextChanged,cr.plugins_.TextBox.prototype.cnds.IsBoolInstanceVarSet,cr.system_object.prototype.exps.clamp,cr.plugins_.AMG_VKbridge.prototype.acts.CheckAds,cr.plugins_.AMG_VKbridge.prototype.acts.ShowAdsVideo,cr.system_object.prototype.exps.find,cr.plugins_.AMG_VKbridge.prototype.cnds.OnInterstitialShown,cr.system_object.prototype.cnds.CompareBetween,cr.plugins_.Sprite.prototype.exps.BBoxLeft,cr.plugins_.Sprite.prototype.exps.BBoxBottom,cr.plugins_.AMG_VKbridge.prototype.acts.ShowLider,cr.plugins_.Keyboard.prototype.cnds.OnKey,cr.plugins_.AMG_VKbridge.prototype.cnds.OnInterstitialLoaded,cr.plugins_.AMG_VKbridge.prototype.cnds.OnRewardLoaded,cr.plugins_.Keyboard.prototype.cnds.IsKeyDown,cr.plugins_.Browser.prototype.acts.Reload,cr.plugins_.Browser.prototype.acts.ConsoleLog,cr.system_object.prototype.exps.renderer,cr.system_object.prototype.exps.imagememoryusage,cr.system_object.prototype.cnds.IsMobile,cr.plugins_.AMG_VKbridge.prototype.cnds.OnGetKeys,cr.plugins_.AMG_VKbridge.prototype.exps.getKey,cr.system_object.prototype.exps.trim,cr.plugins_.AMG_VKbridge.prototype.cnds.OnGetKeysErr,cr.plugins_.AMG_VKbridge.prototype.cnds.OnGetKeysFalse,cr.plugins_.AMG_VKbridge.prototype.exps.getLanchProp,cr.plugins_.AMG_VKbridge.prototype.acts.GetLunchParams,cr.plugins_.AMG_VKbridge.prototype.acts.GetKeys,cr.system_object.prototype.exps.loadingprogress,cr.plugins_.Text.prototype.cnds.PickByUID,cr.system_object.prototype.exps.left,cr.plugins_.Text.prototype.exps.Opacity,cr.system_object.prototype.exps.len,cr.plugins_.AMG_VKbridge.prototype.cnds.OnLunchParams]};